<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Java html转pdf 且解决中文不显示问题</title>
    <link href="/2023/04/10/Java-html%E8%BD%ACpdf-%E4%B8%94%E8%A7%A3%E5%86%B3%E4%B8%AD%E6%96%87%E4%B8%8D%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/"/>
    <url>/2023/04/10/Java-html%E8%BD%ACpdf-%E4%B8%94%E8%A7%A3%E5%86%B3%E4%B8%AD%E6%96%87%E4%B8%8D%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p> 记录一下利用freemarker 将html转换pdf的教程</p><p><strong>pom.xml引入包</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.itextpdf/itextpdf --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itextpdf<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>itextpdf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.5.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.itextpdf.tool/xmlworker --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itextpdf.tool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xmlworker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.5.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.xhtmlrenderer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flying-saucer-pdf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>9.1.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf-itext5 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.xhtmlrenderer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flying-saucer-pdf-itext5<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>9.1.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br>        <span class="hljs-comment">&lt;!-- 解决中文字体问题 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itextpdf<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>itext-asian<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.freemarker/freemarker --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.19<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>解决中文不显示问题</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.express.excms.enroll.config;<br><br><span class="hljs-keyword">import</span> com.itextpdf.text.Font;<br><span class="hljs-keyword">import</span> com.itextpdf.text.pdf.BaseFont;<br><span class="hljs-keyword">import</span> com.itextpdf.tool.xml.XMLWorkerFontProvider;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by IntelliJ IDEA.</span><br><span class="hljs-comment"> * User: 贝先 [ Cason mo ]</span><br><span class="hljs-comment"> * Date: 2021/11/12</span><br><span class="hljs-comment"> * Time: 14:46</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsianFontProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">XMLWorkerFontProvider</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Font <span class="hljs-title function_">getFont</span><span class="hljs-params">(String fontname, String encoding, <span class="hljs-type">float</span> size, <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> style)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">BaseFont</span> <span class="hljs-variable">bfChinese</span> <span class="hljs-operator">=</span>BaseFont.createFont( <span class="hljs-string">&quot;STSong-Light&quot;</span>, <span class="hljs-string">&quot;UniGB-UCS2-H&quot;</span>, BaseFont.EMBEDDED);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Font</span>(bfChinese, size, style);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getFont(fontname, encoding, size, style);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>html转pdf</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.express.excms.enroll.utils;<br><br><span class="hljs-keyword">import</span> com.express.excms.enroll.config.AsianFontProvider;<br><span class="hljs-keyword">import</span> com.itextpdf.text.Document;<br><span class="hljs-keyword">import</span> com.itextpdf.text.pdf.PdfWriter;<br><span class="hljs-keyword">import</span> com.itextpdf.tool.xml.XMLWorkerHelper;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by IntelliJ IDEA.</span><br><span class="hljs-comment"> * User: 贝先 [ Cason mo ]</span><br><span class="hljs-comment"> * Date: 2021/10/18</span><br><span class="hljs-comment"> * Time: 10:54</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PDFUtils</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ByteArrayOutputStream pdf文件流</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> htmlContent 通过freemarker生成的html</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteArrayOutputStream <span class="hljs-title function_">htmlToPdf</span><span class="hljs-params">(String htmlContent)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();<br>        <span class="hljs-type">PdfWriter</span> <span class="hljs-variable">pdfWriter</span> <span class="hljs-operator">=</span> PdfWriter.getInstance(document, output);<br>        document.open();<br>        XMLWorkerHelper.getInstance().parseXHtml(pdfWriter,document,<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(htmlContent.getBytes(StandardCharsets.UTF_8)),<span class="hljs-literal">null</span>, StandardCharsets.UTF_8,<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsianFontProvider</span>());<br>        document.close();<br>        <span class="hljs-keyword">return</span> output;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 写入到文件</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> htmlContent 通过freemarker生成的html</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> filePath 要写入的pdf文件地址</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">htmlToPdf</span><span class="hljs-params">(String htmlContent,String filePath)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();<br>        <span class="hljs-type">PdfWriter</span> <span class="hljs-variable">pdfWriter</span> <span class="hljs-operator">=</span> PdfWriter.getInstance(document, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(filePath));<br>        document.open();<br>        XMLWorkerHelper.getInstance().parseXHtml(pdfWriter,document,<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(htmlContent.getBytes(StandardCharsets.UTF_8)),<span class="hljs-literal">null</span>, StandardCharsets.UTF_8,<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsianFontProvider</span>());<br>        document.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>freemarker 解析并获取生成的html</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">        <span class="hljs-meta">@Autowired</span><br>        <span class="hljs-keyword">private</span> Configuration configuration;<br><br><br>......省略<br><br><br><br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">cfg</span> <span class="hljs-operator">=</span> (Configuration) configuration.clone();<br>        cfg.clearTemplateCache();<br>        <span class="hljs-type">Template</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Template</span>(templateInDB.getName(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(未渲染的html), configuration);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> FreeMarkerTemplateUtils.processTemplateIntoString(t, 要渲染的数据);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> PDFUtils.htmlToPdf(html);<br>            <span class="hljs-comment">//获取pdf的base64</span><br>            <span class="hljs-type">byte</span>[] bytes = byteArrayOutputStream.toByteArray();<br>       <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> ResponseResult.defaultFailed(e.getMessage());<br>        &#125;<br>    <br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>效果图</strong></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304101743692.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>设计模式-适配器模式</title>
    <link href="/2023/04/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    <url>/2023/04/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>适配器模式是一种结构型设计模式，它允许将一个现有的类与另一个不兼容的类进行协同工作。适配器模式通过创建一个中间适配器来连接两个不兼容的接口，使它们能够正常地协作。</p><p>适配器模式适用于需要将不兼容的类或接口进行适配的情况。例如，当我们需要将一个旧版 API 系统与新版的客户端进行集成时，可以使用适配器模式将两种不同的接口进行适配。适配器模式的主要优点是可以复用现有的代码，减少代码的修改和重构，从而提高代码的可维护性和可重用性。但是，适配器模式也会增加系统的复杂度，需要额外的适配器类来协调两个不兼容的接口，在设计时需要慎重考虑其使用场景和影响。</p><h3 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h3><p><strong>大概的构思图</strong><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304101732677.png" alt="构思图"></p><p><strong>这是影像数据输出接口</strong>（只输出数据啊 不负责显示！！！）</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IComputerOuputContent</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">toDisplayData</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p> <strong>适配器接口类</strong>（数据转换器接口类）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IVideoAdapter</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">convertData</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>输出数据接口实现类</strong>  电脑</p><p> 一台电脑implements很多接口  比如各种输入接口（键盘输入接口 鼠标输入接口）  输出接口 （显示屏内容输出接口 音频输出接口）</p><p> 当然我这里只实现了影像输出接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IComputerOuputContent</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">toDisplayData</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;给显示器的数据&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p> <strong>适配器类</strong>   就是把电脑给的数据转化为图像的东东</p><p> 因为Computer（电脑）里面的void toDisplayData（）方法是实现了的 是真的有“给显示器的数据”的</p><p> Displayer（显示器）想显示却不能直接显示的内容</p><p> Displayer（显示器）无法直接调用Computer(电脑)的内容所以需要something帮忙转化数据（适配数据）</p><p> adapter（适配器） 应运而生  这个adapter是可以做很多事情的  但是我只实现了IVideoAdapter（影像数据适配（转换）功能） 当然你还可以implements别的功能</p><p> 简单理解   Adapter继承Computer（电脑）的影像数据 实现给IVideoAdapter（数据转换器）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Adapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Computer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVideoAdapter</span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 此处进行适配(数据转换)</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * 改写适配器convertData接口 输出电脑的content显示内容</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">convertData</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 获取Computer给的数据</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-built_in">this</span>.toDisplayData();<br><br>        <span class="hljs-comment">//此处正在努力转换成显示器能接受的数据。。。。。。。</span><br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>显示器类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Displayer</span> &#123;<br><br>    <span class="hljs-keyword">private</span> IVideoAdapter videoAdapter;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 给显示器加个影像数据适配（转换）器</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> videoAdapter</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVideoAdapter</span><span class="hljs-params">(IVideoAdapter videoAdapter)</span> &#123;<br>        <span class="hljs-built_in">this</span>.videoAdapter = videoAdapter;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 显示内容</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">view</span><span class="hljs-params">()</span> &#123;<br>        videoAdapter.convertData();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>main方法测试一下</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 实例化显示器</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">Displayer</span> <span class="hljs-variable">displayer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Displayer</span>();<br>        displayer.setVideoAdapter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Adapter</span>());<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 把数据转换器接入显示器</span><br><span class="hljs-comment">         * 显示器显示内容</span><br><span class="hljs-comment">         */</span><br>        displayer.view();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>输出内容</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304101732921.png" alt="输出执行结果"><br>懒得敲代码的人可以到这里下载<br>[<a href="https://download.csdn.net/download/Mo_0214/12536851]">https://download.csdn.net/download/Mo_0214/12536851]</a></p>]]></content>
    
    
    <categories>
      
      <category>设计模式</category>
      
    </categories>
    
    
    <tags>
      
      <tag>设计模式</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo-PicGo+Github配置图床</title>
    <link href="/2023/04/10/hexo-PicGo-Github%E9%85%8D%E7%BD%AE%E5%9B%BE%E5%BA%8A/"/>
    <url>/2023/04/10/hexo-PicGo-Github%E9%85%8D%E7%BD%AE%E5%9B%BE%E5%BA%8A/</url>
    
    <content type="html"><![CDATA[<p>使用 PicGo 将图片上传到 Github 仓库作为图床，需要进行以下几个步骤：</p><ol><li><p>在 Github 上创建一个公开仓库，用于存放图片。仓库名称可以自定义，建议取一个简单明了的名称，比如 <code>pic-go</code>。</p></li><li><p>在本地安装 PicGo，并在设置中选择 Github 作为上传方式。</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304100345581.png" alt="image-20230410034338520"></p></li><li><p>创建一个 Github token，用于访问 Github 仓库。在 Github 中进入 <code>Settings</code> -&gt; <code>Developer settings</code> -&gt; <code>Personal access tokens</code>，点击 <code>Generate new token</code> 按钮，按照提示填写 token 的名称和权限，并点击 <code>Generate token</code> 按钮生成 token。复制 token 的值，然后在 PicGo 的设置中将其粘贴到 <code>Token</code> 中。</p></li><li><p>上传图片</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304100346131.png" alt="image-20230410034508553">上传完成后，PicGo 会自动将图片的访问链接复制到剪贴板中，可以直接将链接粘贴到需要使用图片的地方。</p></li></ol><p>需要注意的是，Github 有上传文件大小限制，单个文件不能超过 100 MB，总大小不能超过 1 GB。另外，上传的图片会占用 Github 的存储空间，需要根据实际情况进行管理。</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo-优化seo</title>
    <link href="/2023/04/10/Hexo-%E4%BC%98%E5%8C%96seo/"/>
    <url>/2023/04/10/Hexo-%E4%BC%98%E5%8C%96seo/</url>
    
    <content type="html"><![CDATA[<h4 id="Sitemap"><a href="#Sitemap" class="headerlink" title="Sitemap"></a>Sitemap</h4><p>Sitemap是一种包含网站所有页面URL的XML文件，有助于搜索引擎更快地索引和发现您的网站。以下是在Hexo中使用Sitemap优化SEO的步骤：</p><ol><li>安装hexo-generator-sitemap插件。可以使用以下命令进行安装：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">npm install hexo-generator-sitemap --save<br></code></pre></td></tr></table></figure><ol><li>在Hexo配置文件_config.yml中添加以下内容：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sitemap:</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">sitemap.xml</span><br>  <span class="hljs-attr">exclude:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/404.html</span><br>  <span class="hljs-attr">lastmod:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">priority:</span> <span class="hljs-number">0.8</span><br>  <span class="hljs-attr">changefreq:</span> <span class="hljs-string">weekly</span><br></code></pre></td></tr></table></figure><p>其中，<code>path</code>是Sitemap文件的生成路径；<code>exclude</code>是要排除的页面列表；<code>lastmod</code>用于在Sitemap中包含最后修改时间；<code>priority</code>表示页面的重要性，值的范围为0.0到1.0；<code>changefreq</code>表示页面更新频率。</p><ol><li>生成Sitemap。使用以下命令在Hexo中生成Sitemap文件：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo generate --deploy<br></code></pre></td></tr></table></figure><p>这将生成Sitemap文件并将其部署到您的网站目录下。</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304100235786.png" alt="image-20230410022647919"></p><ol><li>提交Sitemap到搜索引擎。将Sitemap文件提交到Google Search Console和Bing Webmaster Tools等搜索引擎工具中，以帮助搜索引擎更快地发现和索引您的网站。</li></ol><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304100224631.png" alt="image-20230410022410719"></p><p>通过使用Sitemap，您可以确保搜索引擎可以找到您的网站的所有页面，并更好地理解您网站的结构和内容，从而提高您的网站在搜索结果中的排名。</p><h4 id="Robots-txt"><a href="#Robots-txt" class="headerlink" title="Robots.txt"></a>Robots.txt</h4><p>Robots 文件是一个文本文件，用于向搜索引擎指示哪些页面可以访问和索引，哪些页面应该被忽略。通过优化 Robots 文件，可以提高您的网站在搜索引擎中的排名和曝光度。</p><p>在 Hexo 中使用 Robots 文件进行 SEO 优化，可以按照以下步骤操作：</p><ol><li>在 Hexo 根目录下创建一个名为 <code>robots.txt</code> 的文件。</li><li>打开 <code>robots.txt</code> 文件，输入以下内容：</li></ol><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile">makefileCopy code<br><span class="hljs-section">User-agent: *</span><br><span class="hljs-section">Disallow:</span><br></code></pre></td></tr></table></figure><p>其中，<code>User-agent: *</code> 表示允许所有搜索引擎访问您的网站，<code>Disallow:</code> 表示允许搜索引擎访问您的网站中所有页面和文件。</p><ol><li>如果您需要禁止某些搜索引擎访问您的网站，请添加以下内容：</li></ol><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">makefileCopy</span> <span class="hljs-selector-tag">code</span><br><span class="hljs-selector-tag">User-agent</span>: <span class="hljs-selector-attr">[搜索引擎名称]</span><br><span class="hljs-selector-tag">Disallow</span>: /<br></code></pre></td></tr></table></figure><p>其中，<code>[搜索引擎名称]</code> 表示您要禁止访问的搜索引擎名称，<code>Disallow: /</code> 表示禁止该搜索引擎访问您的网站中所有页面和文件。</p><p>例如，如果您想禁止 Google 访问您的网站，可以将以下内容添加到 <code>robots.txt</code> 文件中：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile">makefileCopy code<br><span class="hljs-section">User-agent: Googlebot</span><br><span class="hljs-section">Disallow: /</span><br></code></pre></td></tr></table></figure><ol><li>保存并上传 <code>robots.txt</code> 文件到您的网站根目录下。</li><li>使用 Google Search Console 的 Robots.txt 检查工具，检查您的 Robots 文件是否存在问题，并且是否被正确解析。</li></ol><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304100227739.png" alt="image-20230410022631870"></p><p>注意：Robots 文件可以帮助您优化 SEO，但是也需要谨慎使用。请确保您了解 Robots 文件的规则和用法，以避免出现意外的问题。</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysql索引</title>
    <link href="/2023/04/10/Mysql%E7%B4%A2%E5%BC%95/"/>
    <url>/2023/04/10/Mysql%E7%B4%A2%E5%BC%95/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Msql锁机制</title>
    <link href="/2023/04/09/Msql%E9%94%81%E6%9C%BA%E5%88%B6/"/>
    <url>/2023/04/09/Msql%E9%94%81%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<p>MySQL锁机制是为了保证并发操作的数据一致性而设计的。在并发环境下，多个事务同时访问同一数据，如果不加控制，就会导致数据的不一致性。</p><p>MySQL的锁可以分为行级锁和表级锁。</p><ol><li><p>行级锁：在对表中的数据进行修改时，MySQL会自动加上行级锁，该锁只针对修改的行有效，其他行不受影响。行级锁的优点是精度高，缺点是占用资源多，容易造成死锁。InnoDB行锁是通过给索引上的索引项加锁 来实现的，没有索引的情况下，InnoDB仍然可以使用行级锁。不过，由于在没有索引的情况下需要扫描整个表，因此会对性能产生较大的影响，同时会将锁定作用于整个表，从而影响并发性能和可伸缩性</p><p>使用行级锁定的主要是 <code>InnoDB</code> 存储引擎。</p></li><li><p>表级锁：在对整个表进行操作时，MySQL会自动加上表级锁，该锁可以防止其他事务修改该表。表级锁的优点是简单高效，缺点是并发度低，容易造成阻塞。</p><p>使用表级锁定的主要是 <code>MyISAM</code>，<code>MEMORY</code>，<code>CSV</code> 等一些非事务性存储引擎。</p></li></ol><h3 id="InnoDB-引擎实现的锁机制"><a href="#InnoDB-引擎实现的锁机制" class="headerlink" title="InnoDB 引擎实现的锁机制"></a>InnoDB 引擎实现的锁机制</h3><h4 id="记录锁（Record-LOCK）"><a href="#记录锁（Record-LOCK）" class="headerlink" title="记录锁（Record LOCK）"></a>记录锁（Record LOCK）</h4><p>记录锁是 InnoDB 存储引擎实现多版本并发控制（MVCC）机制的重要基础，用来保证数据的一致性和并发性。在 MVCC 中，每个事务在执行修改操作时都会为所修改的数据行创建一个新的版本，并且使用记录锁来保护当前事务对该数据行的修改操作。</p><h5 id="共享锁（Shared-Lock）"><a href="#共享锁（Shared-Lock）" class="headerlink" title="共享锁（Shared Lock）"></a>共享锁（Shared Lock）</h5><p>共享锁（S锁）是一种共享锁定，它允许多个事务同时读取一行数据，但防止这些事务对该行数据进行修改，保证数据的一致性和隔离性。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs mysql">-- 加共享锁（S）<br>select * from table_name where ... lock in share mode<br></code></pre></td></tr></table></figure><h5 id="排它锁（Exclusive-Lock）"><a href="#排它锁（Exclusive-Lock）" class="headerlink" title="排它锁（Exclusive Lock）"></a>排它锁（Exclusive Lock）</h5><p>排它锁（X锁）是一种排它锁定，它防止其他事务读取或修改该行数据，保证了数据的独占性。如果一个事务已经持有了一个行的 X 锁，其他的事务就不能再持有该行的任何锁，包括共享锁和排它锁。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- 加排它锁（X)<br>select * from table_name where ... for update<br></code></pre></td></tr></table></figure><h4 id="间隙锁（GAP-LOCK）"><a href="#间隙锁（GAP-LOCK）" class="headerlink" title="间隙锁（GAP LOCK）"></a>间隙锁（GAP LOCK）</h4><p>间隙锁是 InnoDB 存储引擎实现的一种锁机制，它可以在多版本并发控制（MVCC）下防止幻读问题的发生。在 RR 隔离级别下，InnoDB 存储引擎可以使用 MVCC 机制来保证读取的数据的可重复性，并且可以使用间隙锁来避免幻读问题的发生。</p><p>间隙锁是针对索引上的间隙（即索引记录之间的空隙）进行加锁，用来防止其他事务在这些间隙中插入新的数据，从而保证了查询结果的一致性。在 RR 隔离级别下，InnoDB 存储引擎使用间隙锁机制来支持幻读问题的解决。</p><p>举例来说，假如 emp 表中只有 101 条记录，其 empid 的值分别是1, 2, …, 100, 101，下面的SQL：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM emp WHERE empid &gt; 100 FOR UPDATE<br></code></pre></td></tr></table></figure><p>当我们用条件检索数据，并请求共享或排他锁时，InnoDB 不仅会对符合条件的 empid 值为 101 的记录加锁，也会对 empid 大于 101（这些记录并不存在）的 “间隙” 加锁。</p><p>这个时候如果你插入 empid 等于 102 的数据的，如果那边事物还没有提交，那你就会处于等待状态，无法插入数据。</p><p><strong>使用方式</strong></p><ol><li><p>使用 SELECT … FOR UPDATE 语句：可以在 SQL 查询语句中使用 SELECT … FOR UPDATE 语句，该语句会在查询时对索引进行间隙锁定。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM table_name WHERE col BETWEEN 10 AND 20 FOR UPDATE;<br></code></pre></td></tr></table></figure><p>该语句会对 col 列值在 10 和 20 之间的行进行间隙锁定，防止其他事务在该间隙内插入新的数据。</p></li><li><p>使用 SELECT … LOCK IN SHARE MODE 语句：该语句与 SELECT … FOR UPDATE 语句类似，但它会对索引进行共享锁定。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM table_name WHERE col BETWEEN 10 AND 20 LOCK IN SHARE MODE;<br></code></pre></td></tr></table></figure><p>该语句会对 col 列值在 10 和 20 之间的行进行共享锁定，防止其他事务在该间隙内修改数据。</p></li></ol><h4 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h4><p>意向锁是 InnoDB 存储引擎实现的一种锁机制，它用来协调事务对表和分区的锁定。</p><p>意向锁是一种表级别的锁，它可以分为意向共享锁（IS）和意向排它锁（IX）两种类型。意向共享锁（IS）表示一个事务想要对表或分区进行共享锁定，意向排它锁（IX）表示一个事务想要对表或分区进行排它锁定。当一个事务想要对表或分区加锁时，它需要先获取对应的意向锁，以通知其他事务该表或分区的锁定状态。</p><p>在 InnoDB 存储引擎中，一个事务想要对一个数据行加锁时，它需要先获取该数据行所在的表或分区的意向锁，然后再获取该数据行的行级锁。这种方式可以减少锁的竞争，提高系统的并发性能。</p><p>需要注意的是，意向锁并不是用来保证数据一致性的锁，而是用来协调事务对表和分区的锁定，避免锁的冲突和竞争。</p><p>我们可以举个生活中的例子，再来理解下为什么需要存在意向锁。</p><p>打个比方，就像有个游乐场，很多小朋友进去玩，看门大爷如果要下班锁游乐场的门(加表锁)，他必须确保每个角落都要去检查一遍，确保每个小朋友都离开了（释放行锁），才可以锁门。</p><p>假设锁门是件频繁发生的事情，大爷就会非常崩溃。那大爷想了一个办法，每个小朋友进入，就把自己的名字写在本子上，小朋友离开，就把自己的名字划掉，那大爷就能方便掌握有没有小朋友在游乐场里，不必每个角落都去寻找一遍。例子中的“小本子”，就是意向锁，他记录的信息并不精细，他只是提醒大爷，是否有人在屋里。</p><h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>MySQL死锁是指两个或多个事务相互等待对方释放锁资源的状态，导致事务无法继续执行，造成数据库的阻塞。MySQL死锁是一个常见的并发问题，特别是在高并发环境下容易发生。</p><p>MyISAM表锁是deadlock free的，这是因为MyISAM总是一次获得所需的全部锁，要么全部满足，要么等待，因此不会出现死锁。但在InnoDB中，除单个SQL组成的事务外，锁是逐步获得的，这就决定了在InnoDB中发生死锁是可能的。</p><p>造成死锁的原因主要有以下几个：</p><ol><li>竞争资源：多个事务同时竞争同一资源（如行、表等），导致相互等待。</li><li>事务执行顺序不一致：当两个事务在相互等待时，如果它们执行的顺序不一致，就会出现死锁。</li><li>数据库事务隔离级别设置不当：如果事务隔离级别设置过高，可能会导致死锁的发生。</li></ol><p>为了避免MySQL死锁，我们可以采取以下措施：</p><ol><li>减少事务时间：事务执行时间越长，死锁的概率就越大。因此，我们应该尽可能地减少事务的执行时间。</li><li>合理使用索引：合理地使用索引可以减少行级锁的竞争，降低死锁的发生率。</li><li>设置合适的事务隔离级别：在选择事务隔离级别时，应根据业务需求来选择，避免设置过高的隔离级别。</li><li>控制并发度：通过控制并发度，可以降低锁竞争的概率，减少死锁的发生。</li><li>定期优化数据库表结构：定期优化表结构可以降低锁竞争的概率，从而减少死锁的发生。</li><li>在应用中，如果不同的程序会并发存取多个表，应尽量约定以相同的顺序来访问表，这样可以大大降低产生死锁的机会。</li><li>在程序以批量方式处理数据的时候，如果事先对数据排序，保证每个线程按固定的顺序来处理记录，也可以大大降低出现死锁的可能。</li></ol><p>如果出现死锁，通过 MySQL 提供的 SHOW ENGINE INNODB STATUS 命令可以查看当前 MySQL 的锁状态。该命令会输出包含当前所有事务、锁等信息的大量文本，需要找到其中的“LATEST DETECTED DEADLOCK”部分，查看最近发生的死锁信息。</p>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>对dubbo的一些理解和简单使用记录</title>
    <link href="/2023/04/06/%E5%AF%B9dubbo%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3%E5%92%8C%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/04/06/%E5%AF%B9dubbo%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3%E5%92%8C%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>图片和内容总结来自：<a href="https://cn.dubbo.apache.org/zh-cn/overview/what/">Dubbo 介绍 | Apache Dubbo</a></p></blockquote><h4 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h4><p>Dubbo是一款高性能、轻量级的Java RPC框架。它可以用于构建分布式服务架构，简化不同服务之间的远程调用过程。Dubbo支持多种协议和序列化方式，可以轻松地与Spring Boot进行集成。Dubbo提供了服务治理、负载均衡、容错、路由、降级等丰富的特性，可以帮助我们构建健壮的分布式系统。</p><p>在使用Dubbo时，我们可以将服务提供者注册到注册中心，消费者通过注册中心查找到服务提供者的地址，然后进行远程调用。Dubbo提供了多种负载均衡策略，例如随机、轮询、一致性哈希等，可以根据实际场景进行选择。此外，Dubbo还支持容错机制，例如超时、失败重试、熔断等，可以提高系统的可靠性和稳定性。</p><h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304061124551.png" alt="service-discovery"></p><p>服务发现包含提供者、消费者和注册中心三个参与角色，其中，Dubbo 提供者实例注册 URL 地址到注册中心，注册中心负责对数据进行聚合，Dubbo 消费者从注册中心读取地址列表并订阅变更，每当地址列表发生变化，注册中心将最新的列表通知到所有订阅的消费者实例。</p><p>Dubbo 使用 JDK 动态代理或者字节码增强技术，生成一个代理类，该代理类实现了本地接口，具有本地接口的所有方法。在调用本地接口方法时，会通过代理类的 invoke 方法将请求转发到远程服务提供者上，服务提供方接收到请求后，会根据请求中的服务接口名和方法名，找到对应的实现类和方法，并将请求消息反序列化成参数列表，最终调用服务实现类的方法，并将执行结果序列化成响应消息返回给客户端。</p><h4 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h4><ul><li><p>引入依赖</p><p>配置Dubbo相关依赖：在<code>pom.xml</code>文件中添加Dubbo相关依赖，例如<code>dubbo-spring-boot-starter</code>、<code>dubbo</code>等。</p><figure class="highlight dust"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;dubbo.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></code></pre></td></tr></table></figure></li><li><p>服务提供者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProvideService</span> &#123;<br>    String <span class="hljs-title function_">test</span><span class="hljs-params">(String text)</span>;<br>&#125;<br><br><span class="hljs-comment">//实现Dubbo服务接口：编写Dubbo服务接口的实现类</span><br><span class="hljs-meta">@DubboService</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProvideServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ProvideService</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">(String text)</span> &#123;<br>         System.out.println(text);<br>      <span class="hljs-keyword">return</span> text;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在<code>application.properties</code>或<code>application.yml</code>中配置Dubbo服务提供者信息和注册中心地址和协议</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># Dubbo服务提供者配置</span><br><span class="hljs-attr">dubbo.application.name</span>=dubbo-provide<br><span class="hljs-attr">dubbo.registry.protocol</span>=zookeeper<br><span class="hljs-attr">dubbo.protocol.name</span>=dubbo<br><span class="hljs-attr">dubbo.protocol.port</span>=<span class="hljs-number">20880</span><br><span class="hljs-comment"># Dubbo注册中心配置</span><br><span class="hljs-attr">dubbo.registry.address</span>=zookeeper://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">2181</span><br></code></pre></td></tr></table></figure><p>打成jar包发不到maven仓库并启动服务</p></li><li><p>服务消费者</p><p>引入包含ProvideService服务的依赖</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerService</span> &#123;<br>    <span class="hljs-meta">@DubboReference</span><br>    <span class="hljs-keyword">private</span> ProvideService provideService;<br>  <br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">(String text)</span> &#123;<br>         <span class="hljs-keyword">return</span> provideService.test(text)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在<code>application.properties</code>或<code>application.yml</code>中配置Dubbo注册中心地址和协议</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># Dubbo注册中心配置</span><br><span class="hljs-attr">dubbo.registry.protocol</span>=zookeeper<br><span class="hljs-attr">dubbo.registry.address</span>=zookeeper://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">2181</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h4><blockquote><p>为什么使用rpc框架，而不是用http？</p></blockquote><ul><li><p>在异构系统（跨语言和跨平台），HTTP具有更好的兼容性，因为HTTP是一种通用的协议，几乎所有的编程语言和操作系统都支持HTTP协议，因为Dubbo支持更严格的通信协议和类型约束，而不是所有的编程语言和操作系统都支持相同的RPC协议。</p></li><li><p>RPC适合用在企业内部，要求使用同一套注册中心进行服务治理，如果是跨组织，或者跨公司，这种情况只能用更加通用的HTTP进行通信。</p></li><li><p>Dubbo在并发连接数较高时表现更好，因为Dubbo使用长连接和TCP协议，而HTTP协议每次请求都要建立连接，在每次连接的过程中需要额外的时间开销和数据传输量。但是，在低并发量和小数据量的情况下，HTTP的开销相对较小。</p></li></ul><blockquote><p>rpc具有以下优点：</p></blockquote><ul><li><p>性能好：RPC在传输效率上通常比HTTP更高，此外，RPC可以使用更紧凑的数据格式，如Protocol Buffers和Thrift，可以更有效地利用网络带宽和存储空间。</p></li><li><p>安全性：目前，Dubbo等RPC框架主要应用在企业内部之间的系统调用，而内部系统之间调用的话安全性就更有保障一些。</p></li><li><p>调用简单：RCP可以帮我们像调用本地方法一样调用远程代码，而HTTP调用需要拼接Body、Header等等，过于复杂。</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Dubbo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>请求wordpress json api记录</title>
    <link href="/2023/01/28/%E8%AF%B7%E6%B1%82wordpress-json-api%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/01/28/%E8%AF%B7%E6%B1%82wordpress-json-api%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h4 id="第三方平台连接wp-json接口需要借助plugin生成token"><a href="#第三方平台连接wp-json接口需要借助plugin生成token" class="headerlink" title="第三方平台连接wp-json接口需要借助plugin生成token"></a>第三方平台连接wp-json接口需要借助plugin生成token</h4><h5 id="JWT-Authentication-for-WP-API"><a href="#JWT-Authentication-for-WP-API" class="headerlink" title="JWT Authentication for WP-API"></a>JWT Authentication for WP-API</h5><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202301281606338.png" alt="image-20230128151015431"></p><p>不太行 要手动修改apache .htaccess文件</p><h5 id="API-Bearer-Auth"><a href="#API-Bearer-Auth" class="headerlink" title="API Bearer Auth"></a>API Bearer Auth</h5><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202301281606381.png" alt="image-20230128152534220"></p><blockquote><p><a href="https://cn.wordpress.org/plugins/api-bearer-auth/">API Bearer Auth – WordPress 插件 | WordPress.org China 简体中文</a></p></blockquote><ul><li>获取Bearer token</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">curl --location --request POST &#x27;http://localhost/wp-json/api-bearer-auth/v1/login&#x27; \<br>--header &#x27;Content-Type: application/json&#x27; \<br>--data-raw &#x27;&#123;<br>    &quot;username&quot;: &quot;beixian&quot;,<br>    &quot;password&quot;: &quot;123456&quot;,<br>    &quot;client_name&quot;: &quot;dealar&quot;<br>&#125;&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;wp_user&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;ID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_login&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_nicename&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_registered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-04 06:32:18&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_activation_key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;display_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;ID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;caps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;administrator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;cap_key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wp_capabilities&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;roles&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;administrator&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;allcaps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;switch_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;activate_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_options&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;moderate_comments&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_categories&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_links&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;upload_files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;unfiltered_html&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_10&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_9&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_8&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_7&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_5&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;create_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;unfiltered_upload&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_dashboard&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;update_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;install_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;update_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;install_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;update_core&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;list_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;remove_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;promote_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_theme_options&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;export&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_woocommerce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;view_woocommerce_reports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_product&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_product&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_product&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_product_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_product_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_product_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assign_product_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_shop_order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_shop_order_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_order_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_order_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assign_shop_order_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_coupon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_shop_coupon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_coupon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_shop_coupon_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_coupon_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_coupon_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assign_shop_coupon_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;administrator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;access_token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dcc21431b90fd8acac52d934ea1955981b68c27d48ea16dc3bad09d9f0aff6e2&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;expires_in&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">86400</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;refresh_token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8ae0503926687677e6e5237031b1876cecfb81ce7dd982461dee8bd50ca48e97&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>Refresh token</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location --request POST &#x27;http://localhost/wp-json/api-bearer-auth/v1/tokens/refresh&#x27; \<br>--header &#x27;Content-Type: application/json&#x27; \<br>--data-raw &#x27;&#123;&quot;token&quot;: &quot;8ae0503926687677e6e5237031b1876cecfb81ce7dd982461dee8bd50ca48e97&quot;, &quot;client_name&quot;: &quot;dealar&quot;&#125;&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;access_token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;f07dc29c8b001ec143e7d6e6ebd110fb5fb07c078c9cb6e384a7cef5a479f1bf&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;expires_in&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">86400</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="Wordpree-media"><a href="#Wordpree-media" class="headerlink" title="Wordpree media"></a>Wordpree media</h4><p>上传media文件接口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location --request POST &#x27;http://localhost/wp-json/wp/v2/media&#x27; \<br>--header &#x27;content-disposition: attachment; filename=beixian.png&#x27; \<br>--header &#x27;Authorization: Bearer f07dc29c8b001ec143e7d6e6ebd110fb5fb07c078c9cb6e384a7cef5a479f1bf&#x27; \<br>--header &#x27;Content-Type: image/jpeg&#x27; \<br>--data-binary &#x27;@/Users/casonmo/Pictures/Photos Library.photoslibrary/originals/9/9E00792B-5CD0-4233-851B-121320A61618.jpeg&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">36</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-28T07:42:13&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;date_gmt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-28T07:42:13&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;guid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;rendered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian.jpg&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;raw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian.jpg&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;modified&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-28T07:42:13&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;modified_gmt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-28T07:42:13&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;slug&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inherit&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;attachment&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;link&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/beixian/&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;raw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rendered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;comment_status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;open&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ping_status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;closed&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;template&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;permalink_template&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/?attachment_id=36&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;generated_slug&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;raw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rendered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;p class=\&quot;attachment\&quot;&gt;&lt;a href=&#x27;http://localhost/wp-content/uploads/2023/01/beixian.jpg&#x27;&gt;&lt;img width=\&quot;300\&quot; height=\&quot;300\&quot; src=\&quot;http://localhost/wp-content/uploads/2023/01/beixian-300x300.jpg\&quot; class=\&quot;attachment-medium size-medium\&quot; alt=\&quot;\&quot; decoding=\&quot;async\&quot; loading=\&quot;lazy\&quot; srcset=\&quot;http://localhost/wp-content/uploads/2023/01/beixian-300x300.jpg 300w, http://localhost/wp-content/uploads/2023/01/beixian.jpg 1024w, http://localhost/wp-content/uploads/2023/01/beixian-150x150.jpg 150w, http://localhost/wp-content/uploads/2023/01/beixian-768x768.jpg 768w, http://localhost/wp-content/uploads/2023/01/beixian-324x324.jpg 324w, http://localhost/wp-content/uploads/2023/01/beixian-416x416.jpg 416w, http://localhost/wp-content/uploads/2023/01/beixian-100x100.jpg 100w\&quot; sizes=\&quot;(max-width: 300px) 100vw, 300px\&quot; /&gt;&lt;/a&gt;&lt;/p&gt;\n&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;caption&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;raw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rendered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;alt_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;media_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;media_details&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023/01/beixian.jpg&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">66568</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sizes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;medium&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-300x300.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">300</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">300</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14751</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-300x300.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;large&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-1024x1024.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">65430</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-1024x1024.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;thumbnail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-150x150.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6292</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-150x150.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;medium_large&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-768x768.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">768</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">768</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">48019</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-768x768.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;woocommerce_thumbnail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-324x324.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">324</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">324</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16413</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;uncropped&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-324x324.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;woocommerce_single&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-416x416.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">416</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">416</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22105</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-416x416.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;woocommerce_gallery_thumbnail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-100x100.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4004</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-100x100.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;full&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;image_meta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;aperture&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;credit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;camera&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;caption&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;created_timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;copyright&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;focal_length&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;iso&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shutter_speed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;orientation&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;keywords&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;post&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian.jpg&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;missing_image_sizes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;_links&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;self&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/media/36&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;collection&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/media&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;about&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/types/attachment&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;embeddable&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/users/1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;embeddable&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/comments?post=36&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;wp:action-unfiltered-html&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/media/36&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;wp:action-assign-author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/media/36&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;curies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wp&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://api.w.org/&#123;rel&#125;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;templated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>wordpress</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>《mysql是怎样运行的》笔记</title>
    <link href="/2023/01/20/%E3%80%8Amysql%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/01/20/%E3%80%8Amysql%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84%E3%80%8B%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h4 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h4><h5 id="Unix里mysql服务器程序："><a href="#Unix里mysql服务器程序：" class="headerlink" title="Unix里mysql服务器程序："></a>Unix里mysql服务器程序：</h5><p>mysqld:mysql服务器程序</p><p>mysqld_safe: 调用mysqld+监控进程+日志</p><p>mysql.server:启动脚本&#x3D;调用mysqld_safe</p><p> mysql_multi:启动多个mysql服务器程序</p><h5 id="启动客户端"><a href="#启动客户端" class="headerlink" title="启动客户端"></a>启动客户端</h5><p>mysql -h主机名 -u用户名 -p密码 -P端口</p><h5 id="客户端和服务器连接的方法"><a href="#客户端和服务器连接的方法" class="headerlink" title="客户端和服务器连接的方法"></a>客户端和服务器连接的方法</h5><ul><li><p>TCP&#x2F;IP</p><ul><li>采用TCP协议，通过IP地址+端口号进行网络连接</li><li>通过skip-networking禁用</li></ul></li><li><p>命名管道（windows）</p><ul><li>启动服务器程序的命令中加上 –enable-named-pipe</li><li>启动客户端程序的命令中加入 –pipe 或者 –protocol&#x3D;pipe 参数</li></ul></li><li><p>共享内存（windows）</p><ul><li>启动服务器程序的命令中加上 –shared-memory</li><li>在启动客户端程序的命令中加入 –protocol&#x3D;memory </li><li>使用 共享内存 的方式进行通信的服务器进程和客户端进程必须在同一台 Windows 主机中</li></ul></li><li><p><strong>Unix</strong>域套接字文件（unix）</p><ul><li><p>启动客户端程序的时候指定的主机名为 localhost ，或者指定了 –protocol&#x3D;socket 的启动参数</p></li><li><p>MySQL 服务器程序默认监听的 Unix 域套接字文件路径为 &#x2F;tmp&#x2F;mysql.sock ,通过mysqld –socket&#x3D;&#x2F;tmp&#x2F;a.txt修改套接字文件路径</p></li><li><p>客户端程序显式连接到unix域套接字路径 mysql -hlocalhost -uroot –socket&#x3D;&#x2F;tmp&#x2F;a.txt -p</p></li></ul></li></ul><h4 id="服务器处理客户端请求"><a href="#服务器处理客户端请求" class="headerlink" title="服务器处理客户端请求"></a>服务器处理客户端请求</h4><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091807683.png" alt="image-20230120113343299"></p><h5 id="连接管理"><a href="#连接管理" class="headerlink" title="连接管理"></a>连接管理</h5><p>为了避免频繁创建和销毁进程，服务器不会立即删除刚退出的客户端连接线程，缓存起来，分配给下一个新连接进来的客户端。连接建立后，对应客户端的服务器进程会持续监控客户端发送的请求</p><h5 id="解析与优化"><a href="#解析与优化" class="headerlink" title="解析与优化"></a>解析与优化</h5><ul><li><p>查询缓存 </p><blockquote><p>缓冲sql请求，并在不同客户端之间共享</p><p>无法命中：任意字符不同，查询请求中包含某些系统函数、用户自定义变量和函数、一些系统表</p><p>失效：INSERT 、 UPDATE 、 DELETE 、 TRUNCATE TABLE 、 ALTER TABLE 、 DROP TABLE 、DROP DATABASE 语句</p></blockquote></li><li><p>语法解析</p><blockquote><p>是一个编译过程，涉及词法解析、语法分析、语义分析等阶段</p><p>提取查询信息到 MySQL 服务器内部使用的一些数据结构</p></blockquote></li><li><p>查询优化</p><blockquote><p>优化sql，生成执行计划，EXPLAIN 语句来查看某个语句的执行计划</p></blockquote></li></ul><p>MySQL 中磁盘和内存交互的基本单位是 页,页的大小一般是 16KB ，也就是 16384 字节，</p><h5 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h5><p>对数据的存储和提取，MySQL server 完成了查询优化后，只需按照生成的执行计划调用底层存储引擎提供的API，获取到数据后</p><p>返回给客户端</p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091807992.png" alt="image-20230120114806430" style="zoom:50%;" /><p>常用的就是 InnoDB 和 MyISAM </p><p>innodb 具有外键支持功能的事务春初引擎</p><p>myisam 主要的非事物处理引擎</p><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>配置文件里就定义了许多个组，组名分别是 server 、 mysqld 、 mysqld_safe 、 client 、 mysql 、mysqladmin </p><p>配置文件优先级：如果我们在多个配置文件中设置了相同的启动选项，那以最后一个配置文件中的为准，将以最后一个出现的组中的启动选项为准，么以命令行中的启动选项为准</p><h4 id="字符集（CHARACTER）和排序规则（COLLATION）"><a href="#字符集（CHARACTER）和排序规则（COLLATION）" class="headerlink" title="字符集（CHARACTER）和排序规则（COLLATION）"></a>字符集（CHARACTER）和排序规则（COLLATION）</h4><h5 id="字符集（部分）："><a href="#字符集（部分）：" class="headerlink" title="字符集（部分）："></a>字符集（部分）：</h5><p>utf8mb3 ：阉割过的 utf8 字符集，只使用1～3个字节表示字符。</p><p>utf8mb4 ：正宗的 utf8 字符集，使用1～4个字节表示字符。</p><h5 id="排序规则："><a href="#排序规则：" class="headerlink" title="排序规则："></a>排序规则：</h5><p>_ai ：accent insensitive  不区分重音</p><p>_as ： accent sensitive 区分重音</p><p>_ci ： case insensitive 不区分大小写</p><p>_cs ： case sensitive 区分大小写</p><p>_bin ： binary 以二进制方式比较</p><p>MySQL 有4个级别的字符集和比较规则，分别是：</p><ul><li>服务器级别</li><li>数据库级别</li><li>表级别</li><li>列级别</li></ul><h5 id="编码和解码使用的字符集不一致的后果"><a href="#编码和解码使用的字符集不一致的后果" class="headerlink" title="编码和解码使用的字符集不一致的后果"></a>编码和解码使用的字符集不一致的后果</h5><p>贝先 utf8编码 &#x3D; 0xE8B49D 0xE58588（3个字节）</p><p>​转gbk &#x3D; 0xE8B4 0x9DE5 0x8588（1-2个字节 1个字节找不到 就2个字节）</p><p>​显示 &#x3D;璐  濆      厛</p><blockquote><p>GBK和文字在线转换：<a href="https://www.23bei.com/tool/54.html#">ASCII&#x2F;GBK&#x2F;GB2312中文汉字区位码,内码,编码在线查询软件 (23bei.com)</a></p><p>UTF-8和文字在线转换：<a href="http://www.metools.info/code/utf8235.html">UTF-8编码转换器-ME2在线工具 (metools.info)</a></p></blockquote><h5 id="MySQL中字符集的转换"><a href="#MySQL中字符集的转换" class="headerlink" title="MySQL中字符集的转换"></a>MySQL中字符集的转换</h5><p>服务器接收到客户端发送来的请求其实是一串二进制的字节，它会认为这串字节采用的字符集是character_set_client ，然后把这串字节转换为 character_set_connection 字符集编码的字符。最后使用 character_set_results字符集 返回客户端</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091807626.png" alt="image-20230120122125932"></p><p>为避免乱码，确保一下三个字符集一致</p><ul><li><p>character_set_client 服务器解码请求时使用的字符集</p></li><li><p>character_set_connection 服务器处理请求时会把请求字符串从 character_set_client 转为 character_set_connection</p></li><li><p>character_set_results 服务器向客户端返回数据时使用的字符集</p></li></ul><p>在配置文件中添加default-character-set&#x3D;utf8</p><p>[client]</p><p>default-character-set&#x3D;utf8</p><h4 id="Innodb"><a href="#Innodb" class="headerlink" title="Innodb"></a>Innodb</h4><p>InnoDB 是一个将表中的数据存储到磁盘上的存储引擎，最大特色就是支持了<a href="https://baike.baidu.com/item/ACID/10738?fromModule=lemma_inlink">ACID</a>兼容的<a href="https://baike.baidu.com/item/%E4%BA%8B%E5%8A%A1/5945882?fromModule=lemma_inlink">事务</a>（Transaction）功能。</p><p>将数据划分为若干个页，以页作为磁盘和内存之间交互的基本单位，InnoDB中页的大小一般为 <strong>16</strong> KB</p><p>是以记录为单位来向表中插入数据的，这些记录在磁盘上的存放方式也被称为 行格式 或者 记录格式</p><blockquote><p>ACID:原子性（atomicity，或称不可分割性）、一致性（consistency）、隔离性（isolation，又称独立性）、持久性（durability）</p></blockquote><h5 id="行格式"><a href="#行格式" class="headerlink" title="行格式"></a>行格式</h5><ul><li>COMPACT行格式</li></ul><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091807391.png" alt="image-20230120102114581"></p><ul><li>Redundant行格式</li></ul><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091807341.png" alt="image-20230120102325757"></p><p>字段长度偏移列表 按照两个相邻数值的差值来计算各个列值的长度</p><ul><li><p>Dynamic</p><blockquote><p>行溢出处理：把所有的字节都存储到其他页面中，只在记录的真实数据处存储其他页面的地址</p></blockquote></li><li><p>Compressed</p><blockquote><p>Compressed 行格式会采用压缩算法对页面进行压缩，以节省空间。</p></blockquote></li></ul><h5 id="varchar-M-最多能存储的数据"><a href="#varchar-M-最多能存储的数据" class="headerlink" title="varchar(M)最多能存储的数据"></a>varchar(M)最多能存储的数据</h5><p> VARCHAR(M) 类型的列最多可以占用 65535 个字节 MySQL 对一条记录占用的最大存储空间是有限制的，除了 BLOB 或者 TEXT 类型的列之外，其他所有的列（不包括隐藏列和记录头信息）占用的字节长度加起来不能超过 65535 个字节</p><p>M &#x3D; 真实数据+真实数据占用字节的长度+NULL 值标识(如果该列有 NOT NULL 属性则可以没有这部分存储空间)</p><p>如果该 VARCHAR 类型的列没有 NOT NULL 属性，那最多只能存储 65532 个字节的数据，因为真实数据的长度可能</p><p>占用2个字节， NULL 值标识需要占用1个字节：</p><blockquote><p>真实数据占用字节的长度65535(十进制) &#x3D; 11111111 11111111（二进制）&#x3D; 2字节</p><p>65532 &#x3D; 65535-2（真实数据占用字节的长度）-1（NULL 值标识）</p><p>65533 &#x3D; 65535-2（真实数据占用字节的长度）-0（Not Null无需标识）</p></blockquote><p>ascii 字符集(最多占用一个字节) 允许为null情况下可以最大65532 ，Not Null最大65533</p><p>gbk 字符集(最多占用2个字节) 允许为null情况下可以最大32766（65532 &#x2F;2）</p><p>utf8 字符集(&#x3D;utf8mb3 最多占用3个字节) 允许为null情况下可以最大21844（65532 &#x2F;3）</p><h5 id="行溢出"><a href="#行溢出" class="headerlink" title="行溢出"></a>行溢出</h5><p>溢出原因：一个页一般是 16KB ，当记录中的数据太多，当前页放不下的时候，会把多余的数据存储到其他页中，这种现象称为 行溢出 。</p><p>解决方法：在 Compact 和 Reduntant 行格式中，在 记录的真实数据 处只会存储该列的一部分数据，把剩余的数据分散存储在几个其他的页中，然后 记录的真实数据 处用20个字节存储指向这些页的地址（当然这20个字节中还包括这些分散在其他页面中的数据的占用的字节数）</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091808473.png" alt="image-20230120111527905"></p><p>只要知道如果我们想一个行中存储了很大的数据时，可能发生 行溢出 的现象</p><p>索引页（数据页）结构</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091808995.png" alt="image-20230120143359530"></p><p><strong>记录头信息</strong></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091808206.png" alt="image-20230120144359136"></p><p>delete_mask：标记着当前记录是否被删除。立即删除重新排列影响性能，所有被删除掉的记录都会组成一个所谓的 垃圾链表 ，在这个链表中的记录占用的空间称之为所谓的 可重用空间 ，之后如果有新记录插入到表中的话，可能把这些被删除的记录占用的存储空间覆盖掉</p><p>min_rec_mask：</p><p>heap_no：当前记录在本 页 中的位置，innodb自动给页添加伪记录（虚拟记录），分别是最小记录和最大记录，以它们并不存放在 页 的 User Records 部分，他们被单独放在 Infimum + Supremum 。</p><p>record_type： 0 表示普通记录， 1 表示B+树非叶节点记录， 2 表示最小记录， 3 表示最大记录</p><p>next_record：从当前记录的真实数据到下一条记录的真实数据的地址偏移量。<strong>Infimum</strong>记录（也就是最小记录） 的下一条记录就是</p><p>本页中主键值最小的用户记录，而本页中主键值最大的用户记录的下一条记录就是 <strong>Supremum</strong>记录（也就是最大记录）</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091808925.png" alt="image-20230207152610054"></p><p>记录在页中按照主键值由小到大顺序串联成一个单链表</p><p><strong>Page Directory页目录</strong></p><ul><li>将记录划分组</li></ul><p>对每个分组中的记录条数是有规定的：对于最小记录所在的分组只能有 <strong>1</strong> 条记录，最大记录所在的分组拥有的记录条数只能在 <strong>1~8</strong> 条之间，剩下的分组中记录的条数范围只能在是 <strong>4~8</strong> 条之间</p><ul><li>每组最后一条记录使用n_owned标记该组拥有几条记录</li><li>把每组的最后一条记录的地址偏移量按顺序存储到页的尾部（页目录），页目录中的地址偏移量称作slot槽</li></ul><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091808381.png" alt="image-20230120151640564"></p><p>在一个数据页中查找主键记录的过程</p><ul><li><p>通过二分法确定该记录所在的槽，并找到该槽中主键值最小的那条记录。 </p></li><li><p>通过记录的 next_record 属性遍历该槽所在的组中的各个记录。</p></li></ul><p><strong>Page Header页头</strong></p><p>页 结构的第二部分，这个部分占用固定的 56 个字节，专门存储各种状态信息</p><p><strong>File Header文件头部</strong></p><p>固定占用的 38 个字节，针对 数据页 记录的各种状态信息</p><p><strong>File Trailer</strong></p><p>为保证从内存中同步到磁盘的页的完整性，在页的首部和尾部都会存储页中数据的校验和和页面最后修改时</p><p>对应的 LSN 值，如果首部和尾部的校验和和 LSN 值校验不成功的话，就说明同步过程出现了问题</p><h5 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h5><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091808692.png" alt="image-20230207150852788"></p><p>页分裂：在对页中的记录进行增删改操作的过程中，我们必须通过一些诸如记录移动的操作来始终保</p><p>证这个状态一直成立：下一个数据页中用户记录的主键值必须大于上一个页中用户记录的主键值。</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202302091808442.png" alt="image-20230207160245808"></p><p>叶子结点是用户记录，非叶子结点是目录项纪录</p><p>聚簇索引：InnoDB 存储引擎会自动的为我们创建聚簇索引。</p><ul><li>使用记录主键值的大小进行记录和页的排序</li><li>B+ 树的叶子节点存储的是<strong>完整的用户记录</strong></li></ul><p>二级索引：在二级索引根据索引列查到对应主键，根据主键在聚簇索引找完整数据（回表）</p><ul><li>使用记录索引列的大小进行记录和页的排序</li><li>B+ 树的叶子节点存储的并不是完整的用户记录，而只是索引列+主键 这两个列的值。</li><li>目录项记录中不再是 主键+页号 的搭配，而变成了 索引列+页号 的搭配</li></ul><p>联合索引：同时以多个列的大小作为排序规则，也就是同时为多个列建立索引</p><p><strong>记录插入B+树过程</strong>：</p><ul><li>根结点（表自动生成）</li><li>记录插入根节点</li><li>再插入数据 根节点空间不足 复制根节点</li><li>页分裂（两个子节点）</li><li>根节点 便升级为存储目录项记录的页。</li></ul><p><strong>结论</strong>：</p><p>每个索引都对应一棵 B+ 树， B+ 树分为好多层，最下边一层是叶子节点，其余的是内节点。所有 用户记录</p><p>都存储在 B+ 树的叶子节点，所有 目录项记录 都存储在内节点。</p><p>InnoDB 存储引擎会自动为主键（如果没有它会自动帮我们添加）建立 聚簇索引 ，聚簇索引的叶子节点包含</p><p>完整的用户记录。</p><p>我们可以为自己感兴趣的列建立 二级索引 ， 二级索引 的叶子节点包含的用户记录由 索引列 + 主键 组</p><p>成，所以如果想通过 二级索引 来查找完整的用户记录的话，需要通过 回表 操作，也就是在通过 二级索引</p><p>找到主键值之后再到 聚簇索引 中查找完整的用户记录。B+ 树中每层节点都是按照索引列值从小到大的顺序排序而组成了双向链表，而且每个页内的记录（不论是</p><p>用户记录还是目录项记录）都是按照索引列的值从小到大的顺序而形成了一个单链表。如果是 联合索引 的</p><p>话，则页面和记录先按照 联合索引 前边的列排序，如果该列值相同，再按照 联合索引 后边的列排序。</p><p>通过索引查找记录是从 B+ 树的根节点开始，一层一层向下搜索。由于每个页面都按照索引列的值建立了</p><p>Page Directory （页目录），所以在这些页面中的查找非常快。</p><p><strong>索引的代价</strong></p><ul><li>空间上的代价</li><li>时间上的代价</li></ul><p>​每次对表中的数据进行增、删、改操作时，都需要去修改各个 B+ 树索引。</p><blockquote><p>搜索语句中也可以不用包含全部联合索引中的列，只包含左边的就行</p><p>前缀都是排好序的，所以对于字符串类型的索引列来说，我们只匹配它的前缀也是可以快速定位记录</p><p>联合索引，如果对多个列同时进行范围查找的话，只有对索引最左边的那个列进行范围查找的时候才能用到 B+ 树索引</p><p>于同一个联合索引来说，虽然对多个列都进行范围查找时只能用到最左边那个索引列，但是如果左边的列是精确查找，则右边的列可以进行范围查找</p></blockquote><p><strong>不可以使用索引进行排序的几种情况</strong></p><ul><li><strong>DESC</strong>混用</li><li><strong>WHERE</strong>子句中出现非排序使用到的索引列</li><li>排序列包含非同一个索引的列</li><li>排序列使用了复杂的表达式</li></ul><p><strong>回表</strong></p><p>需要回表的记录越多，使用二级索引的性能就越低，</p><p>为了彻底告别 回表 操作带来的性能损耗，我们建议：最好在查询列表里只包含索引列，</p><p>索引字符串值的前缀 ： 只对字符串的前几个字符进行索引</p><blockquote><p>KEY idx_name_birthday_phone_number (name(10), birthday, phone_number)</p></blockquote><p>如果索引列在比较表达式中不是以单独列的形式出现，而是以某个表达式，或者函数调用形式出现的话，是用不到索引的</p><p><strong>主键插入顺序</strong></p><p>中间插入主键会导致页分裂，导致性能损耗，最好让插入的记录的主键值依次递增，这样就不会发生这样的性能损耗了。所以我们建议：让主键具有 AUTO_INCREMENT ，让存储引擎自己为表生成主键，而不是我们手动插入</p><p>结论：</p><ol><li><p>B+ 树索引在空间和时间上都有代价，所以没事儿别瞎建索引。</p></li><li><p>B+ 树索引适用于下边这些情况：</p></li></ol><p>全值匹配</p><p>匹配左边的列</p><p>匹配范围值</p><p>精确匹配某一列并范围匹配另外一列</p><p>用于排序</p><p>用于分组</p><ol start="3"><li>在使用索引时需要注意下边这些事项：</li></ol><p>只为用于搜索、排序或分组的列创建索引</p><p>为列的基数大的列创建索引</p><p>索引列的类型尽量小</p><p>可以只对字符串值的前缀建立索引</p><p>只有索引列在比较表达式中单独出现才可以适用索引</p><p>为了尽可能少的让 聚簇索引 发生页面分裂和记录移位的情况，建议让主键拥有 AUTO_INCREMENT 属性。</p><p>定位并删除表中的重复和冗余索引</p><p>尽量使用 覆盖索引 进行查询，避免 回表 带来的性能损耗。</p><h4 id="InnoDB的表空间"><a href="#InnoDB的表空间" class="headerlink" title="InnoDB的表空间"></a>InnoDB的表空间</h4><p>区 （ extent ）：64页</p><p>段（<strong>segment</strong>）：存放叶子节点的区的集合就算是一个 段 （ segment ），存放非叶子节点的区的集合也算是一个 段 。也就是说一个索引会生成2个段，一个叶子节点段，一个非叶子节点段。链表中相邻的两个页，物理位置可能离得非常远，会产生 随机I&#x2F;O，在磁盘中访问速度慢，尽量把页放在相邻的位置</p><ul><li><p>在刚开始向表中插入数据的时候，段是从某个碎片区以单个页面为单位来分配存储空间的。</p></li><li><p>当某个段已经占用了32个碎片区页面之后，就会以完整的区为单位来分配存储空间。</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Javascript修改vue输入框的值</title>
    <link href="/2023/01/18/Javascript%E4%BF%AE%E6%94%B9vue%E8%BE%93%E5%85%A5%E6%A1%86%E7%9A%84%E5%80%BC/"/>
    <url>/2023/01/18/Javascript%E4%BF%AE%E6%94%B9vue%E8%BE%93%E5%85%A5%E6%A1%86%E7%9A%84%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<p>vue 是通过<a href="https://so.csdn.net/so/search?q=input%E4%BA%8B%E4%BB%B6&spm=1001.2101.3001.7020">input事件</a>来触发双向绑定的，而你用单纯的js 去修改input值，并没有触发他的input事件，通过下方代码，进行触发即可。两种方式选其一即可。</p><blockquote><ol><li><p>event.target.dispatchEvent(new Event(‘input’));</p></li><li><p>el.dispatchEvent(new Event(‘input’));</p></li></ol></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>nginx:根据二级域名自动分发对应文件夹目录</title>
    <link href="/2023/01/18/nginx-%E5%8A%A8%E6%80%81%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E8%87%AA%E5%8A%A8%E5%88%86%E5%8F%91%E5%AF%B9%E5%BA%94%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9B%AE%E5%BD%95/"/>
    <url>/2023/01/18/nginx-%E5%8A%A8%E6%80%81%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E8%87%AA%E5%8A%A8%E5%88%86%E5%8F%91%E5%AF%B9%E5%BA%94%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9B%AE%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>记录一下</p><p><a href="http://site-1.cason.work/">http://site-1.cason.work</a> 映射到 &#x2F;www&#x2F;site&#x2F;1&#x2F; 目录</p><p><a href="http://site-2.cason.work/">http://site-2.cason.work</a> 映射到 &#x2F;www&#x2F;site&#x2F;2&#x2F; 目录</p><figure class="highlight json"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><pre><code class="hljs json">server <span class="hljs-punctuation">&#123;</span><br>       listen       <span class="hljs-number">80</span>;<br>        server_name  ~^site\-(?&lt;subdomain&gt;.+)\.cason\.work$;<br>        root   /www/site/$subdomain/;<br>        index  index.html index.htm ;<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Tiktok Shop 生成signature（java）</title>
    <link href="/2023/01/10/Tiktok-Shop-%E7%94%9F%E6%88%90signature%EF%BC%88java%EF%BC%89/"/>
    <url>/2023/01/10/Tiktok-Shop-%E7%94%9F%E6%88%90signature%EF%BC%88java%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>tiktok 官方文档：<a href="https://partner.tiktokshop.com/doc/page/261251">TikTok Shop Partner Center</a></p><p>因为tiktok官方文档生成signature只有go语言版本的</p><p>所以记录一下java版本生成tiktok shop 请求open api时需要的signature</p><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getSignature</span><span class="hljs-params">(String uri, Map&lt;String, String&gt; parametersMap, String appSecret)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Map&lt;String, String&gt; tempParamsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;(Comparator.naturalOrder());<br>        tempParamsMap.putAll(parametersMap);<br>        tempParamsMap.remove(<span class="hljs-string">&quot;sign&quot;</span>);<br>        tempParamsMap.remove(<span class="hljs-string">&quot;access_token&quot;</span>);<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(uri);<br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : tempParamsMap.entrySet()) &#123;<br>            input.append(entry.getKey()).append(entry.getValue());<br>        &#125;<br>        input = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(appSecret + input + appSecret);<br>        <span class="hljs-keyword">return</span> hmacSHA256(appSecret, input.toString());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * sha256_HMAC加密</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message 消息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> secret  秘钥</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 加密后字符串</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">hmacSHA256</span><span class="hljs-params">(String secret, String message)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Mac</span> <span class="hljs-variable">hmacSha256</span> <span class="hljs-operator">=</span> Mac.getInstance(<span class="hljs-string">&quot;HmacSHA256&quot;</span>);<br>        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secret_key</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(secret.getBytes(), <span class="hljs-string">&quot;HmacSHA256&quot;</span>);<br>        hmacSha256.init(secret_key);<br>        <span class="hljs-type">byte</span>[] bytes = hmacSha256.doFinal(message.getBytes());<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">hs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        String stmp;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; bytes != <span class="hljs-literal">null</span> &amp;&amp; n &lt; bytes.length; n++) &#123;<br>            stmp = Integer.toHexString(bytes[n] &amp; <span class="hljs-number">0XFF</span>);<br>            <span class="hljs-keyword">if</span> (stmp.length() == <span class="hljs-number">1</span>)<br>                hs.append(<span class="hljs-string">&#x27;0&#x27;</span>);<br>            hs.append(stmp);<br>        &#125;<br>        <span class="hljs-keyword">return</span> hs.toString().toLowerCase();<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h3><p>原来的url参数加上app_key和timestamp即可</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202301101729177.png" alt="image-20230110172708810"></p>]]></content>
    
    
    <categories>
      
      <category>外贸电商</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tiktok shop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WooCommerce搭建（docker）</title>
    <link href="/2023/01/04/WooCommerce%E6%90%AD%E5%BB%BA%EF%BC%88docker%EF%BC%89/"/>
    <url>/2023/01/04/WooCommerce%E6%90%AD%E5%BB%BA%EF%BC%88docker%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>平台对接WooCommerce api 记录一下创建过程</p><blockquote><p>api地址:<a href="https://woocommerce.github.io/woocommerce-rest-api-docs/?python&from_wecom=1#introduction">Introduction – WooCommerce REST API Documentation - WP REST API v3</a></p></blockquote><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><p><code>docker pull mysql  </code></p><p><code>docker run --name mysql -e MYSQL_ROOT_PASSWORD=&lt;密码&gt; -p 3306:3306 -d mysql</code></p><p>创建一个DB ：wordpress 编码utf8mb4</p><h2 id="wordpress"><a href="#wordpress" class="headerlink" title="wordpress"></a>wordpress</h2><p><code>docker pull wordpress:latest</code></p><p><code>docker run -d --name wordpress -e WORDPRESS_DB_HOST=mysql -e WORDPRESS_DB_USER=root -e WORDPRESS_DB_PASSWORD=&lt;mysql密码&gt; -e WORDPRESS_DB_NAME=wordpress -p 80:80 --link mysql:mysql wordpress</code></p><p>最好使用80端口 否则wordpress rest api无法使用</p><h2 id="WooCommerce"><a href="#WooCommerce" class="headerlink" title="WooCommerce"></a>WooCommerce</h2><p>在Plugins安装WooCommerce</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202301041630702.png" alt="image-20230104162118061"></p>]]></content>
    
    
    <categories>
      
      <category>外贸电商</category>
      
    </categories>
    
    
    <tags>
      
      <tag>woocommerce</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>算法笔记</title>
    <link href="/2022/12/27/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/12/27/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h1><p>特征</p><ul><li>自身调用：原问题可以分解为子问题，子问题和原问题的求解方法是一致的，即都是调用自身的同一个函数。</li><li>终止条件：递归必须有一个终止的条件，即不能无限循环地调用本身。</li></ul><p>解决递归问题三步曲</p><ul><li>第一步，定义函数功能</li><li>第二步，寻找递归终止条件</li><li>第二步，递推函数的等价关系式</li></ul><p>递归存在的问题</p><ul><li>递归调用层级太多，导致栈溢出问题<ul><li>调大JVM的栈空间内存</li><li>优化一下你的递归</li></ul></li><li>递归重复计算，导致效率低下<ul><li>备忘录</li></ul></li></ul><blockquote><p><strong>「题目：」</strong> 翻转一棵二叉树。</p><p><a href="https://leetcode-cn.com/problems/invert-binary-tree/">https://leetcode-cn.com/problems/invert-binary-tree/</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for a binary tree node.</span><br><span class="hljs-comment"> * public class TreeNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     TreeNode left;</span><br><span class="hljs-comment"> *     TreeNode right;</span><br><span class="hljs-comment"> *     TreeNode() &#123;&#125;</span><br><span class="hljs-comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span><br><span class="hljs-comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span><br><span class="hljs-comment"> *         this.val = val;</span><br><span class="hljs-comment"> *         this.left = left;</span><br><span class="hljs-comment"> *         this.right = right;</span><br><span class="hljs-comment"> *     &#125;</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br> <span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">invertTree</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>        <span class="hljs-comment">//节点为空 或 不为叶子节点</span><br>        <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span> || (root.left == <span class="hljs-literal">null</span> &amp;&amp; root.right == <span class="hljs-literal">null</span>)) &#123;<br>            <span class="hljs-keyword">return</span> root;<br>        &#125;<br>        <span class="hljs-comment">//翻转左子树</span><br>        invertTree(root.left);<br>        <span class="hljs-comment">//翻转右子树</span><br>        invertTree(root.right);<br>        <span class="hljs-comment">//将当前节点的左右子树交换</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> root.left;<br>        root.left = root.right;<br>        root.right = temp;<br>        <span class="hljs-keyword">return</span> root;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="字符串相关"><a href="#字符串相关" class="headerlink" title="字符串相关"></a>字符串相关</h1><h2 id="BF算法（Brute-Force）"><a href="#BF算法（Brute-Force）" class="headerlink" title="BF算法（Brute Force）"></a>BF算法（Brute Force）</h2><p>我们将模式串和主串进行比较，一致时则继续比较下一字符，直到比较完整个模式串</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">strStr</span><span class="hljs-params">(String haystack, String needle)</span> &#123;<br>       <span class="hljs-type">char</span>[] haystackChars = haystack.toCharArray();<br>       <span class="hljs-type">char</span>[] needleChars = needle.toCharArray();<br>       <span class="hljs-keyword">if</span> (haystackChars.length &lt; needleChars.length || StringUtils.isBlank(haystack) || StringUtils.isBlank(needle)) &#123;<br>           <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>       &#125;<br>       <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; haystackChars.length; i++) &#123;<br>           <span class="hljs-type">int</span> j;<br>           <span class="hljs-keyword">for</span> ( j= <span class="hljs-number">0</span>; j &lt; needleChars.length; j++) &#123;<br>               <span class="hljs-keyword">if</span> (haystackChars[i+j] != needleChars[j]) &#123;<br>                   <span class="hljs-keyword">break</span>;<br>               &#125;<br>           &#125;<br>           <span class="hljs-keyword">if</span> (j == needleChars.length) &#123;<br>               <span class="hljs-keyword">return</span> i;<br>           &#125;<br>       &#125;<br>       <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>   &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>算法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>数据结构笔记</title>
    <link href="/2022/12/27/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/12/27/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h1><p><strong>栈（stack）是限制插入和删除只能在一个位置上进行的表</strong>，该位置是表的末端叫做栈的顶（top），对栈的基本操作有 push(进栈)和 pop(出栈),前者相当于插入，后者则是删除最后插入的元素。</p><p>栈的另一个名字是 LIFO（先进后出）表</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackTest</span> &#123;<br><br>    <span class="hljs-type">int</span> len;<br>    <span class="hljs-type">int</span>[] elems;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StackTest</span><span class="hljs-params">(<span class="hljs-type">int</span> len)</span> &#123;<br>        <span class="hljs-built_in">this</span>.len = len;<br>        <span class="hljs-built_in">this</span>.elems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[len];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFull</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span>= len - <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span>= -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;empty stack&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.elems[top];<br>        top--;<br>        <span class="hljs-keyword">return</span> val;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">push</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isFull()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;full stack&quot;</span>);<br>        &#125;<br>        top++;<br>        elems[top] = i;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h1><p>像栈一样，队列（queue）也是表。然而使用队列时插入在一端进行而删除在另一端进行，遵守先进先出的规则。所以队列的另一个名字是（FIFO）。</p><p>队列的基本操作是入队（enqueue）:它是在表的末端(队尾(rear)插入一个元素。出队（dequeue）:出队他是删除在表的开头（队头(front)）的元素。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueueTest</span> &#123;<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">rear</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">front</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> size;<br>    <span class="hljs-type">int</span>[] elems;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">QueueTest</span><span class="hljs-params">(<span class="hljs-type">int</span> size)</span> &#123;<br>        <span class="hljs-built_in">this</span>.size = size;<br>        <span class="hljs-built_in">this</span>.elems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[size];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">rear</span> <span class="hljs-operator">=</span>= front;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFull</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> (rear + <span class="hljs-number">1</span>) % <span class="hljs-built_in">this</span>.size == front;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">dequeue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;empty queue&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">this</span>.front = (<span class="hljs-built_in">this</span>.front + <span class="hljs-number">1</span>) % <span class="hljs-built_in">this</span>.size;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.elems[<span class="hljs-built_in">this</span>.front];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isFull()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;full queue&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">this</span>.rear = (<span class="hljs-built_in">this</span>.rear + <span class="hljs-number">1</span>) % <span class="hljs-built_in">this</span>.size;<br>        <span class="hljs-built_in">this</span>.elems[<span class="hljs-built_in">this</span>.rear] = val;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="散列表"><a href="#散列表" class="headerlink" title="散列表"></a>散列表</h1><p>散列过程</p><ul><li>通过<strong>散列函数</strong>计算记录的散列地址，并按此<strong>散列地址</strong>存储该记录</li><li>查找时，我们通过<strong>同样的散列函数</strong>计算记录的散列地址，按此散列地址访问该记录</li></ul><p>散列函数构造方法</p><ul><li><p>直接定址法</p></li><li><p>数字分析法</p></li><li><p>折叠法</p></li><li><p>除法散列法</p></li><li><p>乘法散列法</p></li><li><p>随机数法</p></li><li><p>平方取中法</p></li></ul><p>处理散列冲突的方法</p><ul><li>开放地址法</li><li>链地址法</li><li>公共溢出区法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashTest</span> &#123;<br>    KeyValue[] elements;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HashTest</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.elements = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValue</span>[size];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key,String value)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> key.hashCode() % <span class="hljs-built_in">this</span>.size;<br>        <span class="hljs-type">KeyValue</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.elements[index];<br>        <span class="hljs-keyword">if</span> (element != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">while</span> (element.next != <span class="hljs-literal">null</span>) &#123;<br>                element = element.next;<br>            &#125;<br>            <span class="hljs-type">KeyValue</span> <span class="hljs-variable">newKv</span> <span class="hljs-operator">=</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValue</span>(key, value);<br>            newKv.setNext(element);<br>            <span class="hljs-built_in">this</span>.elements[index] = newKv;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            element = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValue</span>(key, value);<br>            <span class="hljs-built_in">this</span>.elements[index] = element;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> key.hashCode() % <span class="hljs-built_in">this</span>.size;<br>        <span class="hljs-type">KeyValue</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.elements[index];<br>        <span class="hljs-keyword">while</span> (!element.getKey().equals(key)) &#123;<br>            element=element.next;<br>        &#125;<br>        <span class="hljs-keyword">return</span> element.getValue();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyValue</span> &#123;<br>        <span class="hljs-keyword">private</span> String key;<br>        <span class="hljs-keyword">private</span> String value;<br>        <span class="hljs-keyword">private</span> KeyValue next;<br><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> key;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setKey</span><span class="hljs-params">(String key)</span> &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> value;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValue</span><span class="hljs-params">(String value)</span> &#123;<br>            <span class="hljs-built_in">this</span>.value = value;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> KeyValue <span class="hljs-title function_">getNext</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> next;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNext</span><span class="hljs-params">(KeyValue next)</span> &#123;<br>            <span class="hljs-built_in">this</span>.next = next;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">KeyValue</span><span class="hljs-params">(String key, String value)</span> &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>            <span class="hljs-built_in">this</span>.value = value;<br>            <span class="hljs-built_in">this</span>.next = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h1><p>定义：链表是一种递归的数据结构，他或者为空（null），或者是指向一个结点（node）的引用，该结点含有一个泛型的元素和一个指向另一条链表的引用。是一种线性表，但是他不是按线性顺序存取数据。链表在内存不是连续分配的</p><p>链表的类型</p><ul><li>单链表</li><li>双向链表</li></ul><h1 id="树"><a href="#树" class="headerlink" title="树"></a>树</h1><p>树是 n （n &gt;&#x3D; 0） 个节点的有限集。 n &#x3D; 0 时 我们称之为空树, 空树是树的特例。</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202212281826260.png" alt="image-20221228121105999"></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202212281826519.png" alt="image-20221228121120312"></p><p>整理源自<a href="https://github.com/chefyuan/algorithm-base/blob/main/animation-simulation/%E4%BA%8C%E5%8F%89%E6%A0%91/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%9F%BA%E7%A1%80.md">algorithm-base&#x2F;二叉树基础.md at main · chefyuan&#x2F;algorithm-base · GitHub</a></p><h2 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h2><ul><li>每个节点最多有两棵子树，也就是说二叉树中不存在度大于 2 的节点，节点的度可以为 0，1，2。</li><li>左子树和右子树是有顺序的,有左右之分。</li><li>假如只有一棵子树 ，也要区分它是左子树还是右子树</li></ul><h2 id="特殊的二叉树"><a href="#特殊的二叉树" class="headerlink" title="特殊的二叉树"></a>特殊的二叉树</h2><h3 id="满二叉树"><a href="#满二叉树" class="headerlink" title="满二叉树"></a>满二叉树</h3><p>满二叉树：在一棵二叉树中，<code>所有分支节点都存在左子树和右子树</code>，并且<code>所有的叶子都在同一层</code></p><h3 id="完全二叉树"><a href="#完全二叉树" class="headerlink" title="完全二叉树"></a>完全二叉树</h3><p>叶子结点只能出现在最下层和次下层，且最下层的叶子结点集中在树的左部。</p><h3 id="斜二叉树"><a href="#斜二叉树" class="headerlink" title="斜二叉树"></a>斜二叉树</h3><p>斜二叉树也就是斜的二叉树,所有的节点只有左子树的称为左斜树,所有节点只有右子树的二叉树称为右斜树.</p><h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><p>前序遍历</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">traverse</span><span class="hljs-params">(TreeNode root, List&lt;Integer&gt; arr)</span> &#123;<br>     <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> root;<br>     &#125;<br>     arr.add(root.val);<br>     traverse(root.left, arr);<br>     traverse(root.right, arr);<br>     <span class="hljs-keyword">return</span> root;<br> &#125;<br></code></pre></td></tr></table></figure><p>中序遍历</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">traverse</span><span class="hljs-params">(TreeNode root, List&lt;Integer&gt; arr)</span> &#123;<br>     <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> root;<br>     &#125;<br>     traverse(root.left, arr);<br>   arr.add(root.val);<br>     traverse(root.right, arr);<br>     <span class="hljs-keyword">return</span> root;<br> &#125;<br></code></pre></td></tr></table></figure><p>后序遍历</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">traverse</span><span class="hljs-params">(TreeNode root, List&lt;Integer&gt; arr)</span> &#123;<br>     <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> root;<br>     &#125;<br>     traverse(root.left, arr);<br>     traverse(root.right, arr);<br>   arr.add(root.val);<br>     <span class="hljs-keyword">return</span> root;<br> &#125;<br></code></pre></td></tr></table></figure><p>层级遍历</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="hljs-title function_">levelOrder</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>        List&lt;List&lt;Integer&gt;&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> list;<br>        &#125;<br>        Queue&lt;TreeNode&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        queue.offer(root);<br>        <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;<br>            List&lt;Integer&gt; temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            <span class="hljs-comment">//提前取出这层的size ，queue的size是不断变化的</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> queue.size();<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++) &#123;<br>                <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode</span> <span class="hljs-operator">=</span> queue.poll();<br>              <span class="hljs-comment">//出队列前就取出这个节点的左右子节点</span><br>                <span class="hljs-keyword">if</span>(treeNode.left!=<span class="hljs-literal">null</span>) queue.offer(treeNode.left);<br>                <span class="hljs-keyword">if</span>(treeNode.right!=<span class="hljs-literal">null</span>) queue.offer(treeNode.right);<br>                temp.add(treeNode.val);<br>            &#125;<br>            list.add(temp);<br>        &#125;<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>数据结构</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>面试问题记录-Mysql select count(1)、count(*)、count(column)</title>
    <link href="/2022/08/01/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-Mysql-select-count-1-%E3%80%81count-%E3%80%81count-column/"/>
    <url>/2022/08/01/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-Mysql-select-count-1-%E3%80%81count-%E3%80%81count-column/</url>
    
    <content type="html"><![CDATA[<blockquote><p>摘抄自网络</p></blockquote><p>count(*)：先把星号翻译为具体字段名字，多了一步翻译，效率差点<br>count(1)：计算有多少符合条件的行，可以理解为每行数据存在某个值固定的字段，计算有多少个固定值</p><p><strong>从结果来说：</strong></p><ul><li>count(*) 和 count(1) 没区别，都不会过滤 NULL</li><li>count(column) 会过滤 NULL</li></ul><p><strong>从速度来说：</strong></p><ul><li>如果只有一列，count(<em>) 效率最高</em></li><li><em>多列时，count(1) 效率高于 count(</em>)</li><li>如果列为主键，count(column) 效率最高</li><li>如果列不为主键，count(1) 效率比 count(column) 效率高</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>面试问题</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python 通过requests爬取shopify collections商品</title>
    <link href="/2022/08/01/python-%E9%80%9A%E8%BF%87requests%E7%88%AC%E5%8F%96shopify-collections%E5%95%86%E5%93%81/"/>
    <url>/2022/08/01/python-%E9%80%9A%E8%BF%87requests%E7%88%AC%E5%8F%96shopify-collections%E5%95%86%E5%93%81/</url>
    
    <content type="html"><![CDATA[<p>简单使用requests爬取shopify商品信息</p><p>需要自行分析商品链接、标题、价格、描述、图片的选择器</p><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> csv<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">import</span> bs4<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># collections地址</span><br>url_pro = <span class="hljs-string">&#x27;https://www.naluboutique.com/collections/all&#x27;</span><br><br><span class="hljs-comment"># 分析xpath</span><br>product_link_select = <span class="hljs-string">&#x27;.grid-product__content .grid-product__link&#x27;</span><br>product_title_select = <span class="hljs-string">&#x27;.product-single__title&#x27;</span><br>product_price_select = <span class="hljs-string">&#x27;.product__price&#x27;</span><br>product_desc_select = <span class="hljs-string">&#x27;.product-single__description&#x27;</span><br>product_img_select = <span class="hljs-string">&#x27;.product__photos img&#x27;</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;采集商品集合开始&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crawl_collections</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            res = requests.get(url, timeout=<span class="hljs-number">30</span>)<br>            res.encoding = res.apparent_encoding<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;请求&#x27;</span>, url, <span class="hljs-string">&#x27;状态&#x27;</span>, res.status_code)<br>            <span class="hljs-comment"># 如果返回状态不是200，则抛出异常</span><br>            res.raise_for_status()<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span>:<br>            timeout = <span class="hljs-number">3</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;链接失败,等待&#x27;</span>, timeout, <span class="hljs-string">&#x27;秒重试&#x27;</span>)<br>            time.sleep(timeout)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;重新链接中&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;请求成功，开始获取商品链接&#x27;</span>)<br>    <span class="hljs-comment"># html.parser 指定解析器</span><br>    noStarchSoup = bs4.BeautifulSoup(res.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    url = noStarchSoup.select(product_link_select)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(url)):<br>        imgurl = domainWithProtocol + url[i].get(<span class="hljs-string">&#x27;href&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;获取产品url&#x27;</span>)<br>        <span class="hljs-comment"># 调用采集内容方法</span><br>        crawl_product(imgurl)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><br><span class="hljs-string">&#x27;&#x27;&#x27;采集商品url结束&#x27;&#x27;&#x27;</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;采集商品内容开始&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crawl_product</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;开始请求产品页面&#x27;</span>, url)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            res = requests.get(url, timeout=<span class="hljs-number">30</span>)<br>            res.encoding = res.apparent_encoding<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;成功请求商品页面:&#x27;</span>, res.status_code)<br>            res.raise_for_status()  <span class="hljs-comment"># 如果下载发生问题，就抛出异常</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;请求商品页面&#x27;</span>, url, <span class="hljs-string">&#x27;失败，重新链接&#x27;</span>)<br><br>    noStarchSoup = bs4.BeautifulSoup(res.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    name = noStarchSoup.select(product_title_select)<br>    name = name[<span class="hljs-number">0</span>].getText()<br>    price = noStarchSoup.select(product_price_select)<br>    price = price[<span class="hljs-number">0</span>].getText()<br>    price = re.sub(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, price)<br>    price = re.sub(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, price)<br>    des = noStarchSoup.select(product_desc_select)<br>    des = des[<span class="hljs-number">0</span>].getText()<br>    img = noStarchSoup.select(product_img_select)<br>    l = []<br>    <span class="hljs-keyword">if</span> img != []:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(img)):<br>            imgurl = img[i].get(<span class="hljs-string">&#x27;src&#x27;</span>)<br>            <span class="hljs-keyword">if</span> imgurl <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                imgurl = img[i].get(<span class="hljs-string">&#x27;data-src&#x27;</span>)<br>            <span class="hljs-keyword">if</span> imgurl.__contains__(<span class="hljs-string">&#x27;&#123;width&#125;&#x27;</span>):<br>                <span class="hljs-keyword">continue</span><br>            l.append(<span class="hljs-string">&#x27;https:&#x27;</span> + imgurl)<br>        l = <span class="hljs-string">&#x27;\r\n&#x27;</span>.join(l)<br>    fileHeader = [<span class="hljs-string">&#x27;标题&#x27;</span>, <span class="hljs-string">&#x27;产品url&#x27;</span>, <span class="hljs-string">&#x27;价格&#x27;</span>, <span class="hljs-string">&#x27;描述&#x27;</span>, <span class="hljs-string">&#x27;图片&#x27;</span>]<br>    file = [name, url, price, des, l]<br>    <span class="hljs-comment"># 文件存储的地方，文件夹需要事先创建，并指定文件的格式为utf-8</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            csvFile = <span class="hljs-built_in">open</span>(csv_name, <span class="hljs-string">&#x27;a+&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(e)<br>            <span class="hljs-built_in">print</span>(csv_name + <span class="hljs-string">&#x27;文件写入失败，重试中。。。。。&#x27;</span>)<br>            time.sleep(<span class="hljs-number">5</span>)<br>    size = os.path.getsize(csv_name)  <span class="hljs-comment"># 判断文件大小，如果文件大于0则表示文件有内</span><br>    writer = csv.writer(csvFile)<br>    <span class="hljs-keyword">if</span> size == <span class="hljs-number">0</span>:<br>        writer.writerow(fileHeader)<br>        writer.writerow(file)<br>        csvFile.close()<br>    <span class="hljs-keyword">else</span>:<br>        writer.writerow(file)<br>        csvFile.close()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;采集成功！&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    protocol = <span class="hljs-string">&#x27;https://&#x27;</span><br>    domain = re.match(<span class="hljs-string">&#x27;https://(.*)/collections&#x27;</span>, url_pro).group(<span class="hljs-number">1</span>)<br>    domainWithProtocol = protocol + domain<br>    csv_name = domain + time.strftime(<span class="hljs-string">&#x27;_%Y-%m-%d-%H-%M-%S&#x27;</span>, time.localtime(time.time())) + <span class="hljs-string">&#x27;.csv&#x27;</span><br>    <span class="hljs-built_in">next</span> = [<span class="hljs-string">&#x27;1&#x27;</span>]<br>    n = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">next</span> != []:<br>        url = url_pro + <span class="hljs-string">&#x27;?sort_by=best-selling&amp;page=&#x27;</span> + <span class="hljs-built_in">str</span>(n)<br>        <span class="hljs-comment"># 调用采集列表方法</span><br>        crawl_collections(url)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;成功采集&#x27;</span>, n, <span class="hljs-string">&#x27;页&#x27;</span>)<br>        n = n + <span class="hljs-number">1</span><br>        res = requests.get(url)<br>        res.raise_for_status()<br>        noStarchSoup = bs4.BeautifulSoup(res.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>        <span class="hljs-built_in">next</span> = noStarchSoup.select(<span class="hljs-string">&#x27;.next&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;全部采集完毕！！&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>效果：</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202208011527113.png" alt="image-20220801152718166"></p>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OkhttpUtils 工具类</title>
    <link href="/2022/07/26/OkhttpUtils%20%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <url>/2022/07/26/OkhttpUtils%20%E5%B7%A5%E5%85%B7%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<p>记录一下OkhttpUtils工具类</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by IntelliJ IDEA.</span><br><span class="hljs-comment"> * User: 贝先 [ Cason mo ]</span><br><span class="hljs-comment"> * Date: 2022/5/20</span><br><span class="hljs-comment"> * Time: 10:56</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OkHttpUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(OkHttpUtils.class);<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">readTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">connectTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">writeTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">MediaType</span> <span class="hljs-variable">JSON</span> <span class="hljs-operator">=</span> MediaType.parse(<span class="hljs-string">&quot;application/json; charset=utf-8&quot;</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] LOCKER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> OkHttpUtils mInstance;<br>    <span class="hljs-keyword">private</span> OkHttpClient mOkHttpClient;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setReadTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> readTimeout)</span> &#123;<br>        <span class="hljs-built_in">this</span>.readTimeout = readTimeout;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setConnectTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> connectTimeout)</span> &#123;<br>        <span class="hljs-built_in">this</span>.connectTimeout = connectTimeout;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWriteTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> writeTimeout)</span> &#123;<br>        <span class="hljs-built_in">this</span>.writeTimeout = writeTimeout;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 自定义网络回调接口</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NetCall</span> &#123;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">success</span><span class="hljs-params">(Call call, Response response)</span> <span class="hljs-keyword">throws</span> IOException;<br><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">failed</span><span class="hljs-params">(Call call, IOException e)</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">OkHttpUtils</span><span class="hljs-params">()</span> &#123;<br>        okhttp3.OkHttpClient.<span class="hljs-type">Builder</span> <span class="hljs-variable">clientBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">okhttp3</span>.OkHttpClient.Builder();<br>        clientBuilder.readTimeout(readTimeout, TimeUnit.SECONDS);<span class="hljs-comment">//读取超时</span><br>        clientBuilder.connectTimeout(connectTimeout, TimeUnit.SECONDS);<span class="hljs-comment">//连接超时</span><br>        clientBuilder.writeTimeout(writeTimeout, TimeUnit.SECONDS);<span class="hljs-comment">//写入超时</span><br>        clientBuilder.hostnameVerifier(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostnameVerifier</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verify</span><span class="hljs-params">(String hostname, SSLSession session)</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;);<br>        mOkHttpClient = clientBuilder.build();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> OkHttpUtils <span class="hljs-title function_">newInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpUtils</span>();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 单例模式获取OkHttpUtil</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> OkHttpUtils <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mInstance == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (LOCKER) &#123;<br>                <span class="hljs-keyword">if</span> (mInstance == <span class="hljs-literal">null</span>) &#123;<br>                    mInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpUtils</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> mInstance;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">get</span><span class="hljs-params">(String url, Map&lt;String, String&gt; params, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        <span class="hljs-type">UriBuilder</span> <span class="hljs-variable">uriBuilder</span> <span class="hljs-operator">=</span> UriBuilder.fromUri(url);<br>        <span class="hljs-keyword">if</span> (params != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; param : params.entrySet()) &#123;<br>                <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(param.getKey())) &#123;<br>                    uriBuilder.queryParam(param.getKey(), param.getValue());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> builder.get().url(uriBuilder.build().toString()).headers(headers).build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Response <span class="hljs-title function_">post</span><span class="hljs-params">(String url, T t, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">requestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        requestBuilder.post(RequestBody.create(JSON, <span class="hljs-string">&quot;&quot;</span>)).url(url).headers(headers);<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, JsonUtils.toJSONString(t));<br>            requestBuilder.post(body);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestBuilder.build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Response <span class="hljs-title function_">patch</span><span class="hljs-params">(String url, T t, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">requestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        requestBuilder.patch(RequestBody.create(JSON, <span class="hljs-string">&quot;&quot;</span>)).url(url).headers(headers);<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, JsonUtils.toJSONString(t));<br>            requestBuilder.patch(body);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestBuilder.build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">postJson</span><span class="hljs-params">(String url, String json, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, json);<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()<br>                .url(url)<br>                .post(body)<br>                .headers(headers)<br>                .build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-keyword">return</span> mOkHttpClient.newCall(request).execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Response <span class="hljs-title function_">put</span><span class="hljs-params">(String url, T t, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">requestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        requestBuilder.put(RequestBody.create(JSON, <span class="hljs-string">&quot;&quot;</span>)).url(url).headers(headers);<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, JsonUtils.toJSONString(t));<br>            requestBuilder.put(body);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestBuilder.build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">putJson</span><span class="hljs-params">(String url, String json, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, json);<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()<br>                .url(url)<br>                .put(body)<br>                .headers(headers)<br>                .build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-keyword">return</span> mOkHttpClient.newCall(request).execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Response <span class="hljs-title function_">delete</span><span class="hljs-params">(String url, T t, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">requestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        requestBuilder.delete().url(url).headers(headers);<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, JsonUtils.toJSONString(t));<br>            requestBuilder.delete(body);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestBuilder.build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">deleteJson</span><span class="hljs-params">(String url, String json, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, json);<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()<br>                .url(url)<br>                .delete(body)<br>                .headers(headers)<br>                .build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-keyword">return</span> mOkHttpClient.newCall(request).execute();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRequestBody</span><span class="hljs-params">(Request request)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Buffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Buffer</span>();<br>        <span class="hljs-keyword">if</span> (request.body() != <span class="hljs-literal">null</span>) &#123;<br>            request.body().writeTo(buffer);<br>            <span class="hljs-keyword">return</span> buffer.clone().readUtf8();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>获取指定包下使用指定注解相关的类、方法、字段</title>
    <link href="/2022/07/20/%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E5%8C%85%E4%B8%8B%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E6%B3%A8%E8%A7%A3%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB%E3%80%81%E6%96%B9%E6%B3%95%E3%80%81%E5%AD%97%E6%AE%B5/"/>
    <url>/2022/07/20/%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E5%8C%85%E4%B8%8B%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E6%B3%A8%E8%A7%A3%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB%E3%80%81%E6%96%B9%E6%B3%95%E3%80%81%E5%AD%97%E6%AE%B5/</url>
    
    <content type="html"><![CDATA[<p>通过对指定包下的所有类文件进行扫描，获取使用指定注解的所有类、方法、字段</p><h3 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.core.io.DefaultResourceLoader;<br><span class="hljs-keyword">import</span> org.springframework.core.io.Resource;<br><span class="hljs-keyword">import</span> org.springframework.core.io.ResourceLoader;<br><span class="hljs-keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;<br><span class="hljs-keyword">import</span> org.springframework.core.io.support.ResourcePatternUtils;<br><span class="hljs-keyword">import</span> org.springframework.core.type.ClassMetadata;<br><span class="hljs-keyword">import</span> org.springframework.core.type.classreading.MetadataReader;<br><span class="hljs-keyword">import</span> org.springframework.core.type.classreading.MetadataReaderFactory;<br><span class="hljs-keyword">import</span> org.springframework.core.type.classreading.SimpleMetadataReaderFactory;<br><span class="hljs-keyword">import</span> org.springframework.util.ClassUtils;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.lang.annotation.Annotation;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by IntelliJ IDEA.</span><br><span class="hljs-comment"> * User: 贝先 [ Cason mo ]</span><br><span class="hljs-comment"> * Date: 2022/6/29</span><br><span class="hljs-comment"> * Time: 10:45</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(AnnotationUtils.class);<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_RESOURCE_PATTERN</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;**/*.class&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> AnnotationUtils mInstance;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">LOCKER</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 单例模式获取AnnotationUtils</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AnnotationUtils <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mInstance == <span class="hljs-literal">null</span>) &#123;<br>            LOCKER.lock();<br>            <span class="hljs-keyword">if</span> (mInstance == <span class="hljs-literal">null</span>) &#123;<br>                mInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationUtils</span>();<br>            &#125;<br>            LOCKER.unlock();<br>        &#125;<br>        <span class="hljs-keyword">return</span> mInstance;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Class&lt;?&gt;&gt; getClassCandidates(String basePackages, Class clazz) &#123;<br>        List&lt;Class&lt;?&gt;&gt; candidates = scanPackagesForClass(basePackages, clazz);<br>        validateCandidates(basePackages, candidates.isEmpty());<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Method&gt; <span class="hljs-title function_">getMethodCandidates</span><span class="hljs-params">(String basePackages, Class clazz)</span> &#123;<br>        List&lt;Method&gt; candidates = scanPackagesForMethod(basePackages, clazz);<br>        validateCandidates(basePackages, candidates.isEmpty());<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Field&gt; <span class="hljs-title function_">getFieldCandidates</span><span class="hljs-params">(String basePackages, Class clazz)</span> &#123;<br>        List&lt;Field&gt; candidates = scanPackagesForField(basePackages, clazz);<br>        validateCandidates(basePackages, candidates.isEmpty());<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Class&lt;?&gt;&gt; scanPackagesForClass(String basePackages, Class clazz) &#123;<br>        List&lt;Class&lt;?&gt;&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Class&lt;?&gt;&gt;();<br>        <span class="hljs-keyword">try</span> &#123;<br>            candidates.addAll(findCandidateClasses(basePackages, clazz));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            logger.error(<span class="hljs-string">&quot;扫描指定包时出现异常&quot;</span>, basePackages);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Method&gt; <span class="hljs-title function_">scanPackagesForMethod</span><span class="hljs-params">(String basePackages, Class clazz)</span> &#123;<br>        List&lt;Method&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Method&gt;();<br>        <span class="hljs-keyword">try</span> &#123;<br>            candidates.addAll(findCandidateMethod(basePackages, clazz));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            logger.error(<span class="hljs-string">&quot;扫描指定包时出现异常&quot;</span>, basePackages);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Field&gt; <span class="hljs-title function_">scanPackagesForField</span><span class="hljs-params">(String basePackages, Class clazz)</span> &#123;<br>        List&lt;Field&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Field&gt;();<br>        <span class="hljs-keyword">try</span> &#123;<br>            candidates.addAll(findCandidateField(basePackages, clazz));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            logger.error(<span class="hljs-string">&quot;扫描指定包时出现异常&quot;</span>, basePackages);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Class&lt;?&gt;&gt; findCandidateClasses(String basePackage, Class clazz) <span class="hljs-keyword">throws</span> IOException &#123;<br>        List&lt;Class&lt;?&gt;&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Class&lt;?&gt;&gt;();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">packageSearchPath</span> <span class="hljs-operator">=</span> getPackageSearchPath(basePackage);<br>        <span class="hljs-type">ResourceLoader</span> <span class="hljs-variable">resourceLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultResourceLoader</span>();<br>        <span class="hljs-type">MetadataReaderFactory</span> <span class="hljs-variable">readerFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMetadataReaderFactory</span>(resourceLoader);<br>        Resource[] resources = ResourcePatternUtils.getResourcePatternResolver(resourceLoader).getResources(packageSearchPath);<br>        <span class="hljs-keyword">for</span> (Resource resource : resources) &#123;<br>            <span class="hljs-type">MetadataReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> readerFactory.getMetadataReader(resource);<br>            <span class="hljs-keyword">if</span> (match(reader.getClassMetadata(), clazz)) &#123;<br>                Class&lt;?&gt; candidateClass = transform(reader.getClassMetadata().getClassName());<br>                <span class="hljs-keyword">if</span> (candidateClass != <span class="hljs-literal">null</span>) &#123;<br>                    candidates.add(candidateClass);<br>                    logger.debug(<span class="hljs-string">&quot;扫描到符合要求的类：&quot;</span> + candidateClass.getName());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Method&gt; <span class="hljs-title function_">findCandidateMethod</span><span class="hljs-params">(String basePackage, Class clazz)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        List&lt;Method&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Method&gt;();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">packageSearchPath</span> <span class="hljs-operator">=</span> getPackageSearchPath(basePackage);<br>        <span class="hljs-type">ResourceLoader</span> <span class="hljs-variable">resourceLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultResourceLoader</span>();<br>        <span class="hljs-type">MetadataReaderFactory</span> <span class="hljs-variable">readerFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMetadataReaderFactory</span>(resourceLoader);<br>        Resource[] resources = ResourcePatternUtils.getResourcePatternResolver(resourceLoader).getResources(packageSearchPath);<br>        <span class="hljs-keyword">for</span> (Resource resource : resources) &#123;<br>            <span class="hljs-type">MetadataReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> readerFactory.getMetadataReader(resource);<br>            matchMethod(clazz, candidates, reader);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Field&gt; <span class="hljs-title function_">findCandidateField</span><span class="hljs-params">(String basePackage, Class clazz)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        List&lt;Field&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Field&gt;();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">packageSearchPath</span> <span class="hljs-operator">=</span> getPackageSearchPath(basePackage);<br>        <span class="hljs-type">ResourceLoader</span> <span class="hljs-variable">resourceLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultResourceLoader</span>();<br>        <span class="hljs-type">MetadataReaderFactory</span> <span class="hljs-variable">readerFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMetadataReaderFactory</span>(resourceLoader);<br>        Resource[] resources = ResourcePatternUtils.getResourcePatternResolver(resourceLoader).getResources(packageSearchPath);<br>        <span class="hljs-keyword">for</span> (Resource resource : resources) &#123;<br>            <span class="hljs-type">MetadataReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> readerFactory.getMetadataReader(resource);<br>            matchField(clazz, candidates, reader);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">matchMethod</span><span class="hljs-params">(Class clazz, List&lt;Method&gt; candidates, MetadataReader reader)</span> &#123;<br>        Class&lt;?&gt; clz = transformToClass(reader.getClassMetadata().getClassName());<br>        Method[] methods = clz.getMethods();<br>        <span class="hljs-keyword">for</span> (Method method : methods) &#123;<br>            <span class="hljs-type">Annotation</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> method.getAnnotation(clazz);<br><br>            <span class="hljs-keyword">if</span> (annotation == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (method != <span class="hljs-literal">null</span> &amp;&amp; method.isAnnotationPresent(clazz)) &#123;<br>                candidates.add(method);<br>                logger.debug(<span class="hljs-string">&quot;扫描到符合要求的method：&quot;</span> + method.getName());<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">matchField</span><span class="hljs-params">(Class clazz, List&lt;Field&gt; candidates, MetadataReader reader)</span> &#123;<br>        Class&lt;?&gt; clz = transformToClass(reader.getClassMetadata().getClassName());<br>        Field[] declaredFields = clz.getDeclaredFields();<br>        <span class="hljs-keyword">for</span> (Field field : declaredFields) &#123;<br>            <span class="hljs-type">Annotation</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> field.getAnnotation(clazz);<br><br>            <span class="hljs-keyword">if</span> (annotation == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (field != <span class="hljs-literal">null</span> &amp;&amp; field.isAnnotationPresent(clazz)) &#123;<br>                candidates.add(field);<br>                logger.debug(<span class="hljs-string">&quot;扫描到符合要求的field：&quot;</span> + field.getName());<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">convertPath</span><span class="hljs-params">(String path)</span> &#123;<br>        <span class="hljs-keyword">return</span> StringUtils.replace(path, <span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; transform(String className) &#123;<br>        Class&lt;?&gt; clazz = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            clazz = ClassUtils.forName(className, <span class="hljs-built_in">this</span>.getClass().getClassLoader());<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            logger.info(<span class="hljs-string">&quot;未找到指定类&quot;</span>, className);<br>        &#125;<br>        <span class="hljs-keyword">return</span> clazz;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(ClassMetadata metadata, Class c)</span> &#123;<br>        Class&lt;?&gt; clazz = transformToClass(metadata.getClassName());<br>        <span class="hljs-keyword">return</span> clazz != <span class="hljs-literal">null</span> &amp;&amp; clazz.isAnnotationPresent(c);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; transformToClass(String className) &#123;<br>        Class&lt;?&gt; clazz = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            clazz = ClassUtils.forName(className, <span class="hljs-built_in">this</span>.getClass().getClassLoader());<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            logger.info(<span class="hljs-string">&quot;未找到指定类&quot;</span>, className);<br>        &#125;<br>        <span class="hljs-keyword">return</span> clazz;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateCandidates</span><span class="hljs-params">(String basePackages, <span class="hljs-type">boolean</span> empty)</span> &#123;<br>        <span class="hljs-keyword">if</span> (empty) &#123;<br>            logger.info(<span class="hljs-string">&quot;扫描指定包下，未发现符合条件的类&quot;</span>, basePackages);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getPackageSearchPath</span><span class="hljs-params">(String basePackage)</span> &#123;<br>        <span class="hljs-keyword">return</span> ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +<br>                convertPath(basePackage) + <span class="hljs-string">&#x27;/&#x27;</span> + DEFAULT_RESOURCE_PATTERN;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//获取使用指定注解的所有类</span><br>List&lt;Class&lt;?&gt;&gt; candidates = AnnotationUtils.getInstance().getClassCandidates(<span class="hljs-string">&quot;com.cason&quot;</span>, PermitAccountStatus.class);<br><span class="hljs-comment">//获取使用指定注解的所有方法</span><br>List&lt;Method&gt; methodCandidates = AnnotationUtils.getInstance().getMethodCandidates(<span class="hljs-string">&quot;com.cason&quot;</span>, PermitAccountStatus.class);<br><span class="hljs-comment">//获取使用指定注解的所有字段</span><br>List&lt;Field&gt; fieldCandidates = AnnotationUtils.getInstance().getFieldCandidates(<span class="hljs-string">&quot;com.cason&quot;</span>, PermitAccountStatus.class);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>使用ImageIO读取网络图片或本地图片</title>
    <link href="/2022/07/19/%E4%BD%BF%E7%94%A8ImageIO%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E6%88%96%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/"/>
    <url>/2022/07/19/%E4%BD%BF%E7%94%A8ImageIO%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E6%88%96%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<blockquote><p>来自网络</p></blockquote><h3 id="读取网络图片"><a href="#读取网络图片" class="headerlink" title="读取网络图片"></a>读取网络图片</h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(path);<br>BufferedImage source= ImageIO.read(url);<br></code></pre></td></tr></table></figure><h3 id="读取本地图片"><a href="#读取本地图片" class="headerlink" title="读取本地图片"></a>读取本地图片</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">BufferedImage source= ImageIO.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path));<br></code></pre></td></tr></table></figure><h3 id="获取网络图片工具类"><a href="#获取网络图片工具类" class="headerlink" title="获取网络图片工具类"></a>获取网络图片工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpImageUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(HttpImageUtils.class);<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取网络图片转成字节流</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> strUrl 完整图片地址</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 图片资源数组</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] getNetImgByUrl(String strUrl) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(strUrl);<br>            <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> (HttpURLConnection) url.openConnection();<br>            conn.setRequestMethod(<span class="hljs-string">&quot;GET&quot;</span>);<br>            conn.setConnectTimeout(TIMEOUT);<br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">inStream</span> <span class="hljs-operator">=</span> conn.getInputStream();<br>            <span class="hljs-keyword">return</span> readInputStream(inStream);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            logger.error(e.getMessage(),e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 从输入流中获取字节流数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> inStream 输入流</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span>  图片流</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] readInputStream(InputStream inStream) <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">outStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[Integer.MAX_VALUE];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> ((len = inStream.read(buffer)) != -<span class="hljs-number">1</span>) &#123;<br>            outStream.write(buffer, <span class="hljs-number">0</span>, len);<br>        &#125;<br>        inStream.close();<br>        <span class="hljs-keyword">return</span> outStream.toByteArray();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>解决Okhttp只能获取一次responsebody的问题</title>
    <link href="/2022/07/18/%E8%A7%A3%E5%86%B3Okhttp%E5%8F%AA%E8%83%BD%E8%8E%B7%E5%8F%96%E4%B8%80%E6%AC%A1responsebody%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2022/07/18/%E8%A7%A3%E5%86%B3Okhttp%E5%8F%AA%E8%83%BD%E8%8E%B7%E5%8F%96%E4%B8%80%E6%AC%A1responsebody%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>okhttp通过response.body().string() 获取字符串类型的responsebody</p><h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><pre><code class="hljs java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">string</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> source()) &#123;<br>      <span class="hljs-type">Charset</span> <span class="hljs-variable">charset</span> <span class="hljs-operator">=</span> Util.bomAwareCharset(source, charset());<br>      <span class="hljs-keyword">return</span> source.readString(charset);<br>    &#125;<br>  &#125;<br><br><br><span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>    Util.closeQuietly(source());<br>  &#125;<br></code></pre></td></tr></table></figure><p>ResponseBody，其实现了 <code>Closeable</code> 接口，通过复写 <code>close()</code> 方法来 <strong>关闭并释放资源</strong>，关闭 <code>ResponseBody</code> 子类所持有的 <code>BufferedSource</code> 接口对象，当我们第一次调用 <code>response.body().string()</code> 时，OkHttp 将响应体的缓冲资源返回的同时，调用 <code>closeQuietly()</code> 方法默默释放了资源</p><h3 id="获取responseBody"><a href="#获取responseBody" class="headerlink" title="获取responseBody"></a>获取responseBody</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getResponseBody</span><span class="hljs-params">(Response response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>     <span class="hljs-type">BufferedSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> response.body().source();<br>     source.request(Long.MAX_VALUE);<br>     <span class="hljs-type">Buffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> source.getBuffer();<br>     <span class="hljs-type">String</span> <span class="hljs-variable">responseBody</span> <span class="hljs-operator">=</span> buffer.clone().readUtf8();<br>     <span class="hljs-keyword">return</span> responseBody;<br> &#125;<br></code></pre></td></tr></table></figure><h3 id="获取requestBody"><a href="#获取requestBody" class="headerlink" title="获取requestBody"></a>获取requestBody</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRequestBody</span><span class="hljs-params">(Request request)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Buffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Buffer</span>();<br>        <span class="hljs-keyword">if</span> (request.body() != <span class="hljs-literal">null</span>) &#123;<br>            request.body().writeTo(buffer);<br>            <span class="hljs-keyword">return</span> buffer.clone().readUtf8();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>okhttp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>InheritableThreadLocal解决ThreadLocal子线程不可继承父线程变量的问题</title>
    <link href="/2022/06/17/InheritableThreadLocal%E8%A7%A3%E5%86%B3ThreadLocal%E5%AD%90%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%8F%AF%E7%BB%A7%E6%89%BF%E7%88%B6%E7%BA%BF%E7%A8%8B%E5%8F%98%E9%87%8F%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2022/06/17/InheritableThreadLocal%E8%A7%A3%E5%86%B3ThreadLocal%E5%AD%90%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%8F%AF%E7%BB%A7%E6%89%BF%E7%88%B6%E7%BA%BF%E7%A8%8B%E5%8F%98%E9%87%8F%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>当我用Mybatis-plus自动填充创建人员，更新人员字段的时候，发现数据库中又很多字段都没有记录这两个字段，通过分析发现是因为这些更新或者创建操作是在异步的情况下去执行的，由于父线程创建的子线程无法获取父线程的ThreadLocal变量，导致无法正确的获取这两个字段。</p><blockquote><p>以下代码说明使用ThreadLocal 子线程无法访问父线程的线程变量</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestThreadLocal</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;String&gt; username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        username.set(<span class="hljs-string">&quot;beixian&quot;</span>);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;子线程获取：&quot;</span>+username.get());<br>            &#125;<br>        &#125;);<br>        thread.start();<br>        System.out.println(<span class="hljs-string">&quot;main线程获取&quot;</span>+username.get());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202206180001004.png" alt="TestThreadLocal.main执行结果"></p><p>原因：子线程ThreadLocal get()获取的的是子线程的threadLocals里的值，而父线程set()的是父线程的threadLocals里的值，而子线程创建的时候没有继承threadLocals里的值。</p><blockquote><p>以下代码说明使用InheritableThreadLocal子线程可以访问父线程的线程变量</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestInheritableThreadLocal</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> InheritableThreadLocal&lt;String&gt; username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        username.set(<span class="hljs-string">&quot;beixian&quot;</span>);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;子线程获取：&quot;</span>+username.get());<br>            &#125;<br>        &#125;);<br>        thread.start();<br>        System.out.println(<span class="hljs-string">&quot;main线程获取&quot;</span>+username.get());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202206180001992.png" alt="TestInheritableThreadLocal.main执行结果"></p><p>解决方案：InheritableThreadLocal可以帮助我们解决这个问题，子线程在初始化的时候会通过父线程的inheritThreadLocals变量初始化子线程的inheritThreadLocals变量，这样子线程拥有了父线程的线程变量并可访问。</p><h5 id="Thread-init-源码"><a href="#Thread-init-源码" class="headerlink" title="Thread init()源码"></a>Thread init()源码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Thread的构造方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Thread</span><span class="hljs-params">(Runnable target)</span> &#123;<br>        init(<span class="hljs-literal">null</span>, target, <span class="hljs-string">&quot;Thread-&quot;</span> + nextThreadNum(), <span class="hljs-number">0</span>);<br>    &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,</span><br><span class="hljs-params">                      <span class="hljs-type">long</span> stackSize)</span> &#123;<br>  <span class="hljs-comment">//这里设置了inheritThreadLocals为true</span><br>        init(g, target, name, stackSize, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,</span><br><span class="hljs-params">                      <span class="hljs-type">long</span> stackSize, AccessControlContext acc,</span><br><span class="hljs-params">                      <span class="hljs-type">boolean</span> inheritThreadLocals)</span> &#123;<br>      <span class="hljs-comment">/**省略部分代码**/</span><br>  <span class="hljs-comment">// inheritThreadLocals为true 且 父线程的inheritThreadLocals不为空</span><br>        <span class="hljs-keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="hljs-literal">null</span>)<br>            <span class="hljs-built_in">this</span>.inheritableThreadLocals =<br>                ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);<br>       <span class="hljs-comment">/**省略部分代码**/</span><br>    &#125;<br><br><span class="hljs-keyword">static</span> ThreadLocalMap <span class="hljs-title function_">createInheritedMap</span><span class="hljs-params">(ThreadLocalMap parentMap)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(parentMap);<br>    &#125;<br></code></pre></td></tr></table></figure><h5 id="InheritableThreadLocal源码"><a href="#InheritableThreadLocal源码" class="headerlink" title="InheritableThreadLocal源码"></a>InheritableThreadLocal源码</h5><p>InheritableThreadLocal继承于ThreadLocal，只是重写了childValue()，getMap()，createMap()方法，重写的原因是因为要获取和操作的不在是Thread.threadLocals这个变量，而是inheritableThreadLocals这个变量</p><p>get()、set()等方法同ThreadLocal，可以参考【Threadlocal的简单理解和部分源码分析】这篇文章</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ThreadLocal</span>&lt;T&gt; &#123;<br>  <br>    <span class="hljs-keyword">protected</span> T <span class="hljs-title function_">childValue</span><span class="hljs-params">(T parentValue)</span> &#123;<br>        <span class="hljs-keyword">return</span> parentValue;<br>    &#125;<br><br>    ThreadLocalMap <span class="hljs-title function_">getMap</span><span class="hljs-params">(Thread t)</span> &#123;<br>       <span class="hljs-keyword">return</span> t.inheritableThreadLocals;<br>    &#125;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> &#123;<br>        t.inheritableThreadLocals = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(<span class="hljs-built_in">this</span>, firstValue);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>并发编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ThreadLocal</tag>
      
      <tag>InheritableThreadLocal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Threadlocal的简单理解和部分源码分析</title>
    <link href="/2022/06/16/Threadlocal%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E5%92%8C%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <url>/2022/06/16/Threadlocal%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E5%92%8C%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>Mybatis-plus 可以实现字段自动填充功能，我通常会把多个表中共同字段抽离到了一个公共实体类中，如创建时间，创建人员，更新时间，更新人员等等，但是如何获取当前用户信息填入创建人员，更新人员字段？</p><p>ThreadLocal可以帮助我解决这个问题，我使用的的是JWT token 验证登陆状态，在每次Http请求时Header都会附带token，token中就会附带用户信息，当我们验证完后把用户信息set进Threadlocal，就可以在同一个线程中通过ThreadLocal获取用户信息。</p><h4 id="ThreadLocal理解"><a href="#ThreadLocal理解" class="headerlink" title="ThreadLocal理解"></a>ThreadLocal理解</h4><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202206162045177.png" alt="图源自网络"></p><p>ThreadLocal是线程安全的，它可以确保多线程访问时每个线程只能访问到自己的线程私有变量。它的线程隔离机制是通过把共享变量的副本存储到Thread.threadLocals实现，每个线程只能访问自己的副本，就能避免线程安全问题。</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202206162045799.png" alt="Thread类截图"></p><p>ThreadLocal实际上就是一个操作Thread.threadLocals的外壳。Thread.threadLocals变量是一个keyvalueMap，Thread创建的时候默认初始化threadLocals为null，在ThreadLocal首次读或写的时候初始化threadLocals。ThreadLocalMap是ThreadLocal中的静态内部类，ThreadLocalMap通过Entry键值对的方式存储数据，是一个定制化的Map。</p><h4 id="ThreadLocal源码分析"><a href="#ThreadLocal源码分析" class="headerlink" title="ThreadLocal源码分析"></a>ThreadLocal源码分析</h4><h5 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h5><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>  <span class="hljs-comment">//获取当前线程</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>  <span class="hljs-comment">//获取Thread.threadLocals</span><br>        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>  <span class="hljs-comment">//map不为空就设入键值对 key为当前ThreadLocal对象 </span><br>        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)<br>            map.set(<span class="hljs-built_in">this</span>, value);<br>        <span class="hljs-keyword">else</span><br>          <span class="hljs-comment">//否则创建Thread.threadLocals</span><br>            createMap(t, value);<br>    &#125;<br></code></pre></td></tr></table></figure><p>我们可以发现ThreadLocal set的方法是对Thread.threadLocals这个定制化的Map进行操作</p><h6 id="getMap"><a href="#getMap" class="headerlink" title="getMap()"></a>getMap()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadLocalMap <span class="hljs-title function_">getMap</span><span class="hljs-params">(Thread t)</span> &#123;<br>  <span class="hljs-comment">//就是取出Thread.threadLocals</span><br>    <span class="hljs-keyword">return</span> t.threadLocals;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="createMap"><a href="#createMap" class="headerlink" title="createMap()"></a>createMap()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> &#123;<br>  <span class="hljs-comment">//以当前TreadLocal对象为key 创建并初始化一个Thread.threadLocals</span><br>    t.threadLocals = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(<span class="hljs-built_in">this</span>, firstValue);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-comment">//获取当前线程</span><br>     <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>  <span class="hljs-comment">//获取Thread.threadLocals</span><br>     <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>  <span class="hljs-comment">//map不为空 通过当前对象作为key 获取值</span><br>     <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>         ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);<br>       <span class="hljs-comment">//map部位空还得判断当前键在不在map里</span><br>         <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>             <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>             <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;<br>             <span class="hljs-keyword">return</span> result;<br>         &#125;<br>     &#125;<br>  <span class="hljs-comment">// map为空就创建并初始化</span><br>     <span class="hljs-keyword">return</span> setInitialValue();<br> &#125;<br></code></pre></td></tr></table></figure><h6 id="setInitialValue"><a href="#setInitialValue" class="headerlink" title="setInitialValue()"></a>setInitialValue()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-keyword">private</span> T <span class="hljs-title function_">setInitialValue</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-comment">//初始化value为null</span><br>       <span class="hljs-type">T</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> initialValue();<br>     <span class="hljs-comment">//获取当前线程</span><br>       <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>     <span class="hljs-comment">//获取Thread.threadLocals</span><br>       <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>     <span class="hljs-comment">//判断map是否为空 不为空就把 key为当前对象 value为null 设置进map</span><br>       <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)<br>           map.set(<span class="hljs-built_in">this</span>, value);<br>       <span class="hljs-keyword">else</span><br>         <span class="hljs-comment">//否则就创建并初始化Thread.threadLocals</span><br>           createMap(t, value);<br>       <span class="hljs-keyword">return</span> value;<br>   &#125;<br><br><span class="hljs-keyword">protected</span> T <span class="hljs-title function_">initialValue</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>   &#125;<br></code></pre></td></tr></table></figure><h5 id="remove"><a href="#remove" class="headerlink" title="remove()"></a>remove()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-comment">//在当前线程里获取Thread.threadLocals</span><br>        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> getMap(Thread.currentThread());<br>        <span class="hljs-keyword">if</span> (m != <span class="hljs-literal">null</span>)<br>           <span class="hljs-comment">//在map里移除 以当前对象为key的 键值对</span><br>            m.remove(<span class="hljs-built_in">this</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>并发编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ThreadLocal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springboot集成WebSocket实现消息推送 记录</title>
    <link href="/2022/06/07/Springboot%E9%9B%86%E6%88%90WebSocket%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81-%E8%AE%B0%E5%BD%95/"/>
    <url>/2022/06/07/Springboot%E9%9B%86%E6%88%90WebSocket%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81-%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h3 id="一、什么是WebSocket？"><a href="#一、什么是WebSocket？" class="headerlink" title="一、什么是WebSocket？"></a>一、什么是WebSocket？</h3><p>WebSocket是HTML5开始提供的一种在单个TCP连接上进行全双工通讯的协议，能更好的节省服务器资源和带宽，并且能够更实时地进行通讯。</p><p>WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据，在WebSocket API中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。–来源自<a href="https://juejin.cn/post/6844904004762222606?utm_source=gold_browser_extension">https://juejin.cn/post/6844904004762222606?utm_source=gold_browser_extension</a></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202206071031666.jpeg" alt="img"></p><center><small>(图源自网络)</small></center><h3 id="二、与springboot集成"><a href="#二、与springboot集成" class="headerlink" title="二、与springboot集成"></a>二、与springboot集成</h3><h4 id="引入spring-boot-starter-websocket依赖"><a href="#引入spring-boot-starter-websocket依赖" class="headerlink" title="引入spring-boot-starter-websocket依赖"></a>引入spring-boot-starter-websocket依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;springboot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="新建WebSocketHandler"><a href="#新建WebSocketHandler" class="headerlink" title="新建WebSocketHandler"></a>新建WebSocketHandler</h4><p>MercuryWebsocketHandler.class 对连接建立处理，消息处理，错误处理，以及连接关闭处理等等</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MercuryWebSocketHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterConnectionEstablished</span><span class="hljs-params">(WebSocketSession webSocketSession)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">wsId</span> <span class="hljs-operator">=</span> WsSessionManager.getWsId(webSocketSession.getUri().getPath());<br>        <span class="hljs-keyword">if</span> (wsId != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// 用户连接成功，放入在线用户缓存</span><br>            WsSessionManager.add(wsId, webSocketSession);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;用户登录已经失效!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(WebSocketSession webSocketSession, WebSocketMessage&lt;?&gt; webSocketMessage)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> webSocketMessage.getPayload().toString();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">wsId</span> <span class="hljs-operator">=</span> WsSessionManager.getWsId(webSocketSession.getUri().getPath());<br>        System.out.println(<span class="hljs-string">&quot;server 接收到 &quot;</span> + wsId + <span class="hljs-string">&quot; 发送的 &quot;</span> + payload);<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleTransportError</span><span class="hljs-params">(WebSocketSession webSocketSession, Throwable throwable)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        log.error(<span class="hljs-string">&quot;发生错误&quot;</span>, throwable);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterConnectionClosed</span><span class="hljs-params">(WebSocketSession webSocketSession, CloseStatus closeStatus)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">wsId</span> <span class="hljs-operator">=</span> WsSessionManager.getWsId(webSocketSession.getUri().getPath());<br>        <span class="hljs-keyword">if</span> (wsId != <span class="hljs-literal">null</span>) &#123;<br>            WsSessionManager.removeAndClose(wsId);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsPartialMessages</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="实现WebSocketConfigurer-来对握手前后进行逻辑处理"><a href="#实现WebSocketConfigurer-来对握手前后进行逻辑处理" class="headerlink" title="实现WebSocketConfigurer 来对握手前后进行逻辑处理"></a>实现WebSocketConfigurer 来对握手前后进行逻辑处理</h4><p>因为我需要对websocket 握手前进行校验，所以创建WebSocketHandshakeInterceptor.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketHandshakeInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpSessionHandshakeInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">beforeHandshake</span><span class="hljs-params">(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler webSocketHandler, Map&lt;String, Object&gt; attributes)</span><br>            <span class="hljs-keyword">throws</span> Exception &#123;<br>       <span class="hljs-comment">/**省略校验逻辑 校验不通过 return false**/</span><br>      <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.beforeHandshake(request, response, webSocketHandler, attributes);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterHandshake</span><span class="hljs-params">(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Exception e)</span> &#123;<br>        <span class="hljs-built_in">super</span>.afterHandshake(request, response, wsHandler, e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="实现WebSocketConfigurer"><a href="#实现WebSocketConfigurer" class="headerlink" title="实现WebSocketConfigurer"></a>实现WebSocketConfigurer</h4><p>新建websocket配置类，添加拦截地址以及相应的websocket消息处理器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebSocket</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketServerConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerWebSocketHandlers</span><span class="hljs-params">(WebSocketHandlerRegistry registry)</span> &#123;<br>        <span class="hljs-comment">// 添加拦截地址以及相应的websocket消息处理器</span><br>        <span class="hljs-type">WebSocketHandlerRegistration</span> <span class="hljs-variable">registration</span> <span class="hljs-operator">=</span> registry<br>                .addHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MercuryWebSocketHandler</span>(), <span class="hljs-string">&quot;/api/websocket/**&quot;</span>)<br>                .setAllowedOrigins(<span class="hljs-string">&quot;*&quot;</span>);<br>        <span class="hljs-comment">// 添加拦截器</span><br>        registration.addInterceptors(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketHandshakeInterceptor</span>());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="创建WsSessionManager存储websocket-session"><a href="#创建WsSessionManager存储websocket-session" class="headerlink" title="创建WsSessionManager存储websocket session"></a>创建WsSessionManager存储websocket session</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WsSessionManager</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ConcurrentHashMap&lt;String, WebSocketSession&gt; SESSION_POOL = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">onlineCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 添加 session</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wsId</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String wsId, WebSocketSession session)</span> &#123;<br>        addOnlineCount();<br>        SESSION_POOL.put(wsId, session);<br>        log.info(<span class="hljs-string">&quot;有新窗口开始监听:&quot;</span> + wsId + <span class="hljs-string">&quot;,当前在线人数为:&quot;</span> + getOnlineCount());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除 session,会返回删除的 session</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wsId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WebSocketSession <span class="hljs-title function_">remove</span><span class="hljs-params">(String wsId)</span> &#123;<br>        <span class="hljs-type">WebSocketSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> SESSION_POOL.remove(wsId);<br>        subOnlineCount();<br>        log.info(<span class="hljs-string">&quot;释放的wsId为：&quot;</span> + wsId);<br>        log.info(<span class="hljs-string">&quot;有一连接关闭！当前在线人数为&quot;</span> + getOnlineCount());<br>        <span class="hljs-keyword">return</span> session;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除并同步关闭连接</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wsId</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeAndClose</span><span class="hljs-params">(String wsId)</span> &#123;<br>        <span class="hljs-type">WebSocketSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> remove(wsId);<br>        <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 关闭连接</span><br>                session.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                log.error(e.getMessage(),e);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获得 session</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WebSocketSession <span class="hljs-title function_">get</span><span class="hljs-params">(String wsId)</span> &#123;<br>        <span class="hljs-comment">// 获得 session</span><br>        <span class="hljs-keyword">return</span> SESSION_POOL.get(wsId);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 实现服务器主动推送</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(String wsId,String message)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        get(wsId).sendMessage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextMessage</span>(message));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 非多机部署请注释此方法</span><br><span class="hljs-comment">     * 实现服务器主动推送 用于解决分布式websocket session不共享的问题</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessageBroadcasting</span><span class="hljs-params">(String wsId,String message)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">RocketMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> SpringContextUtils.getBean(RocketMQProducer.class);<br>        <span class="hljs-type">WebSocketMessageSendDto</span> <span class="hljs-variable">webSocketMessageSendDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketMessageSendDto</span>();<br>        webSocketMessageSendDto.setWsId(wsId);<br>        webSocketMessageSendDto.setMessage(message);<br>        producer.sendObject(RocketMqConstant.Topic.MERCURY_WEB_SOCKET_MESSAGE_SEND,webSocketMessageSendDto);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOnlineCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> WsSessionManager.onlineCount.get();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addOnlineCount</span><span class="hljs-params">()</span> &#123;<br>        WsSessionManager.onlineCount.getAndIncrement();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subOnlineCount</span><span class="hljs-params">()</span> &#123;<br>        WsSessionManager.onlineCount.getAndDecrement();<br>    &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * url template：http://localhost/api/websocket/&#123;ws_id&#125;</span><br><span class="hljs-comment">    * 需要在url提取ws_id</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getWsId</span><span class="hljs-params">(String requestUrl)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        String[] split = requestUrl.split(<span class="hljs-string">&quot;/api/websocket/&quot;</span>);<br>        <span class="hljs-keyword">if</span> (split.length &lt; <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;invalid ws request&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> split[split.length - <span class="hljs-number">1</span>];<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="发送消息给前端"><a href="#发送消息给前端" class="headerlink" title="发送消息给前端"></a>发送消息给前端</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">WsSessionManager.sendMessage(ws_id,message)<br></code></pre></td></tr></table></figure><h3 id="三、前端Vue与websocket集成"><a href="#三、前端Vue与websocket集成" class="headerlink" title="三、前端Vue与websocket集成"></a>三、前端Vue与websocket集成</h3><h4 id="新建websocket-js"><a href="#新建websocket-js" class="headerlink" title="新建websocket.js"></a>新建websocket.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// import &#123; showInfoMsg, showErrorMsg &#125; from &#x27;@/utils/popInfo&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementUI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">WS_API</span> = <span class="hljs-string">`ws://localhost:8080`</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">initWebSocket</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-string">&#x27;WebSocket&#x27;</span><span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>)) &#123;<br>        <span class="hljs-title class_">ElementUI</span>.<span class="hljs-title class_">Notification</span>(&#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;当前浏览器 Not support websocket&#x27;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>            <span class="hljs-attr">duration</span>: <span class="hljs-number">0</span>,<br>        &#125;);<br>    &#125;<br>    <span class="hljs-keyword">const</span> wsUri = <span class="hljs-variable constant_">WS_API</span> + <span class="hljs-string">&#x27;/api/websocket/&#x27;</span> + e;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(wsUri); <span class="hljs-comment">//这里面的this都指向vue</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">onerror</span> = webSocketOnError;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">onmessage</span> = webSocketOnMessage;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">onclose</span> = closeWebsocket;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">webSocketOnError</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-comment">// console.log(e)</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)<br>    <span class="hljs-title class_">ElementUI</span>.<span class="hljs-title class_">Notification</span>(&#123;<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;WebSocket连接发生错误&#x27;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-number">3000</span>,<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">webSocketOnMessage</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(e.<span class="hljs-property">data</span>);<br>  <span class="hljs-title class_">ElementUI</span>.<span class="hljs-title class_">Notification</span>(&#123;<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-attr">message</span>: data.<span class="hljs-property">msg</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;success&#x27;</span>,<br>    <span class="hljs-attr">duration</span>: <span class="hljs-number">5000</span>,<br>  &#125;);<br>&#125;<br><br><span class="hljs-comment">// 关闭websiocket</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">closeWebsocket</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;连接已关闭...&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">close</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-title function_">close</span>(); <span class="hljs-comment">// 关闭 websocket</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">onclose</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e); <span class="hljs-comment">//监听关闭事件</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;关闭&#x27;</span>);<br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">webSocketSend</span>(<span class="hljs-params">agentData</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-title function_">send</span>(agentData);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    initWebSocket,<br>    close,<br>&#125;;<br><br></code></pre></td></tr></table></figure><h4 id="在main-js引入"><a href="#在main-js引入" class="headerlink" title="在main.js引入"></a>在main.js引入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> websocket <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;具体地址/websocket&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$websocket</span> = websocket;<br></code></pre></td></tr></table></figure><p>然后在需要初始化websocket的地方，我是在App.vue全局mounted以下代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">$websocket</span>.<span class="hljs-title function_">initWebSocket</span>(&#123;ws_id&#125;)<span class="hljs-comment">//请根据具体逻辑替换ws_id 我这里填入的是jwt token</span><br></code></pre></td></tr></table></figure><h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202206071032239.png" alt="image-20220606183934456"></p><center><small>进入页面就会连接websocket</small></center><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202206071032020.png" alt="image-20220606183828420"></p><center><small>后端通过调用WsSessionManager.sendMessage(ws_id,message)发送消息给具体用户</small></center><h3 id="三、解决websocket-session在分布式系统不共享问题"><a href="#三、解决websocket-session在分布式系统不共享问题" class="headerlink" title="三、解决websocket session在分布式系统不共享问题"></a>三、解决websocket session在分布式系统不共享问题</h3><p>在Spring所集成的WebSocket里面，每个ws连接都有一个对应的session：WebSocketSession，在Spring WebSocket中，我们建立ws连接之后可以通过类似这样的方式进行与客户端的通信。但是 ws的session无法序列化到redis， 因此在集群中，我们无法将所有WebSocketSession都缓存到redis进行session共享。</p><p>本文简单解决方案思路：利用rocketmq广播的特性使得每一台机子都能执行发送消息的动作，这样的操作可能会导致没有对应webSocketSession的机器执行一直没必要的操作，但是因为根据键值ws_id在map中定位session，可以忽略不计。</p><h4 id="简单定义一个数据传输对象"><a href="#简单定义一个数据传输对象" class="headerlink" title="简单定义一个数据传输对象"></a>简单定义一个数据传输对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketMessageSendDto</span> &#123;<br>    <span class="hljs-keyword">private</span> String wsId;<br>    <span class="hljs-keyword">private</span> String message;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="创建消费者"><a href="#创建消费者" class="headerlink" title="创建消费者"></a>创建消费者</h4><p>重点：messageModel &#x3D; MessageModel.BROADCASTING</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@RocketMQMessageListener(topic = RocketMqConstant.Topic.MERCURY_WEB_SOCKET_MESSAGE_SEND</span><br><span class="hljs-meta">        , consumerGroup = RocketMqConstant.ComsumerGroup.MERCURY_WEB_SOCKET_MESSAGE_SEND,</span><br><span class="hljs-meta">        messageModel = MessageModel.BROADCASTING)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketMessageSendConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;WebSocketMessageSendDto&gt;, RocketMQPushConsumerLifecycleListener &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(WebSocketMessageSendDto dto)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;WebSocketMessageSendConsumer 接收到信息：&#123;&#125;&quot;</span>,JSON.toJSONString(dto));<br>        <span class="hljs-keyword">try</span> &#123;<br>            WsSessionManager.sendMessage(dto.getWsId(),dto.getMessage());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(e.getMessage(),e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareStart</span><span class="hljs-params">(DefaultMQPushConsumer consumer)</span> &#123;<br>        consumer.setMaxReconsumeTimes(<span class="hljs-number">2</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="消息生产者"><a href="#消息生产者" class="headerlink" title="消息生产者"></a>消息生产者</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * 实现服务器主动推送</span><br><span class="hljs-comment">  */</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessageBroadcasting</span><span class="hljs-params">(String wsId,String message)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>     <span class="hljs-type">RocketMQTemplate</span> <span class="hljs-variable">rocketMQTemplate</span> <span class="hljs-operator">=</span> SpringContextUtils.getBean(RocketMQTemplate.class);<br>     <span class="hljs-type">WebSocketMessageSendDto</span> <span class="hljs-variable">webSocketMessageSendDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketMessageSendDto</span>();<br>     webSocketMessageSendDto.setWsId(wsId);<br>     webSocketMessageSendDto.setMessage(message);<br>   rocketMQTemplate.convertAndSend(RocketMqConstant.Topic.MERCURY_WEB_SOCKET_MESSAGE_SEND, JSON.toJSONString(webSocketMessageSendDto))<br> &#125;<br>  <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WebSocket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>店匠插件开发-创建店匠应用</title>
    <link href="/2022/05/09/%E5%BA%97%E5%8C%A0%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91-%E5%88%9B%E5%BB%BA%E5%BA%97%E5%8C%A0%E5%BA%94%E7%94%A8/"/>
    <url>/2022/05/09/%E5%BA%97%E5%8C%A0%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91-%E5%88%9B%E5%BB%BA%E5%BA%97%E5%8C%A0%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>因为公司最近有需求需要开发商品批量导入到店匠，所以简单记录一下操作过程</p><h3 id="创建店匠私有App"><a href="#创建店匠私有App" class="headerlink" title="创建店匠私有App"></a>创建店匠私有App</h3><p>店匠官网：<a href="https://promo.shoplazza.cn/">https://promo.shoplazza.cn</a></p><p>官方教程：<a href="https://www.shoplazza.dev/reference">https://www.shoplazza.dev/reference</a></p><blockquote><p>创建店铺过程忽略</p></blockquote><p>进入店铺&gt;Apps&gt;管理私有App&gt;创建应用</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205091923902.png" alt="image-20220509151049132"></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205091920237.png" alt="image-20220509192015711"></p><p>填入应用名称，开发者邮箱，然后按需选择接口调用权限</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205091923235.png" alt="image-20220509151137589"></p><p>创建app成功后即可获得Token、App UID、App Secret，后续开发会用到</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205091924048.png" alt="image-20220509151302132"></p><h3 id="使用Postman调试"><a href="#使用Postman调试" class="headerlink" title="使用Postman调试"></a>使用Postman调试</h3><p>使用Token和官方提供的API进行接口调试</p><p>填入token 复制CURL语句</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205091919133.png" alt="image-20220509191946173"></p><p>粘贴到postman进行调试</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205091924847.png" alt="image-20220509191446157"></p><p>有返回值且状态码为200表示测试成功</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205091924934.png" alt="image-20220509191601006"></p><blockquote><p>接下来就可以根据对应接口进行定制化开发啦，后续是公司定制化代码就不展示上来了</p></blockquote><h3 id="创建店匠公有App"><a href="#创建店匠公有App" class="headerlink" title="创建店匠公有App"></a>创建店匠公有App</h3><h4 id="注册账号"><a href="#注册账号" class="headerlink" title="注册账号"></a>注册账号</h4><p>官网：<a href="https://partners.shoplazza.com/">https://partners.shoplazza.com/</a></p><h4 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h4><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205092121186.png" alt="image-20220509212114676"></p><table><thead><tr><th align="left"><strong>App URL</strong></th><th align="left">App’s main service URL</th><th align="left">在应用程序安装过程中使用。 当商家安装您的应用或进入该应用时，您的应用会收到对该应用 URL 的 GET 请求。 您的应用在收到 GET 请求后需要启动 OAuth 流程来安装应用，无论应用安装过程是从 Shoplaza 应用商店的“添加应用”开始，还是从合作伙伴中心仪表板的“安装应用”开始。–谷歌翻译</th></tr></thead><tbody><tr><td align="left"><strong>Redirect URL</strong></td><td align="left">App’s redirect URL</td><td align="left">在应用程序安装过程中使用。 商户在 OAuth 过程中授予权限后，商户将被重定向到带有 OAuth 代码和其他字段的重定向 URL。–谷歌翻译</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205092121847.png" alt="image-20220509212107975"></p><h4 id="授权流程"><a href="#授权流程" class="headerlink" title="授权流程"></a>授权流程</h4><blockquote><p> 以下大部分内容是直接谷歌翻译自店匠官方</p></blockquote><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205092153822.png" alt="img"></p><center><small>基于商家、您的应用和 Shoplaza 的操作的 OAuth 流程-图源来自店匠官网</small></center><ol><li>商家发出安装应用程序的请求。</li><li>应用重定向到Shoplazza Store的应用安装页面，请求商家授权。</li><li>Shoplazza 商店的应用安装页面提示 OAuth 授权屏幕并请求商家授权所需的范围。</li><li>商家通过同意应用请求的权限来授权应用。</li><li>该应用程序收到一个授权代码。</li><li>该应用程序通过使用授权代码向 Shoplazza Store 发送请求来请求访问令牌。</li><li>Shoplazza 对应用程序进行身份验证，验证授权代码，然后发出并返回访问令牌。该应用程序现在可以从 Shoplazza 请求数据。</li><li>该应用程序使用访问令牌向<a href="https://www.shoplazza.dev/reference/overview">Shoplazza Open API</a>发出请求。</li><li>Shoplazza 验证访问令牌并返回请求的数据。</li></ol><h5 id="OAuth授权流程的步骤"><a href="#OAuth授权流程的步骤" class="headerlink" title="OAuth授权流程的步骤"></a>OAuth授权流程的步骤</h5><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205092153672.png" alt="img"></p><center><small>OAuth授权流程-图源来自店匠官网</small></center><blockquote><p> PHP和GO可以使用官网的SDK进行授权第二步，自行尝试</p></blockquote><h5 id="Java对接店匠OAuth授权流程"><a href="#Java对接店匠OAuth授权流程" class="headerlink" title="Java对接店匠OAuth授权流程"></a>Java对接店匠OAuth授权流程</h5>]]></content>
    
    
    <categories>
      
      <category>外贸电商</category>
      
    </categories>
    
    
    <tags>
      
      <tag>店匠</tag>
      
      <tag>外贸电商</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>让 Google 收录博客</title>
    <link href="/2022/05/08/%E8%AE%A9google-%E6%94%B6%E5%BD%95%E5%8D%9A%E5%AE%A2/"/>
    <url>/2022/05/08/%E8%AE%A9google-%E6%94%B6%E5%BD%95%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>注意：本文以Fluid主题当示例来介绍</p></blockquote><h3 id="Google-Search-Console配置"><a href="#Google-Search-Console配置" class="headerlink" title="Google Search Console配置"></a>Google Search Console配置</h3><p>进入网址<a href="https://search.google.com/search-console">https://search.google.com/search-console</a></p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081849682.png" alt="image-20220508183546777" /><p>我选择的是&lt;网址前缀&gt; 输入网址后提示</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081849684.png" alt="image-20220508183818914"></p><p>我选择的是HTML标识验证 把元标记复制添加到hexo配置</p><h3 id="Hexo配置"><a href="#Hexo配置" class="headerlink" title="Hexo配置"></a>Hexo配置</h3><p>因为上文中已使用覆盖配置的方式使<strong>主题配置</strong>放置在 &lt;主题&gt; 目录之外，所以我们需要在hexo根目录下修改_config.&lt;主题名称&gt;.yml即可</p><p>我这里是_config.fluid.yml，全局搜索comment找到以下内容添加google提供的meta</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081849685.png" alt="image-20220508183318695"></p><p>添加成功并Hexo部署</p><p>然后再回到Google Search Console点击验证，显示这个代表配置成功</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081849686.png" alt="image-20220508183634549"></p><h3 id="Google-Search-Console-请求编入索引"><a href="#Google-Search-Console-请求编入索引" class="headerlink" title="Google Search Console 请求编入索引"></a>Google Search Console 请求编入索引</h3><p>登录你的 <a href="https://search.google.com/search-console/about">Google search console</a>，登陆后在控制台点击网址检查。</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081849687.png" alt="image-20220508184304499"></p><p>点击请求编入索引，耐心等待</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081849688.png" alt="image-20220508184322245"></p><p>显示以下内容表示编入索引成功</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081849689.png" alt="image-20220508184351161"></p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo 配置评论功能</title>
    <link href="/2022/05/08/Hexo-%E9%85%8D%E7%BD%AE%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/"/>
    <url>/2022/05/08/Hexo-%E9%85%8D%E7%BD%AE%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<blockquote><p>注意：本文以Fluid主题当示例来介绍如何配置评论，其他主题请根据对应用户手册配置</p></blockquote><p>我是用的主题Fluid支持多种评论插件，utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | </p><p>cusdis，每种插件有不同的配置方法，为了和评论用户有真实反馈、长久的交互和尽可能简单配置我这里选择了基于 GitHub Issues实现的utterances</p><h3 id="新建github仓库"><a href="#新建github仓库" class="headerlink" title="新建github仓库"></a>新建github仓库</h3><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081715639.png" alt="image-20220508171452067"></p><p>（我这里已经创建过了，所以显示报错）</p><h3 id="github-Install-utterances-app"><a href="#github-Install-utterances-app" class="headerlink" title="github Install utterances app"></a>github Install utterances app</h3><p>utterances官网：<a href="https://utteranc.es/">https://utteranc.es/</a></p><p>点击此链接github安装<a href="https://github.com/apps/utterances">utterances app</a>。</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081720238.png" alt="image-20220508172011715"></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081730113.png" alt="image-20220508172028588"></p><h3 id="Hexo配置"><a href="#Hexo配置" class="headerlink" title="Hexo配置"></a>Hexo配置</h3><p>因为上文中已使用覆盖配置的方式使<strong>主题配置</strong>放置在 &lt;主题&gt; 目录之外，所以我们需要在hexo根目录下修改_config.&lt;主题名称&gt;.yml即可</p><p>我这里是_config.fluid.yml，全局搜索comment找到以下内容开启评论并使用utterances插件 修改</p><figure class="highlight yaml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 评论插件</span><br><span class="hljs-comment"># Comment plugin</span><br><span class="hljs-attr">comments:</span><br><span class="hljs-comment">#开启评论插件</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># 指定的插件，需要同时设置对应插件的必要参数</span><br>  <span class="hljs-comment"># The specified plugin needs to set the necessary parameters at the same time</span><br>  <span class="hljs-comment"># Options: utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | cusdis</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">utterances</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081730114.png" alt="image-20220508170721628"></p><p>配置utterances插件 在_config.fluid.yml文件全局搜索utterances找到以下内容修改</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Utterances</span><br><span class="hljs-comment"># 基于 GitHub Issues</span><br><span class="hljs-comment"># Based on GitHub Issues</span><br><span class="hljs-comment"># See: https://utteranc.es</span><br><span class="hljs-attr">utterances:</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">repo仓库</span><br>  <span class="hljs-attr">issue_term:</span> <span class="hljs-string">pathname</span><br>  <span class="hljs-attr">label:</span> <span class="hljs-string">utterances</span><br>  <span class="hljs-attr">theme:</span> <span class="hljs-string">github-light</span><br>  <span class="hljs-attr">theme_dark:</span> <span class="hljs-string">github-dark</span><br>  <span class="hljs-attr">crossorigin:</span> <span class="hljs-string">anonymous</span><br></code></pre></td></tr></table></figure><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>打开你的博客文章 看到以下内容 即为配置成功</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081730181.png" alt="image-20220508172837182"></p><p>注：如果有些页面没有出现此评论插件可以在文章开头手动打开</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081729044.png" alt="image-20220508172937108"></p><p>一旦有评论我就会第一时间收到邮件啦，我就会在第一时间回复啦🤪，欢迎评论</p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081734441.png" alt="image-20220508173435809" />]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo 搭建博客Blog记录</title>
    <link href="/2022/05/07/Hexo%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2Blog%E8%AE%B0%E5%BD%95/"/>
    <url>/2022/05/07/Hexo%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2Blog%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p><strong>我的第一篇文章 记录一下博客搭建过程</strong></p><center><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202205081923624.jpg" alt="GitHub+Hexo 搭建个人网站详细教程" style="width:100%;"/></center><center><small><font color="gray">(此图来源于网络)</font></small></center><h4 id="Hexo介绍"><a href="#Hexo介绍" class="headerlink" title="Hexo介绍"></a>Hexo介绍</h4><p>Hexo官网地址 &gt; <a href="https://hexo.io/">https://hexo.io/</a></p><blockquote><p>What is Hexo?</p><p>Hexo is a fast, simple and powerful blog framework. You write posts in <a href="http://daringfireball.net/projects/markdown/">Markdown</a> (or other markup languages) and Hexo generates static files with a beautiful theme in seconds.—引用自官网</p></blockquote><p>Hexo是什么？ Hexo是一个快速、简单且功能强大的博客框架。你用Markdown（或其他标记语言）写文章，Hexo会在几秒钟内生成带有漂亮主题的静态文件。</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20220507225447240.png" alt="image-20220507225447240"></p><p>注：本文安装教程针对 Mac系统，部分命令不适用于Windows</p><h4 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h4><ul><li><p><a href="http://nodejs.org/">Node.js</a> (Should be at least Node.js 10.13, recommends 12.0 or higher)</p><p><code>brew install node</code></p><blockquote><p>官网：</p><ul><li>Windows: Download &amp; install <a href="https://git-scm.com/download/win">git</a>.</li><li>Mac: Install it with <a href="https://brew.sh/">Homebrew</a>, <a href="http://www.macports.org/">MacPorts</a> or <a href="http://sourceforge.net/projects/git-osx-installer/">installer</a>.</li><li>Linux (Ubuntu, Debian): <code>sudo apt-get install git-core</code></li><li>Linux (Fedora, Red Hat, CentOS): <code>sudo yum install git-core</code></li></ul></blockquote></li><li><p><a href="http://git-scm.com/">Git</a></p><p><code>brew install git</code></p><blockquote><p>官网：</p><ul><li>Windows: Install it with <a href="https://github.com/jasongin/nvs/">nvs</a> (recommended) or <a href="https://github.com/nvm-sh/nvm">nvm</a>.</li><li>Mac: Install it with <a href="https://brew.sh/">Homebrew</a> or <a href="http://www.macports.org/">MacPorts</a>.</li><li>Linux (DEB&#x2F;RPM-based): Install it with <a href="https://github.com/nodesource/distributions">NodeSource</a>.</li><li>Others: Install it through respective package manager. Refer to <a href="https://nodejs.org/en/download/package-manager/">the guide</a> provided by Node.js.</li></ul></blockquote></li></ul><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p><code>npm install hexo-cli -g hexo init blog cd blog npm install</code></p><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><p><code>hexo server</code></p><p>显示以下内容为启动成功</p><p><left><img src="/Users/casonmo/Documents/Typora/图片/image-20220507231042826.png" alt="image-20220507231042826" style="zoom:50%;" /></left></p><p>访问<a href="http://localhost:4000/">http://localhost:4000/</a> 即可进入你的博客</p><h4 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h4><p>主题地址：<a href="https://hexo.io/themes/">https://hexo.io/themes/</a></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20220507233206084.png" alt="image-20220507233206084"></p><p>挑选喜欢的主题 点击进入github地址</p><p>在初始化的hexo目录下执行git clone 到theme下指定目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs git">git clone https://github.com/fluid-dev/hexo-theme-fluid.git themes/fluid<br></code></pre></td></tr></table></figure><p>主题都会有自己的用户手册 我用的是Fluid主题 用户手册：<a href="https://hexo.fluid-dev.com/docs/start">https://hexo.fluid-dev.com/docs/start</a></p><p>主题跟这个用户手册配置就好了 我这里就不赘述了</p><h4 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h4><blockquote><p> 详细使用教程 <a href="https://hexo.io/zh-cn/docs/">https://hexo.io/zh-cn/docs/</a></p></blockquote><ul><li>可以使用以下命令新建文章</li></ul><p><code>hexo new &quot;&lt;文章名称&gt;&quot;</code></p><ul><li><p>然后cd &lt;hexo目录&gt;&#x2F;source&#x2F;_posts 就可以用markdown语句编辑文档</p></li><li><p>可以在文件顶部通过tags 修改标签 、通过categories修改分类、通过hide隐藏文章、通过archives归档</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">搭建博客Blog记录</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2022-05-07 17:44:14</span><br><span class="hljs-attr">hide:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">archives:</span> <span class="hljs-string">/archives</span><br><span class="hljs-attr">tags:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">first</span> <span class="hljs-string">tags</span><br><span class="hljs-attr">categories:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">first</span> <span class="hljs-string">categories</span><br><span class="hljs-meta">---</span><br><span class="hljs-string">&lt;正文内容&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20220508045636333.png" alt="image-20220508045636333"></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20220508045657889.png" alt="image-20220508045657889"></p><h4 id="关于部署"><a href="#关于部署" class="headerlink" title="关于部署"></a>关于部署</h4><blockquote><p>Hexo 支持多种部署方式 具体可到官网查看：<a href="https://hexo.io/zh-cn/docs/one-command-deployment">https://hexo.io/zh-cn/docs/one-command-deployment</a></p></blockquote><h5 id="新建github仓库"><a href="#新建github仓库" class="headerlink" title="新建github仓库"></a>新建github仓库</h5><p>注意：固定名称&lt;用户名&gt;.github.io</p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20220508050126798.png" alt="·" style="zoom:50%;" /><h5 id="关联git仓库和Hexo"><a href="#关联git仓库和Hexo" class="headerlink" title="关联git仓库和Hexo"></a>关联git仓库和Hexo</h5><p>在你初始化Hexo的根目录 修改_config.yml 在#Deployment下添加以下内容 注意空格</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">deploy:</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br><span class="hljs-attr">repo:</span> <span class="hljs-string">仓库地址</span><br><span class="hljs-attr">branch:</span> <span class="hljs-string">分支</span><br></code></pre></td></tr></table></figure><h5 id="安装部署插件"><a href="#安装部署插件" class="headerlink" title="安装部署插件"></a>安装部署插件</h5><p><code>npm install hexo-deployer-git --save</code></p><h5 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h5><p><code>hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</code></p><p>可简写为</p><p><code>hexo clean &amp;&amp; hexo g -d</code></p><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ul><li><p>覆盖配置可以使<strong>主题配置</strong>放置在 fluid 目录之外，避免在更新主题时丢失自定义的配置。</p><p>在博客目录下创建 <code>_config.&lt;主题名称&gt;.yml</code> 文件，将主题的 <a href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml">_config.yml (opens new window)</a>全部配置（或部分配置）复制过去。</p><p>以后如果修改任何主题配置，都只需修改 <code>_config.&lt;主题名称&gt;.yml</code> 的配置即可。</p><p><left><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20220508154920223.png" alt="image-20220508154920223"  /></left></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>部署</tag>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
