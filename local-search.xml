<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Hexo giscusé…ç½®è¯„è®ºåŠŸèƒ½</title>
    <link href="/2024/04/07/Hexo-giscus%E9%85%8D%E7%BD%AE%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/"/>
    <url>/2024/04/07/Hexo-giscus%E9%85%8D%E7%BD%AE%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ³¨æ„ï¼šæœ¬æ–‡ä»¥Fluidä¸»é¢˜å½“ç¤ºä¾‹æ¥ä»‹ç»å¦‚ä½•é…ç½®è¯„è®ºï¼Œå…¶ä»–ä¸»é¢˜è¯·æ ¹æ®å¯¹åº”ç”¨æˆ·æ‰‹å†Œé…ç½®</p></blockquote><p>Giscus å…è®¸ä½ å°† GitHub Discussions é›†æˆåˆ°ä½ çš„ç½‘ç«™ä¸Šä½œä¸ºè¯„è®ºç³»ç»Ÿã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯è¯„è®ºæ•°æ®å­˜å‚¨åœ¨ GitHub ä¸Šï¼Œä¸éœ€è¦ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚</p><p>å®˜æ–¹åœ°å€ï¼š<a href="https://giscus.app/">https://giscus.app/</a></p><ul><li><p>é¦–å…ˆå…ˆçœ‹çœ‹è‡ªå·±çš„theme&#x2F;fluidä¸‹æ˜¯å¦åŒ…å«giscusç›¸å…³çš„æ–‡ä»¶ï¼Œå¦‚æœfluidç‰ˆæœ¬è¿‡æ—§æ²¡æœ‰ç›¸å…³æ–‡ä»¶å°±è¦å…ˆæ›´æ–°fluidæ”¯æŒgiscus</p><p><code>npm update --save hexo-theme-fluid</code></p></li><li><p>æ–°å»ºgithubä»“åº“</p></li></ul><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081715639.png" alt="image-20220508171452067"></p><p>ï¼ˆæˆ‘è¿™é‡Œå·²ç»åˆ›å»ºè¿‡äº†ï¼Œæ‰€ä»¥æ˜¾ç¤ºæŠ¥é”™ï¼‰</p><ul><li>githubä»“åº“å¯ç”¨DiscussionsåŠŸèƒ½ settings-&gt;General-&gt;Features</li></ul><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20240407175728062.png" alt="image-20240407175728062"></p><ul><li>ç‚¹å‡»é“¾æ¥å®‰è£…gisacus <a href="https://github.com/apps/giscus">https://github.com/apps/giscus</a></li></ul><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20240407175530551.png" alt="image-20240407175530551"></p><ul><li>ç„¶åæ ¹æ®å®˜ç½‘æç¤ºå¡«å†™å¯¹åº”ä¿¡æ¯</li></ul><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20240407175638999.png" alt="image-20240407175638999"></p><ul><li>ç„¶åå°±èƒ½è·å–åˆ°repo-idç­‰ç›¸å…³ä¿¡æ¯</li></ul><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20240407175938792.png" alt="image-20240407175938792"></p><ul><li>ä¿®æ”¹_config.fluid.ymlæ–‡ä»¶</li></ul><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">giscus</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">repo</span><span class="hljs-punctuation">:</span> <span class="hljs-string">xxxx/xxxx</span><br>  <span class="hljs-attribute">repo-id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">xxxx</span><br>  <span class="hljs-attribute">category</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Announcements</span><br>  <span class="hljs-attribute">category-id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">xxxx</span><br>  <span class="hljs-comment"># Available values: pathname | url | title | og:title</span><br>  <span class="hljs-attribute">mapping</span><span class="hljs-punctuation">:</span> <span class="hljs-string">pathname</span><br>  <span class="hljs-comment"># Available values: 0 | 1</span><br>  <span class="hljs-attribute">reactions-enabled</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1</span><br>   <span class="hljs-comment"># Available values: 0 | 1</span><br>  <span class="hljs-attribute">emit-metadata</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span><br>  <span class="hljs-comment"># Available values: light | dark | dark_high_contrast | transparent_dark | preferred-color-scheme</span><br>  <span class="hljs-attribute">theme</span><span class="hljs-punctuation">:</span> <span class="hljs-string">preferred_color_scheme</span><br>  <span class="hljs-comment"># Available values: en | zh-CN</span><br>  <span class="hljs-attribute">lang</span><span class="hljs-punctuation">:</span> <span class="hljs-string">zh-CN</span><br>  <span class="hljs-comment"># Place the comment box above the comments</span><br>  <span class="hljs-attribute">input-position</span><span class="hljs-punctuation">:</span> <span class="hljs-string">top</span><br></code></pre></td></tr></table></figure><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs coq">comments:<br>  enable: true<br>  # æŒ‡å®šçš„æ’ä»¶ï¼Œéœ€è¦åŒæ—¶è®¾ç½®å¯¹åº”æ’ä»¶çš„å¿…è¦å‚æ•°<br>  # The specified plugin needs to <span class="hljs-built_in">set</span> the necessary parameters <span class="hljs-built_in">at</span> the same <span class="hljs-built_in">time</span><br>  # <span class="hljs-keyword">Options</span>: utterances | <span class="hljs-type">disqus</span> | <span class="hljs-type">gitalk</span> | <span class="hljs-type">valine</span> | <span class="hljs-type">waline</span> | <span class="hljs-type">changyan</span> | <span class="hljs-type">livere</span> | <span class="hljs-type">remark42</span> | <span class="hljs-type">twikoo</span> | <span class="hljs-type">cusdis</span><br>  type: giscus<br></code></pre></td></tr></table></figure><ul><li>æ‰“å¼€è‡ªå·±çš„ç½‘ç«™çœ‹åˆ°ä»¥ä¸‹è¯„è®ºæ¡†å°±å¤§åŠŸå‘Šæˆ</li></ul><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20240407183951630.png" alt="image-20240407183951630"></p><p>æ³¨æ„ï¼šä»¥å‰ç”¨Utterancesçš„å¯ä»¥æŠŠgithub issue è½¬æˆdiscussion</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20240407185028973.png" alt="image-20240407185028973"></p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨Github-ActionæŒç»­éƒ¨ç½²Springbootæˆ–vue</title>
    <link href="/2024/01/11/%E4%BD%BF%E7%94%A8Github-Action%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2Springboot%E6%88%96vue/"/>
    <url>/2024/01/11/%E4%BD%BF%E7%94%A8Github-Action%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2Springboot%E6%88%96vue/</url>
    
    <content type="html"><![CDATA[<p>GitHub Actions æ˜¯ GitHub æä¾›çš„ä¸€é¡¹æŒç»­é›†æˆ (CI) å’ŒæŒç»­éƒ¨ç½² (CD) æœåŠ¡ã€‚å®ƒå…è®¸ä½ åœ¨ä»£ç ä»“åº“ä¸­å®šä¹‰å’Œè¿è¡Œè‡ªåŠ¨åŒ–çš„å·¥ä½œæµç¨‹ï¼Œä»¥å“åº”å­˜å‚¨åº“ä¸­çš„äº‹ä»¶æˆ–è°ƒåº¦ã€‚GitHub Actions å¯ä»¥ç”¨äºæ„å»ºã€æµ‹è¯•ã€æ‰“åŒ…å’Œéƒ¨ç½²é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œå…¶ä»–è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</p><blockquote><p>è¯¦ç»†github actionç›¸å…³ä¿¡æ¯è¯·çœ‹æœ€åº•éƒ¨</p></blockquote><p><strong>ç¬¬ä¸€æ­¥éœ€è¦å…ˆé…ç½®secretsï¼Œä¿è¯æˆ‘ä»¬çš„æœåŠ¡å™¨ä¿¡æ¯ä¸æš´éœ²</strong></p><p>GitHub Actions ä¸­çš„ secrets å’Œ variables éƒ½æ˜¯ç”¨äºå­˜å‚¨å’Œè®¿é—®æ•æ„Ÿä¿¡æ¯æˆ–é…ç½®çš„æœºåˆ¶</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20240111105350117.png" alt="image-20240111105350117"></p><p>å› ä¸ºæˆ‘çš„æœåŠ¡å™¨ç”¨çš„å®å¡”é¢æ¿ç¯å¢ƒï¼ŒåŠ ä¸Šæ„å»ºå‡ºæ¥çš„åŒ…å’Œæ–‡ä»¶å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ–¹å¼æ˜¯å…ˆåœ¨github actionçš„ç¯å¢ƒæ„å»ºæ‰“åŒ…ï¼Œç„¶åå°†åŒ…å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨github actioné‡Œè®©ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å»åšgitï¼Œæ„å»ºï¼Œéƒ¨ç½²ï¼Œå¯åŠ¨ç­‰ç­‰ç›¸å…³çš„</p><h2 id="Springboot"><a href="#Springboot" class="headerlink" title="Springboot"></a>Springboot</h2><figure class="highlight yaml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Java</span> <span class="hljs-string">CI</span> <span class="hljs-string">with</span> <span class="hljs-string">Maven</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;master&quot;</span> ]<br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <br>    <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">JDK</span> <span class="hljs-number">17</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v3</span><br>      <span class="hljs-attr">with:</span><br>        <span class="hljs-attr">java-version:</span> <span class="hljs-string">&#x27;17&#x27;</span><br>        <span class="hljs-attr">distribution:</span> <span class="hljs-string">&#x27;temurin&#x27;</span><br>        <span class="hljs-attr">cache:</span> <span class="hljs-string">maven</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">with</span> <span class="hljs-string">Maven</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">mvn</span> <span class="hljs-string">-B</span> <span class="hljs-string">package</span> <span class="hljs-string">--file</span> <span class="hljs-string">pom.xml</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">copy</span> <span class="hljs-string">jar</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">cross-the-world/ssh-scp-ssh-pipelines@latest</span><br>      <span class="hljs-attr">with:</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.HOST</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">user:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.USERNAME</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">pass:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.PASSWORD</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">22</span><br>        <span class="hljs-attr">scp:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          ./target/springboot.jar =&gt; /home/</span><br><span class="hljs-string"></span>        <span class="hljs-attr">last_ssh:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          JAR_NAME=&quot;springboot.jar&quot;; PID=$(ps aux | grep &quot;$JAR_NAME&quot; | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27;); if [ -n &quot;$PID&quot; ]; then kill -9 $PID &amp;&amp; echo &quot;è¿›ç¨‹ $PID å·²è¢«æ€æ­»&quot;; else echo &quot;æœªæ‰¾åˆ°ä¸ $JAR_NAME ç›¸å…³çš„è¿›ç¨‹&quot;; fi</span><br><span class="hljs-string">          /usr/bin/java -jar -Xmx1024M -Xms256M  /home/springboot.jar &amp;</span><br></code></pre></td></tr></table></figure><h2 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">Server</span><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;master&quot;</span> ]<br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">deploy:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span> <br><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">node-version:</span> <span class="hljs-number">16</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">yarn</span> <br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">project</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">yarn</span> <span class="hljs-string">generate</span> <br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">zip</span> <span class="hljs-string">dist</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">zip</span> <span class="hljs-string">-r</span> <span class="hljs-string">dist.zip</span> <span class="hljs-string">dist/</span><br><br>        <span class="hljs-comment"># éƒ¨ç½²åˆ°æœåŠ¡å™¨</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">ğŸš€</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">cross-the-world/ssh-scp-ssh-pipelines@latest</span><br>        <span class="hljs-attr">with:</span><br>            <span class="hljs-attr">host:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.HOST</span> <span class="hljs-string">&#125;&#125;</span><br>            <span class="hljs-attr">user:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.USERNAME</span> <span class="hljs-string">&#125;&#125;</span><br>            <span class="hljs-attr">pass:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.PASSWORD</span> <span class="hljs-string">&#125;&#125;</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">22</span><br>            <span class="hljs-attr">scp:</span> <span class="hljs-string">|</span><br><span class="hljs-string">                &#x27;./dist.zip&#x27; =&gt; /home</span><br><span class="hljs-string"></span>            <span class="hljs-attr">last_ssh:</span> <span class="hljs-string">|</span><br><span class="hljs-string">                cd /home/</span><br><span class="hljs-string">                rm -rf dist/ || true</span><br><span class="hljs-string">                unzip dist.zip</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h2 id="å¸¸è§çš„-GitHub-Actions-YAML-è¯­æ³•å’Œå…³é”®æ¦‚å¿µ"><a href="#å¸¸è§çš„-GitHub-Actions-YAML-è¯­æ³•å’Œå…³é”®æ¦‚å¿µ" class="headerlink" title="å¸¸è§çš„ GitHub Actions YAML è¯­æ³•å’Œå…³é”®æ¦‚å¿µ"></a>å¸¸è§çš„ GitHub Actions YAML è¯­æ³•å’Œå…³é”®æ¦‚å¿µ</h2><p>GitHub Actions ä½¿ç”¨ YAML æ–‡ä»¶æ¥å®šä¹‰å·¥ä½œæµç¨‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ GitHub Actions YAML è¯­æ³•å’Œå…³é”®æ¦‚å¿µï¼š</p><h3 id="å·¥ä½œæµç¨‹ï¼ˆWorkflowï¼‰çš„å®šä¹‰ï¼š"><a href="#å·¥ä½œæµç¨‹ï¼ˆWorkflowï¼‰çš„å®šä¹‰ï¼š" class="headerlink" title="å·¥ä½œæµç¨‹ï¼ˆWorkflowï¼‰çš„å®šä¹‰ï¼š"></a>å·¥ä½œæµç¨‹ï¼ˆWorkflowï¼‰çš„å®šä¹‰ï¼š</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">My</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">main</span><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">my_job:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">Repository</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span><br>      <span class="hljs-comment"># å…¶ä»–æ­¥éª¤...</span><br></code></pre></td></tr></table></figure><ul><li><code>name</code>: å·¥ä½œæµç¨‹çš„åç§°ã€‚</li><li><code>on</code>: è§¦å‘å·¥ä½œæµç¨‹çš„äº‹ä»¶ï¼Œä¾‹å¦‚ <code>push</code> åˆ°ç‰¹å®šåˆ†æ”¯ã€‚</li><li><code>jobs</code>: åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡çš„éƒ¨åˆ†ã€‚</li></ul><h3 id="ä»»åŠ¡ï¼ˆJobï¼‰çš„å®šä¹‰ï¼š"><a href="#ä»»åŠ¡ï¼ˆJobï¼‰çš„å®šä¹‰ï¼š" class="headerlink" title="ä»»åŠ¡ï¼ˆJobï¼‰çš„å®šä¹‰ï¼š"></a><strong>ä»»åŠ¡ï¼ˆJobï¼‰çš„å®šä¹‰ï¼š</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">my_job:</span><br>  <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>  <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Step</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;Hello, World!&quot;</span><br>    <span class="hljs-comment"># å…¶ä»–æ­¥éª¤...</span><br></code></pre></td></tr></table></figure><ul><li><code>runs-on</code>: æŒ‡å®šä»»åŠ¡è¿è¡Œçš„æ“ä½œç³»ç»Ÿå’Œç¯å¢ƒã€‚</li><li><code>steps</code>: åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤çš„åˆ—è¡¨ã€‚</li></ul><h3 id="æ­¥éª¤ï¼ˆStepsï¼‰çš„å®šä¹‰ï¼š"><a href="#æ­¥éª¤ï¼ˆStepsï¼‰çš„å®šä¹‰ï¼š" class="headerlink" title="æ­¥éª¤ï¼ˆStepsï¼‰çš„å®šä¹‰ï¼š"></a><strong>æ­¥éª¤ï¼ˆStepsï¼‰çš„å®šä¹‰ï¼š</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">steps:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Step</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;Hello, World!&quot;</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Step</span> <span class="hljs-number">2</span><br>    <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span><br>    <span class="hljs-attr">with:</span><br>      <span class="hljs-attr">node-version:</span> <span class="hljs-string">&#x27;14&#x27;</span><br>  <span class="hljs-comment"># å…¶ä»–æ­¥éª¤...</span><br></code></pre></td></tr></table></figure><ul><li><code>name</code>: æ­¥éª¤çš„åç§°ã€‚</li><li><code>run</code>: æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ã€‚</li><li><code>uses</code>: ä½¿ç”¨çš„åŠ¨ä½œï¼ˆå¯ä»¥æ˜¯å†…ç½®åŠ¨ä½œæˆ–è‡ªå®šä¹‰åŠ¨ä½œï¼‰ã€‚</li><li><code>with</code>: ä¼ é€’ç»™åŠ¨ä½œçš„å‚æ•°ã€‚</li></ul><h3 id="è§¦å‘å™¨ï¼ˆTriggerï¼‰çš„å®šä¹‰ï¼š"><a href="#è§¦å‘å™¨ï¼ˆTriggerï¼‰çš„å®šä¹‰ï¼š" class="headerlink" title="è§¦å‘å™¨ï¼ˆTriggerï¼‰çš„å®šä¹‰ï¼š"></a><strong>è§¦å‘å™¨ï¼ˆTriggerï¼‰çš„å®šä¹‰ï¼š</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">pull_request:</span><br>    <span class="hljs-attr">branches:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">feature/*</span><br></code></pre></td></tr></table></figure><ul><li><code>on</code>: è§¦å‘å·¥ä½œæµç¨‹çš„äº‹ä»¶ã€‚</li><li><code>push</code>: ä»£ç æ¨é€äº‹ä»¶ã€‚</li><li><code>pull_request</code>: åˆå¹¶è¯·æ±‚äº‹ä»¶ã€‚</li></ul><h3 id="ç¯å¢ƒå˜é‡ï¼ˆEnvironment-Variablesï¼‰çš„å®šä¹‰ï¼š"><a href="#ç¯å¢ƒå˜é‡ï¼ˆEnvironment-Variablesï¼‰çš„å®šä¹‰ï¼š" class="headerlink" title="ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰çš„å®šä¹‰ï¼š"></a><strong>ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰çš„å®šä¹‰ï¼š</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">my_job:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">env:</span><br>      <span class="hljs-attr">MY_VARIABLE:</span> <span class="hljs-string">my_value</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-comment"># æ­¥éª¤...</span><br></code></pre></td></tr></table></figure><ul><li><code>env</code>: å®šä¹‰ä»»åŠ¡è¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ã€‚</li></ul><h2 id="Secrets-å’Œ-Variables"><a href="#Secrets-å’Œ-Variables" class="headerlink" title="Secrets å’Œ Variables"></a>Secrets å’Œ Variables</h2><h3 id="ä½¿ç”¨-Secretsï¼š"><a href="#ä½¿ç”¨-Secretsï¼š" class="headerlink" title="ä½¿ç”¨ Secretsï¼š"></a>ä½¿ç”¨ Secretsï¼š</h3><p>GitHub Actions çš„ secrets æ˜¯ç”¨äºå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ API å¯†é’¥ã€è®¿é—®ä»¤ç‰Œç­‰ã€‚è¿™äº› secrets å¯ä»¥è¢«å·¥ä½œæµç¨‹ä¸­çš„æ­¥éª¤å¼•ç”¨ï¼Œä½†å®ƒä»¬æ˜¯åŠ å¯†çš„ï¼Œå¹¶ä¸”åªæœ‰åœ¨è¿è¡Œå·¥ä½œæµç¨‹æ—¶æ‰ä¼šæš´éœ²ç»™æ­¥éª¤ã€‚</p><ol><li><p><strong>åœ¨ GitHub å­˜å‚¨åº“ä¸­åˆ›å»º secretï¼š</strong></p><ul><li>è½¬åˆ° GitHub å­˜å‚¨åº“çš„é¡µé¢ã€‚</li><li>åœ¨å­˜å‚¨åº“é¡¶éƒ¨å¯¼èˆªæ ä¸­ï¼Œç‚¹å‡» â€œSettingsâ€ã€‚</li><li>åœ¨å·¦ä¾§è¾¹æ ä¸­ï¼Œé€‰æ‹© â€œSecretsâ€ã€‚</li><li>ç‚¹å‡» â€œNew repository secretâ€ï¼Œç„¶åè¾“å…¥ secret åç§°å’Œå€¼ã€‚</li></ul></li><li><p><strong>åœ¨å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨ secretï¼š</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">my_job:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Use</span> <span class="hljs-string">secret</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.MY_SECRET</span> <span class="hljs-string">&#125;&#125;</span><br></code></pre></td></tr></table></figure></li></ol><p>è¿™é‡Œ <code>MY_SECRET</code> æ˜¯ä½ åˆ›å»ºçš„ secret çš„åç§°ï¼Œå¯ä»¥åœ¨æ­¥éª¤ä¸­ä½¿ç”¨ <code>$&#123;&#123; secrets.MY_SECRET &#125;&#125;</code> å¼•ç”¨å®ƒã€‚</p><h3 id="ä½¿ç”¨-Variablesï¼š"><a href="#ä½¿ç”¨-Variablesï¼š" class="headerlink" title="ä½¿ç”¨ Variablesï¼š"></a>ä½¿ç”¨ Variablesï¼š</h3><p>GitHub Actions çš„ variables æ˜¯ç”± GitHub æä¾›çš„ä¸€ç»„é»˜è®¤ç¯å¢ƒå˜é‡ï¼ŒåŒæ—¶ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ç¯å¢ƒå˜é‡ã€‚è¿™äº›å˜é‡å¯ä»¥åœ¨å·¥ä½œæµç¨‹çš„ä»»ä½•æ­¥éª¤ä¸­ä½¿ç”¨ã€‚</p><ol><li><p><strong>åœ¨å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨ GitHub æä¾›çš„ variablesï¼š</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">my_job:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Use</span> <span class="hljs-string">GitHub-provided</span> <span class="hljs-string">variable</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">github.event_name</span> <span class="hljs-string">&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>github.event_name</code> æ˜¯ GitHub æä¾›çš„ä¸€ä¸ªé»˜è®¤å˜é‡ï¼Œè¡¨ç¤ºè§¦å‘å·¥ä½œæµç¨‹çš„äº‹ä»¶çš„åç§°ã€‚</p></li><li><p><strong>åœ¨å·¥ä½œæµç¨‹ä¸­å®šä¹‰è‡ªå·±çš„ variablesï¼š</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">my_job:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">env:</span><br>      <span class="hljs-attr">MY_VARIABLE:</span> <span class="hljs-string">my_value</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Use</span> <span class="hljs-string">custom</span> <span class="hljs-string">variable</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">$MY_VARIABLE</span><br></code></pre></td></tr></table></figure></li></ol><p>åœ¨ <code>env</code> éƒ¨åˆ†å®šä¹‰è‡ªå·±çš„ç¯å¢ƒå˜é‡ï¼Œç„¶ååœ¨æ­¥éª¤ä¸­ä½¿ç”¨ <code>$MY_VARIABLE</code> å¼•ç”¨å®ƒã€‚</p><p>æ³¨æ„ï¼šGitHub Actions ä¸­çš„ç¯å¢ƒå˜é‡ï¼ˆåŒ…æ‹¬ secrets å’Œ variablesï¼‰åœ¨æ­¥éª¤ä¸­çš„å¼•ç”¨æ–¹å¼ä½¿ç”¨ <code>$&#123;&#123; ... &#125;&#125;</code> è¯­æ³•ã€‚æ­¤å¤–ï¼Œsecrets åªèƒ½åœ¨å·¥ä½œæµç¨‹çš„åŒä¸€å­˜å‚¨åº“ä¸­ä½¿ç”¨ï¼Œè€Œ variables åˆ™å¯ä»¥åœ¨ä¸åŒå­˜å‚¨åº“çš„å·¥ä½œæµç¨‹ä¸­å…±äº«ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>github action</tag>
      
      <tag>springboot</tag>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Easypoi-å¤§æ•°æ®é‡å¯¼å‡º</title>
    <link href="/2024/01/09/Easypoi-%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%87%8F%E5%AF%BC%E5%87%BA/"/>
    <url>/2024/01/09/Easypoi-%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%87%8F%E5%AF%BC%E5%87%BA/</url>
    
    <content type="html"><![CDATA[<p>EasyExcel åœ¨å¤„ç† Excel æ–‡ä»¶æ—¶ï¼Œéœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ã€‚å¦‚æœå¯¼å‡ºçš„æ•°æ®é‡è¿‡å¤§ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ï¼Œä»è€Œå¼•å‘ CPU è¿‡é«˜çš„é—®é¢˜ã€‚å¹¶å‘è®¿é—®å¯¼å‡ºæ¥å£ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œæ‰€ä»¥å°½é‡åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§çš„å¯¼å‡ºæ¥å£æ·»åŠ é”æ§åˆ¶ã€‚</p><blockquote><p>ä»¥ä¸‹æ˜¯è™šåŒ–ä¸šåŠ¡åçš„ä»£ç ï¼Œè®°å½•ä¸€ä¸‹é‡åˆ°çš„é—®é¢˜è§£å†³æ–¹æ¡ˆ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯¼å‡ºå¤§æ•°æ®é‡Excelæ–‡ä»¶</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response HttpServletResponseå¯¹è±¡ï¼Œç”¨äºè®¾ç½®å“åº”å¤´å’Œè¾“å‡ºæµ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> requestForm åŒ…å«æŸ¥è¯¢å‚æ•°çš„è¡¨å•å¯¹è±¡</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> ParseException å½“æ—¥æœŸè§£æå‘ç”Ÿé”™è¯¯æ—¶æŠ›å‡ºå¼‚å¸¸</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException å½“è¾“å…¥æˆ–è¾“å‡ºæ“ä½œå‘ç”Ÿé”™è¯¯æ—¶æŠ›å‡ºå¼‚å¸¸</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exportBigExcelist</span><span class="hljs-params">(HttpServletResponse response, RequestForm requestForm)</span> <span class="hljs-keyword">throws</span> ParseException, IOException &#123;<br>    <span class="hljs-comment">// è®¾ç½®Excelå¯¼å‡ºå‚æ•°ï¼ŒåŒ…æ‹¬æ ‡é¢˜å’Œsheetåç§°</span><br>    <span class="hljs-type">ExportParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExportParams</span>(<span class="hljs-string">&quot;æ ‡é¢˜&quot;</span>, <span class="hljs-string">&quot;sheetåç§°&quot;</span>);<br><br>    <span class="hljs-comment">// ä½¿ç”¨EasyExcelå·¥å…·ç±»å¯¼å‡ºå¤§æ•°æ®Excelæ–‡ä»¶</span><br>    <span class="hljs-type">Workbook</span> <span class="hljs-variable">workbook</span> <span class="hljs-operator">=</span> ExcelExportUtil.exportBigExcel(params, ExcelDto.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">IExcelExportServer</span>() &#123;<br>        <span class="hljs-meta">@SneakyThrows</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title function_">selectListForExcelExport</span><span class="hljs-params">(Object queryParams, <span class="hljs-type">int</span> page)</span> &#123;<br>            <span class="hljs-comment">// å¼ºåˆ¶è½¬æ¢æŸ¥è¯¢å‚æ•°ä¸ºRequestFormå¯¹è±¡</span><br>            <span class="hljs-type">RequestForm</span> <span class="hljs-variable">tempForm</span> <span class="hljs-operator">=</span> (RequestForm) queryParams;<br>            <br>            <span class="hljs-comment">// è®¾ç½®åˆ†é¡µå‚æ•°</span><br>            tempForm.setPage(page);<br>            tempForm.setPageSize(<span class="hljs-number">10000</span>);<br>            <br>            <span class="hljs-comment">// è°ƒç”¨ä¸šåŠ¡æœåŠ¡è¿›è¡Œåˆ†é¡µæŸ¥è¯¢é€»è¾‘</span><br>            List&lt;ExcelDto&gt; list = service.selectlist(tempForm);<br>            <br>            <span class="hljs-comment">// å°†æŸ¥è¯¢ç»“æœè½¬åŒ–ä¸ºList&lt;Object&gt;</span><br>            List&lt;Object&gt; objects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(list);<br>            <br>            <span class="hljs-comment">// å¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œåˆ™è¿”å›null</span><br>            <span class="hljs-keyword">if</span> (list.size() == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            <br>            <span class="hljs-keyword">return</span> objects;<br>        &#125;<br>    &#125;, requestForm);<br><br>    <span class="hljs-comment">// è®¾ç½®å“åº”å¤´ï¼ŒæŒ‡å®šå¯¼å‡ºæ–‡ä»¶ç±»å‹ä¸ºExcel</span><br>    response.setHeader(<span class="hljs-string">&quot;content-Type&quot;</span>, <span class="hljs-string">&quot;application/vnd.ms-excel&quot;</span>);<br>    <span class="hljs-comment">// è®¾ç½®å“åº”å¤´ï¼ŒæŒ‡å®šå¯¼å‡ºæ–‡ä»¶çš„åç§°ï¼Œå¹¶å¯¹æ–‡ä»¶åè¿›è¡ŒUTF-8ç¼–ç </span><br>    response.setHeader(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, <span class="hljs-string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(<span class="hljs-string">&quot;filename.xls&quot;</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>));<br>    <br>    <span class="hljs-comment">// å°†ç”Ÿæˆçš„Excelæ–‡ä»¶å†™å…¥åˆ°å“åº”è¾“å‡ºæµ</span><br>    workbook.write(response.getOutputStream());<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Easypoi</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Threadlocal-å†…å­˜æ³„éœ²é—®é¢˜</title>
    <link href="/2024/01/03/Threadlocal-%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E9%97%AE%E9%A2%98/"/>
    <url>/2024/01/03/Threadlocal-%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://cason.work/2022/06/16/Threadlocal%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E5%92%8C%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Threadlocalçš„ç®€å•ç†è§£å’Œéƒ¨åˆ†æºç åˆ†æ - Blog|CasonMo</a></p></blockquote><p>åœ¨ThreadLocalMapä¸­ï¼Œç”¨Entryæ¥ä¿å­˜K-Vç»“æ„æ•°æ®çš„ã€‚Entryçš„æ„é€ æ–¹æ³•å·²ç»é™å®šEntryä¸­keyåªèƒ½æ˜¯ThreadLocalå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&gt; &#123;<br>    <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span><br>    Object value;<br><br>    Entry(ThreadLocal k, Object v) &#123;<br>        <span class="hljs-built_in">super</span>(k);<br>        value = v;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Entryç»§æ‰¿è‡ªWeakReferenceï¼ˆå¼±å¼•ç”¨ï¼Œç”Ÿå‘½å‘¨æœŸåªèƒ½å­˜æ´»åˆ°ä¸‹æ¬¡GCå‰ï¼‰ï¼Œä½†åªæœ‰Keyæ˜¯å¼±å¼•ç”¨ç±»å‹çš„ï¼ŒValueå¹¶éå¼±å¼•ç”¨ã€‚ï¼ˆé—®é¢˜é©¬ä¸Šå°±æ¥äº†ï¼‰</p><blockquote><h4 id="å››ç§å¼•ç”¨ç±»å‹"><a href="#å››ç§å¼•ç”¨ç±»å‹" class="headerlink" title="å››ç§å¼•ç”¨ç±»å‹"></a>å››ç§å¼•ç”¨ç±»å‹</h4><ol><li>å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰</li></ol><p>  ç±»ä¼¼Object obj &#x3D; new Object()è¿™ç±»ä¼¼çš„å¼•ç”¨ï¼Œå¼ºå¼•ç”¨åœ¨ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨ï¼Œåªè¦å¼ºå¼•ç”¨åœ¨ï¼Œåƒåœ¾æœé›†å™¨æ°¸è¿œä¸ä¼šæœé›†è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å®æ„¿å‡ºç°å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryErrorï¼‰ï¼Œä¹Ÿä¸ä¼šå›æ”¶è¿™äº›å¯¹è±¡</strong></p><ol start="2"><li>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</li></ol><p>  åœ¨Javaä¸­ç”¨java.lang.ref.SoftReferenceç±»æ¥è¡¨ç¤ºã€‚<strong>å¯¹äºè½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåªæœ‰åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™JVMæ‰ä¼šå›æ”¶è¯¥å¯¹è±¡</strong></p><ol start="3"><li>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</li></ol><p>  å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ï¼Œç”¨java.lang.ref.WeakReferenceç±»æ¥è¡¨ç¤ºï¼Œ<strong>å½“JVMè¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</strong></p><ol start="4"><li>è™šå¼•ç”¨ ï¼ˆPhantomReferenceï¼‰</li></ol><p>  java.lang.ref.PhantomReferenceç±»è¡¨ç¤ºã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸è™šå¼•ç”¨å…³è”ï¼Œåˆ™è·Ÿæ²¡æœ‰å¼•ç”¨ä¸ä¹‹å…³è”ä¸€æ ·ï¼Œ<strong>åœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶</strong>ã€‚</p><p>  è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„åŒºåˆ«ï¼š<strong>è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—è”åˆä½¿ç”¨ã€‚</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><span class="hljs-type">ReferenceQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span> ();<br><span class="hljs-type">PhantomReference</span> <span class="hljs-variable">pr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhantomReference</span> (object, queue); <br></code></pre></td></tr></table></figure></blockquote><p>ç”±äºThreadLocalMapçš„keyæ˜¯å¼±å¼•ç”¨ï¼Œè€ŒValueæ˜¯å¼ºå¼•ç”¨ã€‚è¿™å°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼ŒThreadLocalåœ¨æ²¡æœ‰å¤–éƒ¨å¯¹è±¡å¼ºå¼•ç”¨æ—¶ï¼Œå‘ç”ŸGCæ—¶å¼±å¼•ç”¨Keyä¼šè¢«å›æ”¶ï¼Œè€ŒValueä¸ä¼šå›æ”¶ã€‚</p><p>å½“çº¿ç¨‹æ²¡æœ‰ç»“æŸï¼Œä½†æ˜¯ThreadLocalå·²ç»è¢«å›æ”¶ï¼Œåˆ™å¯èƒ½å¯¼è‡´çº¿ç¨‹ä¸­å­˜åœ¨<code>ThreadLocalMap&lt;null, Object&gt;</code>çš„é”®å€¼å¯¹ï¼Œé€ æˆå†…å­˜æ³„éœ²ã€‚ï¼ˆThreadLocalè¢«å›æ”¶ï¼ŒThreadLocalå…³è”çš„çº¿ç¨‹å…±äº«å˜é‡è¿˜å­˜åœ¨ï¼‰ã€‚</p><h2 id="å¦‚ä½•é¿å…æ³„æ¼"><a href="#å¦‚ä½•é¿å…æ³„æ¼" class="headerlink" title="å¦‚ä½•é¿å…æ³„æ¼"></a>å¦‚ä½•é¿å…æ³„æ¼</h2><p>ä¸ºäº†é˜²æ­¢æ­¤ç±»æƒ…å†µçš„å‡ºç°ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ‰‹æ®µã€‚</p><ul><li><p>ä½¿ç”¨å®Œçº¿ç¨‹å…±äº«å˜é‡åï¼Œæ˜¾ç¤ºè°ƒç”¨<code>ThreadLocalMap.remove</code>æ–¹æ³•æ¸…é™¤çº¿ç¨‹å…±äº«å˜é‡ï¼›</p><p>æ—¢ç„¶Keyæ˜¯å¼±å¼•ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦åšçš„äº‹ï¼Œå°±æ˜¯åœ¨è°ƒç”¨ThreadLocalçš„<code>get()</code>ã€<code>set()</code>æ–¹æ³•æ—¶å®Œæˆåå†è°ƒç”¨removeæ–¹æ³•ï¼Œå°†EntryèŠ‚ç‚¹å’ŒMapçš„å¼•ç”¨å…³ç³»ç§»é™¤ï¼Œè¿™æ ·æ•´ä¸ªEntryå¯¹è±¡åœ¨GC Rootsåˆ†æåå°±å˜æˆä¸å¯è¾¾äº†ï¼Œä¸‹æ¬¡GCçš„æ—¶å€™å°±å¯ä»¥è¢«å›æ”¶ã€‚</p></li><li><p>JDKå»ºè®®ThreadLocalå®šä¹‰ä¸º<code>private static</code>ï¼Œè¿™æ ·ThreadLocalçš„å¼±å¼•ç”¨é—®é¢˜åˆ™ä¸å­˜åœ¨äº†ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ThreadLocal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mybatisplus-åŠ¨æ€è·å–sqlå­—ç¬¦ä¸²</title>
    <link href="/2023/12/11/Mybatisplus-%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96sql%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    <url>/2023/12/11/Mybatisplus-%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96sql%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>è®°å½•è´´</p></blockquote><p>å€ŸåŠ©mybatisplusæ„å»ºåŠ¨æ€ SQL æŸ¥è¯¢è¯­å¥çš„åŠŸèƒ½ï¼Œæ¥åŠ¨æ€æ„å»ºsqlæ¥åšprestoæŸ¥è¯¢ï¼Œè¿™æ ·å°±ä¸ç”¨åœ¨ä»£ç é‡Œå†™sqläº†</p><p><code>getBoundSql</code> æ˜¯ MyBatis ä¸­ <code>org.apache.ibatis.mapping.BoundSql</code> æ¥å£çš„æ–¹æ³•ï¼Œç”¨äºè·å–ä¸€ä¸ªè¡¨ç¤º SQL è¯­å¥å’Œç›¸å…³å‚æ•°æ˜ å°„çš„å¯¹è±¡ã€‚<code>BoundSql</code> å®ä¾‹åŒ…å«äº†é¢„ç¼–è¯‘çš„ SQL è¯­å¥ä»¥åŠå‚æ•°æ˜ å°„ä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.ibatis.mapping.BoundSql;<br><span class="hljs-keyword">import</span> org.apache.ibatis.mapping.MappedStatement;<br><span class="hljs-keyword">import</span> org.apache.ibatis.mapping.ParameterMapping;<br><span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.Configuration;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicSqlUtils</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SqlSession sqlSession;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSql</span><span class="hljs-params">(Class clz,String method, Object obj)</span> &#123;<br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> sqlSession.getConfiguration();<br>        <span class="hljs-type">MappedStatement</span> <span class="hljs-variable">ms</span> <span class="hljs-operator">=</span> configuration.getMappedStatement(clz.getName() + <span class="hljs-string">&quot;.&quot;</span> + method);<br>        <span class="hljs-type">BoundSql</span> <span class="hljs-variable">boundSql</span> <span class="hljs-operator">=</span> ms.getBoundSql(obj);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">parsedSql</span> <span class="hljs-operator">=</span> boundSql.getSql();<br>      <span class="hljs-comment">// #&#123;&#125;ä¼šè¢«æ›¿æ¢æˆ? ,$&#123;&#125;æ‰ä¼šè¢«æ›¿æ¢æˆå¯¹åº”çš„å€¼</span><br>        <span class="hljs-comment">// è·å–å‚æ•°æ˜ å°„</span><br>        List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();<br>        <span class="hljs-comment">// è·å–å‚æ•°å¯¹è±¡</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">parameterObject</span> <span class="hljs-operator">=</span> boundSql.getParameterObject();<br>        <span class="hljs-comment">// æ‰“å°å‚æ•°å ä½ç¬¦å’Œå¯¹åº”çš„å‚æ•°å€¼</span><br>        <span class="hljs-keyword">for</span> (ParameterMapping parameterMapping : parameterMappings) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> parameterMapping.getProperty();<br>            <span class="hljs-comment">// è·å–å‚æ•°å€¼</span><br>            <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-keyword">if</span> (boundSql.hasAdditionalParameter(property)) &#123;<br>                <span class="hljs-comment">// å¯¹äºé¢å¤–çš„å‚æ•°ï¼Œç›´æ¥è·å–</span><br>                value = boundSql.getAdditionalParameter(property);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parameterObject != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// å¯¹äºå‚æ•°å¯¹è±¡ï¼Œé€šè¿‡åå°„è·å–å±æ€§å€¼</span><br>                <span class="hljs-type">MetaObject</span> <span class="hljs-variable">metaObject</span> <span class="hljs-operator">=</span> configuration.newMetaObject(parameterObject);<br>                value = metaObject.getValue(property);<br>            &#125;<br>            <span class="hljs-comment">// æ›¿æ¢ SQL è¯­å¥ä¸­çš„å ä½ç¬¦</span><br>            parsedSql = parsedSql.replaceFirst(<span class="hljs-string">&quot;\\?&quot;</span>, <span class="hljs-string">&quot;&#x27;&quot;</span>+value.toString()+<span class="hljs-string">&quot;&#x27;&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> parsedSql;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;demoList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.*.dto.DemoDTO&quot;</span>&gt;</span><br>  select * from t demo where 1=1<br>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;form.status != null&quot;</span>&gt;</span><br>     and  t.status = #&#123;form.status&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>mapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DemoMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;DemoEntity&gt; &#123;<br>List&lt;DemoDTO&gt; <span class="hljs-title function_">demoList</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;form&quot;)</span> DemoForm form)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è°ƒç”¨</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†@Param(â€œformâ€)ç»™æ–¹æ³•å‚æ•°èµ·åˆ«åï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨Mapæ¥åŒ…è£…ä¸€ä¸‹map.put(â€œformâ€,åŸæ¥çš„formå¯¹è±¡)ï¼Œå¦åˆ™è·å–ä¸åˆ°form</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>Map&lt;String, Object&gt; map2 = JSON.parseObject(JSON.toJSONString(demoForm), <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;Map&lt;String, Object&gt;&gt;() &#123;&#125;);<br>map.put(<span class="hljs-string">&quot;form&quot;</span>, map2);<br>String sql=dynamicSqlUtils.getSql(DemoMapper.class, <span class="hljs-string">&quot;demoList&quot;</span>, map);<br><span class="hljs-comment">//presto.query(sql) æˆ–è€… hive.query(sql)</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mybatis</tag>
      
      <tag>presto</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®€å•å®ç°åˆ†æµåŠŸèƒ½</title>
    <link href="/2023/12/11/%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E5%88%86%E6%B5%81%E5%8A%9F%E8%83%BD/"/>
    <url>/2023/12/11/%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E5%88%86%E6%B5%81%E5%8A%9F%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<p>é€»è¾‘æ¯”è¾ƒç®€å•å°±æ˜¯å¯¹å­—ç¬¦ä¸²ä¸€é¡¿åŠ è§£å¯†æ“ä½œç„¶åhashcodeç„¶åå–æ¨¡100ï¼Œç„¶åçœ‹å–æ¨¡ç»“æœè½åœ¨å“ªä¸ªç»„çš„åŒºé—´</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.util.CollectionUtils;<br><span class="hljs-keyword">import</span> org.springframework.util.DigestUtils;<br><br><span class="hljs-keyword">import</span> java.math.BigDecimal;<br><span class="hljs-keyword">import</span> java.math.RoundingMode;<br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Percent</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æµé‡åˆ‡åˆ†ç®—æ³•ï¼ˆéšæœºï¼‰</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rid       rid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> groupMap å¯¹ç…§ç»„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> åˆ†ç»„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">choose</span><span class="hljs-params">(String rid, Map&lt;String, Double&gt; groupMap)</span> &#123;<br>        <span class="hljs-keyword">if</span> (groupMap == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        List&lt;String&gt; groups = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(groupMap.keySet());<br>        List&lt;Double&gt; rates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(groupMap.values());<br>        <span class="hljs-keyword">if</span> (CollectionUtils.isEmpty(groupMap) || CollectionUtils.isEmpty(rates)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">digest</span> <span class="hljs-operator">=</span> DigestUtils.md5DigestAsHex(rid.getBytes());<br>        <span class="hljs-type">int</span> <span class="hljs-variable">hashCode</span> <span class="hljs-operator">=</span> digest.hashCode();<br>        <span class="hljs-comment">//ç™¾åˆ†æ¯”</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> Math.abs(hashCode) % <span class="hljs-number">100</span>;<br>        <span class="hljs-comment">//murmur3_32ç®—æ³•æ¯”è¾ƒå¥½ï¼Œåˆ†å¸ƒå¾ˆå‡åŒ€</span><br>        <span class="hljs-comment">//int random = Math.abs(Hashing.murmur3_32().hashString(rid, Charset.forName(&quot;utf-8&quot;)).asInt())%100;</span><br><br>        <span class="hljs-type">double</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>;<br>        <span class="hljs-type">double</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; rates.size(); i++) &#123;<br>            end = end + rates.get(i);<br>            <span class="hljs-keyword">if</span> (start &lt;= random &amp;&amp; random &lt; end) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> groups.get(i);<br>                <span class="hljs-keyword">for</span> (String tempGroup : groups) &#123;<br>                    <span class="hljs-keyword">if</span> (group.equals(tempGroup)) &#123;<br>                        log.info(<span class="hljs-string">&quot;choose [rid]: &#123;&#125; [group]: &#123;&#125; random ;&#123;&#125;&quot;</span>, rid, group, random);<br>                        <span class="hljs-keyword">return</span> group;<br>                    &#125;<br>                &#125;<br>            &#125;<br>            start = start + rates.get(i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å†™ä¸ªmainæ–¹æ³•æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    Map&lt;String, Double&gt; groups = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    groups.put(<span class="hljs-string">&quot;g1&quot;</span>, <span class="hljs-number">15d</span>);<br>    groups.put(<span class="hljs-string">&quot;g2&quot;</span>, <span class="hljs-number">25d</span>);<br>    groups.put(<span class="hljs-string">&quot;g3&quot;</span>, <span class="hljs-number">30d</span>);<br>    groups.put(<span class="hljs-string">&quot;g4&quot;</span>, <span class="hljs-number">30d</span>);<br>    Map&lt;String, Integer&gt; groupCountMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-number">100000</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; total; i++) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">group_super_id</span> <span class="hljs-operator">=</span> choose(UUID.randomUUID().toString(), groups);<br>        <span class="hljs-keyword">if</span> (!groupCountMap.containsKey(group_super_id)) &#123;<br>            groupCountMap.put(group_super_id, <span class="hljs-number">1</span>);<br>        &#125;<br>        groupCountMap.put(group_super_id, groupCountMap.get(group_super_id) + <span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : groupCountMap.entrySet()) &#123;<br>        log.info(<span class="hljs-string">&quot;group : &#123;&#125; count : &#123;&#125; percent :&#123;&#125;&quot;</span>, entry.getKey(), entry.getValue(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(entry.getValue()).divide(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(total), <span class="hljs-number">4</span>, RoundingMode.UP).multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>)) + <span class="hljs-string">&quot;%&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœé€¼è¿‘é¢„è®¾å€¼</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231211160804894.png" alt="image-20231211160804894"></p>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>ç®—æ³•</tag>
      
      <tag>åˆ†æµ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo-ç”Ÿæˆç«™ç‚¹åœ°å›¾ï¼ˆsitemapï¼‰</title>
    <link href="/2023/12/08/Hexo-%E7%94%9F%E6%88%90%E7%AB%99%E7%82%B9%E5%9C%B0%E5%9B%BE%EF%BC%88sitemap%EF%BC%89/"/>
    <url>/2023/12/08/Hexo-%E7%94%9F%E6%88%90%E7%AB%99%E7%82%B9%E5%9C%B0%E5%9B%BE%EF%BC%88sitemap%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h3 id="SiteMapæ˜¯ä»€ä¹ˆ"><a href="#SiteMapæ˜¯ä»€ä¹ˆ" class="headerlink" title="SiteMapæ˜¯ä»€ä¹ˆ"></a>SiteMapæ˜¯ä»€ä¹ˆ</h3><p>Sitemap æ˜¯ä¸€ç§åˆ—ä¸¾äº†ç½‘ç«™ä¸­æ‰€æœ‰é¡µé¢çš„ XML æ–‡ä»¶ã€‚å®ƒå¯ä»¥è¢«æœç´¢å¼•æ“ï¼ˆå¦‚ Googleã€Bingï¼‰ç”¨æ¥æ›´æœ‰æ•ˆåœ°æŠ“å–ç½‘ç«™ï¼Œäº†è§£ç½‘ç«™çš„ç»“æ„ã€‚Sitemap æ–‡ä»¶æä¾›äº†ç½‘ç«™ä¸Šæ¯ä¸ªé¡µé¢çš„é“¾æ¥ä»¥åŠæœ‰å…³é¡µé¢æœ€åä¿®æ”¹æ—¶é—´ã€æ›´æ–°é¢‘ç‡å’Œç›¸å¯¹é‡è¦æ€§çš„é™„åŠ ä¿¡æ¯ï¼Œè¿™æœ‰åŠ©äºæœç´¢å¼•æ“ç¡®å®šå“ªäº›é¡µé¢åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä»¥åŠå¤šä¹…æŠ“å–ä¸€æ¬¡è¿™äº›é¡µé¢ã€‚</p><p>å¯¹äºå¤§å‹ç½‘ç«™ã€å…·æœ‰è®¸å¤šåŠ¨æ€é¡µé¢çš„ç½‘ç«™æˆ–æ–°ç½‘ç«™ï¼ŒSitemap å°¤å…¶é‡è¦ï¼Œå› ä¸ºå®ƒèƒ½ç¡®ä¿æœç´¢å¼•æ“èƒ½å¤Ÿå‘ç°å¹¶ç´¢å¼•ç½‘ç«™ä¸Šçš„æ‰€æœ‰é‡è¦é¡µé¢ã€‚å³ä¾¿å¯¹äºå°å‹ç½‘ç«™ï¼Œæ‹¥æœ‰ Sitemap ä¹Ÿæœ‰åŠ©äºæé«˜SEOï¼ˆæœç´¢å¼•æ“ä¼˜åŒ–ï¼‰çš„æ•ˆæœã€‚</p><p>ç«™ç‚¹åœ°å›¾æœ‰ä¸¤ç§å¸¸è§ç±»å‹ï¼š</p><ol><li><p>XML Sitemapï¼š<br>è¿™æ˜¯ç»™æœç´¢å¼•æ“çš„ï¼Œè§„èŒƒå®šä¹‰æ¯”è¾ƒä¸¥æ ¼ï¼Œå®ƒä½¿ç”¨ XML è¯­è¨€ç¼–å†™ï¼Œä¸€èˆ¬ä¼šæ”¾åœ¨ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹ï¼Œå¹¶å¯ä»¥é€šè¿‡ &#x2F;sitemap.xml è®¿é—®ã€‚è¿™æ ·åšå¯ä»¥ä½¿æœç´¢å¼•æ“æ›´å®¹æ˜“æ‰¾åˆ°å’ŒæŠ“å–æ‰€æœ‰çš„é¡µé¢ã€‚</p></li><li><p>HTML Sitemapï¼š<br>è¿™ç±» Sitemap æ˜¯ç»™ç”¨æˆ·çš„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç®€å•çš„ HTML é¡µé¢ï¼ŒåŒ…å«äº†ç½‘ç«™ä¸Šæ‰€æœ‰æˆ–æ˜¯æœ€é‡è¦çš„é¡µé¢çš„é“¾æ¥ã€‚è¿™å¯ä»¥å¸®åŠ©ç”¨æˆ·å¿«é€Ÿå¯¼èˆªåˆ°ä»–ä»¬æƒ³è¦æ‰¾çš„é¡µé¢ï¼Œå¹¶æé«˜ç½‘ç«™çš„ç”¨æˆ·ä½“éªŒã€‚</p></li></ol><h3 id="Hexoå¦‚ä½•ç”ŸæˆSitemap"><a href="#Hexoå¦‚ä½•ç”ŸæˆSitemap" class="headerlink" title="Hexoå¦‚ä½•ç”ŸæˆSitemap"></a>Hexoå¦‚ä½•ç”ŸæˆSitemap</h3><ul><li><p>Google ç‰ˆæœ¬</p><p><code>npm install hexo-generator-sitemap --save</code></p></li><li><p>Baidu ç‰ˆæœ¬</p><p><code>npm install hexo-generator-baidu-sitemap --save</code></p></li><li><p>åœ¨<code>_config.yml</code>ä¸­æ‰¾åˆ°<code>url</code>ï¼Œæ”¹æˆä½ è‡ªå·±çš„åŸŸåï¼Œå½±å“ç”Ÿæˆçš„sitemapä¸‹çš„æ¯ä¸€æ¡é“¾æ¥</p><figure class="highlight yaml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># URL</span><br><span class="hljs-comment">## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;</span><br><span class="hljs-attr">url:</span> <span class="hljs-string">&lt;è¿™é‡Œ&gt;</span><br><span class="hljs-attr">permalink:</span> <span class="hljs-string">:year/:month/:day/:title/</span><br><span class="hljs-attr">permalink_defaults:</span><br><span class="hljs-attr">pretty_urls:</span><br>  <span class="hljs-attr">trailing_index:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span><br>  <span class="hljs-attr">trailing_html:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Set to false to remove trailing &#x27;.html&#x27; from permalinks</span><br></code></pre></td></tr></table></figure></li><li><p>æ‰“åŒ…è‡ªåŠ¨åœ¨<code>public</code>ä¸‹ç”Ÿæˆ<code>sitemap.xml</code>å’Œ<code>baidusitemap.xml</code></p><p><code>hexo g -d</code></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231208174125354.png" alt="image-20231208174125354"></p><p>æµè§ˆå™¨è®¿é—®<code>https://&lt;åŸŸå&gt;/sitemap.xml</code>å’Œ<code>https://&lt;åŸŸå&gt;/baidusitemap.xml</code>å³å¯çœ‹åˆ°å†…å®¹<img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231208174254230.png" alt="image-20231208174254230"></p></li></ul><h3 id="æäº¤ç«™ç‚¹åˆ°ç™¾åº¦"><a href="#æäº¤ç«™ç‚¹åˆ°ç™¾åº¦" class="headerlink" title="æäº¤ç«™ç‚¹åˆ°ç™¾åº¦"></a>æäº¤ç«™ç‚¹åˆ°ç™¾åº¦</h3><ul><li><p>åˆ°ç™¾åº¦èµ„æºå¹³å°æäº¤ç«™ç‚¹</p><blockquote><p><a href="https://ziyuan.baidu.com/site/index#/">ç«™ç‚¹ç®¡ç†_ç«™é•¿å·¥å…·_ç™¾åº¦æœç´¢èµ„æºå¹³å° (baidu.com)</a></p></blockquote><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231208174539329.png" alt="image-20231208174539329"></p></li><li><p>æäº¤Sitemap<br><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231208174443927.png" alt="image-20231208174443927"></p></li></ul><h3 id="æäº¤ç«™ç‚¹åˆ°è°·æ­Œ"><a href="#æäº¤ç«™ç‚¹åˆ°è°·æ­Œ" class="headerlink" title="æäº¤ç«™ç‚¹åˆ°è°·æ­Œ"></a>æäº¤ç«™ç‚¹åˆ°è°·æ­Œ</h3><ul><li><p>åˆ°google search console æäº¤ç«™ç‚¹</p><blockquote><p><a href="https://search.google.com/search-console">https://search.google.com/search-console</a></p></blockquote><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231208174713820.png" alt="image-20231208174713820"></p></li><li><p>æäº¤ç«™ç‚¹åœ°å›¾Sitemap</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231208174929691.png" alt="image-20231208174929691"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Seo</tag>
      
      <tag>Sitemap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Easypoi-å¯¼å‡ºexcelå•å…ƒæ ¼æ·»åŠ ä¸‹æ‹‰åˆ—è¡¨</title>
    <link href="/2023/12/08/Easypoi-%E5%AF%BC%E5%87%BAexcel%E5%8D%95%E5%85%83%E6%A0%BC%E6%B7%BB%E5%8A%A0%E4%B8%8B%E6%8B%89%E5%88%97%E8%A1%A8/"/>
    <url>/2023/12/08/Easypoi-%E5%AF%BC%E5%87%BAexcel%E5%8D%95%E5%85%83%E6%A0%BC%E6%B7%BB%E5%8A%A0%E4%B8%8B%E6%8B%89%E5%88%97%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨ä½¿ç”¨excelè¿›è¡Œæ‰¹é‡å¯¼å…¥çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæä¾›å¯¼å…¥æ¨¡æ¿excelæ¥ç»™ç”¨æˆ·æ¥è§„èŒƒç”¨æˆ·çš„è¾“å…¥ï¼Œå…¶ä¸­å°±ä¼šç”¨åˆ°ä¸‹æ‹‰é€‰é¡¹æ¥çº¦æŸè¿™ä¸€ç§æ–¹å¼</p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231208165732976.png" alt="image-20231208165732976" style="zoom:50%;" /><h3 id="æ–¹æ³•ä¸€ï¼š-Excel"><a href="#æ–¹æ³•ä¸€ï¼š-Excel" class="headerlink" title="æ–¹æ³•ä¸€ï¼š@Excel"></a>æ–¹æ³•ä¸€ï¼š@Excel</h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Excel(name = &quot;çŠ¶æ€&quot;, width = 25, replace = &#123;&quot;å¾…å®¡_1&quot;, &quot;é€šè¿‡_2&quot;, &quot;é©³å›_3&quot;&#125;,addressList = true,orderNum = &quot;25&quot;)</span><br><span class="hljs-keyword">private</span> Integer status;<br></code></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯replaceå’ŒaddressListè¿™ä¸¤ä¸ªå±æ€§é…ç½®ã€‚</p><p><code>replace</code>ï¼šæ›¿æ¢å­—æ®µå†…å®¹ï¼Œé€šå¸¸ç”¨äºçŠ¶æ€å­—æ®µçš„æ˜¾ç¤ºï¼ˆä¾‹å¦‚ï¼šâ€ç”·_1,å¥³_2â€ï¼‰ã€‚</p><p><code>addressList</code>ï¼šæ˜¯å¦ç”Ÿæˆä¸‹æ‹‰çš„é€‰é¡¹ã€‚</p><blockquote><p><code>@Excel</code> æ˜¯ easypoi ä¸­ç”¨äº Excel å¯¼å…¥å¯¼å‡ºçš„æ³¨è§£ï¼Œå¯ä»¥ç”¨äºå®ä½“ç±»çš„å­—æ®µä¸Šï¼Œç”¨ä»¥å®šä¹‰è¯¥å­—æ®µæ•°æ®ä¸ Excel æ–‡ä»¶ä¸­çš„åˆ—çš„å¯¹åº”å…³ç³»ä»¥åŠè¿›è¡Œå¯¼å…¥å¯¼å‡ºæ—¶çš„å„ç§è®¾ç½®ã€‚ä»¥ä¸‹æ˜¯ <code>@Excel</code> æ³¨è§£çš„ä¸€äº›ä¸»è¦å±æ€§å’Œå®ƒä»¬çš„åŠŸèƒ½ï¼š</p><ol><li><code>name</code>ï¼šè®¾ç½®å¯¼å‡ºæ—¶åœ¨è¡¨æ ¼ä¸­çš„æ˜¾ç¤ºåç§°ã€‚</li><li><code>width</code>ï¼šåˆ—å®½åº¦ï¼Œå•ä½ä¸ºå­—ç¬¦ã€‚</li><li><code>height</code>ï¼šè¡Œé«˜åº¦ï¼Œå•ä½ä¸ºå­—ç¬¦ã€‚</li><li><code>orderNum</code>ï¼šå¯¼å‡ºæ’åºé¡ºåºï¼Œæ•°å€¼å°çš„å…ˆå¯¼å‡ºã€‚</li><li><code>needMerge</code>ï¼šæ˜¯å¦éœ€è¦åˆå¹¶å•å…ƒæ ¼ã€‚</li><li><code>mergeVertical</code>ï¼šçºµå‘åˆå¹¶å†…å®¹ç›¸åŒçš„å•å…ƒæ ¼ã€‚</li><li><code>mergeRely</code>ï¼šåˆå¹¶ä¾èµ–äºæŸäº›åˆ—çš„æƒ…å†µã€‚</li><li><code>replace</code>ï¼šæ›¿æ¢å­—æ®µå†…å®¹ï¼Œé€šå¸¸ç”¨äºçŠ¶æ€å­—æ®µçš„æ˜¾ç¤ºï¼ˆä¾‹å¦‚ï¼šâ€ç”·_1,å¥³_2â€ï¼‰ã€‚</li><li><code>suffix</code>ï¼šæ–‡æœ¬åç¼€ï¼Œå¦‚%ã€å…ƒã€ä¸ªã€‚</li><li><code>isImportField</code>ï¼šæ˜¯å¦ä¸ºå¯¼å…¥å­—æ®µï¼Œå¯¼å…¥æ¨¡æ¿æ—¶æ˜¯å¦éœ€è¦æ˜¾ç¤ºã€‚</li><li><code>exportType</code>ï¼šå¯¼å‡ºç±»å‹ï¼ŒæŒ‡å¯¼å‡ºæ–‡æœ¬è¿˜æ˜¯å¯¼å‡ºå›¾ç‰‡ç­‰ç±»å‹ã€‚</li><li><code>format</code>ï¼šæ—¶é—´æ ¼å¼åŒ–ï¼Œæ¯”å¦‚ï¼šâ€yyyy-MM-ddâ€ã€‚</li><li><code>databaseFormat</code>ï¼šæ•°æ®åº“æ ¼å¼ï¼Œé€šå¸¸é…åˆ <code>format</code> ä½¿ç”¨ã€‚</li><li><code>dict</code>ï¼šæ•°æ®å­—å…¸æ ‡è¯†ã€‚</li><li><code>savePath</code>ï¼šå›¾ç‰‡ç­‰æ–‡ä»¶ä¿å­˜è·¯å¾„ã€‚</li><li><code>type</code>ï¼šå­—æ®µç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ï¼‰ã€‚</li><li><code>imageType</code>ï¼šå›¾ç‰‡ç±»å‹ï¼Œæ§åˆ¶å¯¼å‡ºå›¾ç‰‡çš„æ–¹å¼ã€‚</li><li><code>suffix</code>ï¼šæ–‡æœ¬ç±»å‹çš„å­—æ®µåç¼€æ ‡è®°ã€‚</li><li><code>statistics</code>ï¼šæ˜¯å¦ç»Ÿè®¡å½“å‰åˆ—ï¼Œç”Ÿæˆç»Ÿè®¡è¡Œã€‚</li></ol></blockquote><h3 id="æ–¹æ³•äºŒï¼šDataValidation"><a href="#æ–¹æ³•äºŒï¼šDataValidation" class="headerlink" title="æ–¹æ³•äºŒï¼šDataValidation"></a>æ–¹æ³•äºŒï¼šDataValidation</h3><p>ç”±äºæœ‰çš„æ—¶å€™æˆ‘ä»¬çš„ä¸‹æ‹‰åˆ—è¡¨é€‰é¡¹æ¥è‡ªæ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨dictå±æ€§æ­é…IExcelDictHandlerï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨workbookä¸Šæ“ä½œï¼ŒæŠŠåˆ—è¡¨çº¦æŸä½œç”¨åˆ°æŒ‡å®šå•å…ƒæ ¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * firstRow å¼€å§‹è¡Œå· æ ¹æ®æ­¤é¡¹ç›®ï¼Œé»˜è®¤ä¸º2(ä¸‹æ ‡0å¼€å§‹)</span><br><span class="hljs-comment">     * lastRow  æ ¹æ®æ­¤é¡¹ç›®ï¼Œé»˜è®¤ä¸ºæœ€å¤§65535</span><br><span class="hljs-comment">     * firstCol åŒºåŸŸä¸­ç¬¬ä¸€ä¸ªå•å…ƒæ ¼çš„åˆ—å· (ä¸‹æ ‡0å¼€å§‹)</span><br><span class="hljs-comment">     * lastCol åŒºåŸŸä¸­æœ€åä¸€ä¸ªå•å…ƒæ ¼çš„åˆ—å·</span><br><span class="hljs-comment">     * strings ä¸‹æ‹‰å†…å®¹</span><br><span class="hljs-comment">     * */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDropdown</span><span class="hljs-params">(Workbook workbook,<span class="hljs-type">int</span> firstRow, <span class="hljs-type">int</span> col, String[] strings )</span>&#123;<br>       <span class="hljs-comment">//å¯¹å·¥ä½œç°¿ä¸­ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨è¿›è¡Œæ“ä½œ</span><br>        <span class="hljs-type">Sheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> workbook.getSheetAt(<span class="hljs-number">0</span>);<br>       <span class="hljs-comment">// åˆ›å»º`CellRangeAddressList`å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æŒ‡å®šä¸‹æ‹‰åˆ—è¡¨çš„é€‚ç”¨åŒºåŸŸï¼š</span><br>      <span class="hljs-comment">//è¯¥åŒºåŸŸä»`firstRow`èµ·å§‹è¡Œï¼ˆåŒ…å«ï¼‰åˆ°ç¬¬65535è¡Œï¼ˆåŒ…å«ï¼‰ï¼Œåœ¨`col`åˆ—ä¸Šã€‚ï¼ˆç”±äºæˆ‘ä»¬ä½œç”¨äºåŒä¸€åˆ—ï¼Œæ‰€ä»¥firstCol=lastColï¼‰</span><br>        <span class="hljs-type">CellRangeAddressList</span> <span class="hljs-variable">cellRangeAddressList</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CellRangeAddressList</span>(firstRow, <span class="hljs-number">65535</span>, col,col);<br>        <span class="hljs-type">DataValidationHelper</span> <span class="hljs-variable">helper</span> <span class="hljs-operator">=</span> sheet.getDataValidationHelper();<br>       <span class="hljs-comment">//ä½¿ç”¨ä¼ å…¥çš„å­—ç¬¦ä¸²æ•°ç»„åˆ›å»ºä¸€ä¸ªæ˜¾å¼åˆ—è¡¨çº¦æŸï¼Œç¡®å®šä¸‹æ‹‰åˆ—è¡¨ä¸­çš„é€‰é¡¹</span><br>        <span class="hljs-type">DataValidationConstraint</span> <span class="hljs-variable">dvConstraint</span> <span class="hljs-operator">=</span> helper.createExplicitListConstraint(strings);<br>       <span class="hljs-comment">//æŠŠåˆ›å»ºçš„åˆ—è¡¨çº¦æŸä½œç”¨åˆ°é‚£äº›èŒƒå›´å†…çš„å•å…ƒæ ¼</span><br>        <span class="hljs-type">DataValidation</span> <span class="hljs-variable">validation</span> <span class="hljs-operator">=</span> helper.createValidation(dvConstraint, cellRangeAddressList);<br>       <span class="hljs-comment">//  ä½œç”¨åˆ°sheetä¸Š</span><br>        sheet.addValidationData(validation);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ä»¥ä¸Šä»£ç æœ‰ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚æœä¸‹æ‹‰é€‰é¡¹è¿‡å¤šï¼Œä¼šæ— æ³•æ˜¾ç¤ºï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©ä¸€ä¸ªéšè—çš„å­—å…¸sheetï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLongDropdown</span><span class="hljs-params">(Workbook workbook,<span class="hljs-type">int</span> firstRow, <span class="hljs-type">int</span> col, String[] strings )</span>&#123;<br>       <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> (XSSFSheet)workbook.getSheetAt(<span class="hljs-number">0</span>);<br>       <span class="hljs-comment">//é»˜è®¤ä¸ºæœ€å¤§65535</span><br>       <span class="hljs-type">int</span> <span class="hljs-variable">endRow</span> <span class="hljs-operator">=</span><span class="hljs-number">65535</span>;<br>       <span class="hljs-comment">//éšä¾¿èµ·ä¸ªsheetå</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">hiddenName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hidden&quot;</span>+col;<br>       <span class="hljs-comment">//1.åˆ›å»ºéšè—çš„sheeté¡µã€‚</span><br>       <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">hidden</span> <span class="hljs-operator">=</span> (XSSFSheet)workbook.createSheet(hiddenName);<br>       <span class="hljs-comment">//2.å¾ªç¯èµ‹å€¼ï¼ˆä¸ºäº†é˜²æ­¢ä¸‹æ‹‰æ¡†çš„è¡Œæ•°ä¸éšè—åŸŸçš„è¡Œæ•°ç›¸å¯¹åº”ï¼Œå°†éšè—åŸŸåŠ åˆ°ç»“æŸè¡Œä¹‹åï¼‰</span><br>       <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, length = strings.length; i &lt; length; i++) &#123;<br>           hidden.createRow(endRow + i).createCell(col).setCellValue(strings[i]);<br>       &#125;<br>       <span class="hljs-comment">//åˆ›å»ºå¯è¢«å…¶ä»–å•å…ƒæ ¼å¼•ç”¨çš„åç§°</span><br>       <span class="hljs-type">Name</span> <span class="hljs-variable">workbookName</span> <span class="hljs-operator">=</span> workbook.createName();<br>       workbookName.setNameName(hiddenName);<br>       <span class="hljs-comment">//3 A1:Aä»£è¡¨éšè—åŸŸåˆ›å»ºç¬¬Nåˆ—createCell(N)æ—¶ã€‚ä»¥A1åˆ—å¼€å§‹Aè¡Œæ•°æ®è·å–ä¸‹æ‹‰æ•°ç»„</span><br>       workbookName.setRefersToFormula(hiddenName + <span class="hljs-string">&quot;!A1:A&quot;</span> + (strings.length + endRow));<br>       <span class="hljs-type">DataValidationHelper</span> <span class="hljs-variable">helper</span> <span class="hljs-operator">=</span> sheet.getDataValidationHelper();<br>       <span class="hljs-type">DataValidationConstraint</span> <span class="hljs-variable">constraint</span> <span class="hljs-operator">=</span> helper.createFormulaListConstraint(hiddenName);<br>       <span class="hljs-type">CellRangeAddressList</span> <span class="hljs-variable">addressList</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CellRangeAddressList</span>(firstRow, endRow, col, col);<br>       <span class="hljs-type">DataValidation</span> <span class="hljs-variable">dataValidation</span> <span class="hljs-operator">=</span> helper.createValidation(constraint, addressList);<br>       <span class="hljs-keyword">if</span> (dataValidation <span class="hljs-keyword">instanceof</span> XSSFDataValidation) &#123;<br>           <span class="hljs-comment">// æ•°æ®æ ¡éªŒ</span><br>           dataValidation.setSuppressDropDownArrow(<span class="hljs-literal">true</span>);<br>           dataValidation.setShowErrorBox(<span class="hljs-literal">true</span>);<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           dataValidation.setSuppressDropDownArrow(<span class="hljs-literal">false</span>);<br>       &#125;<br>       <span class="hljs-comment">// ä½œç”¨åœ¨ç›®æ ‡sheetä¸Š</span><br>       sheet.addValidationData(dataValidation);<br>       <span class="hljs-comment">// ä¸ºäº†ç”¨æˆ·å‹å¥½ï¼Œè®¾ç½®hiddenSheetéšè—</span><br>       workbook.setSheetHidden(workbook.getSheetIndex(hiddenName), <span class="hljs-literal">true</span>);<br>   &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Easypoi</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Arthas:æ’æŸ¥cpuå¼‚å¸¸è¿‡é«˜çš„é—®é¢˜</title>
    <link href="/2023/10/27/Arthas-%E6%8E%92%E6%9F%A5cpu%E5%BC%82%E5%B8%B8%E8%BF%87%E9%AB%98%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2023/10/27/Arthas-%E6%8E%92%E6%9F%A5cpu%E5%BC%82%E5%B8%B8%E8%BF%87%E9%AB%98%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>ä¸‹è½½arthas</p><p><code>curl -O https://alibaba.github.io/arthas/arthas-boot.jar</code></p><p>å¯åŠ¨arthas</p><p><code>java -jar arthas-boot.jar</code></p><p>dashboard ä»ªè¡¨æ¿</p><blockquote><p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯æ˜¾ç¤ºJVMä¸­è¿è¡Œçš„æ‰€æœ‰çº¿ç¨‹ï¼šæ‰€åœ¨çº¿ç¨‹ç»„ï¼Œä¼˜å…ˆçº§ï¼Œçº¿ç¨‹çš„çŠ¶æ€ï¼ŒCPUçš„å ç”¨ç‡ï¼Œæ˜¯å¦æ˜¯åå°è¿›ç¨‹ç­‰</p><p>ç¬¬äºŒéƒ¨åˆ†æ˜¾ç¤ºçš„JVMå†…å­˜çš„ä½¿ç”¨æƒ…å†µ</p><p>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€äº›ä¿¡æ¯å’ŒJavaç‰ˆæœ¬å·</p></blockquote><p><code>dashboard</code></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231226145518601.png" alt="image-20231226145518601"></p><p>é€šè¿‡ thread å‘½ä»¤æ¥è·å–çº¿ç¨‹ä¿¡æ¯</p><blockquote><p>1ã€å½“æ²¡æœ‰å‚æ•°æ—¶ï¼Œæ˜¾ç¤ºæ‰€æœ‰çº¿ç¨‹çš„ä¿¡æ¯</p><p>thread<br>2ã€å±•ç¤ºå½“å‰æœ€å¿™çš„å‰3ä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ</p><p>thread -n 3<br>3ã€æ˜¾ç¤º1å·çº¿ç¨‹çš„è¿è¡Œå †æ ˆ</p><p>thread 1<br>4ã€æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å‘ç°åº”ç”¨å¡ä½äº†ï¼Œ é€šå¸¸æ˜¯ç”±äºæŸä¸ªçº¿ç¨‹æ‹¿ä½äº†æŸä¸ªé”ï¼Œ å¹¶ä¸”å…¶ä»–çº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¿™æŠŠé”é€ æˆçš„ã€‚ ä¸ºäº†æ’æŸ¥è¿™ç±»é—®é¢˜ï¼Œ arthasæä¾›äº†thread -bï¼Œ ä¸€é”®æ‰¾å‡ºé‚£ä¸ªç½ªé­ç¥¸é¦–ã€‚</p><p>thread -b<br>5ã€æŒ‡å®šé‡‡æ ·æ—¶é—´é—´éš”ï¼Œæ¯è¿‡1000æ¯«ç§’é‡‡æ ·ï¼Œæ˜¾ç¤ºæœ€å æ—¶é—´çš„3ä¸ªçº¿ç¨‹</p><p>thread -i 1000 -n 3<br>6ã€æŸ¥çœ‹å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹</p></blockquote><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231226145349492.png" alt="image-20231226145349492"></p><p>æ‰¾å¯¹å¯¹åº”æ–¹æ³•è§£å†³</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Elasticseatchç®€å•å®è·µ</title>
    <link href="/2023/09/05/Elasticseatch%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/"/>
    <url>/2023/09/05/Elasticseatch%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p>Elasticsearchæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œç”¨äºå­˜å‚¨ã€æœç´¢å’Œåˆ†æå¤§é‡æ•°æ®ã€‚å®ƒæœ€åˆç”±Elasticsearch BVï¼ˆç°åœ¨ç§°ä¸ºElastic NVï¼‰å¼€å‘ï¼Œæ˜¯Elastic Stackï¼ˆä»¥å‰ç§°ä¸ºELK Stackï¼‰çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚Elastic Stackæ˜¯ä¸€ä¸ªç”¨äºæ—¥å¿—å’Œæ•°æ®åˆ†æçš„å¼€æºè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Elasticsearchã€Logstashå’ŒKibanaã€‚</p><p>Elasticsearchçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li>åˆ†å¸ƒå¼æ€§èƒ½ï¼šElasticsearchå¯ä»¥è½»æ¾åœ°æ‰©å±•åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä»¥å¤„ç†å¤§è§„æ¨¡çš„æ•°æ®å’ŒæŸ¥è¯¢ã€‚å®ƒä½¿ç”¨åˆ†ç‰‡å’Œå¤åˆ¶æ¥ç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</li><li>å®æ—¶æœç´¢ï¼šElasticsearchèƒ½å¤Ÿåœ¨æ–‡æ¡£è¢«ç´¢å¼•åå‡ ä¹ç«‹å³æä¾›å®æ—¶æœç´¢ç»“æœï¼Œä½¿å…¶éå¸¸é€‚ç”¨äºå„ç§åº”ç”¨ï¼ŒåŒ…æ‹¬æ—¥å¿—åˆ†æã€æœç´¢å¼•æ“ã€ç›‘æ§å’Œä»ªè¡¨æ¿ç­‰ã€‚</li><li>å¤šæ•°æ®ç±»å‹æ”¯æŒï¼šElasticsearchæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€æ•°å€¼ã€æ—¥æœŸã€åœ°ç†ä½ç½®ç­‰ã€‚è¿™ä½¿å¾—å®ƒéå¸¸çµæ´»ï¼Œå¯ä»¥åº”ç”¨äºå„ç§ä¸åŒç±»å‹çš„æ•°æ®åˆ†æä»»åŠ¡ã€‚</li><li>å¼ºå¤§çš„æŸ¥è¯¢åŠŸèƒ½ï¼šElasticsearchæä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€å’ŒåŠŸèƒ½ï¼ŒåŒ…æ‹¬å…¨æ–‡æœç´¢ã€æ¨¡ç³Šæœç´¢ã€èŒƒå›´æŸ¥è¯¢ã€èšåˆåˆ†æç­‰ï¼Œä½¿ç”¨æˆ·å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®è¿›è¡Œå¤æ‚çš„æŸ¥è¯¢å’Œåˆ†æã€‚</li><li>å¯æ‰©å±•æ€§å’Œæ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼šElasticsearchå…·æœ‰ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œå¯ä»¥æ‰©å±•å…¶åŠŸèƒ½ï¼ŒåŒ…æ‹¬å®‰å…¨æ€§ã€ç›‘æ§ã€æŠ¥å‘Šç­‰æ–¹é¢ã€‚</li><li>å¼€æºå’Œå…è´¹ï¼šElasticsearchæ˜¯å¼€æºè½¯ä»¶ï¼Œå¯å…è´¹ä½¿ç”¨ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºæ”¯æŒå’Œç»´æŠ¤ã€‚</li></ol><p>Elasticsearché€šå¸¸ä¸å…¶ä»–Elastic Stackç»„ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚Logstashç”¨äºæ•°æ®æ”¶é›†å’Œå¤„ç†ï¼ŒKibanaç”¨äºæ•°æ®å¯è§†åŒ–å’Œä»ªè¡¨æ¿åˆ›å»ºã€‚è¿™äº›ç»„ä»¶å…±åŒæ„å»ºäº†å¼ºå¤§çš„æ•°æ®åˆ†æå’Œæœç´¢è§£å†³æ–¹æ¡ˆï¼Œå¹¿æ³›ç”¨äºå„ç§åº”ç”¨é¢†åŸŸï¼ŒåŒ…æ‹¬ä¼ä¸šæœç´¢ã€æ—¥å¿—åˆ†æã€å®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†ï¼ˆSIEMï¼‰ã€ç”µå­å•†åŠ¡æœç´¢ç­‰ã€‚</p><h2 id="å®‰è£…ElasticSearch"><a href="#å®‰è£…ElasticSearch" class="headerlink" title="å®‰è£…ElasticSearch"></a>å®‰è£…ElasticSearch</h2><ul><li><p>ä»Dockeré•œåƒä»“åº“ï¼ˆé€šå¸¸æ˜¯Docker Hubæˆ–å…¶ä»–é•œåƒä»“åº“ï¼‰ä¸‹è½½ï¼ˆæˆ–æ‹‰å–ï¼‰elasticsearché•œåƒåˆ°æœ¬åœ°è®¡ç®—æœº</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">docker pull elasticsearch:7.16.2<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå¯åŠ¨ä¸€ä¸ªåä¸º â€œesâ€ çš„åå°è¿è¡Œçš„Elasticsearchå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d --name es -p 9200:9200 -p 9300:9300 -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot; -e &quot;discovery.type=single-node&quot; -v es:/usr/share/elasticsearch/data  elasticsearch:7.16.2<br></code></pre></td></tr></table></figure><blockquote><ol><li><code>docker run</code>: è¿™æ˜¯Dockerå‘½ä»¤è¡Œå·¥å…·ä¸­ç”¨äºåˆ›å»ºå’Œè¿è¡Œå®¹å™¨çš„å‘½ä»¤ã€‚</li><li><code>-d</code>: è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œè¡¨ç¤ºå®¹å™¨å°†ä»¥åå°ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰æ¨¡å¼è¿è¡Œï¼Œå³ä¸ä¼šé˜»æ­¢ç»ˆç«¯ã€‚</li><li><code>--name es</code>: è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºæŒ‡å®šå®¹å™¨çš„åç§°ä¸º â€œesâ€ã€‚è¿™å°†ä½¿æ‚¨èƒ½å¤Ÿä½¿ç”¨å®¹å™¨åç§°å¼•ç”¨å®¹å™¨ï¼Œè€Œä¸å¿…ä¾èµ–äºå®¹å™¨çš„IDã€‚</li><li><code>-p 9200:9200 -p 9300:9300</code>: è¿™æ˜¯ç”¨äºç«¯å£æ˜ å°„çš„é€‰é¡¹ã€‚å®ƒå°†å®¹å™¨å†…éƒ¨çš„9200ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„9200ç«¯å£ï¼ŒåŒæ—¶å°†å®¹å™¨å†…éƒ¨çš„9300ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„9300ç«¯å£ã€‚è¿™äº›ç«¯å£æ˜¯Elasticsearchç”¨äºä¸å¤–éƒ¨é€šä¿¡çš„ç«¯å£ï¼Œå…¶ä¸­9200ç”¨äºHTTPè¯·æ±‚ï¼Œ9300ç”¨äºå†…éƒ¨èŠ‚ç‚¹é€šä¿¡ã€‚</li><li><code>-e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot;</code>: è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºè®¾ç½®Elasticsearchçš„Javaè™šæ‹Ÿæœºé€‰é¡¹ã€‚åœ¨è¿™é‡Œï¼Œå®ƒè®¾ç½®äº†åˆå§‹å †å¤§å°ï¼ˆXmsï¼‰å’Œæœ€å¤§å †å¤§å°ï¼ˆXmxï¼‰éƒ½ä¸º256MBï¼Œä»¥æ§åˆ¶Elasticsearchä½¿ç”¨çš„å†…å­˜ã€‚</li><li><code>-e &quot;discovery.type=single-node&quot;</code>: è¿™æ˜¯å¦ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºè®¾ç½®Elasticsearchçš„å‘ç°ç±»å‹ä¸º â€œsingle-nodeâ€ã€‚è¿™è¡¨ç¤ºElasticsearchå°†ä½œä¸ºå•èŠ‚ç‚¹è¿è¡Œï¼Œé€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚</li><li><code>-v es:/usr/share/elasticsearch/data</code>: è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºå°†ä¸»æœºçš„ä¸€ä¸ªå·ï¼ˆvolumeï¼‰æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„ç›®å½•ã€‚è¿™é‡Œå°†ä¸»æœºä¸Šçš„åä¸º â€œesâ€ çš„å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„ â€œ&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;dataâ€ ç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨Elasticsearchçš„æ•°æ®ã€‚</li><li><code>elasticsearch:7.16.2</code>: è¿™æ˜¯è¦è¿è¡Œçš„Dockeré•œåƒçš„åç§°å’Œæ ‡ç­¾ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™æ˜¯Elasticsearch 7.16.2é•œåƒçš„æ ‡è¯†ï¼ŒDockerå°†æ ¹æ®æ­¤æ ‡è¯†ä»Docker Hubæ‹‰å–é•œåƒå¹¶åˆ›å»ºå®¹å™¨ã€‚</li></ol></blockquote></li><li><p>è¿›å…¥åä¸º â€œesâ€ çš„å®¹å™¨ï¼Œå¹¶ä»¥äº¤äº’æ–¹å¼ï¼ˆ<code>-it</code>æ ‡å¿—ï¼‰å¯åŠ¨ä¸€ä¸ªbash shellã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it es /bin/bash<br></code></pre></td></tr></table></figure></li><li><p>åœ¨å®¹å™¨å†…å®‰è£…ikä¸­æ–‡åˆ†è¯å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.16.2/elasticsearch-analysis-ik-7.16.2.zip<br></code></pre></td></tr></table></figure></li><li><p>é‡å¯eså®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker restart es<br></code></pre></td></tr></table></figure></li><li><p>éªŒè¯åˆ†è¯æ’ä»¶æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">// å¢åŠ ä¸€ä¸ªå«test001çš„ç´¢å¼•<br>curl -X PUT http://localhost:9200/test001<br>// æˆåŠŸè¿”å› &#123;&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;test001&quot;&#125;<br><br>// ik_smartåˆ†è¯<br>curl -X POST \<br>&#x27;http://127.0.0.1:9200/test001/_analyze?pretty=true&#x27; \<br>-H &#x27;Content-Type: application/json&#x27; \<br>-d &#x27;&#123;&quot;text&quot;:&quot;æˆ‘ä»¬æ˜¯è½¯ä»¶å·¥ç¨‹å¸ˆ&quot;,&quot;tokenizer&quot;:&quot;ik_smart&quot;&#125;&#x27;<br><br>// ik_max_wordåˆ†è¯<br>curl -X POST \<br>&#x27;http://127.0.0.1:9200/test001/_analyze?pretty=true&#x27; \<br>-H &#x27;Content-Type: application/json&#x27; \<br>-d &#x27;&#123;&quot;text&quot;:&quot;æˆ‘ä»¬æ˜¯è½¯ä»¶å·¥ç¨‹å¸ˆ&quot;,&quot;tokenizer&quot;:&quot;ik_max_word&quot;&#125;&#x27;<br></code></pre></td></tr></table></figure></li><li><p>æˆ‘ä»¬å¯ä»¥åœ¨æœ¬æœºçš„ host æ–‡ä»¶ä¸­ï¼Œæ·»åŠ æ˜ å°„ï¼Œå°† <code>127.0.0.1 host.docker.internal</code>;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">host.docker.internal 127.0.0.1<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå¯åŠ¨ä¸€ä¸ªåä¸º â€œkibanaâ€ çš„åå°è¿è¡Œçš„kibanaå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run --name kibana -e ELASTICSEARCH_HOSTS=http://host.docker.internal:9200 -p 5601:5601 -d kibana:7.16.2<br></code></pre></td></tr></table></figure></li><li><p>è®¿é—®<a href="http://localhost:5601åˆ¤æ–­kibanaæ˜¯å¦å¯åŠ¨æˆåŠŸ">http://localhost:5601åˆ¤æ–­kibanaæ˜¯å¦å¯åŠ¨æˆåŠŸ</a></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202309051448318.png" alt="image-20230905114036359"></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202309051448326.png" alt="image-20230905114212959"></p></li></ul><h2 id="é›†æˆSpringboot"><a href="#é›†æˆSpringboot" class="headerlink" title="é›†æˆSpringboot"></a>é›†æˆSpringboot</h2><ul><li><p>æ·»åŠ Elasticsearchå®¢æˆ·ç«¯åº“ä¾èµ–é¡¹ï¼šè¿™é‡Œæˆ‘æ˜¯è·Ÿç€springbootçš„ç‰ˆæœ¬ 2.3.9.RELEASE</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®Elasticsearchè¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåã€ç«¯å£å·ç­‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">elasticsearch:</span><br>      <span class="hljs-attr">client:</span><br>        <span class="hljs-attr">reactive:</span><br>          <span class="hljs-attr">endpoints:</span> <span class="hljs-string">http://localhost:9200</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå®ä½“ç±»ï¼š åˆ›å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œè¡¨ç¤ºè¦å­˜å‚¨åœ¨Elasticsearchä¸­çš„æ–‡æ¡£ã€‚è¯¥å®ä½“ç±»éœ€è¦ä½¿ç”¨<code>@Document</code>æ³¨è§£æ¥æŒ‡å®šä¸Elasticsearchç´¢å¼•çš„æ˜ å°„ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Document(indexName = &quot;test_index&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestIndex</span> &#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> String content;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;TestIndex&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;id=&#x27;&quot;</span> + id + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, title=&#x27;&quot;</span> + title + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, content=&#x27;&quot;</span> + content + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºElasticsearchå­˜å‚¨åº“ï¼ˆRepositoryï¼‰ï¼š åˆ›å»ºä¸€ä¸ªElasticsearchå­˜å‚¨åº“æ¥å£ï¼Œå®ƒå°†ç»§æ‰¿è‡ªSpring Data Elasticsearchçš„<code>ElasticsearchRepository</code>ã€‚è¿™ä¸ªå­˜å‚¨åº“å°†ç”¨äºå®šä¹‰ä¸Elasticsearchç´¢å¼•çš„äº¤äº’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TestIndexElasticsearchRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;TestIndex, String&gt; &#123;<br>    List&lt;TestIndex&gt; <span class="hljs-title function_">findAllByContent</span><span class="hljs-params">(String content)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨testä¸‹åˆ›å»ºæµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TestIndexElasticsearchRepository testIndexElasticsearchRepository;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">TestIndex</span> <span class="hljs-variable">testIndex</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestIndex</span>();<br>        testIndex.setId(<span class="hljs-string">&quot;1&quot;</span>);<br>        testIndex.setTitle(<span class="hljs-string">&quot;ä½ å¥½&quot;</span>);<br>        testIndex.setContent(<span class="hljs-string">&quot;æˆ‘æ˜¯javaå¼€å‘å·¥ç¨‹å¸ˆ&quot;</span>);<br>        <span class="hljs-type">TestIndex</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> testIndexElasticsearchRepository.save(testIndex);<br>        System.out.println(save);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">()</span> &#123;<br>        List&lt;TestIndex&gt; testIndices = testIndexElasticsearchRepository.findAllByContent(<span class="hljs-string">&quot;java&quot;</span>);<br>        <span class="hljs-keyword">for</span> (TestIndex index : testIndices) &#123;<br>            System.out.println(index);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">find</span><span class="hljs-params">()</span> &#123;<br>        Iterable&lt;TestIndex&gt; testIndices = testIndexElasticsearchRepository.findAll();<br>        <span class="hljs-keyword">for</span> (TestIndex index : testIndices) &#123;<br>            System.out.println(index);<br>        &#125;<br>        <span class="hljs-type">TestIndex</span> <span class="hljs-variable">testIndex</span> <span class="hljs-operator">=</span> testIndexElasticsearchRepository.findById(<span class="hljs-string">&quot;1&quot;</span>).get();<br>        System.out.println(testIndex);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        testIndexElasticsearchRepository.deleteById(<span class="hljs-string">&quot;1&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æ‰§è¡Œç»“æœ</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202309051448825.png" alt="image-20230905144512754"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ†å¸ƒå¼ç³»ç»Ÿ</tag>
      
      <tag>ElasticSearch</tag>
      
      <tag>æœç´¢ä¸åˆ†æå¼•æ“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡-Seataç®€å•å®è·µ</title>
    <link href="/2023/08/28/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1-Seata%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/"/>
    <url>/2023/08/28/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1-Seata%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p>å½“æ¶‰åŠå¤šä¸ªä¸åŒçš„è®¡ç®—æœºæˆ–ç³»ç»Ÿä¹‹é—´çš„æ“ä½œæ—¶ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ç¡®ä¿è¿™äº›æ“ä½œåœ¨ä¸€ç»„ç›¸å…³çš„äº‹åŠ¡ä¸­ä¿æŒä¸€è‡´æ€§å’Œéš”ç¦»æ€§çš„æœºåˆ¶ã€‚åœ¨ä¼ ç»Ÿçš„å•æœºäº‹åŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ•°æ®åº“çš„äº‹åŠ¡æ¥ç¡®ä¿æ“ä½œçš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ã€‚ç„¶è€Œï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¯èƒ½æ¶‰åŠç½‘ç»œé—®é¢˜ã€èŠ‚ç‚¹æ•…éšœç­‰ï¼Œä½¿å¾—ä¿æŒä¸€è‡´æ€§å˜å¾—æ›´åŠ å¤æ‚ã€‚åˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦è§£å†³ä»¥ä¸‹æŒ‘æˆ˜ï¼š</p><ol><li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>ï¼šåˆ†å¸ƒå¼äº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸èƒ½åªå®Œæˆéƒ¨åˆ†æ“ä½œã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªæ“ä½œå¤±è´¥ï¼Œæ‰€æœ‰æ¶‰åŠçš„æ“ä½œéƒ½å¿…é¡»å›æ»šã€‚</li><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šäº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåï¼Œç³»ç»Ÿå¿…é¡»ä¿æŒä¸€è‡´çŠ¶æ€ã€‚å³ä½¿åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œäº‹åŠ¡ä¹Ÿå¿…é¡»ç¡®ä¿æ•°æ®ä¸ä¼šè¿›å…¥ä¸ä¸€è‡´çŠ¶æ€ã€‚</li><li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>ï¼šåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå„ä¸ªäº‹åŠ¡ä¹‹é—´åº”è¯¥ç›¸äº’éš”ç¦»ï¼Œä»¥é¿å…å¹¶å‘æ‰§è¡Œå¯¼è‡´çš„é—®é¢˜ï¼Œä¾‹å¦‚è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li><li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong>ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå…¶ç»“æœåº”è¯¥æŒä¹…ä¿å­˜ï¼Œå³ä½¿å‘ç”Ÿç³»ç»Ÿæ•…éšœä¹Ÿä¸åº”ä¸¢å¤±ã€‚</li></ol><p>åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼</p><ol><li><strong>XAæ¨¡å¼</strong>ï¼š XAæ˜¯ä¸€ç§æ ‡å‡†çš„åˆ†å¸ƒå¼äº‹åŠ¡åè®®ï¼Œå®ƒåœ¨ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰çš„åŸºç¡€ä¸Šå®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„ACIDå±æ€§ã€‚XAæ¶‰åŠä¸¤ä¸ªè§’è‰²ï¼šäº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰å’Œèµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰ã€‚åœ¨ç¬¬ä¸€é˜¶æ®µï¼ŒTMè¦æ±‚æ‰€æœ‰RMé¢„æäº¤äº‹åŠ¡ã€‚åœ¨ç¬¬äºŒé˜¶æ®µï¼ŒTMå‘é€å…¨å±€æäº¤æˆ–å›æ»šå‘½ä»¤ï¼ŒRMæ‰§è¡Œå¯¹åº”æ“ä½œã€‚è™½ç„¶XAç¡®ä¿äº†ä¸€è‡´æ€§ï¼Œä½†å®ƒçš„ç¼ºç‚¹æ˜¯å¯èƒ½ä¼šå¯¼è‡´é˜»å¡ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œæ•…éšœæˆ–å‚ä¸è€…æ•…éšœçš„æƒ…å†µä¸‹ã€‚</li><li><strong>ATæ¨¡å¼ï¼ˆAutomatic Transactionï¼‰</strong>ï¼š ATæ¨¡å¼æ˜¯ä¸€ç§åŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡è‡ªåŠ¨åŒ–äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ¥å®ç°ä¸€è‡´æ€§ã€‚æ¯ä¸ªå‚ä¸è€…èŠ‚ç‚¹åœ¨æ‰§è¡Œäº‹åŠ¡ä¹‹å‰ä¼šå…ˆå°è¯•æ‰§è¡Œæ“ä½œï¼Œç„¶åè®°å½•æ“ä½œäº§ç”Ÿçš„å½±å“ã€‚å¦‚æœæ‰€æœ‰å‚ä¸è€…çš„æ“ä½œéƒ½æˆåŠŸï¼Œé‚£ä¹ˆäº‹åŠ¡å°±ä¼šè¢«è‡ªåŠ¨æäº¤ã€‚å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå‚ä¸è€…çš„æ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡ä¼šè¢«å›æ»šã€‚ATæ¨¡å¼é¿å…äº†2PCçš„é˜»å¡é—®é¢˜ï¼Œä½†å¯èƒ½å¯¼è‡´éƒ¨åˆ†å¤±è´¥é—®é¢˜ã€‚</li><li><strong>TCCæ¨¡å¼ï¼ˆTry-Confirm-Cancelï¼‰</strong>ï¼š TCCæ¨¡å¼é€šè¿‡å°†ä¸€ä¸ªå¤§äº‹åŠ¡åˆ†è§£ä¸ºä¸‰ä¸ªé˜¶æ®µæ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå°è¯•ï¼ˆTryï¼‰ã€ç¡®è®¤ï¼ˆConfirmï¼‰å’Œå–æ¶ˆï¼ˆCancelï¼‰ã€‚åœ¨å°è¯•é˜¶æ®µï¼Œæ‰€æœ‰å‚ä¸è€…éƒ½ä¼šå°è¯•æ‰§è¡Œæ“ä½œã€‚åœ¨ç¡®è®¤é˜¶æ®µï¼Œå¦‚æœæ‰€æœ‰å‚ä¸è€…çš„æ“ä½œéƒ½æˆåŠŸï¼Œå°±ä¼šè¿›è¡Œç¡®è®¤æ“ä½œã€‚å¦‚æœä»»ä½•æ“ä½œå¤±è´¥ï¼Œå°±ä¼šè¿›è¡Œå–æ¶ˆæ“ä½œã€‚TCCæ¨¡å¼æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä½†éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼ç¼–å†™ç¡®è®¤å’Œå–æ¶ˆé€»è¾‘ã€‚</li><li><strong>Sagaæ¨¡å¼</strong>ï¼š Sagaæ¨¡å¼å°†ä¸€ä¸ªå¤§äº‹åŠ¡æ‹†åˆ†ä¸ºä¸€ç³»åˆ—å°æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚æ¯ä¸ªæ­¥éª¤éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„è¡¥å¿æ“ä½œï¼Œç”¨äºæ’¤é”€è¯¥æ­¥éª¤çš„å½±å“ã€‚å¦‚æœä¸€ä¸ªæ­¥éª¤å¤±è´¥ï¼Œå°±ä¼šè§¦å‘å…¶å…³è”çš„è¡¥å¿æ“ä½œï¼Œå°†ç³»ç»ŸçŠ¶æ€å›æ»šåˆ°ä¸€è‡´çŠ¶æ€ã€‚Sagaæ¨¡å¼é€‚ç”¨äºåˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„é•¿æ—¶é—´äº‹åŠ¡ï¼Œä½†éœ€è¦å¼€å‘äººå‘˜ä»”ç»†è®¾è®¡è¡¥å¿é€»è¾‘ã€‚</li></ol><h2 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h2><h3 id="å®‰è£…é…ç½®"><a href="#å®‰è£…é…ç½®" class="headerlink" title="å®‰è£…é…ç½®"></a>å®‰è£…é…ç½®</h3><ul><li><p>ä¸‹è½½</p><p>ç‚¹å‡»é“¾æ¥è¿›å»ä¸‹è½½ï¼š<a href="https://seata.io/zh-cn/blog/download.html">https://seata.io/zh-cn/blog/download.html</a></p><p>æœ¬æ–‡çš„seataç‰ˆæœ¬ä¸º1.7.0</p></li><li><p>é…ç½®</p><ul><li><p>å‚è€ƒconf&#x2F;application.example.ymlä¿®æ”¹conf&#x2F;application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></div></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">7091</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">seata-server</span><br><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">config:</span> <span class="hljs-string">classpath:logback-spring.xml</span><br>  <span class="hljs-attr">file:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">$&#123;user.home&#125;/logs/seata</span><br><br><span class="hljs-attr">console:</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">seata</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">seata</span><br><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">config:</span><br>    <span class="hljs-comment"># support: nacos, consul, apollo, zk, etcd3</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>      <span class="hljs-attr">namespace:</span><br>      <span class="hljs-attr">group:</span> <span class="hljs-string">SEATA_GROUP</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">nacos</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">nacos</span><br>      <span class="hljs-attr">context-path:</span><br>      <span class="hljs-comment">##if use MSE Nacos with auth, mutex with username/password attribute</span><br>      <span class="hljs-comment">#access-key:</span><br>      <span class="hljs-comment">#secret-key:</span><br>      <span class="hljs-attr">data-id:</span> <span class="hljs-string">seataServer.properties</span><br>    <span class="hljs-attr">consul:</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-comment"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">application:</span> <span class="hljs-string">seata-server</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>      <span class="hljs-attr">group:</span> <span class="hljs-string">SEATA_GROUP</span><br>      <span class="hljs-attr">namespace:</span><br>      <span class="hljs-attr">cluster:</span> <span class="hljs-string">default</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">nacos</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">nacos</span><br>      <span class="hljs-attr">context-path:</span><br>  <span class="hljs-attr">store:</span><br>    <span class="hljs-comment"># support: file ã€ db ã€ redis</span><br>    <span class="hljs-attr">mode:</span> <span class="hljs-string">db</span><br>    <span class="hljs-attr">db:</span><br>      <span class="hljs-attr">datasource:</span> <span class="hljs-string">druid</span><br>      <span class="hljs-attr">db-type:</span> <span class="hljs-string">mysql</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/seata?rewriteBatchedStatements=true</span><br>      <span class="hljs-attr">user:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">min-conn:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">max-conn:</span> <span class="hljs-number">100</span><br>      <span class="hljs-attr">global-table:</span> <span class="hljs-string">global_table</span><br>      <span class="hljs-attr">branch-table:</span> <span class="hljs-string">branch_table</span><br>      <span class="hljs-attr">lock-table:</span> <span class="hljs-string">lock_table</span><br>      <span class="hljs-attr">distributed-lock-table:</span> <span class="hljs-string">distributed_lock</span><br>      <span class="hljs-attr">query-limit:</span> <span class="hljs-number">1000</span><br>      <span class="hljs-attr">max-wait:</span> <span class="hljs-number">5000</span><br><span class="hljs-comment">#  server:</span><br><span class="hljs-comment">#    service-port: 8091 #If not configured, the default is &#x27;$&#123;server.port&#125; + 1000&#x27;</span><br>  <span class="hljs-attr">security:</span><br>    <span class="hljs-attr">secretKey:</span> <span class="hljs-string">SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</span><br>    <span class="hljs-attr">tokenValidityInMilliseconds:</span> <span class="hljs-number">1800000</span><br>    <span class="hljs-attr">ignore:</span><br>      <span class="hljs-attr">urls:</span> <span class="hljs-string">/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.jpeg,/**/*.ico,/api/v1/auth/login</span><br></code></pre></td></tr></table></figure></li><li><p>mysqlæ•°æ®åº“åˆ›å»ºseataåº“å¹¶æ‰§è¡Œ&#x2F;seata&#x2F;script&#x2F;server&#x2F;db&#x2F;mysql.sql</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------<br>-- the table to store GlobalSession data<br>CREATE TABLE IF NOT EXISTS `global_table`<br>(<br>    `xid`                       VARCHAR(128) NOT NULL,<br>    `transaction_id`            BIGINT,<br>    `status`                    TINYINT      NOT NULL,<br>    `application_id`            VARCHAR(32),<br>    `transaction_service_group` VARCHAR(32),<br>    `transaction_name`          VARCHAR(128),<br>    `timeout`                   INT,<br>    `begin_time`                BIGINT,<br>    `application_data`          VARCHAR(2000),<br>    `gmt_create`                DATETIME,<br>    `gmt_modified`              DATETIME,<br>    PRIMARY KEY (`xid`),<br>    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),<br>    KEY `idx_transaction_id` (`transaction_id`)<br>) ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8mb4;<br><br>-- the table to store BranchSession data<br>CREATE TABLE IF NOT EXISTS `branch_table`<br>(<br>    `branch_id`         BIGINT       NOT NULL,<br>    `xid`               VARCHAR(128) NOT NULL,<br>    `transaction_id`    BIGINT,<br>    `resource_group_id` VARCHAR(32),<br>    `resource_id`       VARCHAR(256),<br>    `branch_type`       VARCHAR(8),<br>    `status`            TINYINT,<br>    `client_id`         VARCHAR(64),<br>    `application_data`  VARCHAR(2000),<br>    `gmt_create`        DATETIME(6),<br>    `gmt_modified`      DATETIME(6),<br>    PRIMARY KEY (`branch_id`),<br>    KEY `idx_xid` (`xid`)<br>) ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8mb4;<br><br>-- the table to store lock data<br>CREATE TABLE IF NOT EXISTS `lock_table`<br>(<br>    `row_key`        VARCHAR(128) NOT NULL,<br>    `xid`            VARCHAR(128),<br>    `transaction_id` BIGINT,<br>    `branch_id`      BIGINT       NOT NULL,<br>    `resource_id`    VARCHAR(256),<br>    `table_name`     VARCHAR(32),<br>    `pk`             VARCHAR(36),<br>    `status`         TINYINT      NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;0:locked ,1:rollbacking&#x27;,<br>    `gmt_create`     DATETIME,<br>    `gmt_modified`   DATETIME,<br>    PRIMARY KEY (`row_key`),<br>    KEY `idx_status` (`status`),<br>    KEY `idx_branch_id` (`branch_id`),<br>    KEY `idx_xid` (`xid`)<br>) ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8mb4;<br><br>CREATE TABLE IF NOT EXISTS `distributed_lock`<br>(<br>    `lock_key`       CHAR(20) NOT NULL,<br>    `lock_value`     VARCHAR(20) NOT NULL,<br>    `expire`         BIGINT,<br>    primary key (`lock_key`)<br>) ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8mb4;<br><br>INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES (&#x27;AsyncCommitting&#x27;, &#x27; &#x27;, 0);<br>INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES (&#x27;RetryCommitting&#x27;, &#x27; &#x27;, 0);<br>INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES (&#x27;RetryRollbacking&#x27;, &#x27; &#x27;, 0);<br>INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES (&#x27;TxTimeoutCheck&#x27;, &#x27; &#x27;, 0);<br></code></pre></td></tr></table></figure></li></ul></li><li><p>å¯åŠ¨</p><p>åœ¨seataç›®å½•ä¸‹æ‰§è¡Œseata-server.sh æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bin/seata-server.sh <br></code></pre></td></tr></table></figure><p>è®¿é—®<a href="http://localhost:7091/%EF%BC%8C%E5%87%BA%E7%8E%B0%E4%BB%A5%E4%B8%8B%E7%94%BB%E9%9D%A2%E4%BB%A3%E8%A1%A8%E6%88%90%E5%8A%9F%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E5%B0%B1%E6%98%AF%E5%9C%A8application.yml%E9%85%8D%E7%BD%AE%E7%9A%84console.user.username%E5%92%8Cconsole.user.password">http://localhost:7091/ï¼Œå‡ºç°ä»¥ä¸‹ç”»é¢ä»£è¡¨æˆåŠŸè´¦å·å¯†ç å°±æ˜¯åœ¨application.ymlé…ç½®çš„console.user.usernameå’Œconsole.user.password</a></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308282051746.png" alt="image-20230828204423604"></p><p>ä¹Ÿå¯ä»¥åœ¨nacosé¡µé¢ä¸­æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308282051341.png" alt="image-20230828205059592"></p></li></ul><p>â€‹</p><h3 id="å¾®æœåŠ¡é›†æˆSeata"><a href="#å¾®æœåŠ¡é›†æˆSeata" class="headerlink" title="å¾®æœåŠ¡é›†æˆSeata"></a>å¾®æœåŠ¡é›†æˆSeata</h3><ul><li><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.seata<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>              <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.seata<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="XA"><a href="#XA" class="headerlink" title="XA"></a>XA</h4><h5 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h5><p>æ”¯æŒXA äº‹åŠ¡çš„æ•°æ®åº“ã€‚<br>Java åº”ç”¨ï¼Œé€šè¿‡ JDBC è®¿é—®æ•°æ®åº“ã€‚</p><h5 id="æ•´ä½“æœºåˆ¶"><a href="#æ•´ä½“æœºåˆ¶" class="headerlink" title="æ•´ä½“æœºåˆ¶"></a>æ•´ä½“æœºåˆ¶</h5><p>åœ¨ Seata å®šä¹‰çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶å†…ï¼Œåˆ©ç”¨äº‹åŠ¡èµ„æºï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯æœåŠ¡ç­‰ï¼‰å¯¹ XA åè®®çš„æ”¯æŒï¼Œä»¥ XA åè®®çš„æœºåˆ¶æ¥ç®¡ç†åˆ†æ”¯äº‹åŠ¡çš„ä¸€ç§ äº‹åŠ¡æ¨¡å¼ã€‚</p><p>æ‰§è¡Œé˜¶æ®µï¼š</p><p>å¯å›æ»šï¼šä¸šåŠ¡ SQL æ“ä½œæ”¾åœ¨ XA åˆ†æ”¯ä¸­è¿›è¡Œï¼Œç”±èµ„æºå¯¹ XA åè®®çš„æ”¯æŒæ¥ä¿è¯ å¯å›æ»š<br>æŒä¹…åŒ–ï¼šXA åˆ†æ”¯å®Œæˆåï¼Œæ‰§è¡Œ XA prepareï¼ŒåŒæ ·ï¼Œç”±èµ„æºå¯¹ XA åè®®çš„æ”¯æŒæ¥ä¿è¯ æŒä¹…åŒ–ï¼ˆå³ï¼Œä¹‹åä»»ä½•æ„å¤–éƒ½ä¸ä¼šé€ æˆæ— æ³•å›æ»šçš„æƒ…å†µï¼‰</p><p>å®Œæˆé˜¶æ®µï¼š</p><p>åˆ†æ”¯æäº¤ï¼šæ‰§è¡Œ XA åˆ†æ”¯çš„ commit<br>åˆ†æ”¯å›æ»šï¼šæ‰§è¡Œ XA åˆ†æ”¯çš„ rollback</p><ul><li><p>é…ç½®application.yml ä½¿ç”¨XAæ¨¡å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">data-source-proxy-mode:</span> <span class="hljs-string">XA</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">application:</span> <span class="hljs-string">seata-server</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span><br>      <span class="hljs-attr">namespace:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">nacos</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">nacos</span><br>  <span class="hljs-comment">#äº‹åŠ¡ç»„çš„åç§°</span><br>  <span class="hljs-attr">tx-service-group:</span> <span class="hljs-string">seata-demo</span><br>  <span class="hljs-attr">service:</span><br>    <span class="hljs-comment">#äº‹åŠ¡ç»„å’Œclusterçš„æ˜ å°„å…³ç³»</span><br>    <span class="hljs-attr">vgroup-mapping:</span><br>    <span class="hljs-comment">#ä½ é…ç½®çš„seata/conf/application.ymlçš„ cluster</span><br>      <span class="hljs-attr">seata-demo:</span> <span class="hljs-string">default</span><br></code></pre></td></tr></table></figure></li><li><p>Seataé€šè¿‡å°è£…æ•°æ®åº“çš„XAæ¥å£ï¼Œå®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†çš„æµç¨‹ï¼Œé™ä½äº†ä½¿ç”¨è€…çš„å¤æ‚åº¦ã€‚ç”¨æˆ·åªè¦åœ¨Seataå®¢æˆ·ç«¯è¿›è¡Œç®€å•çš„å¼€å¯XAæ¨¡å¼çš„é…ç½®ï¼Œå³å¯æˆåŠŸä½¿ç”¨Seataçš„XAæ¨¡å¼ã€‚XAæ¨¡å¼çš„æ€§èƒ½ä¹Ÿè¾ƒå·®ï¼Œåªé€‚ç”¨äºä¸€äº›å¯¹äº‹åŠ¡ä¸€è‡´æ€§è¦æ±‚éå¸¸é«˜çš„åœºæ™¯ã€‚</p><p>ç›´æ¥åœ¨serviceå¯¹ç”¨æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£@GlobalTransactionalï¼Œå³å¯ç”Ÿæ•ˆ</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308311843476.png" alt="image-20230831183911000"></p><p>xaæ¨¡å¼ä¸‹çš„æ—¥å¿—</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308311843190.png" alt="image-20230831182630307"></p></li></ul><h4 id="AT"><a href="#AT" class="headerlink" title="AT"></a>AT</h4><h5 id="å‰æ-1"><a href="#å‰æ-1" class="headerlink" title="å‰æ"></a>å‰æ</h5><ul><li>åŸºäºæ”¯æŒæœ¬åœ° ACID äº‹åŠ¡çš„å…³ç³»å‹æ•°æ®åº“ã€‚</li><li>Java åº”ç”¨ï¼Œé€šè¿‡ JDBC è®¿é—®æ•°æ®åº“ã€‚</li></ul><h5 id="æ•´ä½“æœºåˆ¶-1"><a href="#æ•´ä½“æœºåˆ¶-1" class="headerlink" title="æ•´ä½“æœºåˆ¶"></a>æ•´ä½“æœºåˆ¶</h5><p>ä¸¤é˜¶æ®µæäº¤åè®®çš„æ¼”å˜ï¼š</p><ul><li>ä¸€é˜¶æ®µï¼šä¸šåŠ¡æ•°æ®å’Œå›æ»šæ—¥å¿—è®°å½•åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤ï¼Œé‡Šæ”¾æœ¬åœ°é”å’Œè¿æ¥èµ„æºã€‚</li><li>äºŒé˜¶æ®µï¼š<ul><li>æäº¤å¼‚æ­¥åŒ–ï¼Œéå¸¸å¿«é€Ÿåœ°å®Œæˆã€‚</li><li>å›æ»šé€šè¿‡ä¸€é˜¶æ®µçš„å›æ»šæ—¥å¿—è¿›è¡Œåå‘è¡¥å¿ã€‚</li></ul></li></ul><ul><li><p>mysqlæ•°æ®æ–°å¢undo_logè¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE `undo_log` (<br>  `id` bigint(20) NOT NULL AUTO_INCREMENT,<br>  `branch_id` bigint(20) NOT NULL,<br>  `xid` varchar(100) NOT NULL,<br>  `context` varchar(128) NOT NULL,<br>  `rollback_info` longblob NOT NULL,<br>  `log_status` int(11) NOT NULL,<br>  `log_created` datetime NOT NULL,<br>  `log_modified` datetime NOT NULL,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)<br>) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;<br></code></pre></td></tr></table></figure></li><li><p>data-source-proxy-modeä¿®æ”¹æˆATæ¨¡å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">data-source-proxy-mode:</span> <span class="hljs-string">AT</span><br></code></pre></td></tr></table></figure></li><li><p>ATä¸‹çš„æ—¥å¿—</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202309011026520.png" alt="image-20230901101219676"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>SpringCloud</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ç†”æ–­é™çº§é™æµ-Sentinelç®€å•å®è·µ</title>
    <link href="/2023/08/25/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7%E9%99%90%E6%B5%81-Sentinel%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/"/>
    <url>/2023/08/25/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7%E9%99%90%E6%B5%81-Sentinel%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç†”æ–­ã€é™çº§å’Œé™æµæ˜¯ä¸‰ç§å¸¸è§çš„ä¿æŠ¤ç­–ç•¥ï¼Œç”¨äºç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</p><p><strong>ç†”æ–­ï¼š</strong> ç†”æ–­æ˜¯ä¸€ç§é’ˆå¯¹ç‰¹å®šæœåŠ¡æˆ–èµ„æºçš„ä¿æŠ¤æœºåˆ¶ã€‚å½“è¯¥æœåŠ¡æˆ–èµ„æºå‡ºç°å¼‚å¸¸ã€æ•…éšœæˆ–æ€§èƒ½ä¸‹é™æ—¶ï¼Œç†”æ–­æœºåˆ¶ä¼šè¿…é€Ÿåœæ­¢å‘è¯¥æœåŠ¡æˆ–èµ„æºå‘é€è¯·æ±‚ï¼Œé¿å…ç»§ç»­çš„è¯·æ±‚å¯èƒ½åŠ é‡é—®é¢˜ã€‚ç†”æ–­é€šå¸¸åŸºäºä¸€äº›æŒ‡æ ‡ï¼ˆå¦‚é”™è¯¯ç‡ã€å“åº”æ—¶é—´ç­‰ï¼‰è¿›è¡Œè§¦å‘ï¼Œå¦‚æœè¿™äº›æŒ‡æ ‡è¶…è¿‡äº†é¢„è®¾çš„é˜ˆå€¼ï¼Œç³»ç»Ÿä¼šå°†è¯¥æœåŠ¡ç†”æ–­ï¼Œå³æš‚åœå¯¹å®ƒçš„è¯·æ±‚ï¼Œç›´åˆ°ä¸€æ®µæ—¶é—´åé‡æ–°å°è¯•ã€‚ç†”æ–­æœ‰åŠ©äºé˜²æ­¢æ•…éšœæ‰©æ•£ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p><p><strong>é™çº§ï¼š</strong> é™çº§æ˜¯ä¸€ç§åœ¨ç³»ç»Ÿå‹åŠ›å‰§å¢ã€èµ„æºä¸è¶³æˆ–å¼‚å¸¸æƒ…å†µä¸‹çš„åº”å¯¹ç­–ç•¥ã€‚ä¸ºäº†ä¿æŒæ ¸å¿ƒåŠŸèƒ½çš„å¯ç”¨æ€§ï¼Œç³»ç»Ÿå¯ä»¥ä¸»åŠ¨æ”¾å¼ƒä¸€äº›éæ ¸å¿ƒæˆ–æ¬¡è¦åŠŸèƒ½ï¼Œä»è€Œå‡è½»ç³»ç»Ÿçš„è´Ÿè½½ã€‚ä¾‹å¦‚ï¼Œåœ¨é«˜æµé‡æœŸé—´ï¼Œç³»ç»Ÿå¯ä»¥é™çº§ä¸ºæä¾›åŸºæœ¬çš„æœåŠ¡ï¼Œç¦ç”¨æŸäº›é«˜æˆæœ¬æˆ–èµ„æºå¯†é›†å‹çš„åŠŸèƒ½ã€‚è¿™å¯ä»¥ç¡®ä¿ç³»ç»Ÿçš„å…³é”®éƒ¨åˆ†ä»ç„¶æ­£å¸¸å·¥ä½œï¼Œå³ä½¿åœ¨èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ä¹Ÿèƒ½ä¿æŒè¾ƒå¥½çš„å“åº”æ€§èƒ½ã€‚</p><p><strong>é™æµï¼š</strong> é™æµæ˜¯ä¸€ç§æ§åˆ¶ç³»ç»Ÿè®¿é—®é‡çš„ç­–ç•¥ï¼Œç”¨äºé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚é€šè¿‡é™åˆ¶å¯¹æŸä¸ªç‰¹å®šæœåŠ¡ã€æ¥å£æˆ–èµ„æºçš„å¹¶å‘è®¿é—®æ•°é‡ï¼Œé™æµå¯ä»¥é˜²æ­¢è¿‡å¤šçš„è¯·æ±‚å½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚é™æµå¯ä»¥åŸºäºå¤šç§æ¡ä»¶è¿›è¡Œï¼Œå¦‚è®¾ç½®æ¯ç§’æŸ¥è¯¢æ•°ï¼ˆQPSï¼‰é™åˆ¶ã€å¹¶å‘è¿æ¥æ•°ã€è¯·æ±‚é¢‘ç‡ç­‰ã€‚è¿™æœ‰åŠ©äºç»´æŠ¤ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨å…¶å¯æ‰¿å—çš„è´Ÿè½½èŒƒå›´å†…è¿è¡Œã€‚</p><h2 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h2><p>Sentinelæ—¨åœ¨è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸è§çš„æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§å’Œä¿æŠ¤é—®é¢˜ï¼Œå¸®åŠ©å¼€å‘äººå‘˜æ„å»ºç¨³å®šã€å¯é çš„å¾®æœåŠ¡æ¶æ„ã€‚ä»¥ä¸‹æ˜¯Sentinelçš„ä¸€äº›é‡è¦æ–¹é¢ï¼š</p><ol><li><p><strong>æµé‡æ§åˆ¶ï¼š</strong> Sentinelå¯ä»¥æ ¹æ®ç³»ç»Ÿçš„è´Ÿè½½æƒ…å†µå’Œèµ„æºçš„å¯ç”¨æ€§ï¼Œé™åˆ¶å¯¹æŸä¸ªç‰¹å®šèµ„æºçš„è®¿é—®ã€‚é€šè¿‡è®¾å®šé˜ˆå€¼ï¼Œå¼€å‘äººå‘˜å¯ä»¥é™åˆ¶èµ„æºçš„å¹¶å‘è®¿é—®æ•°ã€QPSç­‰ï¼Œé˜²æ­¢è¿‡å¤šçš„è¯·æ±‚å¯¼è‡´èµ„æºè€—å°½æˆ–æ€§èƒ½ä¸‹é™ã€‚</p></li><li><p><strong>ç†”æ–­é™çº§ï¼š</strong> Sentinelå¯ä»¥ç›‘æ§èµ„æºçš„é”™è¯¯ç‡ã€å¼‚å¸¸ç‡ç­‰æƒ…å†µã€‚å¦‚æœé”™è¯¯ç‡è¶…è¿‡äº†è®¾å®šçš„é˜ˆå€¼ï¼ŒSentinelå¯ä»¥è‡ªåŠ¨è§¦å‘ç†”æ–­æ“ä½œï¼Œåœæ­¢å¯¹è¯¥èµ„æºçš„è¯·æ±‚ä¸€æ®µæ—¶é—´ï¼Œä»¥é˜²æ­¢æ•…éšœæ‰©æ•£ã€‚ç†”æ–­æœºåˆ¶æœ‰åŠ©äºä¿æŠ¤ç³»ç»Ÿå…å—æ•…éšœçš„å½±å“ã€‚</p></li><li><p><strong>ç³»ç»Ÿä¿æŠ¤ï¼š</strong> Sentinelå¯ä»¥ç›‘æ§æ•´ä¸ªç³»ç»Ÿçš„å¥åº·çŠ¶æ€ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè´Ÿè½½ã€èµ„æºåˆ©ç”¨ç‡ç­‰ã€‚å½“ç³»ç»Ÿè´Ÿè½½è¿‡é«˜æˆ–å‡ºç°å¼‚å¸¸æƒ…å†µæ—¶ï¼ŒSentinelå¯ä»¥é‡‡å–æªæ–½ï¼Œå¦‚é™åˆ¶æŸäº›èµ„æºçš„è®¿é—®ï¼Œä»¥ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿå…å—è¿‡è½½çš„å½±å“ã€‚</p></li><li><p><strong>å®æ—¶ç›‘æ§å’Œç»Ÿè®¡ï¼š</strong> Sentinelæä¾›å®æ—¶çš„ç›‘æ§é¢æ¿å’Œç»Ÿè®¡ä¿¡æ¯ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡è¿™äº›ä¿¡æ¯äº†è§£èµ„æºçš„ä½¿ç”¨æƒ…å†µã€å¼‚å¸¸æƒ…å†µå’Œç³»ç»Ÿçš„æ•´ä½“çŠ¶æ€ã€‚è¿™äº›æ•°æ®æœ‰åŠ©äºåŠæ—¶å‘ç°é—®é¢˜å¹¶é‡‡å–æªæ–½ã€‚</p></li><li><p><strong>è§„åˆ™é…ç½®ï¼š</strong> Sentinelå…è®¸å¼€å‘äººå‘˜é…ç½®æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§çš„è§„åˆ™ã€‚è§„åˆ™å¯ä»¥åŸºäºèµ„æºçš„åç§°ã€è·¯å¾„ã€HTTPæ–¹æ³•ç­‰è¿›è¡Œé…ç½®ï¼Œä»¥é€‚åº”ä¸åŒçš„åœºæ™¯å’Œéœ€æ±‚ã€‚</p></li><li><p><strong>é›†æˆå’Œé€‚ç”¨æ€§ï¼š</strong> Sentinelå¯ä»¥ä¸å„ç§ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶ä¸€èµ·ä½¿ç”¨ï¼Œé€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ä¸­çš„å„ç§åœºæ™¯ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„APIå’Œæ’ä»¶ï¼Œä»¥ä¾¿ä¸ç°æœ‰ç³»ç»Ÿé›†æˆã€‚</p></li></ol><h3 id="ç®€å•å®è·µ"><a href="#ç®€å•å®è·µ" class="headerlink" title="ç®€å•å®è·µ"></a>ç®€å•å®è·µ</h3><ul><li><p>ä¸‹è½½sentinel</p><blockquote><p>åœ°å€ï¼š<a href="https://github.com/alibaba/Sentinel">https://github.com/alibaba/Sentinel</a></p></blockquote></li><li><p>å¯åŠ¨sentinel</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">java -jar sentinel-dashboard-1.8.6.jar <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308251829872.png" alt="image-20230825182945267"></p></li><li><p><strong>å¼•å…¥ä¾èµ–ï¼š</strong> åœ¨ä½ çš„Spring Booté¡¹ç›®çš„ <code>pom.xml</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ Sentinelçš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>é…ç½®ï¼š</strong> åœ¨ä½ çš„ <code>application.properties</code> æˆ– <code>application.yml</code> æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›åŸºæœ¬çš„é…ç½®ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8080</span><br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨é¡¹ç›®å³å¯åœ¨é¡µé¢ä¸­å®æ—¶ç›‘æ§ã€é…ç½®æµæ§è§„åˆ™ç­‰</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308251825142.png" alt="image-20230825182546927"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>SpringCloud</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ†å¸ƒå¼ç³»ç»Ÿ</tag>
      
      <tag>Sentinel</tag>
      
      <tag>ç†”æ–­</tag>
      
      <tag>é™çº§</tag>
      
      <tag>é™æµ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ-Nacosç®€å•å®è·µ</title>
    <link href="/2023/08/23/%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-Nacos%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/"/>
    <url>/2023/08/23/%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-Nacos%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒæ˜¯ä¸€ç§ç”¨äºç®¡ç†å’Œé›†ä¸­å­˜å‚¨åº”ç”¨ç¨‹åºé…ç½®çš„ç³»ç»Ÿï¼Œç‰¹åˆ«é€‚ç”¨äºå¤§è§„æ¨¡ã€å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯å°†åº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ä»ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä½¿å¾—é…ç½®å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡ŒåŠ¨æ€ä¿®æ”¹å’Œç®¡ç†ï¼Œè€Œæ— éœ€é‡æ–°éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚</p><p>ä»¥ä¸‹æ˜¯åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒçš„ä¸€äº›å…³é”®ç‰¹ç‚¹å’Œä¼˜åŠ¿ï¼š</p><ol><li><strong>é›†ä¸­ç®¡ç†ï¼š</strong> åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒå…è®¸å°†æ‰€æœ‰åº”ç”¨ç¨‹åºçš„é…ç½®é›†ä¸­å­˜å‚¨åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œä»è€Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†å’Œä¿®æ”¹é…ç½®ï¼Œé¿å…äº†åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹ä¸­æ‰‹åŠ¨æ›´æ”¹é…ç½®ã€‚</li><li><strong>åŠ¨æ€æ›´æ–°ï¼š</strong> é…ç½®ä¸­å¿ƒæ”¯æŒåœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€æ›´æ–°é…ç½®ï¼Œè€Œæ— éœ€é‡æ–°å¯åŠ¨æˆ–é‡æ–°éƒ¨ç½²åº”ç”¨ã€‚è¿™å¯¹äºéœ€è¦é¢‘ç¹å˜æ›´é…ç½®çš„åœºæ™¯éå¸¸æœ‰ç”¨ã€‚</li><li><strong>ç‰ˆæœ¬æ§åˆ¶ï¼š</strong> é…ç½®ä¸­å¿ƒé€šå¸¸æ”¯æŒé…ç½®ç‰ˆæœ¬æ§åˆ¶ï¼Œä½¿å¾—å¯ä»¥è·Ÿè¸ªé…ç½®çš„å˜æ›´å†å²ï¼Œæ–¹ä¾¿å›é€€æˆ–æ¢å¤é…ç½®ã€‚</li><li><strong>ç¯å¢ƒéš”ç¦»ï¼š</strong> é…ç½®ä¸­å¿ƒå…è®¸å°†ä¸åŒç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰çš„é…ç½®éš”ç¦»å¼€æ¥ï¼Œä»è€Œç¡®ä¿åœ¨ä¸åŒç¯å¢ƒä¸­ä½¿ç”¨ä¸åŒçš„é…ç½®ã€‚</li><li><strong>åŠ¨æ€æ‰©å±•ï¼š</strong> é…ç½®ä¸­å¿ƒå¯ä»¥æ”¯æŒå¤šä¸ªåº”ç”¨ç¨‹åºå®ä¾‹å’Œå¤šä¸ªå›¢é˜ŸåŒæ—¶è®¿é—®ï¼Œå¹¶èƒ½å¤Ÿå¤„ç†é«˜å¹¶å‘çš„é…ç½®è¯·æ±‚ã€‚</li><li><strong>å®‰å…¨æ€§ï¼š</strong> é…ç½®ä¸­å¿ƒé€šå¸¸æä¾›æƒé™æ§åˆ¶ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è®¿é—®å’Œä¿®æ”¹é…ç½®ã€‚</li><li><strong>é›†æˆæ”¯æŒï¼š</strong> é…ç½®ä¸­å¿ƒå¯ä»¥ä¸å…¶ä»–å·¥å…·å’Œæ¡†æ¶é›†æˆï¼Œå¦‚ç›‘æ§ç³»ç»Ÿã€CI&#x2F;CDæµæ°´çº¿ç­‰ï¼Œä»è€Œæ›´å¥½åœ°æ”¯æŒè‡ªåŠ¨åŒ–å’Œè¿ç»´æµç¨‹ã€‚</li></ol><h2 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2><p>Nacosï¼ˆNaming and Configuration Serviceï¼‰æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€ä¸ªç”¨äºæœåŠ¡å‘ç°ã€åŠ¨æ€é…ç½®ç®¡ç†å’Œå¯è§†åŒ–å¹³å°çš„é¡¹ç›®ã€‚å®ƒç»“åˆäº†æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’Œå¥åº·ç›‘æµ‹ç­‰åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªç»¼åˆçš„å¾®æœåŠ¡åŸºç¡€è®¾æ–½ç»„ä»¶ã€‚å…¶ä¸­ï¼ŒNacosçš„é…ç½®ç®¡ç†éƒ¨åˆ†å¯ä»¥è¢«ç”¨ä½œåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒã€‚</p><ul><li><p>æ·»åŠ nacosé…ç½®ç®¡ç†ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs xml">  <span class="hljs-comment">&lt;!-- nacosçš„é…ç½®ç®¡ç†ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨resourceä¸‹åˆ›å»ºbootstrap.yamlé…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-comment"># ç¯å¢ƒ</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span> <br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-comment"># nacosåœ°å€</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span> <br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-comment"># æ–‡ä»¶åç¼€</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span> <br></code></pre></td></tr></table></figure><ol><li><strong>é…ç½®åŠ è½½é¡ºåºï¼š</strong> åœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­ï¼Œé…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºæ˜¯æœ‰ä¸€å®šè§„åˆ™çš„ã€‚<code>bootstrap.yaml</code> é…ç½®æ–‡ä»¶åœ¨åŠ è½½é¡ºåºä¸Šä½äºå…¶ä»–é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>application.yaml</code> æˆ– <code>application.properties</code>ï¼‰ä¹‹å‰ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥ç”¨äºé…ç½®ä¸€äº›åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹å‰å°±éœ€è¦çš„å±æ€§ï¼Œä¾‹å¦‚è¿æ¥åˆ°é…ç½®æœåŠ¡å™¨çš„å±æ€§ã€‚</li><li><strong>å¤–éƒ¨é…ç½®åŠ è½½ï¼š</strong> é€šå¸¸ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦ä»é…ç½®ä¸­å¿ƒï¼ˆå¦‚Nacosã€Consulç­‰ï¼‰è·å–é…ç½®ä¿¡æ¯ã€‚<code>bootstrap.yaml</code> é…ç½®æ–‡ä»¶å¯ä»¥ç”¨æ¥é…ç½®ä¸é…ç½®ä¸­å¿ƒçš„è¿æ¥å’Œèº«ä»½éªŒè¯ç­‰ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶èƒ½å¤Ÿæ­£ç¡®åœ°åŠ è½½é…ç½®ã€‚</li></ol></li><li><p>åœ¨nacosä¸­ä»¥&lt;spring.application.name&gt;-&lt;spring.profiles.active&gt;.yamlä½œä¸ºdata idåœ¨DEFAULT_GROUPæ–°å»ºé…ç½®ï¼Œä¾‹å¦‚ï¼šgateway-dev.yaml</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308231648127.png" alt="image-20230823161911507"></p></li></ul><p>é¡¹ç›®å¯åŠ¨åï¼Œæ— éœ€é‡æ–°å¯åŠ¨æˆ–åœæœºå°±ä¼šä»nacosä¸­åŠ¨æ€åŠ è½½é…ç½®ä¸‹æ¥ï¼Œé€šè¿‡@Valueå³å¯è·å–å¯¹åº”çš„å€¼ã€‚å¦‚æœæ‚¨å°†é…ç½®å±æ€§æ³¨å…¥åˆ°äº†Springç®¡ç†çš„Beanä¸­ï¼Œè€Œä¸”å¸Œæœ›åœ¨é…ç½®å‘ç”Ÿå˜åŒ–æ—¶åŠ¨æ€åˆ·æ–°Beançš„çŠ¶æ€ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>@RefreshScope</code> æ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@RefreshScope</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;config.hello&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String helloConfig;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SpringCloud</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ†å¸ƒå¼ç³»ç»Ÿ</tag>
      
      <tag>Nacos</tag>
      
      <tag>é…ç½®ä¸­å¿ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>APIç½‘å…³-SpringCloud Gateway</title>
    <link href="/2023/08/17/API%E7%BD%91%E5%85%B3-SpringCloud-Gateway/"/>
    <url>/2023/08/17/API%E7%BD%91%E5%85%B3-SpringCloud-Gateway/</url>
    
    <content type="html"><![CDATA[<p>Spring Cloud Gatewayæ˜¯ä¸€ä¸ªåŸºäºSpring Frameworkçš„å¼€æºAPIç½‘å…³ï¼Œç”¨äºæ„å»ºå¾®æœåŠ¡æ¶æ„ä¸­çš„ç»Ÿä¸€è®¿é—®å±‚ã€‚å®ƒå……å½“äº†åº”ç”¨ç¨‹åºå’Œåç«¯æœåŠ¡ä¹‹é—´çš„ä»£ç†ï¼Œæä¾›äº†è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€å®‰å…¨æ€§ã€ç›‘æ§ç­‰åŠŸèƒ½ï¼Œä»¥ç®€åŒ–å¾®æœåŠ¡æ¶æ„ä¸­çš„ç½‘ç»œè¯·æ±‚ç®¡ç†å’Œæµé‡æ§åˆ¶ã€‚</p><p>Spring Cloud Gatewayçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li><strong>åŠ¨æ€è·¯ç”±ï¼š</strong> å¯ä»¥æ ¹æ®è¯·æ±‚çš„ä¿¡æ¯å°†æµé‡è·¯ç”±åˆ°ä¸åŒçš„åç«¯æœåŠ¡ï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹è·¯ç”±è§„åˆ™ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡ï¼š</strong> å¯ä»¥è‡ªåŠ¨åˆ†é…æµé‡åˆ°å¤šä¸ªå®ä¾‹ï¼Œä»¥æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</li><li><strong>æ–­è·¯å™¨æ¨¡å¼ï¼š</strong> æä¾›äº†æ–­è·¯å™¨æ¨¡å¼æ¥å¤„ç†åç«¯æœåŠ¡çš„æ•…éšœï¼Œé˜²æ­¢æ•…éšœæœåŠ¡å¯¹æ•´ä¸ªç³»ç»Ÿçš„å½±å“ã€‚</li><li><strong>è¿‡æ»¤å™¨ï¼š</strong> å¯ä»¥åœ¨è¯·æ±‚å’Œå“åº”ä¹‹é—´åº”ç”¨ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨ï¼Œç”¨äºä¿®æ”¹è¯·æ±‚ã€å“åº”æˆ–æ‰§è¡Œä¸€äº›é¢„å¤„ç†&#x2F;åå¤„ç†æ“ä½œã€‚</li><li><strong>é™æµå’Œé€Ÿç‡æ§åˆ¶ï¼š</strong> å¯ä»¥é€šè¿‡é…ç½®é™åˆ¶æ¯ä¸ªè·¯ç”±æˆ–æœåŠ¡çš„è¯·æ±‚é€Ÿç‡ï¼Œä»¥é˜²æ­¢è¿‡è½½å’Œæ»¥ç”¨ã€‚</li><li><strong>å®‰å…¨æ€§ï¼š</strong> å¯ä»¥é›†æˆSpring Securityç­‰å®‰å…¨æ¡†æ¶ï¼Œå¯¹è¯·æ±‚è¿›è¡Œè®¤è¯å’Œæˆæƒã€‚</li><li><strong>ç›‘æ§å’Œæ—¥å¿—ï¼š</strong> æä¾›äº†ç›‘æ§å’Œæ—¥å¿—åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘äººå‘˜äº†è§£æµé‡å’Œç³»ç»Ÿçš„çŠ¶æ€ã€‚</li><li><strong>æ˜“äºæ‰©å±•ï¼š</strong> ç”±äºåŸºäºSpring Frameworkæ„å»ºï¼Œå› æ­¤å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ’ä»¶å’Œè¿‡æ»¤å™¨æ¥æ‰©å±•å…¶åŠŸèƒ½ã€‚</li></ol><h2 id="SpringCloud-Gatewayç®€å•ä½¿ç”¨"><a href="#SpringCloud-Gatewayç®€å•ä½¿ç”¨" class="headerlink" title="SpringCloud Gatewayç®€å•ä½¿ç”¨"></a>SpringCloud Gatewayç®€å•ä½¿ç”¨</h2><ul><li><p><strong>æ·»åŠ ä¾èµ–ï¼š</strong> åœ¨ç”Ÿæˆçš„<code>pom.xml</code>æ–‡ä»¶ä¸­ï¼Œæ·»åŠ Spring Cloud Gatewayçš„ä¾èµ–ã€‚é€šå¸¸ï¼Œæ‚¨éœ€è¦æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†nacoså®ç°æœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°ï¼Œæ‰€ä»¥ä¹Ÿè¦å¼•å…¥nacosç›¸å…³çš„ä¾èµ–ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥ä¸å¼•å…¥ï¼Œroutes.uriç›´æ¥æŒ‡å®šç›®æ ‡æœåŠ¡çš„å®Œæ•´URLå­—ç¬¦ä¸²ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">  <span class="hljs-comment">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>é…ç½®è·¯ç”±ï¼š</strong> åœ¨<code>application.yml</code>æˆ–<code>application.properties</code>ä¸­é…ç½®æ‚¨çš„è·¯ç”±è§„åˆ™ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">10010</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-comment"># è·¯ç”±æ ‡ç¤ºï¼Œå¿…é¡»å”¯ä¸€</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user-service</span><br>          <span class="hljs-comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://user-service</span><br>          <span class="hljs-comment"># è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè§„åˆ™</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-comment"># è·¯å¾„æ–­è¨€ï¼Œåˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯ä»¥/userå¼€å¤´ï¼Œå¦‚æœæ˜¯åˆ™ç¬¦åˆ</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/**</span><br>          <span class="hljs-attr">filter:</span><br>          <span class="hljs-comment">#æ·»åŠ è·¯ç”±è¿‡æ»¤å™¨</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=Tag,userRequest</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">order-service</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://order-service</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/order/**</span><br>      <span class="hljs-comment">#æ·»åŠ defaultè¿‡æ»¤å™¨</span><br>      <span class="hljs-attr">default-filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=origin,gateway</span><br></code></pre></td></tr></table></figure><blockquote><ol><li><p><strong>ç›´æ¥URLå­—ç¬¦ä¸²ï¼š</strong> æœ€ç®€å•çš„å†™æ³•å°±æ˜¯ç›´æ¥æŒ‡å®šç›®æ ‡æœåŠ¡çš„å®Œæ•´URLå­—ç¬¦ä¸²ã€‚</p><p><code>  uri: http://example.com</code></p></li><li><p><strong>lbåè®®ï¼š</strong> ä½¿ç”¨<code>lb</code>åè®®å¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒå®ä¾‹ã€‚</p><p> <code> uri: lb://service-name</code></p></li><li><p><strong>lbåè®® + è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</strong> å¯ä»¥åœ¨<code>lb</code>åè®®åé¢æ·»åŠ è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¦‚<code>lb://service-name?lbMethod=ROUND_ROBIN</code>ã€‚</p><p><code> uri: lb://service-name?lbMethod=ROUND_ROBIN</code></p></li><li><p><strong>ä½¿ç”¨è‡ªå®šä¹‰åè®®ï¼š</strong> æ‚¨å¯ä»¥å®šä¹‰è‡ªå·±çš„åè®®å‰ç¼€ï¼Œç„¶ååœ¨ç›®æ ‡URIä¸­ä½¿ç”¨ã€‚</p><p><code>uri: custom://destination</code></p></li><li><p><strong>ä½¿ç”¨è¡¨è¾¾å¼ï¼š</strong> æ‚¨å¯ä»¥åœ¨<code>routes.uri</code>ä¸­ä½¿ç”¨SpELè¡¨è¾¾å¼æ¥åŠ¨æ€ç”Ÿæˆç›®æ ‡URIã€‚</p><p><code>uri: &quot;&#39;http://dynamic-&#39; + #serviceId + &#39;.example.com&#39;&quot;</code></p></li></ol></blockquote></li><li><p><strong>æµ‹è¯•è·¯ç”±ï¼š</strong> å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æˆ–å·¥å…·ï¼ˆå¦‚curlæˆ–Postmanï¼‰æ¥æµ‹è¯•é…ç½®çš„è·¯ç”±ã€‚è®¿é—®<code>http://localhost:10010/user/1</code>åº”è¯¥å°†è¯·æ±‚ä»£ç†åˆ°<code>http://user-service/user/1</code>ã€‚</p><p>![image-20230817210750025](..&#x2F;..&#x2F;..&#x2F;..&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230817210750025.png)</p></li><li><p>æ·»åŠ GlobalFilterç®€å•å®ç°è®¿é—®é‰´æƒ</p><blockquote><p><code>GlobalFilter</code>æ˜¯Spring Cloud Gatewayä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå®ƒå…è®¸æ‚¨åœ¨è¯·æ±‚å’Œå“åº”çš„ç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œå…¨å±€æ“ä½œã€‚è¿™äº›æ“ä½œå¯ä»¥ç”¨äºå„ç§ç›®çš„ï¼Œå¦‚èº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ã€æ·»åŠ è¯·æ±‚å¤´ã€å¤„ç†å¼‚å¸¸ç­‰ã€‚<code>GlobalFilter</code>å¯ä»¥åœ¨æ•´ä¸ªç½‘å…³çš„è¯·æ±‚å¤„ç†æµç¨‹ä¸­åº”ç”¨ï¼Œæ— è®ºæ˜¯åœ¨è·¯ç”±åŒ¹é…ä¹‹å‰è¿˜æ˜¯ä¹‹åã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthorizeFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GlobalFilter</span>, Ordered &#123;<br><br>    <span class="hljs-meta">@SneakyThrows(Exception.class)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;<br>        <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> exchange.getRequest();<br>        MultiValueMap&lt;String, String&gt; params = request.getQueryParams();<br>        <span class="hljs-comment">//è·å–å‚æ•°ä¸­çš„ authorization å‚æ•° ã€‚é€šå¸¸æ˜¯è·å–headeré‡Œçš„authorization</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">authorization</span> <span class="hljs-operator">=</span> params.getFirst(<span class="hljs-string">&quot;authorization&quot;</span>);<br>        <span class="hljs-comment">//è¿™é‡Œdemoç®€å•å¤„ç† åˆ¤æ–­æ•°å€¼æ˜¯å¦ç­‰äº admin</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;admin&quot;</span>.equals(authorization)) &#123;<br>            <span class="hljs-comment">//æ”¾è¡Œ</span><br>            <span class="hljs-keyword">return</span> chain.filter(exchange);<br>        &#125;<br>        <span class="hljs-comment">//å…ˆè®¾ç½®çŠ¶æ€ç </span><br>        <span class="hljs-type">ServerHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> exchange.getResponse();<br>        response.setStatusCode(HttpStatus.UNAUTHORIZED);<br>        <span class="hljs-type">DataBufferFactory</span> <span class="hljs-variable">bufferFactory</span> <span class="hljs-operator">=</span> response.bufferFactory();<br>        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        <span class="hljs-type">DataBuffer</span> <span class="hljs-variable">wrap</span> <span class="hljs-operator">=</span> bufferFactory.wrap(objectMapper.writeValueAsBytes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RestResult</span>&lt;&gt;(<span class="hljs-number">401</span>, <span class="hljs-string">&quot;unauthrize&quot;</span>)));<br>        <span class="hljs-keyword">return</span> response.writeWith(Mono.fromSupplier(() -&gt; wrap));<br><span class="hljs-comment">//        //æ‹¦æˆªè¯·æ±‚</span><br><span class="hljs-comment">//        return exchange.getResponse().setComplete();</span><br>    &#125;<br><br>    <span class="hljs-comment">//è®¾ç½®ä¼˜å…ˆçº§ä¸º-1</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç é€šè¿‡å¯¹è¯·æ±‚å‚æ•°é‡Œçš„authorizationæ˜¯å¦ç­‰äºadminç®€å•å®ç°äº†é‰´æƒï¼Œæ˜¯adminåˆ™é€šè¿‡</p><p>![image-20230817211428288](..&#x2F;..&#x2F;..&#x2F;..&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230817211428288.png)</p><p>å¦åˆ™è¿”å›401 httpstatuså’Œjson responsebodyæç¤º</p><p>![image-20230817211437210](..&#x2F;..&#x2F;..&#x2F;..&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230817211437210.png)</p></li></ul><h3 id="é›†æˆnacosé…ç½®ä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±"><a href="#é›†æˆnacosé…ç½®ä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±" class="headerlink" title="é›†æˆnacosé…ç½®ä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±"></a>é›†æˆnacosé…ç½®ä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±</h3><ul><li><p><strong>æ·»åŠ ä¾èµ–</strong>ï¼šåœ¨ä¸Šé¢é…ç½®çš„ä¾èµ–çš„åŸºç¡€ä¸Šæ·»åŠ nacos-configç›¸å…³çš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- nacosçš„é…ç½®ç®¡ç†ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>é…ç½®Nacosä½œä¸ºé…ç½®ä¸­å¿ƒï¼š</strong> åœ¨<code>bootstrap.yaml</code>æˆ–<code>bootstrap.properties</code>ä¸­é…ç½®Nacosçš„é…ç½®ä¸­å¿ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬Nacos Serverçš„åœ°å€å’Œé…ç½®çš„Data IDã€Groupç­‰ä¿¡æ¯ã€‚</p><p>bootstrap.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># ç¯å¢ƒ</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span> <span class="hljs-comment"># nacosåœ°å€</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span> <span class="hljs-comment"># æ–‡ä»¶åç¼€</span><br></code></pre></td></tr></table></figure><p>application.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">10010</span><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">com.cason:</span> <span class="hljs-string">debug</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span><br></code></pre></td></tr></table></figure></li><li><p><strong>é…ç½®åŠ¨æ€è·¯ç”±ï¼š</strong> åœ¨Nacosé…ç½®ä¸­å¿ƒä¸­åˆ›å»ºé…ç½®ï¼Œç”¨äºå®šä¹‰åŠ¨æ€è·¯ç”±è§„åˆ™ã€‚é…ç½®çš„Data IDå¯ä»¥æ ¹æ®æ‚¨çš„å®é™…æƒ…å†µè¿›è¡Œå®šä¹‰ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯&lt;spring.application.name&gt;-&lt;spring.profiles.active&gt;.yamlä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼š</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308172132323.png" alt="image-20230817212606004"></p></li><li><p><strong>æµ‹è¯•</strong></p><ul><li><p>è®¿é—®userï¼Œorderç›¸å…³è·¯ç”±æ²¡æœ‰é—®é¢˜</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308172133265.png" alt="image-20230817213157261"></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308172133225.png" alt="image-20230817213209689"></p></li><li><p>ç§»é™¤userç›¸å…³çš„è·¯ç”±ï¼Œè¯·æ±‚userç›¸å…³è·¯ç”±404ï¼Œè¯·æ±‚orderç›¸å…³è·¯ç”±æ²¡æœ‰é—®é¢˜</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308172133551.png" alt="image-20230817213049030"></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308172133941.png" alt="image-20230817213130551"></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308180955610.png" alt="image-20230817213238702"></p></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>SpringCloud</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Gateway</tag>
      
      <tag>APIç½‘å…³</tag>
      
      <tag>åˆ†å¸ƒå¼ç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenFeignå®è·µ</title>
    <link href="/2023/08/16/OpenFeign%E5%AE%9E%E8%B7%B5/"/>
    <url>/2023/08/16/OpenFeign%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p>OpenFeignæ˜¯ä¸€ä¸ªç”¨äºå£°æ˜å¼RESTå®¢æˆ·ç«¯çš„Javaæ¡†æ¶ï¼Œå®ƒæ˜¯ç”±Netflixå¼€å‘çš„ï¼Œç”¨äºç®€åŒ–åœ¨Javaåº”ç”¨ç¨‹åºä¸­è°ƒç”¨HTTP APIçš„è¿‡ç¨‹ã€‚å®ƒä¸Spring Cloudé›†æˆå¾—å¾ˆå¥½ï¼Œç‰¹åˆ«é€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡é—´é€šä¿¡ã€‚</p><p>OpenFeignçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å®šä¹‰æ¥å£çš„æ–¹å¼æ¥æè¿°è¿œç¨‹APIçš„è°ƒç”¨ã€‚ä½ å¯ä»¥ä½¿ç”¨æ³¨è§£åœ¨æ¥å£æ–¹æ³•ä¸ŠæŒ‡å®šHTTPè¯·æ±‚çš„æ–¹å¼ã€URLã€è¯·æ±‚å‚æ•°ã€è¯·æ±‚ä½“ã€å“åº”å¤„ç†ç­‰ä¿¡æ¯ï¼Œè€Œä¸å¿…æ‰‹åŠ¨ç¼–å†™å¤§é‡çš„HTTPè¯·æ±‚ä»£ç ã€‚è¿™ç§æ–¹å¼ä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€å¯è¯»æ€§æ›´é«˜ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°ç»´æŠ¤å’Œæ‰©å±•ã€‚</p><p>ä¸»è¦ç‰¹ç‚¹å’Œä¼˜åŠ¿åŒ…æ‹¬ï¼š</p><ol><li><strong>å£°æ˜å¼æ¥å£å®šä¹‰ï¼š</strong> ä½¿ç”¨Javaæ¥å£æ¥æè¿°APIè°ƒç”¨ï¼Œé€šè¿‡æ³¨è§£æ¥é…ç½®è¯·æ±‚çš„æ–¹å¼ã€è·¯å¾„ç­‰ä¿¡æ¯ï¼Œä½¿ä»£ç å…·æœ‰æ›´é«˜çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li><strong>é›†æˆè´Ÿè½½å‡è¡¡ï¼š</strong> OpenFeignä¸Ribbonç­‰è´Ÿè½½å‡è¡¡ç»„ä»¶é›†æˆï¼Œå¯ä»¥è‡ªåŠ¨åœ°åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ä¸­è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</li><li><strong>å†…å»ºHystrixæ”¯æŒï¼š</strong> OpenFeigné›†æˆäº†Hystrixï¼Œå¯ä»¥æ–¹ä¾¿åœ°ä¸ºæ¥å£æ–¹æ³•æ·»åŠ å®¹é”™å’Œé™çº§çš„é€»è¾‘ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¯é æ€§ã€‚</li><li><strong>ä¸Spring Cloudé›†æˆï¼š</strong> OpenFeignä¸Spring Cloudæ¡†æ¶æ— ç¼é›†æˆï¼Œå¯ä»¥ä¸Eurekaã€Configã€Zuulç­‰ç»„ä»¶ååŒå·¥ä½œï¼Œæ„å»ºå‡ºå®Œæ•´çš„å¾®æœåŠ¡æ¶æ„ã€‚</li><li><strong>ç®€åŒ–HTTPè°ƒç”¨ï¼š</strong> OpenFeignè‡ªåŠ¨å¤„ç†HTTPè¯·æ±‚å’Œå“åº”ï¼Œå‡å°‘äº†æ‰‹åŠ¨ç¼–å†™HTTPè¯·æ±‚ä»£ç çš„å¤æ‚æ€§ã€‚</li><li><strong>æ˜“äºæµ‹è¯•ï¼š</strong> ç”±äºOpenFeignæ¥å£æ˜¯åŸºäºJavaæ¥å£å®šä¹‰çš„ï¼Œå› æ­¤å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨å•å…ƒæµ‹è¯•æ¥æµ‹è¯•æ¥å£æ–¹æ³•ã€‚</li></ol><p>OpenFeignåœ¨å¾®æœåŠ¡æ¶æ„ä¸­å‘æŒ¥ç€é‡è¦çš„ä½œç”¨ï¼Œé€šè¿‡ç®€åŒ–æœåŠ¡é—´é€šä¿¡çš„å®ç°ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡å¹¶ä¿ƒè¿›äº†ç³»ç»Ÿçš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h2 id="OpenFeignç®€å•ä½¿ç”¨"><a href="#OpenFeignç®€å•ä½¿ç”¨" class="headerlink" title="OpenFeignç®€å•ä½¿ç”¨"></a>OpenFeignç®€å•ä½¿ç”¨</h2><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--OpenFeign--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å¯åŠ¨ç±»æ·»åŠ -EnableFeignClientsæ³¨è§£"><a href="#å¯åŠ¨ç±»æ·»åŠ -EnableFeignClientsæ³¨è§£" class="headerlink" title="å¯åŠ¨ç±»æ·»åŠ @EnableFeignClientsæ³¨è§£"></a>å¯åŠ¨ç±»æ·»åŠ <code>@EnableFeignClients</code>æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableFeignClients</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(OrderApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è¿œç¨‹æœåŠ¡å®¢æˆ·ç«¯"><a href="#è¿œç¨‹æœåŠ¡å®¢æˆ·ç«¯" class="headerlink" title="è¿œç¨‹æœåŠ¡å®¢æˆ·ç«¯"></a>è¿œç¨‹æœåŠ¡å®¢æˆ·ç«¯</h4><ul><li><p>Useré¡¹ç›®ä¸‹åˆ›å»ºUserController.javaå’ŒUserService.java é€šè¿‡&#x2F;user&#x2F;{id}æä¾›æœåŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-keyword">public</span> UserEntity <span class="hljs-title function_">getUser</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-type">UserEntity</span> <span class="hljs-variable">userEntity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserEntity</span>();<br>        userEntity.setId(id);<br>        userEntity.setName(<span class="hljs-string">&quot;ç”¨æˆ·&quot;</span>+id);<br>        <span class="hljs-keyword">return</span> userEntity;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserClient</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> UserEntity <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.getUser(id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Orderé¡¹ç›®ä¸‹åˆ›å»ºUserClient.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(&quot;user-service&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserClient</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span><br>    UserEntity <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>@FeignClientæ³¨è§£å£°æ˜å¼RESTå®¢æˆ·ç«¯æ¥å£ä¸Šæ ‡è®°ï¼Œä»¥æŒ‡ç¤ºè¯¥æ¥å£å°†è¢«OpenFeignç”¨ä½œè¿œç¨‹æœåŠ¡è°ƒç”¨çš„å®¢æˆ·ç«¯ã€‚</p><p>ä¸»è¦å±æ€§åŒ…æ‹¬ï¼š</p><ol><li><strong>nameï¼š</strong> ç”¨äºæŒ‡å®šè¿œç¨‹æœåŠ¡çš„åç§°ã€‚è¿™é€šå¸¸æ˜¯Eurekaæ³¨å†Œä¸­å¿ƒä¸­çš„æœåŠ¡åç§°ï¼Œä»¥ä¾¿OpenFeignèƒ½å¤Ÿæ ¹æ®åç§°æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å®ä¾‹ã€‚ä¾‹å¦‚ï¼š<code>@FeignClient(name = &quot;user-service&quot;)</code>ã€‚</li><li><strong>urlï¼š</strong> å¦‚æœä¸ä½¿ç”¨æœåŠ¡å‘ç°ï¼ˆä¾‹å¦‚Eurekaï¼‰æ¥å®šä½æœåŠ¡ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šæœåŠ¡çš„URLã€‚ä¾‹å¦‚ï¼š<code>@FeignClient(url = &quot;http://localhost:8080&quot;)</code>ã€‚</li><li><strong>valueï¼š</strong> ä¸<code>name</code>å±æ€§ç›¸åŒï¼Œç”¨äºæŒ‡å®šè¿œç¨‹æœåŠ¡çš„åç§°ã€‚</li><li><strong>pathï¼š</strong> ç”¨äºæŒ‡å®šåŸºç¡€è·¯å¾„ï¼Œå®ƒä¼šè¢«æ·»åŠ åˆ°æ‰€æœ‰æ¥å£æ–¹æ³•çš„URLå‰é¢ã€‚ä¾‹å¦‚ï¼š<code>@FeignClient(name = &quot;user-service&quot;, path = &quot;/api&quot;)</code>ã€‚</li><li><strong>fallbackï¼š</strong> æŒ‡å®šä¸€ä¸ªé™çº§å¤„ç†çš„ç±»ï¼Œå½“è¿œç¨‹æœåŠ¡è°ƒç”¨å¤±è´¥æ—¶ä¼šæ‰§è¡Œé™çº§é€»è¾‘ã€‚è¿™ä¸ªç±»éœ€è¦å®ç°ç›¸åº”çš„æ¥å£ï¼Œå¹¶æ·»åŠ <code>@Component</code>æ³¨è§£ä»¥è®©Springèƒ½å¤Ÿæ‰«æåˆ°ã€‚ä¾‹å¦‚ï¼š<code>@FeignClient(name = &quot;user-service&quot;, fallback = UserServiceFallback.class)</code>ã€‚</li><li><strong>fallbackFactoryï¼š</strong> ä¸<code>fallback</code>ç±»ä¼¼ï¼Œä½†æ˜¯è¿™é‡ŒæŒ‡å®šçš„æ˜¯ä¸€ä¸ªé™çº§å¤„ç†å·¥å‚ï¼Œç”¨äºåˆ›å»ºé™çº§å¤„ç†ç±»çš„å®ä¾‹ã€‚è¿™é€šå¸¸ç”¨äºå®ç°æ›´å¤æ‚çš„é™çº§é€»è¾‘ã€‚ä¾‹å¦‚ï¼š<code>@FeignClient(name = &quot;user-service&quot;, fallbackFactory = UserServiceFallbackFactory.class)</code>ã€‚</li></ol><h4 id="è°ƒç”¨æ–¹"><a href="#è°ƒç”¨æ–¹" class="headerlink" title="è°ƒç”¨æ–¹"></a>è°ƒç”¨æ–¹</h4><ul><li><p>Orderé¡¹ç›®ä¸‹åˆ›å»ºOrderService.java </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserClient userClient;<br><br><br>    <span class="hljs-keyword">public</span> OrderEntity <span class="hljs-title function_">getOrder</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-type">OrderEntity</span> <span class="hljs-variable">orderEntity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderEntity</span>();<br>        orderEntity.setUser(userClient.getUser(id));<br>        orderEntity.setId(id);<br>        orderEntity.setTitle(<span class="hljs-string">&quot;è®¢å•&quot;</span>+id);<br><br>        <span class="hljs-keyword">return</span> orderEntity;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Orderé¡¹ç›®ä¸‹åˆ›å»ºOrderController.java </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> OrderEntity <span class="hljs-title function_">getOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> orderService.getOrder(id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h4><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308162052859.png" alt="image-20230816204051210"></p><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308162052726.png" alt="image-20230816204027091"></p><p>RPC æ¥å£å’Œå®ç°å„è‡ªæ”¾åœ¨ç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œæ–¹ä¾¿æœåŠ¡è°ƒç”¨æ–¹é‡ç”¨æœåŠ¡æ¥å£ï¼ŒæœåŠ¡æ¥å£æ¨¡å—åªèƒ½åŒ…æ‹¬æœ€åŸºæœ¬çš„æ¨¡å—ä¾é ï¼ˆè¿‡å¤šä¼šå¯¼è‡´ä¾é ä¼ é€’ï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">user</span>:<br><span class="hljs-keyword">user</span><span class="hljs-operator">-</span>service<br><span class="hljs-keyword">user</span><span class="hljs-operator">-</span>api<br><span class="hljs-keyword">order</span>:<br><span class="hljs-keyword">order</span><span class="hljs-operator">-</span>service<br><span class="hljs-keyword">order</span><span class="hljs-operator">-</span>api<br></code></pre></td></tr></table></figure><p>xxx-api æ¨¡å—ä¸­æ”¾æœåŠ¡è°ƒç”¨æ–¹éœ€æ±‚ç”¨åˆ°çš„ä¸œè¥¿ï¼Œapiæ¥å£ï¼Œvoï¼Œå…¥å‚ç­‰ç­‰ã€‚</p><p>xxx-service å®ç° account-api ä¾›ç»™çš„æ¥å£ã€‚</p><ul><li><p>user-api</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(&quot;user-service&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserClient</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span><br>    UserEntity <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>user-service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserClient</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> UserEntity <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.getUser(id);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>Order-serviceå¼•å…¥user-api</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.cason<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>user-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æŒ‡å®šclientæ³¨å…¥å®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;)</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>SpringCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼æ³¨å†Œä¸­å¿ƒ-Nacos</title>
    <link href="/2023/08/16/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83-Nacos/"/>
    <url>/2023/08/16/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83-Nacos/</url>
    
    <content type="html"><![CDATA[<p>åˆ†å¸ƒå¼æ³¨å†Œä¸­å¿ƒæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€ç§å…³é”®ç»„ä»¶ï¼Œç”¨äºç®¡ç†å’Œç»´æŠ¤å„ä¸ªåˆ†å¸ƒå¼æœåŠ¡å®ä¾‹çš„æ³¨å†Œã€å‘ç°å’ŒçŠ¶æ€ä¿¡æ¯ã€‚å®ƒæä¾›äº†ä¸€ç§é›†ä¸­åŒ–çš„æœºåˆ¶ï¼Œä½¿å¾—ä¸åŒçš„æœåŠ¡èƒ½å¤Ÿåœ¨ä¸€ä¸ªå…±äº«çš„åœ°æ–¹æ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ï¼Œå¹¶èƒ½å¤ŸåŠ¨æ€åœ°å‘ç°å…¶ä»–æœåŠ¡ï¼Œä»è€Œå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†å’Œé€šä¿¡ã€‚</p><p>åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°æ˜¯ä¸¤ä¸ªå…³é”®çš„æ¦‚å¿µï¼Œç”¨äºç®¡ç†å’Œç»´æŠ¤ç³»ç»Ÿä¸­å„ä¸ªåˆ†å¸ƒå¼ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚</p><p><strong>æœåŠ¡æ³¨å†Œï¼š</strong> æœåŠ¡æ³¨å†Œæ˜¯æŒ‡å°†æœåŠ¡çš„ç½‘ç»œåœ°å€å’Œå…ƒæ•°æ®æ³¨å†Œåˆ°ä¸€ä¸ªä¸­å¿ƒåŒ–çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå„ä¸ªæœåŠ¡æä¾›è€…å°†è‡ªå·±çš„æœåŠ¡æ³¨å†Œåˆ°è¿™ä¸ªæ³¨å†Œè¡¨ï¼Œä½¿å¾—å…¶ä»–ç»„ä»¶æˆ–æœåŠ¡èƒ½å¤Ÿæ‰¾åˆ°å¹¶ä¸å…¶é€šä¿¡ã€‚è¿™ç§æ³¨å†Œå¯ä»¥åŒ…æ‹¬æœåŠ¡çš„åç§°ã€ç‰ˆæœ¬ã€IPåœ°å€ã€ç«¯å£å·ç­‰ä¿¡æ¯ï¼Œä»¥ä¾¿å…¶ä»–æœåŠ¡èƒ½å¤Ÿå‡†ç¡®åœ°å®šä½å’Œè¿æ¥åˆ°è¿™äº›æœåŠ¡ã€‚</p><p><strong>æœåŠ¡å‘ç°ï¼š</strong> æœåŠ¡å‘ç°æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªæœåŠ¡æˆ–ç»„ä»¶èƒ½å¤ŸåŠ¨æ€åœ°æ‰¾åˆ°å’Œè¯†åˆ«å…¶ä»–æœåŠ¡çš„è¿‡ç¨‹ã€‚é€šè¿‡æœåŠ¡å‘ç°ï¼ŒæœåŠ¡æ¶ˆè´¹è€…èƒ½å¤ŸæŸ¥è¯¢æœåŠ¡æ³¨å†Œè¡¨ï¼Œæ‰¾åˆ°æ‰€éœ€çš„æœåŠ¡çš„ç½‘ç»œåœ°å€å’Œå…¶ä»–ä¿¡æ¯ï¼Œä»è€Œèƒ½å¤Ÿä¸å…¶å»ºç«‹é€šä¿¡å’Œäº¤äº’ã€‚æœåŠ¡å‘ç°å¯ä»¥å¸®åŠ©ç³»ç»Ÿè‡ªåŠ¨é€‚åº”ç»„ä»¶çš„å˜åŒ–ï¼Œå¦‚æ–°å¢ã€åˆ é™¤æˆ–æ›¿æ¢æœåŠ¡ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨æ›´æ–°é…ç½®ã€‚</p><p><strong>Zookeeperï¼š</strong> Zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åè°ƒæœåŠ¡ï¼Œå¯ä»¥ç”¨äºæœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ç»“æ„ï¼Œå…è®¸æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œå¹¶èƒ½å¤Ÿå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§é—®é¢˜ã€‚Zookeeperé€‚ç”¨äºä¸€äº›éœ€è¦é«˜ä¸€è‡´æ€§å’Œç¨³å®šæ€§çš„åœºæ™¯</p><p><strong>Eurekaï¼š</strong> Eurekaæ˜¯Netflixå¼€æºçš„ä¸€ä¸ªæœåŠ¡å‘ç°ç»„ä»¶ï¼Œç‰¹åˆ«é€‚ç”¨äºåŸºäºå¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿã€‚å®ƒå…è®¸æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œå¹¶æä¾›äº†ä¸€äº›é«˜çº§çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»æœºåˆ¶ã€‚Eurekaä¸€èˆ¬ç”¨äºå†…éƒ¨æœåŠ¡å‘ç°ï¼Œä¸å¤ªé€‚åˆå¤æ‚çš„å¤šæ•°æ®ä¸­å¿ƒåœºæ™¯ã€‚</p><p><strong>Nacosï¼š</strong> Nacosæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€ä¸ªç»¼åˆæ€§æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†å¹³å°ï¼Œæ”¯æŒæœåŠ¡æ³¨å†Œã€é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°å’ŒåŠ¨æ€é…ç½®æ›´æ–°ç­‰åŠŸèƒ½ã€‚å®ƒèƒ½å¤Ÿæ»¡è¶³å¤šç§åˆ†å¸ƒå¼ç³»ç»Ÿçš„éœ€æ±‚ï¼ŒåŒ…æ‹¬å¾®æœåŠ¡å’Œäº‘åŸç”Ÿåº”ç”¨ã€‚</p><h2 id="Nacos-å®ç°ç®€å•çš„æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°"><a href="#Nacos-å®ç°ç®€å•çš„æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°" class="headerlink" title="Nacos å®ç°ç®€å•çš„æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°"></a>Nacos å®ç°ç®€å•çš„æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°</h2><h3 id="å¯åŠ¨åˆ†å¸ƒå¼æ³¨å†Œä¸­å¿ƒ"><a href="#å¯åŠ¨åˆ†å¸ƒå¼æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="å¯åŠ¨åˆ†å¸ƒå¼æ³¨å†Œä¸­å¿ƒ"></a>å¯åŠ¨åˆ†å¸ƒå¼æ³¨å†Œä¸­å¿ƒ</h3><blockquote><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://nacos.io/zh-cn/docs/what-is-nacos.html">ä»€ä¹ˆæ˜¯ Nacos</a></p></blockquote><p>å¯åŠ¨nacos</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å‰å¾€è§£å‹çš„nacosæ–‡ä»¶å¤¹å†…</span><br>cd bin<br>./startup.sh -m standalone<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308161114188.png" alt="image-20230816103800624"></p><p>è®¿é—®åœ°å€ï¼š<a href="http://localhost:8848/nacos/#/login">http://localhost:8848/nacos/#/login</a></p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308161114059.png" alt="image-20230816103746727"></p><p>è´¦å·å¯†ç ï¼šnacos&#x2F;nacos</p><h2 id="æ³¨å†ŒæœåŠ¡"><a href="#æ³¨å†ŒæœåŠ¡" class="headerlink" title="æ³¨å†ŒæœåŠ¡"></a>æ³¨å†ŒæœåŠ¡</h2><p>é¡¹ç›®æ ¹ç›®å½•pom.xmlæ·»åŠ springcloudï¼Œspringcloud alibabaä¾èµ–ç®¡ç†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>         <span class="hljs-comment">&lt;!-- springCloud --&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>         <span class="hljs-comment">&lt;!-- alibaba nacos--&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Moduleé¡¹ç›®pom.xmlæ·»åŠ nacos discoveryä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>application.yamlæ·»åŠ nacosç›¸å…³é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>    <span class="hljs-comment"># nacosæœåŠ¡åœ°å€</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span> <br>      <span class="hljs-attr">discovery:</span><br>      <span class="hljs-comment"># cluster-name å±æ€§æ¥æŒ‡å®šé›†ç¾¤åç§°ï¼Œä»è€Œæ›´å¥½åœ°ç®¡ç†å’ŒåŒºåˆ†ä¸åŒçš„æœåŠ¡å‘ç°é›†ç¾¤ã€‚</span><br>        <span class="hljs-attr">cluster-name:</span> <span class="hljs-string">HZ</span><br>        <span class="hljs-comment"># å‘½åç©ºé—´ï¼šå‘½åç©ºé—´å¯ä»¥ç”¨æ¥éš”ç¦»ä¸åŒçš„åº”ç”¨æˆ–å›¢é˜Ÿçš„é…ç½®ã€‚ä¸åŒçš„å‘½åç©ºé—´å¯ä»¥åœ¨ä¸åŒçš„ Nacos å®ä¾‹ä¸­ã€‚</span><br>        <span class="hljs-attr">namespace:</span> <span class="hljs-string">7a5618ff-a674-46dd-99a7-33da5f094f7f</span> <span class="hljs-comment"># å‘½åç©ºé—´ID</span><br>        <span class="hljs-comment"># æ˜¯å¦æ˜¯ä¸´æ—¶å®ä¾‹</span><br>        <span class="hljs-attr">ephemeral:</span> <span class="hljs-literal">true</span> <br></code></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308161114223.png" alt="image-20230816111101326"></p><p>æ³¨å†Œåˆ° Nacos åï¼Œæ‚¨çš„å¾®æœåŠ¡å°†è¢«è‡ªåŠ¨æ³¨å†Œåˆ° Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå¹¶ä¸”å…¶ä»–å¾®æœåŠ¡å¯ä»¥ä½¿ç”¨ Nacos è¿›è¡ŒæœåŠ¡å‘ç°ã€‚è¿™ä½¿å¾—å¾®æœåŠ¡å¯ä»¥è½»æ¾åœ°æ‰¾åˆ°å…¶ä»–æœåŠ¡çš„å®ä¾‹ï¼Œå¹¶è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä»è€Œå®ç°æ›´é«˜çš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚Nacos æ”¯æŒåŠ¨æ€æ³¨å†Œå’Œæ³¨é”€å¾®æœåŠ¡ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ·»åŠ ã€æ›´æ–°æˆ–åˆ é™¤æœåŠ¡å®ä¾‹ï¼Œè€Œæ— éœ€é‡å¯åº”ç”¨ã€‚è¿™ä½¿å¾—æœåŠ¡çš„ç®¡ç†å’Œç»´æŠ¤æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚</p>]]></content>
    
    
    <categories>
      
      <category>SpringCloud</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ†å¸ƒå¼ç³»ç»Ÿ</tag>
      
      <tag>Nacos</tag>
      
      <tag>æ³¨å†Œä¸­å¿ƒ</tag>
      
      <tag>æœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Github actionæŒç»­éƒ¨ç½²springboot+vueå‰åç«¯åˆ†ç¦»é¡¹ç›®</title>
    <link href="/2023/08/15/Github-action%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2springboot-vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/"/>
    <url>/2023/08/15/Github-action%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2springboot-vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<p>å› ä¸ºè´­ä¹°çš„é˜¿é‡Œäº‘æœåŠ¡å™¨æ€§èƒ½æ¯”è¾ƒæ‹‰å®ï¼Œå®‰è£…jenkinsåšæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ä¼šå ç”¨æ¯”è¾ƒå¤§é‡çš„æœåŠ¡å™¨èµ„æºã€‚å› ä¸ºå®ä¹ çš„æ—¶å€™å½“æ—¶è´Ÿè´£çš„ä¸€ä¸ªé¡¹ç›®å°±æ˜¯æŠŠjenkinsè¿ç§»åˆ°github actionï¼Œæ‰€ä»¥å°±ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨Github action.</p><p>GitHub Actions æ˜¯ä¸€ä¸ªç”± GitHub æä¾›çš„æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰å¹³å°ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨ä»£ç ä»“åº“ä¸­è®¾ç½®è‡ªåŠ¨åŒ–çš„å·¥ä½œæµç¨‹ã€‚è¿™äº›å·¥ä½œæµç¨‹å¯ä»¥åœ¨ä»£ç çš„ä¸åŒäº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä¾‹å¦‚æ¨é€ä»£ç ã€åˆ›å»º Pull Requestã€å‘å¸ƒ Release ç­‰ã€‚</p><h2 id="Secreté…ç½®"><a href="#Secreté…ç½®" class="headerlink" title="Secreté…ç½®"></a>Secreté…ç½®</h2><p>éœ€è¦æå‰é…ç½®ä¸€äº›github action secretï¼Œæ‰“å¼€å¯¹åº”é¡¹ç›®setting</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202308151056837.png" alt="image-20230815103929921"></p><p>é…ç½®åå³å¯åœ¨yamlæ–‡ä»¶ä¸­ä½¿ç”¨$ä½¿ç”¨å¯¹åº”å€¼</p><h2 id="vueé¡¹ç›®"><a href="#vueé¡¹ç›®" class="headerlink" title="vueé¡¹ç›®"></a>vueé¡¹ç›®</h2><p>åœ¨é¡¹ç›®é‡Œç¼–å†™.github&#x2F;workflows&#x2F;node.js.yml</p><p>åœ¨github actioné‡Œå®ç°äº†</p><p>1ã€checkoutä»£ç </p><p>2ã€å°†æºä»£ç è¿›è¡Œæ‰“åŒ…ã€å‹ç¼©å’Œä¼˜åŒ–ï¼Œç”Ÿæˆé€‚åˆéƒ¨ç½²çš„ç”Ÿäº§ç¯å¢ƒä»£ç </p><p>3ã€å‹ç¼©å¹¶scpå‘é€åˆ°æœåŠ¡å™¨æŒ‡å®šåœ°å€å¹¶è§£å‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Node.js</span> <span class="hljs-string">CI</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;master&quot;</span> ]<br>  <span class="hljs-attr">pull_request:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;master&quot;</span> ]<br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br><br>    <span class="hljs-attr">strategy:</span><br>      <span class="hljs-attr">matrix:</span><br>        <span class="hljs-attr">node-version:</span> [ <span class="hljs-number">16.</span><span class="hljs-string">x</span> ]<br>        <span class="hljs-comment"># See supported Node.js release schedule at https://nodejs.org/en/about/releases/</span><br><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Use</span> <span class="hljs-string">Node.js</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">matrix.node-version</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">node-version:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">matrix.node-version</span> <span class="hljs-string">&#125;&#125;</span><br>          <span class="hljs-attr">cache:</span> <span class="hljs-string">&#x27;npm&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span> <span class="hljs-string">--if-present</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">zip</span> <span class="hljs-string">-r</span> <span class="hljs-string">ui.zip</span> <span class="hljs-string">ui/</span><br><br>      <span class="hljs-comment"># éƒ¨ç½²åˆ°æœåŠ¡å™¨</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">ğŸš€</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">cross-the-world/ssh-scp-ssh-pipelines@latest</span> <br>        <span class="hljs-attr">env:</span><br>         <span class="hljs-attr">WELCOME:</span> <span class="hljs-string">&quot;ssh scp ssh pipelines&quot;</span><br>         <span class="hljs-attr">LASTSSH:</span> <span class="hljs-string">&quot;Doing something after copying&quot;</span><br>        <span class="hljs-attr">with:</span><br>         <span class="hljs-attr">host:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.HOST</span> <span class="hljs-string">&#125;&#125;</span><br>         <span class="hljs-attr">user:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.USERNAME</span> <span class="hljs-string">&#125;&#125;</span><br>         <span class="hljs-attr">pass:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.PASSWORD</span> <span class="hljs-string">&#125;&#125;</span><br>         <span class="hljs-attr">port:</span> <span class="hljs-number">22</span><br>         <span class="hljs-attr">first_ssh:</span> <span class="hljs-string">|</span><br><span class="hljs-string">            ls -a</span><br><span class="hljs-string"></span>         <span class="hljs-attr">scp:</span> <span class="hljs-string">|</span><br><span class="hljs-string">           &#x27;./ui.zip&#x27; =&gt; /www/wwwroot/default/x-springboot/</span><br><span class="hljs-string"></span>         <span class="hljs-attr">last_ssh:</span> <span class="hljs-string">|</span><br><span class="hljs-string">           cd /www/wwwroot/default/x-springboot/</span><br><span class="hljs-string">           unzip ui.zip</span><br></code></pre></td></tr></table></figure><h2 id="Springbooté¡¹ç›®"><a href="#Springbooté¡¹ç›®" class="headerlink" title="Springbooté¡¹ç›®"></a>Springbooté¡¹ç›®</h2><p>åœ¨é¡¹ç›®ä¸­ç¼–å†™.github&#x2F;workflows&#x2F;maven.yml</p><p>1ã€checkoutä»£ç </p><p>2ã€ä½¿ç”¨mavenæ‰“åŒ…é¡¹ç›®æˆjarbao</p><p>3ã€scpå‘é€åˆ°æœåŠ¡å™¨æŒ‡å®šåœ°å€</p><p>4ã€å®å¡”é‡æ–°å¯åŠ¨é¡¹ç›®ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨yamlä¸­ç¼–å†™last_ssh: æ‰§è¡Œjava -jarå¯åŠ¨é¡¹ç›®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Java</span> <span class="hljs-string">CI</span> <span class="hljs-string">with</span> <span class="hljs-string">Maven</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;master&quot;</span> ]<br>  <span class="hljs-attr">pull_request:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;master&quot;</span> ]<br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br><br>    <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">JDK</span> <span class="hljs-number">17</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v3</span><br>      <span class="hljs-attr">with:</span><br>        <span class="hljs-attr">java-version:</span> <span class="hljs-string">&#x27;17&#x27;</span><br>        <span class="hljs-attr">distribution:</span> <span class="hljs-string">&#x27;temurin&#x27;</span><br>        <span class="hljs-attr">cache:</span> <span class="hljs-string">maven</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">with</span> <span class="hljs-string">Maven</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">mvn</span> <span class="hljs-string">-B</span> <span class="hljs-string">package</span> <span class="hljs-string">--file</span> <span class="hljs-string">pom.xml</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">copy</span> <span class="hljs-string">jar</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">cross-the-world/ssh-scp-ssh-pipelines@latest</span><br>      <span class="hljs-attr">with:</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.HOST</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">user:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.USERNAME</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">pass:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.PASSWORD</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">22</span><br>        <span class="hljs-attr">scp:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          ./target/x-springboot.jar =&gt; /www/wwwroot/default/x-springboot/</span><br><span class="hljs-string"></span><span class="hljs-comment">#å‚è€ƒä»¥ä¸‹åœ¨scpä¸Šä¼ åŒ…ä»¥åæ‰§è¡Œ</span><br><span class="hljs-comment">#        last_ssh: |</span><br><span class="hljs-comment">#        nohup java -jar /www/wwwroot/default/x-springboot/x-springboot.jar &gt;temp.txt &amp; </span><br></code></pre></td></tr></table></figure><h2 id="Nginxé…ç½®"><a href="#Nginxé…ç½®" class="headerlink" title="Nginxé…ç½®"></a>Nginxé…ç½®</h2><p>å½“ç„¶è¿™é‡Œæ¯ä¸ªäººçš„é¡¹ç›®ä¸ä¸€æ ·nginxé…ç½®éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘åªæ˜¯ç”¨æ¥è®°å½•ä¸€ä¸‹æ–¹ä¾¿ä»¥åæ¢å¤ç¯å¢ƒ</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;<br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl http2;<br>    <span class="hljs-attribute">server_name</span> &lt;åŸŸå&gt;;<br>    <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">100m</span>;<br><br>    <span class="hljs-attribute">ssl_certificate</span> &lt;path&gt;_bundle.crt;<br>    <span class="hljs-attribute">ssl_certificate_key</span> &lt;path&gt;.key;<br>    <span class="hljs-attribute">ssl_trusted_certificate</span> &lt;path&gt;_bundle.pem;<br><br>    <span class="hljs-comment"># SSLé…ç½®</span><br>    <span class="hljs-attribute">ssl_session_timeout</span> <span class="hljs-number">1d</span>;<br>    <span class="hljs-attribute">ssl_session_cache</span> shared:MozSSL:<span class="hljs-number">10m</span>;<br>    <span class="hljs-attribute">ssl_session_tickets</span> <span class="hljs-literal">off</span>;<br><br>    <span class="hljs-comment"># SSLåŠ å¯†æ–¹å¼ï¼Œä½¿ç”¨ç°ä»£åŒ–çš„åŠ å¯†å¥—ä»¶</span><br>    <span class="hljs-attribute">ssl_protocols</span> TLSv1.<span class="hljs-number">2</span> TLSv1.<span class="hljs-number">3</span>;<br>    <span class="hljs-attribute">ssl_ciphers</span> ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDSA-AES256-SHA384:RSA-AES256-SHA384:ECDSA-AES256-SHA:RSA-AES256-SHA:ECDSA-AES128-SHA256:RSA-AES128-SHA256:ECDSA-AES128-SHA:RSA-AES128-SHA:!DSS;<br><br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-comment"># UIç›®å½•</span><br>        <span class="hljs-attribute">root</span> /www/wwwroot/default/x-springboot/ui/;<br>        <span class="hljs-comment">#åŠ¨æ€é¡µé¢</span><br>        <span class="hljs-attribute">proxy_set_header</span> X-forwarded-for <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">if</span> ( !-e <span class="hljs-variable">$request_filename</span> ) &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8080;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-section">location</span><span class="hljs-regexp"> ^~//</span> &#123;<br>        <span class="hljs-attribute">proxy_set_header</span> X-forwarded-for <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8080;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>CI/CD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»è¾“å…¥URLåˆ°é¡µé¢å±•ç¤ºå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</title>
    <link href="/2023/08/10/%E4%BB%8E%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F/"/>
    <url>/2023/08/10/%E4%BB%8E%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªURLä»æµè§ˆå™¨è¾“å…¥åˆ°åº”ç”¨æœåŠ¡å¤„ç†çš„å®Œæ•´è¯·æ±‚è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€è¦çš„æ¦‚è¿°ï¼š</p><ol><li><p><strong>URLè§£æå’Œåˆ†æ</strong>ï¼š ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥URLï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰ã€‚æµè§ˆå™¨éœ€è¦è§£æè¿™ä¸ªURLï¼Œå®ƒåŒ…æ‹¬åè®®ï¼ˆå¦‚httpã€httpsï¼‰ã€åŸŸåï¼ˆä¾‹å¦‚<a href="http://www.example.com)ã€è·¯å¾„ã€æŸ¥è¯¢å‚æ•°ç­‰ç­‰./">www.example.comï¼‰ã€è·¯å¾„ã€æŸ¥è¯¢å‚æ•°ç­‰ç­‰ã€‚</a></p></li><li><p><strong>DNSè§£æ</strong>ï¼š æµè§ˆå™¨éœ€è¦å°†åŸŸåè§£æä¸ºIPåœ°å€ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºDNSè§£æã€‚æµè§ˆå™¨å‘æœ¬åœ°DNSæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨å¯èƒ½ä¼šæŸ¥è¯¢å…¶ç¼“å­˜ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå®ƒä¼šå‘æ ¹DNSæœåŠ¡å™¨é€æ­¥æŸ¥è¯¢ï¼Œæœ€ç»ˆæ‰¾åˆ°å¯¹åº”çš„IPåœ°å€ã€‚</p></li><li><p><strong>å»ºç«‹TCPè¿æ¥</strong>ï¼š é€šè¿‡è§£æå¾—åˆ°çš„IPåœ°å€ï¼Œæµè§ˆå™¨ä¸ç›®æ ‡æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠTCPçš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œç¡®ä¿æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´å¯ä»¥è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p></li><li><p><strong>å‘èµ·HTTPè¯·æ±‚</strong>ï¼š ä¸€æ—¦TCPè¿æ¥å»ºç«‹ï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚ä¸­åŒ…å«äº†ä¹‹å‰è§£æå¾—åˆ°çš„è·¯å¾„ã€æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POSTç­‰ï¼‰ã€Headersï¼ˆä¾‹å¦‚User-Agentã€Cookieç­‰ï¼‰ç­‰ä¿¡æ¯ã€‚</p><blockquote><p>:authority:cason.work</p><p>:method:GET</p><p>:path:&#x2F;api&#x2F;user&#x2F;sysInfo</p><p>:scheme:https</p><p>Accept:application&#x2F;json, text&#x2F;plain, <em>&#x2F;</em></p><p>Accept-Encoding:gzip, deflate, br</p><p>Accept-Language:zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-US;q&#x3D;0.7,en-GB;q&#x3D;0.6</p><p>Cache-Control:no-cache</p><p>Cookie:na me&#x3D;1691121971; </p><p>Pragma:no-cache</p><p>Referer:<a href="https://cason.work/">https://cason.work/</a></p><p>Sec-Fetch-Dest:empty</p><p>Sec-Fetch-Mode:cors</p><p>Sec-Fetch-Site:same-origin</p><p>Token:***</p><p>User-Agent:Mozilla&#x2F;5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit&#x2F;605.1.15 (KHTML, like Gecko) Version&#x2F;13.0.3 Mobile&#x2F;15E148 Safari&#x2F;604.1 Edg&#x2F;115.0.0.0</p></blockquote></li><li><p><strong>æœåŠ¡å™¨å¤„ç†è¯·æ±‚</strong>ï¼š æœåŠ¡å™¨æ¥æ”¶åˆ°HTTPè¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚çš„å†…å®¹è¿›è¡Œå¤„ç†ã€‚å¦‚æœè¯·æ±‚çš„æ˜¯é™æ€èµ„æºï¼ˆä¾‹å¦‚HTMLæ–‡ä»¶ã€å›¾ç‰‡ç­‰ï¼‰ï¼ŒæœåŠ¡å™¨ä¼šä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–èµ„æºå¹¶è¿”å›ç»™æµè§ˆå™¨ã€‚å¦‚æœè¯·æ±‚éœ€è¦åº”ç”¨é€»è¾‘å¤„ç†ï¼ˆä¾‹å¦‚é€šè¿‡æŸç§ç¼–ç¨‹è¯­è¨€ç”ŸæˆåŠ¨æ€å†…å®¹ï¼‰ï¼ŒæœåŠ¡å™¨ä¼šå°†è¯·æ±‚è½¬å‘ç»™ç›¸åº”çš„åº”ç”¨æœåŠ¡ã€‚</p></li><li><p><strong>åº”ç”¨æœåŠ¡å¤„ç†</strong>ï¼š åº”ç”¨æœåŠ¡æ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®è¯·æ±‚çš„å†…å®¹æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚è¿™å¯èƒ½åŒ…æ‹¬ä»æ•°æ®åº“ä¸­æ£€ç´¢æ•°æ®ã€å¤„ç†ä¸šåŠ¡é€»è¾‘ã€ç”ŸæˆåŠ¨æ€å†…å®¹ç­‰ã€‚</p></li><li><p><strong>ç”ŸæˆHTTPå“åº”</strong>ï¼š åº”ç”¨æœåŠ¡å¤„ç†å®Œè¯·æ±‚åï¼Œä¼šç”Ÿæˆä¸€ä¸ªHTTPå“åº”ã€‚è¿™ä¸ªå“åº”åŒ…æ‹¬äº†çŠ¶æ€ç ï¼ˆä¾‹å¦‚200è¡¨ç¤ºæˆåŠŸã€404è¡¨ç¤ºèµ„æºæœªæ‰¾åˆ°ç­‰ï¼‰ã€Headersï¼ˆä¾‹å¦‚Content-Typeã€Cache-Controlç­‰ï¼‰ä»¥åŠå®é™…çš„å“åº”å†…å®¹ã€‚</p><blockquote><details open=""><devtools-response-header-section style="display: block;"><devtools-header-section-row data-index="0" style="display: block; --override-error-background-color: #d93025; margin-top: 2px;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Cache-Control:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">no-cache, no-store, max-age=0, must-revalidate<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="1" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Content-Type:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">application/json<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="2" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Date:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">Thu, 10 Aug 2023 11:47:23 GMT<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="3" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Expires:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">0<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="4" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Pragma:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">no-cache<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 1; visibility: visible; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="5" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Server:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">nginx<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="6" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Vary:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">Access-Control-Request-Headers<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="7" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Vary:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">Access-Control-Request-Method<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="8" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">Vary:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">Origin<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="9" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">X-Content-Type-Options:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">nosniff<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="10" style="display: block; --override-error-background-color: #d93025;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">X-Frame-Options:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">DENY<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row><devtools-header-section-row data-index="11" style="display: block; --override-error-background-color: #d93025; margin-bottom: 10px;"><div class=" row " style="display: flex; line-height: 20px; padding-left: 8px; gap: 12px; user-select: text;"><div class=" header-name " style="color: var(--color-text-primary); font-weight: 400; width: 160px; flex-shrink: 0; text-transform: capitalize; overflow-wrap: break-word;">X-Xss-Protection:</div><div class=" header-value " style="display: flex; overflow-wrap: anywhere;">1; mode=block<devtools-button class="enable-editing inline-button" role="presentation" title="æ›¿ä»£æ ‡å¤´" style="display: inline-flex; flex-direction: row; vertical-align: middle; opacity: 0; visibility: hidden; transition: opacity 200ms ease 0s; padding-left: 2px;"><button class=" round only-icon small tiny explicit-size " style="margin: 0px; padding: 0px; box-sizing: border-box; --button-has-right-border-radius: calc(1 - var(--override-button-no-right-border-radius, 0)); --button-border-size: 1px; --button-height: 18px; --button-width: 18px; align-items: center; border-radius: 100%; display: inline-flex; font-family: inherit; font-size: 12px; font-weight: 500; height: var(--button-height); line-height: 14px; justify-content: center; width: var(--button-width); white-space: nowrap; background: transparent; border: none; overflow: hidden;"><devtools-icon style="display: inline-block; white-space: nowrap; position: relative; margin: 0px; padding: 0px; box-sizing: border-box; width: unset; height: unset; --icon-color: var(--icon-default);"><div class="icon-basic" style="width: 16px; height: 16px; display: block; -webkit-mask-image: url(&quot;devtools://devtools/bundled/Images/edit.svg&quot;); -webkit-mask-position: center center; -webkit-mask-repeat: no-repeat; -webkit-mask-size: 99%; background-color: var(--icon-color, var(--color-background));"></div></devtools-icon><slot style="margin: 0px; padding: 0px; box-sizing: border-box;"></slot></button></devtools-button></div></div></devtools-header-section-row></devtools-response-header-section></details></blockquote></li><li><p><strong>ä¼ è¾“HTTPå“åº”</strong>ï¼š æœåŠ¡å™¨å°†ç”Ÿæˆçš„HTTPå“åº”é€šè¿‡ä¹‹å‰å»ºç«‹çš„TCPè¿æ¥ä¼ è¾“å›æµè§ˆå™¨ã€‚</p></li><li><p><strong>æµè§ˆå™¨æ¥æ”¶å“åº”</strong>ï¼š æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨ä¼ å›çš„HTTPå“åº”ã€‚å®ƒä¼šæ ¹æ®å“åº”ä¸­çš„ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚è§£æHTMLå†…å®¹ã€æ¸²æŸ“é¡µé¢ã€æ‰§è¡ŒJavaScriptä»£ç ç­‰ã€‚</p></li><li><p><strong>å…³é—­è¿æ¥</strong>ï¼š ä¸€æ—¦å“åº”ä¼ è¾“å®Œæ¯•ï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„TCPè¿æ¥ä¼šè¢«å…³é—­ã€‚è¿™ä¸€æ­¥ç¡®ä¿è¿æ¥èµ„æºè¢«é‡Šæ”¾ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠäº†å¤šä¸ªå…³é”®æ­¥éª¤ï¼ŒåŒ…æ‹¬URLè§£æã€DNSè§£æã€å»ºç«‹TCPè¿æ¥ã€å‘èµ·HTTPè¯·æ±‚ã€æœåŠ¡å™¨å¤„ç†ã€åº”ç”¨æœåŠ¡å¤„ç†ã€ç”ŸæˆHTTPå“åº”ã€ä¼ è¾“å“åº”ã€æµè§ˆå™¨å¤„ç†ç­‰ï¼Œæœ€ç»ˆå°†ç”¨æˆ·è¾“å…¥çš„URLè½¬åŒ–ä¸ºæµè§ˆå™¨ä¸Šå¯è§çš„ç½‘é¡µå†…å®¹ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>é¢è¯•é—®é¢˜</tag>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>obsidian git ios å¤šå¹³å°åŒæ­¥</title>
    <link href="/2023/04/20/obsidian-git-ios-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%90%8C%E6%AD%A5/"/>
    <url>/2023/04/20/obsidian-git-ios-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%90%8C%E6%AD%A5/</url>
    
    <content type="html"><![CDATA[<p>Obsidian æä¾›äº†å¤šç§æ•°æ®åŒæ­¥æ–¹å¼ï¼Œå…¶ä¸­å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹æ’ä»¶å®ç° Git åŒæ­¥ã€‚é€šè¿‡ Git åŒæ­¥ï¼Œä½ å¯ä»¥å°† Obsidian ä¸­çš„ç¬”è®°æ•°æ®ä¸Šä¼ åˆ° GitHubã€GitLabã€Bitbucket ç­‰ Git ä»“åº“ä¸­ï¼Œä»è€Œå®ç°åœ¨ iOS å’Œ Mac ç­‰ä¸åŒè®¾å¤‡ä¹‹é—´åŒæ­¥ç¬”è®°ã€‚</p><p>ä»¥ä¸‹æ˜¯å®ç° Obsidian Git åŒæ­¥çš„æ­¥éª¤ï¼š</p><h4 id="Macï¼š"><a href="#Macï¼š" class="headerlink" title="Macï¼š"></a>Macï¼š</h4><ol><li><p>åœ¨ä½ çš„ Git ä»“åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼Œå¹¶å°†å…¶å…‹éš†åˆ°æœ¬åœ°è®¡ç®—æœºä¸Šã€‚</p></li><li><p>åœ¨ Obsidian ä¸­æ‰“å¼€è®¾ç½®ç•Œé¢ï¼Œé€‰æ‹©ã€Œç¬¬ä¸‰æ–¹æ’ä»¶ã€é€‰é¡¹å¡ï¼Œå®‰è£…å¹¶å¯ç”¨ã€ŒObsidian Gitã€æ’ä»¶ã€‚</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304201140960.png" alt="image-20230420114013073"></p></li><li><p>åœ¨ Obsidian Gitè®¾ç½®ç•Œé¢ä¸­ï¼Œç‚¹å‡»å¼€å¯è‡ªåŠ¨commitå’Œpushï¼Œå¹¶è®¾ç½®æ—¶é—´ã€‚</p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304201142184.png" alt="image-20230420114154147" style="zoom:50%;" /></li></ol><p>æ­¤æ—¶ï¼ŒObsidian ä¸­çš„ç¬”è®°æ•°æ®å°†è¢«åŒæ­¥åˆ° Git ä»“åº“ä¸­</p><h4 id="IOS"><a href="#IOS" class="headerlink" title="IOS"></a>IOS</h4><ol><li>apple storeä¸‹è½½ISH</li></ol><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/202304201146055.png" alt="image-20230420114624522"></p><ol start="2"><li><p>æ‰“å¼€ISHæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><ol><li>å®‰è£…git</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">apk add git<br></code></pre></td></tr></table></figure><ol start="2"><li>ç”¨äºåœ¨å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º â€œobsidianâ€ çš„æ–°æ–‡ä»¶å¤¹</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~ &amp;&amp; mkdir obsidian<br></code></pre></td></tr></table></figure><ol start="3"><li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¼šæ‰“å¼€æ‰‹æœºæ–‡ä»¶ç®¡ç†å™¨ï¼Œä¹‹åéœ€è¦é€‰ä¸­æœ¬åœ°çš„obsidianæ–‡ä»¶å¤¹ï¼Œç‚¹å‡»å®Œæˆã€‚è¿™æ ·å°±è®©obsidianè½¯ä»¶ä¸­çš„mathæ–‡ä»¶å¤¹ï¼Œè£…è½½åˆ°ishä¸Šçš„obsidianæ–‡ä»¶å¤¹å†… ï¼Œä¹‹åå¯¹äºobsidianè½¯ä»¶å†…mathæ–‡ä»¶çš„ä¿®æ”¹ï¼ŒiSHä¸Šä¹ŸåŒæ­¥ä¿®æ”¹</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mount -t ios . obsidian<br></code></pre></td></tr></table></figure><ol start="4"><li>é€šè¿‡cdå‘½ä»¤ï¼Œè¿›å…¥obsidianæ–‡ä»¶å¤¹å†…</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/obsidian<br></code></pre></td></tr></table></figure><ol start="5"><li>Git å…‹éš†ä»“åº“åˆ°obsidianç›®å½•,è¾“å…¥è´¦å·å’Œå¯†ç ï¼ˆgithub personal access keyï¼‰</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://xxxxxx.git<br></code></pre></td></tr></table></figure></li><li><p>æ‰“å¼€obsidianå°±ä¼šçœ‹åˆ°ä½ çš„ä»“åº“å’¯ï¼Œç„¶åæ‰“å¼€Obsidian Gité…ç½®ï¼Œgitè´¦å·å¯†ç </p></li></ol><h4 id="å¼‚å¸¸è§£å†³"><a href="#å¼‚å¸¸è§£å†³" class="headerlink" title="å¼‚å¸¸è§£å†³"></a>å¼‚å¸¸è§£å†³</h4><p>å¦‚æœé‡åˆ°git clone ä¸€ç›´å¡ç€ å¤šæ¬¡å°è¯•éƒ½æ— æ³•cloneæˆåŠŸçš„</p><ol><li>å…ˆåˆ›å»ºç›®å½•å¹¶è¿›å…¥ç›®å½•</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir ï½/obsidian/ç›®å½•å<br>cd ï½/obsidian/ç›®å½•å<br></code></pre></td></tr></table></figure><ol start="2"><li>åˆå§‹åŒ–gitä»“åº“</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git init<br></code></pre></td></tr></table></figure><ol start="3"><li>å°†ä¸€ä¸ªåä¸º â€œsafe.directoryâ€ çš„ Git å…¨å±€é…ç½®è®¾ç½®æ·»åŠ åˆ°æ‚¨çš„ Git ç¯å¢ƒä¸­ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º â€œ <del>&#x2F;obsidian&#x2F;ç›®å½•åâ€ ç›®å½•ã€‚è¿™ä¸ªå…¨å±€é…ç½®è®¾ç½®è¢«æ·»åŠ åˆ°æ‚¨çš„ â€œ</del>&#x2F;.gitconfigâ€ æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å¯ä»¥è¢«æ‰€æœ‰åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œçš„ Git ä»“åº“ä½¿ç”¨ï¼Œä»¥ç¡®ä¿å®ƒä»¬éƒ½çŸ¥é“æ‚¨é€‰æ‹©çš„å®‰å…¨ç›®å½•çš„ä½ç½®ã€‚è¿™ä¸ªå‘½ä»¤æ˜¯ä¸ºäº†å¸®åŠ©æ‚¨ä¿æŠ¤æ‚¨çš„ä¸ªäººã€æ•æ„Ÿæˆ–é‡è¦çš„ Git ä»“åº“ï¼Œä»¥é˜²æ­¢åœ¨é”™è¯¯çš„ä½ç½®æˆ–å—åˆ°æ”»å‡»çš„è®¡ç®—æœºä¸Šæ³„éœ²ã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config --global --add safe.directory ~/obsidian/ç›®å½•å<br></code></pre></td></tr></table></figure><ol start="4"><li>å½“ Git æ‰“åŒ…ä¸€ä¸ªä»“åº“çš„å¯¹è±¡æ—¶ï¼Œä¼šå°†è¿™äº›å¯¹è±¡å‹ç¼©æˆä¸€ä¸ªæ–‡ä»¶å­˜å‚¨åœ¨ Git å¯¹è±¡åº“ä¸­ã€‚è¿™ä¸ªæ“ä½œéå¸¸è€—è´¹èµ„æºï¼Œå› æ­¤ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†å¯ä»¥åŠ é€Ÿæ‰“åŒ…è¿‡ç¨‹ã€‚è®¾ç½® â€œpack.threadsâ€ ä¸º 1 æ„å‘³ç€ Git å°†ä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œæ‰“åŒ…æ“ä½œï¼Œè¿™æ ·å¯èƒ½ä¼šå‡ç¼“æ‰“åŒ…é€Ÿåº¦ï¼Œä½†æ˜¯ä¹Ÿèƒ½å¤Ÿå‡å°‘è®¡ç®—æœºçš„ CPU å’Œå†…å­˜è´Ÿè½½ã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config pack.threads 1<br></code></pre></td></tr></table></figure><ol start="5"><li>ä»è¿œç¨‹ä»“åº“è·å–æœ€æ–°çš„æäº¤å’Œå¯¹è±¡ï¼Œä½†æ˜¯ä¸ä¼šå°†å®ƒä»¬åˆå¹¶åˆ°å½“å‰çš„æœ¬åœ°åˆ†æ”¯ä¸­ã€‚å®ƒé€šå¸¸è¢«ç”¨æ¥æ£€æŸ¥è¿œç¨‹ä»“åº“ä¸­çš„æœ€æ–°å˜æ›´ï¼Œä»¥ä¾¿åœ¨æœ¬åœ°è¿›è¡Œæ›´æ–°æˆ–è€…åˆå¹¶æ“ä½œä¹‹å‰å…ˆäº†è§£è¿™äº›å˜æ›´ã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git fetch<br></code></pre></td></tr></table></figure><ol start="7"><li>å¦‚æœæƒ³è¦æ‹‰å–æœ€æ–°çš„ä»£ç å¹¶è‡ªåŠ¨å°†å…¶åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>git pull</code> å‘½ä»¤ã€‚ä½†æ˜¯å¦‚æœåªæ˜¯æƒ³è¦çŸ¥é“è¿œç¨‹ä»“åº“çš„æœ€æ–°çŠ¶æ€ï¼Œè€Œä¸ä¼šæ”¹å˜å½“å‰çš„æœ¬åœ°åˆ†æ”¯çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <code>git fetch</code>ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„åˆå¹¶å†²çªï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git pull<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>obsidian</category>
      
    </categories>
    
    
    <tags>
      
      <tag>obsidian</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqläº‹åŠ¡</title>
    <link href="/2023/04/17/Mysql%E4%BA%8B%E5%8A%A1/"/>
    <url>/2023/04/17/Mysql%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<p>æ•°æ®åº“äº‹åŠ¡æ˜¯æŒ‡ä¸€ç»„æ•°æ®åº“æ“ä½œï¼Œå®ƒä»¬ä½œä¸ºä¸€ä¸ªé€»è¾‘å•å…ƒä¸€èµ·æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œäº‹åŠ¡é€šå¸¸ç”¨äºæ‰§è¡Œä¸€ç³»åˆ—çš„æ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤å¤šæ¡è®°å½•ç­‰ã€‚</p><h3 id="äº‹åŠ¡ç‰¹æ€§"><a href="#äº‹åŠ¡ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡ç‰¹æ€§"></a>äº‹åŠ¡ç‰¹æ€§</h3><p>äº‹åŠ¡å…·æœ‰ä»¥ä¸‹å››ä¸ªç‰¹æ€§ï¼Œé€šå¸¸ç§°ä¸º ACID ç‰¹æ€§ï¼š</p><ol><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œä¸å…è®¸å‡ºç°éƒ¨åˆ†æ‰§è¡Œçš„æƒ…å†µã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡æ‰§è¡Œå‰å’Œæ‰§è¡Œåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½åº”è¯¥æ„Ÿè§‰ä¸åˆ°å…¶ä»–äº‹åŠ¡çš„å­˜åœ¨ï¼Œå„ä¸ªäº‹åŠ¡ä¹‹é—´åº”è¯¥ç›¸äº’éš”ç¦»ã€‚</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆåŠŸï¼Œå…¶ç»“æœå°±åº”è¯¥æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå³ä½¿å‡ºç°ç³»ç»Ÿæ•…éšœä¹Ÿä¸åº”è¯¥ä¸¢å¤±ã€‚</li></ol><h3 id="è„è¯»"><a href="#è„è¯»" class="headerlink" title="è„è¯»"></a>è„è¯»</h3><p>è„è¯»ï¼ˆDirty Readï¼‰æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡å°šæœªæäº¤çš„æ•°æ®ã€‚åœ¨è„è¯»çš„æƒ…å†µä¸‹ï¼Œè¯»å–åˆ°çš„æ•°æ®å¯èƒ½æ˜¯ä¸å‡†ç¡®çš„ï¼Œå› ä¸ºè¿™äº›æ•°æ®å¯èƒ½ä¼šè¢«å¦ä¸€ä¸ªäº‹åŠ¡æ’¤é”€æˆ–ä¿®æ”¹ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªäº‹åŠ¡ A å’Œ Bï¼Œäº‹åŠ¡ A åœ¨è¯»å–äº†ä¸€æ¡æ•°æ®ä¹‹åï¼Œäº‹åŠ¡ B ä¿®æ”¹äº†è¯¥æ•°æ®ï¼Œä½†æ˜¯å°šæœªæäº¤ã€‚å¦‚æœæ­¤æ—¶äº‹åŠ¡ A å†æ¬¡è¯»å–è¯¥æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šè¯»å–åˆ°äº‹åŠ¡ B ä¿®æ”¹åçš„æ•°æ®ï¼Œè€Œè¿™ä¸ªæ•°æ®å¯èƒ½æ˜¯ä¸å‡†ç¡®çš„ã€‚</p><h3 id="ä¸å¯é‡å¤è¯»"><a href="#ä¸å¯é‡å¤è¯»" class="headerlink" title="ä¸å¯é‡å¤è¯»"></a>ä¸å¯é‡å¤è¯»</h3><p>åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­ï¼Œä¸å¯é‡å¤è¯»æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶å¾—åˆ°çš„ç»“æœå¯èƒ½ä¸åŒã€‚è¿™é€šå¸¸æ˜¯ç”±äºåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå¦ä¸€ä¸ªå¹¶å‘çš„äº‹åŠ¡ä¿®æ”¹äº†åŒä¸€ä¸ªæ•°æ®æ‰€å¯¼è‡´çš„ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜ä¸å¯é‡å¤è¯»çš„æƒ…å†µï¼š</p><ol><li>äº‹åŠ¡T1è¯»å–æ•°æ®Xï¼Œè·å¾—ç»“æœAã€‚</li><li>åœ¨T1è¯»å–æ•°æ®Xä¹‹åï¼Œäº‹åŠ¡T2ä¿®æ”¹äº†æ•°æ®Xï¼Œå°†å…¶æ›´æ”¹ä¸ºBã€‚</li><li>äº‹åŠ¡T1å†æ¬¡è¯»å–æ•°æ®Xï¼Œæ­¤æ—¶è·å¾—ç»“æœBï¼Œä¸ç¬¬ä¸€æ¬¡è¯»å–æ—¶çš„ç»“æœä¸åŒã€‚</li></ol><h3 id="å¹»è¯»"><a href="#å¹»è¯»" class="headerlink" title="å¹»è¯»"></a>å¹»è¯»</h3><p>åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­ï¼Œå¹»è¯»æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒä¸€ä¸ªèŒƒå›´å†…çš„è®°å½•æ—¶ï¼Œå¾—åˆ°çš„ç»“æœå¯èƒ½ä¸åŒã€‚è¿™é€šå¸¸æ˜¯ç”±äºåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå¦ä¸€ä¸ªå¹¶å‘çš„äº‹åŠ¡æ’å…¥æˆ–åˆ é™¤äº†ä¸€äº›è®°å½•æ‰€å¯¼è‡´çš„ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¹»è¯»çš„æƒ…å†µï¼š</p><ol><li>äº‹åŠ¡T1è¯»å–æ•°æ®é›†Xï¼Œè·å¾—ç»“æœAã€‚</li><li>åœ¨T1è¯»å–æ•°æ®é›†Xä¹‹åï¼Œäº‹åŠ¡T2åœ¨æ•°æ®é›†Xä¸­æ’å…¥äº†ä¸€æ¡æ–°çš„è®°å½•ï¼Œè¿™æ¡è®°å½•ä¸åœ¨T1çš„ç»“æœé›†ä¸­ã€‚</li><li>äº‹åŠ¡T1å†æ¬¡è¯»å–æ•°æ®é›†Xï¼Œæ­¤æ—¶è·å¾—ç»“æœBï¼Œå…¶ä¸­åŒ…å«äº†T2æ’å…¥çš„æ–°è®°å½•ã€‚</li></ol><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒT1çš„ä¸¤æ¬¡è¯»å–ä¹‹é—´çš„å·®å¼‚å°±æ˜¯å¹»è¯»çš„ç»“æœã€‚</p><h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p>æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯æŒ‡å¤šä¸ªäº‹åŠ¡ä¹‹é—´ç›¸äº’éš”ç¦»çš„ç¨‹åº¦ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®éš”ç¦»çº§åˆ«æ¥æ§åˆ¶äº‹åŠ¡ä¹‹é—´çš„å¹¶å‘æ€§å’Œæ•°æ®ä¸€è‡´æ€§ã€‚å¸¸è§çš„éš”ç¦»çº§åˆ«æœ‰å››ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol><li>è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼šåœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡å°šæœªæäº¤çš„æ•°æ®ï¼Œä¼šå‡ºç°è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜ã€‚</li><li>è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ï¼šåœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é¿å…è„è¯»çš„é—®é¢˜ï¼Œä½†æ˜¯ä»ç„¶ä¼šå‡ºç°ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜ã€‚</li><li>å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ï¼šåœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´å¤šæ¬¡è¯»å–åŒä¸€æ¡è®°å½•çš„æ•°æ®æ—¶ï¼Œä¼šä¿è¯æ¯æ¬¡è¯»å–çš„æ•°æ®éƒ½ç›¸åŒï¼Œå¯ä»¥é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œä½†æ˜¯ä»ç„¶ä¼šå‡ºç°å¹»è¯»çš„é—®é¢˜ã€‚</li><li>ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼šåœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œæ‰€æœ‰çš„äº‹åŠ¡éƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªäº‹åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆåæ‰èƒ½æ‰§è¡Œï¼Œå¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šé™ä½ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</li></ol><h3 id="log"><a href="#log" class="headerlink" title="log"></a>log</h3><h4 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h4><p>åœ¨ MySQL ä¸­ï¼Œredo log æ˜¯ä¸€ç§ç”¨äºå´©æºƒæ¢å¤å’Œäº‹åŠ¡æŒä¹…åŒ–çš„æœºåˆ¶ã€‚redo log è®°å½•äº†æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œï¼Œå³äº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ•°æ®æ‰€åšçš„æ‰€æœ‰ä¿®æ”¹ã€‚å½“ MySQL åœ¨å´©æºƒåé‡æ–°å¯åŠ¨æ—¶ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ redo log æ¥æ¢å¤æœ€åä¸€æ¬¡å´©æºƒä¹‹å‰æäº¤çš„äº‹åŠ¡ã€‚</p><p>redo log æ˜¯åŸºäºç£ç›˜çš„æ—¥å¿—ï¼Œå®ƒæ˜¯å¾ªç¯å†™å…¥çš„ï¼Œå½“æ‰€æœ‰çš„ redo log è¢«å†™æ»¡ä¹‹åï¼ŒMySQL å°†ä» redo log çš„å¼€å¤´é‡æ–°å¼€å§‹å†™å…¥ã€‚redo log å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå› æ­¤å®ƒä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„å†…å­˜ã€‚</p><p>redo log çš„å·¥ä½œåŸç†æ˜¯ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹æ—¶ï¼Œæ‰€æœ‰çš„ä¿®æ”¹æ“ä½œéƒ½è¢«è®°å½•åˆ° redo log ä¸­ï¼Œä½†å®é™…çš„æ•°æ®ä¿®æ”¹æ“ä½œä¸ä¼šç«‹å³è¢«æ‰§è¡Œã€‚ç›¸åï¼Œå®ƒä»¬ä¼šè¢«æš‚æ—¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç­‰åˆ°äº‹åŠ¡æäº¤æ—¶ï¼ŒMySQL æ‰ä¼šå°†å…¶å†™å…¥ç£ç›˜ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘ç£ç›˜å†™å…¥çš„æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p>å½“ MySQL å‘ç”Ÿå´©æºƒæˆ–éæ­£å¸¸å…³é—­æ—¶ï¼Œredo log å°±å‘æŒ¥äº†é‡è¦çš„ä½œç”¨ã€‚MySQL åœ¨é‡æ–°å¯åŠ¨æ—¶ï¼Œä¼šæ£€æŸ¥ redo log ä¸­å°šæœªæäº¤çš„äº‹åŠ¡ï¼Œç„¶åå°†å…¶é‡æ–°æ‰§è¡Œï¼Œä»¥ä¿è¯æ•°æ®åº“çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚</p><h4 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h4><p>åœ¨ MySQL ä¸­ï¼Œundo log æ˜¯ç”¨äºäº‹åŠ¡å›æ»šå’Œ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å®ç°çš„æœºåˆ¶ã€‚å½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹æ—¶ï¼ŒMySQL ä¼šåˆ›å»ºä¸€ä¸ª undo log æ¥è®°å½•è¯¥äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹æ“ä½œã€‚å½“äº‹åŠ¡è¢«å›æ»šæ—¶ï¼ŒMySQL å°±ä¼šä½¿ç”¨ undo log å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>ä¸ redo log ä¸åŒçš„æ˜¯ï¼Œundo log è®°å½•çš„æ˜¯åŸå§‹æ•°æ®çš„â€œæ—§å€¼â€ï¼Œè€Œä¸æ˜¯æ–°çš„ä¿®æ”¹å€¼ã€‚å› æ­¤ï¼Œåœ¨äº‹åŠ¡å›æ»šæ—¶ï¼ŒMySQL å¯ä»¥ä½¿ç”¨ undo log å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚æ­¤å¤–ï¼Œundo log è¿˜å¯ä»¥ç”¨äºæ”¯æŒ MVCC å®ç°ï¼ŒMVCC å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å–åŒä¸€ä¸ªæ•°æ®é¡¹ï¼Œè€Œä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚</p><p>undo log å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œä½†å®ƒä»¬é€šå¸¸å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ä¸´æ—¶ç¼“å†²åŒºä¸­ã€‚å½“äº‹åŠ¡æäº¤æ—¶ï¼ŒMySQL ä¼šå°†å…¶å¯¹åº”çš„ undo log ä»å†…å­˜ä¸­å†™å…¥ç£ç›˜ä¸­çš„ undo log æ–‡ä»¶ä¸­ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼Œé‚£ä¹ˆå®ƒçš„ undo log å°±ä¸ä¼šè¢«å†™å…¥ç£ç›˜ï¼Œè¿™æ ·å¯ä»¥é¿å…å†™å…¥ç£ç›˜çš„å¼€é”€ã€‚</p><h4 id="bin-log"><a href="#bin-log" class="headerlink" title="bin log"></a>bin log</h4><p>åœ¨ MySQL ä¸­ï¼Œbin log æ˜¯ç”¨äºæ•°æ®å¤‡ä»½ã€æ¢å¤ä»¥åŠå¤åˆ¶çš„æœºåˆ¶ã€‚bin log è®°å½•äº† MySQL ä¸­æ‰€æœ‰ä¿®æ”¹æ•°æ®çš„æ“ä½œï¼ŒåŒ…æ‹¬å¯¹æ•°æ®çš„æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤ç­‰æ“ä½œã€‚</p><p>bin log å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æ•°æ®æˆ–å¤åˆ¶æ•°æ®åˆ°å…¶ä»– MySQL å®ä¾‹ã€‚å› æ­¤ï¼Œbin log å¯ä»¥ç”¨äºæ•°æ®å¤‡ä»½å’Œæ¢å¤ï¼Œä¹Ÿå¯ä»¥ç”¨äºä¸»ä»å¤åˆ¶ï¼Œå°†ä¸€ä¸ª MySQL å®ä¾‹çš„æ•°æ®å¤åˆ¶åˆ°å…¶ä»– MySQL å®ä¾‹ã€‚</p><p>bin log çš„å·¥ä½œåŸç†æ˜¯ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹æ—¶ï¼ŒMySQL ä¼šå°†æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œè®°å½•åˆ° bin log ä¸­ã€‚å½“äº‹åŠ¡æäº¤æ—¶ï¼ŒMySQL å°†äº‹åŠ¡çš„æäº¤ä¿¡æ¯ä¸€å¹¶è®°å½•åˆ° bin log ä¸­ã€‚å› æ­¤ï¼Œbin log ä¸­ä¸ä»…åŒ…å«æ•°æ®çš„ä¿®æ”¹æ“ä½œï¼Œè¿˜åŒ…å«äº†äº‹åŠ¡æäº¤çš„æ—¶é—´ã€äº‹åŠ¡ ID ç­‰ä¿¡æ¯ã€‚</p><p>bin log æœ‰å¤šç§æ ¼å¼ï¼ŒåŒ…æ‹¬ statementã€row å’Œ mixed ç­‰æ ¼å¼ã€‚å…¶ä¸­ï¼Œstatement æ ¼å¼è®°å½•çš„æ˜¯ SQL è¯­å¥ï¼Œrow æ ¼å¼è®°å½•çš„æ˜¯è¡Œçº§åˆ«çš„å˜åŒ–ï¼Œmixed æ ¼å¼æ˜¯ä¸¤è€…çš„ç»“åˆã€‚</p><h4 id="äº‹åŠ¡ä¸­æ—¥å¿—æ‰§è¡Œæµç¨‹"><a href="#äº‹åŠ¡ä¸­æ—¥å¿—æ‰§è¡Œæµç¨‹" class="headerlink" title="äº‹åŠ¡ä¸­æ—¥å¿—æ‰§è¡Œæµç¨‹"></a>äº‹åŠ¡ä¸­æ—¥å¿—æ‰§è¡Œæµç¨‹</h4><ol><li><p>è®°å½•undo logï¼Œå°†ä¿®æ”¹å‰çš„æ•°æ®è®°å½•åˆ°undoLogä¸­ï¼Œä»¥ä¾¿åœ¨äº‹åŠ¡å›æ»šæ—¶æ¢å¤åŸæ¥çš„æ•°æ®ã€‚</p></li><li><p>æ‰§è¡Œäº‹åŠ¡ä¸­çš„SQLè¯­å¥ï¼Œè¿™äº›è¯­å¥ä¼šä¿®æ”¹æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p></li><li><p>è®°å½•redo logï¼Œå°†ä¿®æ”¹åçš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸Šçš„æ•°æ®æ–‡ä»¶ä¸­ï¼Œä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚</p></li><li><p>è®°å½•bin logï¼Œå°†æ‰§è¡Œçš„SQLè¯­å¥è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œä»¥ä¾¿ç”¨äºä¸»ä»åŒæ­¥å’Œæ•°æ®æ¢å¤ç­‰ã€‚</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>zookeeperç®€å•ä½¿ç”¨+å·¥å…·ç±»</title>
    <link href="/2023/04/13/zookeeper%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8-%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <url>/2023/04/13/zookeeper%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8-%E5%B7%A5%E5%85%B7%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<p>Zookeeperæ˜¯ä¸€ç§åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œæ—¨åœ¨å¸®åŠ©æ„å»ºå¯é çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å®ƒæä¾›äº†ä¸€ç»„åŸè¯­ï¼Œç”¨äºåè°ƒä¸åŒè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å’ŒåŒæ­¥ã€‚Zookeeperå¯ä»¥ç”¨äºå„ç§åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚åˆ†å¸ƒå¼é”ï¼Œé…ç½®ç®¡ç†ï¼Œé˜Ÿåˆ—ç­‰ã€‚</p><p>Zookeeperçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯znodeï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„èŠ‚ç‚¹ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•æˆ–æ–‡ä»¶ã€‚æ¯ä¸ªznodeéƒ½æœ‰ä¸€ä¸ªåç§°å’Œä¸€ä¸ªå…³è”çš„æ•°æ®ã€‚Zookeeperç»´æŠ¤äº†ä¸€ä¸ªåˆ†å±‚çš„znodeå‘½åç©ºé—´ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•æ ‘ã€‚é€šè¿‡åˆ›å»ºï¼Œåˆ é™¤å’Œæ›´æ–°znodeï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å®ç°åœ¨ä¸åŒè¿›ç¨‹ä¹‹é—´å…±äº«çŠ¶æ€çš„åè°ƒã€‚</p><p>Zookeeperè¿˜æä¾›äº†ä¸€äº›ç‰¹æ®Šçš„znodeï¼Œä¾‹å¦‚ä¸´æ—¶èŠ‚ç‚¹å’Œé¡ºåºèŠ‚ç‚¹ï¼Œç”¨äºå®ç°åˆ†å¸ƒå¼é”å’Œé˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚</p><p>Zookeeperä½¿ç”¨ä¸€ç§ç§°ä¸ºâ€œZabâ€çš„åè®®æ¥ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚Zabåè®®ç¡®ä¿åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå…¶ä½™èŠ‚ç‚¹éƒ½æ˜¯ä»èŠ‚ç‚¹ã€‚ä¸»èŠ‚ç‚¹è´Ÿè´£å¤„ç†æ‰€æœ‰å†™æ“ä½œï¼Œç„¶åå°†ç»“æœå¤åˆ¶åˆ°æ‰€æœ‰ä»èŠ‚ç‚¹ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä¿è¯ç³»ç»Ÿåœ¨ä»»ä½•æ—¶å€™éƒ½å…·æœ‰ä¸€è‡´çš„çŠ¶æ€ã€‚</p><p><strong>æ°¸ä¹…èŠ‚ç‚¹å’Œä¸´æ—¶èŠ‚ç‚¹</strong></p><p>Zookeeperä¸­ï¼Œæ°¸ä¹…èŠ‚ç‚¹å’Œä¸´æ—¶èŠ‚ç‚¹çš„ä¸åŒç‚¹åœ¨äºå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸå’Œç”¨é€”ã€‚</p><ol><li>ç”Ÿå‘½å‘¨æœŸï¼š</li></ol><ul><li>æ°¸ä¹…èŠ‚ç‚¹ï¼šä¸€æ—¦åˆ›å»ºï¼ŒèŠ‚ç‚¹å°†ä¸€ç›´å­˜åœ¨ç›´åˆ°è¢«æ˜¾å¼åˆ é™¤ã€‚å³ä½¿å®¢æˆ·ç«¯å’ŒZookeeper Serverä¹‹é—´çš„è¿æ¥æ–­å¼€ï¼ŒèŠ‚ç‚¹ä¹Ÿä¼šä¸€ç›´å­˜åœ¨äºZookeeper Serverä¸Šã€‚</li><li>ä¸´æ—¶èŠ‚ç‚¹ï¼šå½“åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹çš„å®¢æˆ·ç«¯å’ŒZookeeper ServerçŸ­æš‚çš„å¤±å»è¿æ¥æ—¶ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸Zookeeper Serverä¹‹é—´çš„è¿æ¥æ¢å¤ï¼Œåˆ™èŠ‚ç‚¹å°†é‡æ–°å‡ºç°åœ¨Zookeeper Serverä¸Šã€‚</li></ul><ol start="2"><li>ç”¨é€”ï¼š</li></ol><ul><li>æ°¸ä¹…èŠ‚ç‚¹ï¼šç”¨äºå­˜å‚¨æ°¸ä¹…æ€§çš„æ•°æ®ï¼Œä¾‹å¦‚é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰ã€‚</li><li>ä¸´æ—¶èŠ‚ç‚¹ï¼šç”¨äºè¡¨ç¤ºåœ¨çº¿å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œä¾‹å¦‚ä»»åŠ¡è°ƒåº¦èŠ‚ç‚¹ã€ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€é˜Ÿåˆ—ä¸­çš„å…ƒç´ ç­‰ã€‚</li></ul><p>å› æ­¤ï¼Œå¼€å‘äººå‘˜åœ¨ä½¿ç”¨Zookeeperæ—¶éœ€è¦æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©æ°¸ä¹…èŠ‚ç‚¹æˆ–ä¸´æ—¶èŠ‚ç‚¹æ¥å­˜å‚¨æ•°æ®ã€‚</p><p><strong>æœ‰åºèŠ‚ç‚¹å’Œæ— åºèŠ‚ç‚¹</strong></p><p>Zookeeperä¸­ï¼Œæœ‰åºèŠ‚ç‚¹å’Œæ— åºèŠ‚ç‚¹çš„ä¸åŒç‚¹åœ¨äºå®ƒä»¬çš„èŠ‚ç‚¹åç§°å’Œæ’åºæ–¹å¼ã€‚</p><ol><li>èŠ‚ç‚¹åç§°ï¼š</li></ol><ul><li>æ— åºèŠ‚ç‚¹ï¼šèŠ‚ç‚¹åç§°ç”±ç”¨æˆ·æŒ‡å®šï¼ŒZookeeperä¼šæ£€æŸ¥è¯¥åç§°æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚èŠ‚ç‚¹åç§°å¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸²ã€‚</li><li>æœ‰åºèŠ‚ç‚¹ï¼šèŠ‚ç‚¹åç§°ç”±Zookeeperè‡ªåŠ¨åˆ†é…ï¼ŒèŠ‚ç‚¹åç§°çš„æ ¼å¼ä¸ºæŒ‡å®šèŠ‚ç‚¹åç§°åè·Ÿç€ä¸€ä¸ªåºå·ï¼Œä¾‹å¦‚ï¼š&#x2F;myapp&#x2F;node00001ã€‚åœ¨åˆ†é…èŠ‚ç‚¹åç§°æ—¶ï¼ŒZookeeperä¼šæ ¹æ®èŠ‚ç‚¹ç¼–å·çš„å¤§å°æ¥æ’åºèŠ‚ç‚¹ã€‚</li></ul><ol start="2"><li>æ’åºæ–¹å¼ï¼š</li></ol><ul><li>æ— åºèŠ‚ç‚¹ï¼šèŠ‚ç‚¹æ— æ³•è¿›è¡Œæ’åºï¼Œåªèƒ½æ ¹æ®èŠ‚ç‚¹åç§°è¿›è¡ŒæŸ¥æ‰¾ã€‚</li><li>æœ‰åºèŠ‚ç‚¹ï¼šèŠ‚ç‚¹æ ¹æ®èŠ‚ç‚¹ç¼–å·çš„å¤§å°è¿›è¡Œæ’åºï¼Œå¯ä»¥é€šè¿‡èŠ‚ç‚¹çš„ç¼–å·æ¥æŸ¥æ‰¾èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯é€šè¿‡èŠ‚ç‚¹çš„åç§°ã€‚</li></ul><p>æœ‰åºèŠ‚ç‚¹åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¸¸ç”¨äºå®ç°é˜Ÿåˆ—æˆ–è€…é”ç­‰åŠŸèƒ½ï¼Œå› ä¸ºæœ‰åºèŠ‚ç‚¹æ€»æ˜¯èƒ½å¤Ÿä¿è¯æ‰§è¡Œçš„å…ˆåé¡ºåºã€‚è€Œæ— åºèŠ‚ç‚¹é€šå¸¸ç”¨äºå­˜å‚¨é…ç½®ä¿¡æ¯ç­‰ï¼Œå› ä¸ºä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œè¾ƒé¢‘ç¹ï¼Œä½¿ç”¨æœ‰åºèŠ‚ç‚¹ä¼šå¸¦æ¥ä¸€å®šçš„å¤æ‚åº¦ã€‚</p><h3 id="Springbooté›†æˆ"><a href="#Springbooté›†æˆ" class="headerlink" title="Springbooté›†æˆ"></a>Springbooté›†æˆ</h3><p>Curatoræ˜¯ä¸€ä¸ªZookeeperå®¢æˆ·ç«¯åº“ï¼Œæä¾›äº†ä¸€ç»„ç®€å•æ˜“ç”¨çš„APIï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´å®¹æ˜“åœ°ä¸Zookeeperè¿›è¡Œäº¤äº’ã€‚Curatorä¹Ÿæä¾›äº†ä¸€äº›å®ç”¨çš„ç‰¹æ€§ï¼Œä¾‹å¦‚é‡è¯•æœºåˆ¶ã€é€‰ä¸¾ã€åˆ†å¸ƒå¼é”ç­‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ„å»ºå¯é çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚</p><p>application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#åœ°å€å’Œç«¯å£å·</span><br><span class="hljs-attr">curator.zookeeper.address</span>=<span class="hljs-string">127.0.0.1:2181</span><br><span class="hljs-comment">#ä¼šè¯è¶…æ—¶æ—¶é—´ å•ä½ms</span><br><span class="hljs-attr">curator.zookeeper.session_timeout</span>=<span class="hljs-string">60000</span><br><span class="hljs-comment">#è¿æ¥è¶…æ—¶æ—¶é—´ å•ä½ms</span><br><span class="hljs-attr">curator.zookeeper.connection_timeout</span>=<span class="hljs-string">15000</span><br><span class="hljs-comment">#é»˜è®¤ä¸ºæ“ä½œçš„æ ¹èŠ‚ç‚¹ï¼Œä¸ºäº†å®ç°ä¸åŒçš„Zookeeperä¸šåŠ¡ä¹‹é—´çš„éš”ç¦»ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸºäºè¯¥ç›®å½•è¿›è¡Œçš„</span><br><span class="hljs-attr">curator.zookeeper.name_space</span>=<span class="hljs-string">beixian</span><br><span class="hljs-comment">#é‡è¯•é—´éš”æ—¶é—´</span><br><span class="hljs-attr">curator.zookeeper.base_sleep_time_ms</span>=<span class="hljs-string">3000</span><br><span class="hljs-comment">#é‡è¯•æ¬¡æ•°</span><br><span class="hljs-attr">curator.zookeeper.max_retries</span>=<span class="hljs-string">10</span><br></code></pre></td></tr></table></figure><p>CuratorConfig.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CuratorConfig</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;curator.zookeeper.address&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String zkAddress;<br>    <span class="hljs-meta">@Value(&quot;$&#123;curator.zookeeper.session_timeout&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> sessionTimeout;<br>    <span class="hljs-meta">@Value(&quot;$&#123;curator.zookeeper.connection_timeout&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> connectionTimeout;<br>    <span class="hljs-meta">@Value(&quot;$&#123;curator.zookeeper.name_space&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String nameSpace;<br>    <span class="hljs-meta">@Value(&quot;$&#123;curator.zookeeper.base_sleep_time_ms&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> baseSleepTimeMs;<br>    <span class="hljs-meta">@Value(&quot;$&#123;curator.zookeeper.max_retries&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxRetries;<br><br>    <span class="hljs-meta">@Bean(initMethod = &quot;start&quot;, destroyMethod = &quot;close&quot;)</span><br>    <span class="hljs-keyword">public</span> CuratorFramework <span class="hljs-title function_">curatorFramework</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">RetryPolicy</span> <span class="hljs-variable">retryPolicy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExponentialBackoffRetry</span>(baseSleepTimeMs, maxRetries);<br>        <span class="hljs-keyword">return</span> CuratorFrameworkFactory.builder()<br>                .connectString(zkAddress)<br>                .sessionTimeoutMs(sessionTimeout)<br>                .connectionTimeoutMs(connectionTimeout)<br>                .retryPolicy(retryPolicy)<br>                .namespace(nameSpace)<br>                .build();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h3><p>é€šè¿‡ä»¥ä¸‹å·¥å…·ç±»å®ç°å¯¹zookeeperèŠ‚ç‚¹çš„å¢åˆ æ”¹æŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZookeeperService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CuratorFramework client;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºæ°¸ä¹…ZookeeperèŠ‚ç‚¹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath  èŠ‚ç‚¹è·¯å¾„ï¼ˆå¦‚æœçˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼‰ï¼Œå¦‚ï¼š/curator</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodeValue èŠ‚ç‚¹æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›åˆ›å»ºæˆåŠŸçš„èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createPersistentNode</span><span class="hljs-params">(String nodePath, String nodeValue)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> client.create().creatingParentsIfNeeded().forPath(nodePath, nodeValue.getBytes());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;åˆ›å»ºæ°¸ä¹…ZookeeperèŠ‚ç‚¹å¤±è´¥,nodePath:&#123;&#125;,nodeValue:&#123;&#125;&quot;</span>, nodePath, nodeValue, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºæ°¸ä¹…æœ‰åºZookeeperèŠ‚ç‚¹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath  èŠ‚ç‚¹è·¯å¾„ï¼ˆå¦‚æœçˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼‰ï¼Œå¦‚ï¼š/curator</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodeValue èŠ‚ç‚¹æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›åˆ›å»ºæˆåŠŸçš„èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createSequentialPersistentNode</span><span class="hljs-params">(String nodePath, String nodeValue)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> client.create().creatingParentsIfNeeded()<br>                    .withMode(CreateMode.PERSISTENT_SEQUENTIAL)<br>                    .forPath(nodePath, nodeValue.getBytes());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;åˆ›å»ºæ°¸ä¹…æœ‰åºZookeeperèŠ‚ç‚¹å¤±è´¥,nodePath:&#123;&#125;,nodeValue:&#123;&#125;&quot;</span>, nodePath, nodeValue, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºä¸´æ—¶ZookeeperèŠ‚ç‚¹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath  èŠ‚ç‚¹è·¯å¾„ï¼ˆå¦‚æœçˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼‰ï¼Œå¦‚ï¼š/curator</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodeValue èŠ‚ç‚¹æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›åˆ›å»ºæˆåŠŸçš„èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createEphemeralNode</span><span class="hljs-params">(String nodePath, String nodeValue)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> client.create().creatingParentsIfNeeded()<br>                    .withMode(CreateMode.EPHEMERAL)<br>                    .forPath(nodePath, nodeValue.getBytes());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;åˆ›å»ºä¸´æ—¶ZookeeperèŠ‚ç‚¹å¤±è´¥,nodePath:&#123;&#125;,nodeValue:&#123;&#125;&quot;</span>, nodePath, nodeValue, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºä¸´æ—¶æœ‰åºZookeeperèŠ‚ç‚¹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath  èŠ‚ç‚¹è·¯å¾„ï¼ˆå¦‚æœçˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼‰ï¼Œå¦‚ï¼š/curator</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodeValue èŠ‚ç‚¹æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›åˆ›å»ºæˆåŠŸçš„èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@since</span> 1.0.0</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createSequentialEphemeralNode</span><span class="hljs-params">(String nodePath, String nodeValue)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> client.create().creatingParentsIfNeeded()<br>                    .withMode(CreateMode.EPHEMERAL_SEQUENTIAL)<br>                    .forPath(nodePath, nodeValue.getBytes());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;åˆ›å»ºä¸´æ—¶æœ‰åºZookeeperèŠ‚ç‚¹å¤±è´¥,nodePath:&#123;&#125;,nodeValue:&#123;&#125;&quot;</span>, nodePath, nodeValue, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ£€æŸ¥ZookeeperèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> boolean å¦‚æœå­˜åœ¨åˆ™è¿”å›true</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkExists</span><span class="hljs-params">(String nodePath)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> client.checkExists().forPath(nodePath);<br><br>            <span class="hljs-keyword">return</span> stat != <span class="hljs-literal">null</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;æ£€æŸ¥ZookeeperèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨å‡ºç°å¼‚å¸¸,nodePath:&#123;&#125;&quot;</span>, nodePath, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–æŸä¸ªZookeeperèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›æ‰€æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹å</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getChildren</span><span class="hljs-params">(String nodePath)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> client.getChildren().forPath(nodePath);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;è·å–æŸä¸ªZookeeperèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹å‡ºç°å¼‚å¸¸,nodePath:&#123;&#125;&quot;</span>, nodePath, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–æŸä¸ªZookeeperèŠ‚ç‚¹çš„æ•°æ®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getData</span><span class="hljs-params">(String nodePath)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(client.getData().forPath(nodePath));<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;è·å–æŸä¸ªZookeeperèŠ‚ç‚¹çš„æ•°æ®å‡ºç°å¼‚å¸¸,nodePath:&#123;&#125;&quot;</span>, nodePath, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®æŸä¸ªZookeeperèŠ‚ç‚¹çš„æ•°æ®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(String nodePath, String newNodeValue)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            client.setData().forPath(nodePath, newNodeValue.getBytes());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;è®¾ç½®æŸä¸ªZookeeperèŠ‚ç‚¹çš„æ•°æ®å‡ºç°å¼‚å¸¸,nodePath:&#123;&#125;&quot;</span>, nodePath, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤æŸä¸ªZookeeperèŠ‚ç‚¹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(String nodePath)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            client.delete().guaranteed().forPath(nodePath);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;åˆ é™¤æŸä¸ªZookeeperèŠ‚ç‚¹å‡ºç°å¼‚å¸¸,nodePath:&#123;&#125;&quot;</span>, nodePath, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * çº§è”åˆ é™¤æŸä¸ªZookeeperèŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteChildrenIfNeeded</span><span class="hljs-params">(String nodePath)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            client.delete().guaranteed().deletingChildrenIfNeeded().forPath(nodePath);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;çº§è”åˆ é™¤æŸä¸ªZookeeperèŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹å‡ºç°å¼‚å¸¸,nodePath:&#123;&#125;&quot;</span>, nodePath, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç›‘å¬èŠ‚ç‚¹å˜åŒ–</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> nodePath èŠ‚ç‚¹è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheListener</span><span class="hljs-params">(String nodePath, CuratorCacheListener listener)</span> &#123;<br>        <span class="hljs-comment">//1.åˆ›å»ºcuratorCacheå¯¹è±¡</span><br>        <span class="hljs-type">CuratorCache</span> <span class="hljs-variable">curatorCache</span> <span class="hljs-operator">=</span> CuratorCache.build(client, nodePath);<br>        <span class="hljs-comment">//2.æ³¨å†Œç›‘å¬å™¨</span><br>        curatorCache.listenable().addListener(listener);<br>        <span class="hljs-comment">//3.å¼€å¯ç›‘å¬ï¼štrueåŠ è½½ç¼“å†²æ•°æ®</span><br>        curatorCache.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç›‘å¬æ”¹åŠ¨"><a href="#ç›‘å¬æ”¹åŠ¨" class="headerlink" title="ç›‘å¬æ”¹åŠ¨"></a>ç›‘å¬æ”¹åŠ¨</h3><p>è¦é€šè¿‡Curatoræ¥ç›‘å¬Zookeeperä¸Šçš„ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨Curatoræä¾›çš„CuratorCacheç±»ã€‚CuratorCacheç±»å¯ä»¥ç›‘å¬ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨å¤„ç†èŠ‚ç‚¹çš„æ–°å¢ã€åˆ é™¤ã€æ›´æ–°ç­‰äº‹ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨CuratorCacheç±»ç›‘å¬Zookeeperä¸Šç›®å½•çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CuratorWatcher</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CuratorFramework curatorFramework;<br><br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/&quot;</span>;<br>        <span class="hljs-type">CuratorCache</span> <span class="hljs-variable">curatorCache</span> <span class="hljs-operator">=</span> CuratorCache.build(curatorFramework, path);<br>        curatorCache.listenable().addListener((type, childData, childData1) -&gt; &#123;<br>            <span class="hljs-keyword">switch</span> (type) &#123;<br>                <span class="hljs-keyword">case</span> NODE_CHANGED:<br>                    log.info(<span class="hljs-string">&quot;èŠ‚ç‚¹æ•°æ®ä¿®æ”¹&quot;</span>);<br>                    log.info(<span class="hljs-string">&quot;ä¿®æ”¹å‰çš„èŠ‚ç‚¹è·¯å¾„ï¼š&quot;</span> + childData.getPath());<br>                    log.info(<span class="hljs-string">&quot;ä¿®æ”¹å‰çš„èŠ‚ç‚¹æ•°æ®ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(childData.getData()));<br>                    log.info(<span class="hljs-string">&quot;ä¿®æ”¹åçš„èŠ‚ç‚¹è·¯å¾„ï¼š&quot;</span> + childData1.getPath());<br>                    log.info(<span class="hljs-string">&quot;ä¿®æ”¹åçš„èŠ‚ç‚¹æ•°æ®ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(childData1.getData()));<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> NODE_CREATED:<br>                    log.info(<span class="hljs-string">&quot;æ–°å¢èŠ‚ç‚¹&quot;</span>);<br>                    log.info(<span class="hljs-string">&quot;æ–°å¢èŠ‚ç‚¹çš„è·¯å¾„&quot;</span> + childData1.getPath());<br>                    log.info(<span class="hljs-string">&quot;æ–°å¢èŠ‚ç‚¹çš„æ•°æ®ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(childData1.getData()));<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> NODE_DELETED:<br>                    log.info(<span class="hljs-string">&quot;åˆ é™¤èŠ‚ç‚¹&quot;</span>);<br>                    log.info(<span class="hljs-string">&quot;åˆ é™¤èŠ‚ç‚¹çš„è·¯å¾„&quot;</span> + childData.getPath());<br>                    log.info(<span class="hljs-string">&quot;åˆ é™¤èŠ‚ç‚¹çš„æ•°æ®ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(childData.getData()));<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">default</span>:<br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;);<br>        curatorCache.start();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="ç®€å•å®ç°åˆ†å¸ƒå¼é”"><a href="#ç®€å•å®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="ç®€å•å®ç°åˆ†å¸ƒå¼é”"></a>ç®€å•å®ç°åˆ†å¸ƒå¼é”</h3><p>InterProcessMutexæ˜¯Zookeeperä¸­æä¾›çš„ä¸€ç§åˆ†å¸ƒå¼é”å®ç°æ–¹å¼ã€‚å®ƒåŸºäºZookeeperçš„æœ‰åºèŠ‚ç‚¹çš„ç‰¹æ€§å®ç°ï¼Œé€šè¿‡åœ¨Zookeeperä¸Šåˆ›å»ºä¸€ä¸ªæœ‰åºèŠ‚ç‚¹æ¥ä»£è¡¨é”ï¼Œå¹¶é€šè¿‡æ£€æŸ¥è¯¥èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨æ¥æ§åˆ¶é”çš„è·å–å’Œé‡Šæ”¾ã€‚</p><p>InterProcessMutexçš„ä¸»è¦æ–¹æ³•åŒ…æ‹¬ï¼š</p><ol><li>acquire()ï¼šè·å–é”ï¼Œå¦‚æœé”å¤„äºå¯ç”¨çŠ¶æ€ï¼Œåˆ™è·å–é”ï¼Œåœ¨é”è¢«é‡Šæ”¾ä¹‹å‰å°†ä¸€ç›´é˜»å¡ã€‚</li><li>acquire(long time, TimeUnit unit)ï¼šå°è¯•è·å–é”ï¼Œæœ€å¤šé˜»å¡æŒ‡å®šçš„æ—¶é—´ï¼Œå¦‚æœæˆåŠŸè·å–é”åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li><li>release()ï¼šé‡Šæ”¾é”ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æŒæœ‰é”ï¼Œåˆ™é‡Šæ”¾é”ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZookeeperLockService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CuratorFramework client;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lock</span><span class="hljs-params">(String path, <span class="hljs-type">long</span> timeMs)</span> &#123;<br>        <span class="hljs-type">InterProcessMutex</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterProcessMutex</span>(client, path);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> lock.acquire(timeMs, TimeUnit.MILLISECONDS);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(e.getMessage(), e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">(String path)</span> &#123;<br>        <span class="hljs-type">InterProcessMutex</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterProcessMutex</span>(client, path);<br>        <span class="hljs-keyword">try</span> &#123;<br>            lock.release();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(e.getMessage(), e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>zookeeper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java htmlè½¬pdf ä¸”è§£å†³ä¸­æ–‡ä¸æ˜¾ç¤ºé—®é¢˜</title>
    <link href="/2023/04/10/Java-html%E8%BD%ACpdf-%E4%B8%94%E8%A7%A3%E5%86%B3%E4%B8%AD%E6%96%87%E4%B8%8D%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/"/>
    <url>/2023/04/10/Java-html%E8%BD%ACpdf-%E4%B8%94%E8%A7%A3%E5%86%B3%E4%B8%AD%E6%96%87%E4%B8%8D%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p> è®°å½•ä¸€ä¸‹åˆ©ç”¨freemarker å°†htmlè½¬æ¢pdfçš„æ•™ç¨‹</p><p><strong>pom.xmlå¼•å…¥åŒ…</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.itextpdf/itextpdf --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itextpdf<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>itextpdf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.5.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.itextpdf.tool/xmlworker --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itextpdf.tool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xmlworker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.5.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.xhtmlrenderer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flying-saucer-pdf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>9.1.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf-itext5 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.xhtmlrenderer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flying-saucer-pdf-itext5<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>9.1.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br>        <span class="hljs-comment">&lt;!-- è§£å†³ä¸­æ–‡å­—ä½“é—®é¢˜ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itextpdf<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>itext-asian<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.freemarker/freemarker --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.19<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong>è§£å†³ä¸­æ–‡ä¸æ˜¾ç¤ºé—®é¢˜</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.express.excms.enroll.config;<br><br><span class="hljs-keyword">import</span> com.itextpdf.text.Font;<br><span class="hljs-keyword">import</span> com.itextpdf.text.pdf.BaseFont;<br><span class="hljs-keyword">import</span> com.itextpdf.tool.xml.XMLWorkerFontProvider;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by IntelliJ IDEA.</span><br><span class="hljs-comment"> * User: è´å…ˆ [ Cason mo ]</span><br><span class="hljs-comment"> * Date: 2021/11/12</span><br><span class="hljs-comment"> * Time: 14:46</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsianFontProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">XMLWorkerFontProvider</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Font <span class="hljs-title function_">getFont</span><span class="hljs-params">(String fontname, String encoding, <span class="hljs-type">float</span> size, <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> style)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">BaseFont</span> <span class="hljs-variable">bfChinese</span> <span class="hljs-operator">=</span>BaseFont.createFont( <span class="hljs-string">&quot;STSong-Light&quot;</span>, <span class="hljs-string">&quot;UniGB-UCS2-H&quot;</span>, BaseFont.EMBEDDED);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Font</span>(bfChinese, size, style);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getFont(fontname, encoding, size, style);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong>htmlè½¬pdf</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.express.excms.enroll.utils;<br><br><span class="hljs-keyword">import</span> com.express.excms.enroll.config.AsianFontProvider;<br><span class="hljs-keyword">import</span> com.itextpdf.text.Document;<br><span class="hljs-keyword">import</span> com.itextpdf.text.pdf.PdfWriter;<br><span class="hljs-keyword">import</span> com.itextpdf.tool.xml.XMLWorkerHelper;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by IntelliJ IDEA.</span><br><span class="hljs-comment"> * User: è´å…ˆ [ Cason mo ]</span><br><span class="hljs-comment"> * Date: 2021/10/18</span><br><span class="hljs-comment"> * Time: 10:54</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PDFUtils</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ByteArrayOutputStream pdfæ–‡ä»¶æµ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> htmlContent é€šè¿‡freemarkerç”Ÿæˆçš„html</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteArrayOutputStream <span class="hljs-title function_">htmlToPdf</span><span class="hljs-params">(String htmlContent)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();<br>        <span class="hljs-type">PdfWriter</span> <span class="hljs-variable">pdfWriter</span> <span class="hljs-operator">=</span> PdfWriter.getInstance(document, output);<br>        document.open();<br>        XMLWorkerHelper.getInstance().parseXHtml(pdfWriter,document,<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(htmlContent.getBytes(StandardCharsets.UTF_8)),<span class="hljs-literal">null</span>, StandardCharsets.UTF_8,<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsianFontProvider</span>());<br>        document.close();<br>        <span class="hljs-keyword">return</span> output;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å†™å…¥åˆ°æ–‡ä»¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> htmlContent é€šè¿‡freemarkerç”Ÿæˆçš„html</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> filePath è¦å†™å…¥çš„pdfæ–‡ä»¶åœ°å€</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">htmlToPdf</span><span class="hljs-params">(String htmlContent,String filePath)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();<br>        <span class="hljs-type">PdfWriter</span> <span class="hljs-variable">pdfWriter</span> <span class="hljs-operator">=</span> PdfWriter.getInstance(document, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(filePath));<br>        document.open();<br>        XMLWorkerHelper.getInstance().parseXHtml(pdfWriter,document,<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(htmlContent.getBytes(StandardCharsets.UTF_8)),<span class="hljs-literal">null</span>, StandardCharsets.UTF_8,<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsianFontProvider</span>());<br>        document.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong>freemarker è§£æå¹¶è·å–ç”Ÿæˆçš„html</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">        <span class="hljs-meta">@Autowired</span><br>        <span class="hljs-keyword">private</span> Configuration configuration;<br><br><br>......çœç•¥<br><br><br><br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">cfg</span> <span class="hljs-operator">=</span> (Configuration) configuration.clone();<br>        cfg.clearTemplateCache();<br>        <span class="hljs-type">Template</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Template</span>(templateInDB.getName(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(æœªæ¸²æŸ“çš„html), configuration);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> FreeMarkerTemplateUtils.processTemplateIntoString(t, è¦æ¸²æŸ“çš„æ•°æ®);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> PDFUtils.htmlToPdf(html);<br>            <span class="hljs-comment">//è·å–pdfçš„base64</span><br>            <span class="hljs-type">byte</span>[] bytes = byteArrayOutputStream.toByteArray();<br>       <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> ResponseResult.defaultFailed(e.getMessage());<br>        &#125;<br>    <br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong>æ•ˆæœå›¾</strong></p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304101743692.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼</title>
    <link href="/2023/04/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    <url>/2023/04/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ä¸€ä¸ªç°æœ‰çš„ç±»ä¸å¦ä¸€ä¸ªä¸å…¼å®¹çš„ç±»è¿›è¡ŒååŒå·¥ä½œã€‚é€‚é…å™¨æ¨¡å¼é€šè¿‡åˆ›å»ºä¸€ä¸ªä¸­é—´é€‚é…å™¨æ¥è¿æ¥ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿæ­£å¸¸åœ°åä½œã€‚</p><p>é€‚é…å™¨æ¨¡å¼é€‚ç”¨äºéœ€è¦å°†ä¸å…¼å®¹çš„ç±»æˆ–æ¥å£è¿›è¡Œé€‚é…çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªæ—§ç‰ˆ API ç³»ç»Ÿä¸æ–°ç‰ˆçš„å®¢æˆ·ç«¯è¿›è¡Œé›†æˆæ—¶ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†ä¸¤ç§ä¸åŒçš„æ¥å£è¿›è¡Œé€‚é…ã€‚é€‚é…å™¨æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å¯ä»¥å¤ç”¨ç°æœ‰çš„ä»£ç ï¼Œå‡å°‘ä»£ç çš„ä¿®æ”¹å’Œé‡æ„ï¼Œä»è€Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ã€‚ä½†æ˜¯ï¼Œé€‚é…å™¨æ¨¡å¼ä¹Ÿä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œéœ€è¦é¢å¤–çš„é€‚é…å™¨ç±»æ¥åè°ƒä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£ï¼Œåœ¨è®¾è®¡æ—¶éœ€è¦æ…é‡è€ƒè™‘å…¶ä½¿ç”¨åœºæ™¯å’Œå½±å“ã€‚</p><h3 id="ç®€å•å®ç°"><a href="#ç®€å•å®ç°" class="headerlink" title="ç®€å•å®ç°"></a>ç®€å•å®ç°</h3><p><strong>å¤§æ¦‚çš„æ„æ€å›¾</strong><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304101732677.png" alt="æ„æ€å›¾"></p><p><strong>è¿™æ˜¯å½±åƒæ•°æ®è¾“å‡ºæ¥å£</strong>ï¼ˆåªè¾“å‡ºæ•°æ®å•Š ä¸è´Ÿè´£æ˜¾ç¤ºï¼ï¼ï¼ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IComputerOuputContent</span> &#123;<br>    String <span class="hljs-title function_">toDisplayData</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p> <strong>é€‚é…å™¨æ¥å£ç±»</strong>ï¼ˆæ•°æ®è½¬æ¢å™¨æ¥å£ç±»ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IVideoAdapter</span> &#123;<br>    String <span class="hljs-title function_">convertData</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è¾“å‡ºæ•°æ®æ¥å£å®ç°ç±»</strong>  ç”µè„‘</p><p> ä¸€å°ç”µè„‘implementså¾ˆå¤šæ¥å£  æ¯”å¦‚å„ç§è¾“å…¥æ¥å£ï¼ˆé”®ç›˜è¾“å…¥æ¥å£ é¼ æ ‡è¾“å…¥æ¥å£ï¼‰  è¾“å‡ºæ¥å£ ï¼ˆæ˜¾ç¤ºå±å†…å®¹è¾“å‡ºæ¥å£ éŸ³é¢‘è¾“å‡ºæ¥å£ï¼‰</p><p> å½“ç„¶æˆ‘è¿™é‡Œåªå®ç°äº†å½±åƒè¾“å‡ºæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IComputerOuputContent</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toDisplayData</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//ç»™æ˜¾ç¤ºå™¨çš„æ•°æ® æ˜¾ç¤ºå™¨æ— æ³•ç†è§£çš„</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1101010101010101010&quot;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p> <strong>é€‚é…å™¨ç±»</strong>   å°±æ˜¯æŠŠç”µè„‘ç»™çš„æ•°æ®è½¬åŒ–ä¸ºå›¾åƒçš„ä¸œä¸œ</p><p> computerï¼ˆç”µè„‘ï¼‰è¾“å‡ºçš„<code>1101010101010101010</code>æ˜¯ Displayerï¼ˆæ˜¾ç¤ºå™¨ï¼‰ä¸èƒ½ç›´æ¥æ˜¾ç¤ºçš„å†…å®¹</p><p> adapterï¼ˆé€‚é…å™¨ï¼‰ åº”è¿è€Œç”Ÿ  è¿™ä¸ªadapteræ˜¯å¯ä»¥åšå¾ˆå¤šäº‹æƒ…çš„  ä½†æ˜¯æˆ‘åªå®ç°äº†IVideoAdapterï¼ˆå½±åƒæ•°æ®é€‚é…ï¼ˆè½¬æ¢ï¼‰åŠŸèƒ½ï¼‰ å½“ç„¶ä½ è¿˜å¯ä»¥implementsåˆ«çš„åŠŸèƒ½ï¼ŒAdapterï¼ˆé€‚é…å™¨ï¼‰è´Ÿè´£æŠŠcomputerï¼ˆç”µè„‘ï¼‰è¾“å‡ºçš„æ•°æ®è§£ç æˆDisplayerï¼ˆæ˜¾ç¤ºå™¨ï¼‰èƒ½ç†è§£çš„ç¼–ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Adapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Computer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVideoAdapter</span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ­¤å¤„è¿›è¡Œé€‚é…(æ•°æ®è½¬æ¢)</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * æ”¹å†™é€‚é…å™¨convertDataæ¥å£  æ‰§è¡Œè§£ç </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">convertData</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * è·å–Computerç»™çš„æ•°æ®</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">displayData</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.toDisplayData();<br>        <span class="hljs-comment">//æ­¤å¤„æ­£åœ¨åŠªåŠ›è½¬æ¢æˆæ˜¾ç¤ºå™¨èƒ½æ¥å—çš„æ•°æ®ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚å‡è£…åœ¨è§£ç </span><br>        displayData = displayData.replace(<span class="hljs-string">&quot;1101010101&quot;</span>, <span class="hljs-string">&quot;ä½ &quot;</span>)<br>                .replace(<span class="hljs-string">&quot;010101010&quot;</span>, <span class="hljs-string">&quot;å¥½&quot;</span>);<br>        <span class="hljs-keyword">return</span> displayData;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æ˜¾ç¤ºå™¨ç±»</strong></p><p>è¾“å‡ºè½¬æ¢åDisplayerï¼ˆæ˜¾ç¤ºå™¨ï¼‰èƒ½ç†è§£çš„ç¼–ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Displayer</span> &#123;<br><br>    <span class="hljs-keyword">private</span> IVideoAdapter videoAdapter;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç»™æ˜¾ç¤ºå™¨åŠ ä¸ªå½±åƒæ•°æ®é€‚é…ï¼ˆè½¬æ¢ï¼‰å™¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> videoAdapter</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVideoAdapter</span><span class="hljs-params">(IVideoAdapter videoAdapter)</span> &#123;<br>        <span class="hljs-built_in">this</span>.videoAdapter = videoAdapter;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ˜¾ç¤ºå†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">view</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(videoAdapter.convertData());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>mainæ–¹æ³•æµ‹è¯•ä¸€ä¸‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * å®ä¾‹åŒ–æ˜¾ç¤ºå™¨</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">Displayer</span> <span class="hljs-variable">displayer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Displayer</span>();<br>        displayer.setVideoAdapter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Adapter</span>());<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * æŠŠæ•°æ®è½¬æ¢å™¨æ¥å…¥æ˜¾ç¤ºå™¨</span><br><span class="hljs-comment">         * æ˜¾ç¤ºå™¨æ˜¾ç¤ºå†…å®¹</span><br><span class="hljs-comment">         */</span><br>        displayer.view();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå†…å®¹</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304102055869.png" alt="image-20230410205458740"></p><p>æ‡’å¾—æ•²ä»£ç çš„äººå¯ä»¥åˆ°è¿™é‡Œä¸‹è½½<a href="https://download.csdn.net/download/Mo_0214/12536851">https://download.csdn.net/download/Mo_0214/12536851</a></p>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo-PicGo+Githubé…ç½®å›¾åºŠ</title>
    <link href="/2023/04/10/hexo-PicGo-Github%E9%85%8D%E7%BD%AE%E5%9B%BE%E5%BA%8A/"/>
    <url>/2023/04/10/hexo-PicGo-Github%E9%85%8D%E7%BD%AE%E5%9B%BE%E5%BA%8A/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ PicGo å°†å›¾ç‰‡ä¸Šä¼ åˆ° Github ä»“åº“ä½œä¸ºå›¾åºŠï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><p>åœ¨ Github ä¸Šåˆ›å»ºä¸€ä¸ªå…¬å¼€ä»“åº“ï¼Œç”¨äºå­˜æ”¾å›¾ç‰‡ã€‚ä»“åº“åç§°å¯ä»¥è‡ªå®šä¹‰ï¼Œå»ºè®®å–ä¸€ä¸ªç®€å•æ˜äº†çš„åç§°ï¼Œæ¯”å¦‚ <code>pic-go</code>ã€‚</p></li><li><p>åœ¨æœ¬åœ°å®‰è£… PicGoï¼Œå¹¶åœ¨è®¾ç½®ä¸­é€‰æ‹© Github ä½œä¸ºä¸Šä¼ æ–¹å¼ã€‚</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304100345581.png" alt="image-20230410034338520"></p></li><li><p>åˆ›å»ºä¸€ä¸ª Github tokenï¼Œç”¨äºè®¿é—® Github ä»“åº“ã€‚åœ¨ Github ä¸­è¿›å…¥ <code>Settings</code> -&gt; <code>Developer settings</code> -&gt; <code>Personal access tokens</code>ï¼Œç‚¹å‡» <code>Generate new token</code> æŒ‰é’®ï¼ŒæŒ‰ç…§æç¤ºå¡«å†™ token çš„åç§°å’Œæƒé™ï¼Œå¹¶ç‚¹å‡» <code>Generate token</code> æŒ‰é’®ç”Ÿæˆ tokenã€‚å¤åˆ¶ token çš„å€¼ï¼Œç„¶ååœ¨ PicGo çš„è®¾ç½®ä¸­å°†å…¶ç²˜è´´åˆ° <code>Token</code> ä¸­ã€‚</p></li><li><p>ä¸Šä¼ å›¾ç‰‡</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304100346131.png" alt="image-20230410034508553">ä¸Šä¼ å®Œæˆåï¼ŒPicGo ä¼šè‡ªåŠ¨å°†å›¾ç‰‡çš„è®¿é—®é“¾æ¥å¤åˆ¶åˆ°å‰ªè´´æ¿ä¸­ï¼Œå¯ä»¥ç›´æ¥å°†é“¾æ¥ç²˜è´´åˆ°éœ€è¦ä½¿ç”¨å›¾ç‰‡çš„åœ°æ–¹ã€‚</p></li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGithub æœ‰ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œå•ä¸ªæ–‡ä»¶ä¸èƒ½è¶…è¿‡ 100 MBï¼Œæ€»å¤§å°ä¸èƒ½è¶…è¿‡ 1 GBã€‚å¦å¤–ï¼Œä¸Šä¼ çš„å›¾ç‰‡ä¼šå ç”¨ Github çš„å­˜å‚¨ç©ºé—´ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œç®¡ç†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo-ä¼˜åŒ–seo</title>
    <link href="/2023/04/10/Hexo-%E4%BC%98%E5%8C%96seo/"/>
    <url>/2023/04/10/Hexo-%E4%BC%98%E5%8C%96seo/</url>
    
    <content type="html"><![CDATA[<h4 id="Sitemap"><a href="#Sitemap" class="headerlink" title="Sitemap"></a>Sitemap</h4><p>Sitemapæ˜¯ä¸€ç§åŒ…å«ç½‘ç«™æ‰€æœ‰é¡µé¢URLçš„XMLæ–‡ä»¶ï¼Œæœ‰åŠ©äºæœç´¢å¼•æ“æ›´å¿«åœ°ç´¢å¼•å’Œå‘ç°æ‚¨çš„ç½‘ç«™ã€‚ä»¥ä¸‹æ˜¯åœ¨Hexoä¸­ä½¿ç”¨Sitemapä¼˜åŒ–SEOçš„æ­¥éª¤ï¼š</p><ol><li>å®‰è£…hexo-generator-sitemapæ’ä»¶ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-generator-sitemap --save<br></code></pre></td></tr></table></figure><ol><li>åœ¨Hexoé…ç½®æ–‡ä»¶_config.ymlä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sitemap:</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">sitemap.xml</span><br>  <span class="hljs-attr">exclude:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/404.html</span><br>  <span class="hljs-attr">lastmod:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">priority:</span> <span class="hljs-number">0.8</span><br>  <span class="hljs-attr">changefreq:</span> <span class="hljs-string">weekly</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>path</code>æ˜¯Sitemapæ–‡ä»¶çš„ç”Ÿæˆè·¯å¾„ï¼›<code>exclude</code>æ˜¯è¦æ’é™¤çš„é¡µé¢åˆ—è¡¨ï¼›<code>lastmod</code>ç”¨äºåœ¨Sitemapä¸­åŒ…å«æœ€åä¿®æ”¹æ—¶é—´ï¼›<code>priority</code>è¡¨ç¤ºé¡µé¢çš„é‡è¦æ€§ï¼Œå€¼çš„èŒƒå›´ä¸º0.0åˆ°1.0ï¼›<code>changefreq</code>è¡¨ç¤ºé¡µé¢æ›´æ–°é¢‘ç‡ã€‚</p><ol><li>ç”ŸæˆSitemapã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨Hexoä¸­ç”ŸæˆSitemapæ–‡ä»¶ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo generate --deploy<br></code></pre></td></tr></table></figure><p>è¿™å°†ç”ŸæˆSitemapæ–‡ä»¶å¹¶å°†å…¶éƒ¨ç½²åˆ°æ‚¨çš„ç½‘ç«™ç›®å½•ä¸‹ã€‚</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304100235786.png" alt="image-20230410022647919"></p><ol><li>æäº¤Sitemapåˆ°æœç´¢å¼•æ“ã€‚å°†Sitemapæ–‡ä»¶æäº¤åˆ°Google Search Consoleå’ŒBing Webmaster Toolsç­‰æœç´¢å¼•æ“å·¥å…·ä¸­ï¼Œä»¥å¸®åŠ©æœç´¢å¼•æ“æ›´å¿«åœ°å‘ç°å’Œç´¢å¼•æ‚¨çš„ç½‘ç«™ã€‚</li></ol><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304100224631.png" alt="image-20230410022410719"></p><p>é€šè¿‡ä½¿ç”¨Sitemapï¼Œæ‚¨å¯ä»¥ç¡®ä¿æœç´¢å¼•æ“å¯ä»¥æ‰¾åˆ°æ‚¨çš„ç½‘ç«™çš„æ‰€æœ‰é¡µé¢ï¼Œå¹¶æ›´å¥½åœ°ç†è§£æ‚¨ç½‘ç«™çš„ç»“æ„å’Œå†…å®¹ï¼Œä»è€Œæé«˜æ‚¨çš„ç½‘ç«™åœ¨æœç´¢ç»“æœä¸­çš„æ’åã€‚</p><h4 id="Robots-txt"><a href="#Robots-txt" class="headerlink" title="Robots.txt"></a>Robots.txt</h4><p>Robots æ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç”¨äºå‘æœç´¢å¼•æ“æŒ‡ç¤ºå“ªäº›é¡µé¢å¯ä»¥è®¿é—®å’Œç´¢å¼•ï¼Œå“ªäº›é¡µé¢åº”è¯¥è¢«å¿½ç•¥ã€‚é€šè¿‡ä¼˜åŒ– Robots æ–‡ä»¶ï¼Œå¯ä»¥æé«˜æ‚¨çš„ç½‘ç«™åœ¨æœç´¢å¼•æ“ä¸­çš„æ’åå’Œæ›å…‰åº¦ã€‚</p><p>åœ¨ Hexo ä¸­ä½¿ç”¨ Robots æ–‡ä»¶è¿›è¡Œ SEO ä¼˜åŒ–ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p><ol><li>åœ¨ Hexo æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>robots.txt</code> çš„æ–‡ä»¶ã€‚</li><li>æ‰“å¼€ <code>robots.txt</code> æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</li></ol><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile">makefileCopy code<br><span class="hljs-section">User-agent: *</span><br><span class="hljs-section">Disallow:</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>User-agent: *</code> è¡¨ç¤ºå…è®¸æ‰€æœ‰æœç´¢å¼•æ“è®¿é—®æ‚¨çš„ç½‘ç«™ï¼Œ<code>Disallow:</code> è¡¨ç¤ºå…è®¸æœç´¢å¼•æ“è®¿é—®æ‚¨çš„ç½‘ç«™ä¸­æ‰€æœ‰é¡µé¢å’Œæ–‡ä»¶ã€‚</p><ol><li>å¦‚æœæ‚¨éœ€è¦ç¦æ­¢æŸäº›æœç´¢å¼•æ“è®¿é—®æ‚¨çš„ç½‘ç«™ï¼Œè¯·æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</li></ol><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">makefileCopy</span> <span class="hljs-selector-tag">code</span><br><span class="hljs-selector-tag">User-agent</span>: <span class="hljs-selector-attr">[æœç´¢å¼•æ“åç§°]</span><br><span class="hljs-selector-tag">Disallow</span>: /<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>[æœç´¢å¼•æ“åç§°]</code> è¡¨ç¤ºæ‚¨è¦ç¦æ­¢è®¿é—®çš„æœç´¢å¼•æ“åç§°ï¼Œ<code>Disallow: /</code> è¡¨ç¤ºç¦æ­¢è¯¥æœç´¢å¼•æ“è®¿é—®æ‚¨çš„ç½‘ç«™ä¸­æ‰€æœ‰é¡µé¢å’Œæ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³ç¦æ­¢ Google è®¿é—®æ‚¨çš„ç½‘ç«™ï¼Œå¯ä»¥å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° <code>robots.txt</code> æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile">makefileCopy code<br><span class="hljs-section">User-agent: Googlebot</span><br><span class="hljs-section">Disallow: /</span><br></code></pre></td></tr></table></figure><ol><li>ä¿å­˜å¹¶ä¸Šä¼  <code>robots.txt</code> æ–‡ä»¶åˆ°æ‚¨çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹ã€‚</li><li>ä½¿ç”¨ Google Search Console çš„ Robots.txt æ£€æŸ¥å·¥å…·ï¼Œæ£€æŸ¥æ‚¨çš„ Robots æ–‡ä»¶æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼Œå¹¶ä¸”æ˜¯å¦è¢«æ­£ç¡®è§£æã€‚</li></ol><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304100227739.png" alt="image-20230410022631870"></p><p>æ³¨æ„ï¼šRobots æ–‡ä»¶å¯ä»¥å¸®åŠ©æ‚¨ä¼˜åŒ– SEOï¼Œä½†æ˜¯ä¹Ÿéœ€è¦è°¨æ…ä½¿ç”¨ã€‚è¯·ç¡®ä¿æ‚¨äº†è§£ Robots æ–‡ä»¶çš„è§„åˆ™å’Œç”¨æ³•ï¼Œä»¥é¿å…å‡ºç°æ„å¤–çš„é—®é¢˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlç´¢å¼•</title>
    <link href="/2023/04/10/Mysql%E7%B4%A2%E5%BC%95/"/>
    <url>/2023/04/10/Mysql%E7%B4%A2%E5%BC%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åŸºäºInnodbå­˜å‚¨å¼•æ“ç¼–å†™ï¼Œå›¾æº+æ€»ç»“è‡ªã€Šmysqlæ˜¯æ€æ ·è¿è¡Œçš„ã€‹</p></blockquote><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>MySQLç´¢å¼•æ˜¯MySQLæ•°æ®åº“ä¸­çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¿«é€ŸæŸ¥è¯¢æ•°æ®ã€‚å®ƒç±»ä¼¼äºä¹¦çš„ç´¢å¼•ï¼Œå¯ä»¥è®©æ‚¨å¿«é€Ÿæ‰¾åˆ°ç‰¹å®šçš„æ•°æ®è¡Œï¼Œè€Œæ— éœ€éå†æ•´ä¸ªæ•°æ®è¡¨ã€‚</p><p>ç´¢å¼•æ˜¯é€šè¿‡åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ä¸Šåˆ›å»ºä¸€ä¸ªæ•°æ®ç»“æ„æ¥å®ç°çš„ã€‚å½“æŸ¥è¯¢éœ€è¦ä½¿ç”¨ç´¢å¼•çš„åˆ—æ—¶ï¼ŒMySQLä¼šä½¿ç”¨ç´¢å¼•çš„æ•°æ®ç»“æ„æ¥å¿«é€Ÿå®šä½å’Œæ£€ç´¢ç›¸åº”çš„æ•°æ®è¡Œã€‚è¿™ç§æ–¹å¼æ¯”å…¨è¡¨æ‰«æè¦å¿«å¾—å¤šï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§å‹æ•°æ®è¡¨ä¸­æŸ¥è¯¢æ•°æ®æ—¶ï¼Œç´¢å¼•çš„æ€§èƒ½ä¼˜åŠ¿éå¸¸æ˜æ˜¾ã€‚</p><h3 id="B-æ ‘ç´¢å¼•"><a href="#B-æ ‘ç´¢å¼•" class="headerlink" title="B+æ ‘ç´¢å¼•"></a>B+æ ‘ç´¢å¼•</h3><p>mysqlé€šè¿‡æ•°æ®é¡µè¿›è¡Œå­˜å‚¨æ•°æ®ï¼Œå¦‚ä¸‹å›¾ç»“æ„ï¼Œæ¯ä¸ªæ•°æ®é¡µä¹‹é—´çš„ç»“æ„æ˜¯åŒå‘é“¾è¡¨ï¼Œå•ä¸ªæ•°æ®é¡µå†…çš„è®°å½•æ˜¯é€šè¿‡å•å‘é“¾æ¥æ ¹æ®ä¸»é”®ä»å°åˆ°å¤§ä¸²è¿</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304102034269.png" alt="image-20230410193826228"></p><p>æ¯ä¸ªæ•°æ®é¡µä¼šä¸ºé‡Œé¢çš„è®°å½•ç”Ÿæˆé¡µç›®å½•ï¼ˆæ§½ç»„æˆé¡µç›®å½•ï¼‰</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304102034284.png" alt="image-20230410195931662"></p><p>å¦‚æœæ˜¯æ ¹æ®ä¸»é”®ï¼ˆæœ‰åºå­˜å‚¨è¿›æ•°æ®é¡µï¼‰æŸ¥æ‰¾æ˜¯é€šè¿‡äºŒåˆ†å¿«é€Ÿå®šä½ç„¶åéå†æ§½ï¼ˆ4-8æ¡è®°å½•ç»„åˆä¸€ä¸ªæ§½ï¼‰å†…è®°å½•ä¼šæ¯”è¾ƒå¿«ã€‚ä½†æ˜¯å¦‚æœä¸æ˜¯ä¸»é”®çš„å­—æ®µï¼ˆä¸”ä¸æ˜¯ç´¢å¼•ï¼‰è¿™ç§æƒ…å†µä¸‹åªèƒ½æŒ‰ä¸»é”®é¡ºåºæŠŠæ¯ä¸ªæ•°æ®é¡µä» æœ€å°è®°å½• å¼€å§‹ä¾æ¬¡éå†å•é“¾è¡¨ä¸­çš„æ¯æ¡è®°å½•ã€‚</p><p>Innodbä½¿ç”¨ <code>ç›®å½•é¡¹çºªå½•</code> æ¥å®ç°ç´¢å¼•ï¼Œ<code>ç›®å½•é¡¹çºªå½•</code>é‡Œåªå­˜å‚¨ä¸»é”®+æ•°æ®é¡µå·ï¼Œç›®å½•é¡¹çºªå½•è¿˜æœ‰æ›´é¡¶å±‚çš„ç›®å½•é¡¹çºªå½•ï¼Œç›´è‡³æ ¹èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304102034015.png" alt="image-20230410193422059"></p><p>å¶å­ç»“ç‚¹å­˜æ”¾ç”¨æˆ·è®°å½•ï¼Œéå¶å­ç»“ç‚¹ï¼ˆå†…ç»“ç‚¹ï¼‰å­˜æ”¾ç›®å½•é¡¹</p><h4 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h4><p>èšç°‡ç´¢å¼•æ ¹æ®ä¸»é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼Œç›®å½•é¡¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼å’Œæ•°æ®é¡µå·ï¼Œå¶å­ç»“ç‚¹è®°å½•çš„æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚ä¸éœ€è¦æ˜¾å¼çš„ä½¿ç”¨Indexå»åˆ›å»ºï¼ŒInnodbä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºã€‚</p><p>éå¶å­ç»“ç‚¹ï¼ˆç›®å½•é¡¹è®°å½•ï¼‰ï¼šä¸»é”® - æ•°æ®é¡µå·</p><p>å¶å­ç»“ç‚¹ï¼ˆç´¢å¼•è®°å½•ï¼‰ï¼šä¸»é”® - å®Œæ•´ç”¨æˆ·è®°å½•</p><h4 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h4><p>äºŒçº§ç´¢å¼•æ ¹æ®ç´¢å¼•é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼Œéå¶å­ç»“ç‚¹è®°å½•ç´¢å¼•é”®å€¼å’Œæ•°æ®é¡µå·ï¼Œå¶å­ç»“ç‚¹åªè®°å½•ç´¢å¼•é”®å€¼å’Œä¸»é”®å€¼ã€‚äºŒçº§ç´¢å¼•æŸ¥è¯¢åˆ°ä¸»é”®åéœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œè·å–å®Œæ•´è®°å½•ã€‚ï¼ˆå†å¼€äº†ä¸€ä¸ªb+æ ‘ï¼‰</p><p>éå¶å­ç»“ç‚¹ï¼ˆç›®å½•é¡¹è®°å½•ï¼‰ï¼šç´¢å¼•åˆ— - æ•°æ®é¡µå·</p><p>å¶å­ç»“ç‚¹ï¼ˆç´¢å¼•è®°å½•ï¼‰ï¼šç´¢å¼•åˆ— - ä¸»é”®</p><h4 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h4><p>è”åˆç´¢å¼•æ˜¯æŒ‰ç…§å®šä¹‰çš„ç´¢å¼•åˆ—é¡ºåºæ’åºï¼Œå¯¹äºç›¸åŒçš„ç´¢å¼•åˆ—ï¼Œå†æŒ‰ç…§å…¶ç´¢å¼•é”®å€¼çš„å¤§å°è¿›è¡Œæ’åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç´¢å¼•å»ºç«‹ä¹‹æ—¶ï¼Œå®šä¹‰çš„ç´¢å¼•åˆ—é¡ºåºå°±å¯¹åº”äº†ç´¢å¼•çš„æ’åºæ–¹å¼ï¼ŒæŒ‰ç…§å®ƒä»¬å®šä¹‰çš„é¡ºåºæ’åºï¼Œä»¥è¾¾åˆ°æœ€ä¼˜çš„æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>å¯¹äºéå¶å­ç»“ç‚¹ï¼Œå®ƒä»¬æŒ‰ç…§ç´¢å¼•åˆ—çš„é¡ºåºè®°å½•ç€å­ç»“ç‚¹çš„ç´¢å¼•é”®å€¼å’Œæ•°æ®é¡µå·ï¼Œç´¢å¼•é”®å€¼ç”¨äºæŒ‡ç¤ºè¦æŸ¥æ‰¾çš„æ•°æ®åº”è¯¥è½åœ¨å“ªä¸ªå­ç»“ç‚¹ä¸­ï¼Œæ•°æ®é¡µå·åˆ™ç”¨äºæŒ‡ç¤ºå­˜å‚¨è¯¥å­ç»“ç‚¹ä¸­æ•°æ®çš„æ•°æ®é¡µã€‚</p><p>å¯¹äºå¶å­ç»“ç‚¹ï¼Œå®ƒä»¬ä¹ŸæŒ‰ç…§ç´¢å¼•åˆ—çš„é¡ºåºè®°å½•ç€ç´¢å¼•é”®å€¼å’Œä¸»é”®å€¼ï¼Œç´¢å¼•é”®å€¼ç”¨äºæŸ¥è¯¢æ“ä½œä¸­å®šä½åˆ°å¶å­ç»“ç‚¹ï¼Œè€Œä¸»é”®å€¼åˆ™ç”¨äºè·å–å®Œæ•´çš„æ•°æ®è¡Œã€‚</p><p>è”åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€é›†åˆã€‚</p><p>éå¶å­ç»“ç‚¹ï¼ˆç›®å½•é¡¹è®°å½•ï¼‰ï¼šAç´¢å¼•åˆ— - Bç´¢å¼•åˆ— - æ•°æ®é¡µå·</p><p>å¶å­ç»“ç‚¹ï¼ˆç´¢å¼•è®°å½•ï¼‰ï¼šAç´¢å¼•åˆ— - Bç´¢å¼•åˆ— - ä¸»é”®</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p><strong>å­—ç¬¦ä¸²ç´¢å¼•åŸç†</strong></p><p>åœ¨B-treeç´¢å¼•ä¸­ï¼ŒMySQLå°†æ¯ä¸ªå­—ç¬¦ä¸²å€¼éƒ½åˆ†è§£æˆä¸€ç»„å‰ç¼€ï¼Œç„¶åå°†è¿™äº›å‰ç¼€ä½œä¸ºç´¢å¼•çš„é”®å€¼ã€‚è¿™äº›å‰ç¼€å¯ä»¥æ˜¯å›ºå®šé•¿åº¦çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯å˜é•¿åº¦çš„ï¼Œå…·ä½“å–å†³äºç´¢å¼•å®šä¹‰çš„é•¿åº¦ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªåä¸º<code>mytable</code>çš„è¡¨çš„<code>name</code>åˆ—ä¸Šåˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º10çš„ç´¢å¼•ï¼Œé‚£ä¹ˆMySQLå°†å¯¹æ¯ä¸ª<code>name</code>å€¼æå–å‰10ä¸ªå­—ç¬¦ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç´¢å¼•æ ‘ä¸­ã€‚æŸ¥è¯¢æ—¶ï¼ŒMySQLå¯ä»¥ä½¿ç”¨è¿™ä¸ªç´¢å¼•å¿«é€ŸæŸ¥æ‰¾åŒ¹é…çš„è®°å½•ã€‚</p><p>ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æƒè¡¡ç´¢å¼•é•¿åº¦å’ŒæŸ¥è¯¢æ•ˆç‡ã€‚å¦‚æœç´¢å¼•é•¿åº¦è¿‡é•¿ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ç´¢å¼•æ ‘å˜å¾—æ›´å¤§ï¼Œæ›´æ…¢ï¼Œç”šè‡³ä¼šå½±å“åˆ°æŸ¥è¯¢æ€§èƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µæ¥ç¡®å®šç´¢å¼•é•¿åº¦ï¼Œä»¥å¹³è¡¡æŸ¥è¯¢æ•ˆç‡å’Œå­˜å‚¨ç©ºé—´çš„åˆ©ç”¨ç‡ã€‚</p><p>æŸ¥è¯¢æ—¶MySQL ä¼šå°†å­—ç¬¦ä¸²æŒ‰ç…§å­—ç¬¦é›†çš„æ’åºè§„åˆ™è¿›è¡Œæ¯”è¾ƒ</p>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Msqlé”æœºåˆ¶</title>
    <link href="/2023/04/09/Msql%E9%94%81%E6%9C%BA%E5%88%B6/"/>
    <url>/2023/04/09/Msql%E9%94%81%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<p>MySQLé”æœºåˆ¶æ˜¯ä¸ºäº†ä¿è¯å¹¶å‘æ“ä½œçš„æ•°æ®ä¸€è‡´æ€§è€Œè®¾è®¡çš„ã€‚åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªäº‹åŠ¡åŒæ—¶è®¿é—®åŒä¸€æ•°æ®ï¼Œå¦‚æœä¸åŠ æ§åˆ¶ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</p><p>MySQLçš„é”å¯ä»¥åˆ†ä¸ºè¡Œçº§é”å’Œè¡¨çº§é”ã€‚</p><ol><li><p>è¡Œçº§é”ï¼šåœ¨å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼ŒMySQLä¼šè‡ªåŠ¨åŠ ä¸Šè¡Œçº§é”ï¼Œè¯¥é”åªé’ˆå¯¹ä¿®æ”¹çš„è¡Œæœ‰æ•ˆï¼Œå…¶ä»–è¡Œä¸å—å½±å“ã€‚è¡Œçº§é”çš„ä¼˜ç‚¹æ˜¯ç²¾åº¦é«˜ï¼Œç¼ºç‚¹æ˜¯å ç”¨èµ„æºå¤šï¼Œå®¹æ˜“é€ æˆæ­»é”ã€‚InnoDBè¡Œé”æ˜¯é€šè¿‡ç»™ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é” æ¥å®ç°çš„ï¼Œæ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼ŒInnoDBä»ç„¶å¯ä»¥ä½¿ç”¨è¡Œçº§é”ã€‚ä¸è¿‡ï¼Œç”±äºåœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹éœ€è¦æ‰«ææ•´ä¸ªè¡¨ï¼Œå› æ­¤ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè¾ƒå¤§çš„å½±å“ï¼ŒåŒæ—¶ä¼šå°†é”å®šä½œç”¨äºæ•´ä¸ªè¡¨ï¼Œä»è€Œå½±å“å¹¶å‘æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§</p><p>ä½¿ç”¨è¡Œçº§é”å®šçš„ä¸»è¦æ˜¯ <code>InnoDB</code> å­˜å‚¨å¼•æ“ã€‚</p></li><li><p>è¡¨çº§é”ï¼šåœ¨å¯¹æ•´ä¸ªè¡¨è¿›è¡Œæ“ä½œæ—¶ï¼ŒMySQLä¼šè‡ªåŠ¨åŠ ä¸Šè¡¨çº§é”ï¼Œè¯¥é”å¯ä»¥é˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹è¯¥è¡¨ã€‚è¡¨çº§é”çš„ä¼˜ç‚¹æ˜¯ç®€å•é«˜æ•ˆï¼Œç¼ºç‚¹æ˜¯å¹¶å‘åº¦ä½ï¼Œå®¹æ˜“é€ æˆé˜»å¡ã€‚</p><p>ä½¿ç”¨è¡¨çº§é”å®šçš„ä¸»è¦æ˜¯ <code>MyISAM</code>ï¼Œ<code>MEMORY</code>ï¼Œ<code>CSV</code> ç­‰ä¸€äº›éäº‹åŠ¡æ€§å­˜å‚¨å¼•æ“ã€‚</p></li></ol><h3 id="InnoDB-å¼•æ“å®ç°çš„é”æœºåˆ¶"><a href="#InnoDB-å¼•æ“å®ç°çš„é”æœºåˆ¶" class="headerlink" title="InnoDB å¼•æ“å®ç°çš„é”æœºåˆ¶"></a>InnoDB å¼•æ“å®ç°çš„é”æœºåˆ¶</h3><h4 id="è®°å½•é”ï¼ˆRecord-LOCKï¼‰"><a href="#è®°å½•é”ï¼ˆRecord-LOCKï¼‰" class="headerlink" title="è®°å½•é”ï¼ˆRecord LOCKï¼‰"></a>è®°å½•é”ï¼ˆRecord LOCKï¼‰</h4><blockquote><p>Record Lockè¡¨ç¤ºè®°å½•é”ï¼Œé”çš„æ˜¯ç´¢å¼•è®°å½•ã€‚</p></blockquote><p>è®°å½•é”æ˜¯ InnoDB å­˜å‚¨å¼•æ“å®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æœºåˆ¶çš„é‡è¦åŸºç¡€ï¼Œç”¨æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå¹¶å‘æ€§ã€‚åœ¨ MVCC ä¸­ï¼Œæ¯ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œä¿®æ”¹æ“ä½œæ—¶éƒ½ä¼šä¸ºæ‰€ä¿®æ”¹çš„æ•°æ®è¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä½¿ç”¨è®°å½•é”æ¥ä¿æŠ¤å½“å‰äº‹åŠ¡å¯¹è¯¥æ•°æ®è¡Œçš„ä¿®æ”¹æ“ä½œã€‚</p><h5 id="å…±äº«é”ï¼ˆShared-Lockï¼‰"><a href="#å…±äº«é”ï¼ˆShared-Lockï¼‰" class="headerlink" title="å…±äº«é”ï¼ˆShared Lockï¼‰"></a>å…±äº«é”ï¼ˆShared Lockï¼‰</h5><p>å…±äº«é”ï¼ˆSé”ï¼‰æ˜¯ä¸€ç§å…±äº«é”å®šï¼Œå®ƒå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å–ä¸€è¡Œæ•°æ®ï¼Œä½†é˜²æ­¢è¿™äº›äº‹åŠ¡å¯¹è¯¥è¡Œæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs mysql">-- åŠ å…±äº«é”ï¼ˆSï¼‰<br>select * from table_name where ... lock in share mode<br></code></pre></td></tr></table></figure><h5 id="æ’å®ƒé”ï¼ˆExclusive-Lockï¼‰"><a href="#æ’å®ƒé”ï¼ˆExclusive-Lockï¼‰" class="headerlink" title="æ’å®ƒé”ï¼ˆExclusive Lockï¼‰"></a>æ’å®ƒé”ï¼ˆExclusive Lockï¼‰</h5><p>æ’å®ƒé”ï¼ˆXé”ï¼‰æ˜¯ä¸€ç§æ’å®ƒé”å®šï¼Œå®ƒé˜²æ­¢å…¶ä»–äº‹åŠ¡è¯»å–æˆ–ä¿®æ”¹è¯¥è¡Œæ•°æ®ï¼Œä¿è¯äº†æ•°æ®çš„ç‹¬å æ€§ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡å·²ç»æŒæœ‰äº†ä¸€ä¸ªè¡Œçš„ X é”ï¼Œå…¶ä»–çš„äº‹åŠ¡å°±ä¸èƒ½å†æŒæœ‰è¯¥è¡Œçš„ä»»ä½•é”ï¼ŒåŒ…æ‹¬å…±äº«é”å’Œæ’å®ƒé”ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- åŠ æ’å®ƒé”ï¼ˆX)<br>select * from table_name where ... for update<br></code></pre></td></tr></table></figure><h4 id="é—´éš™é”ï¼ˆGAP-LOCKï¼‰"><a href="#é—´éš™é”ï¼ˆGAP-LOCKï¼‰" class="headerlink" title="é—´éš™é”ï¼ˆGAP LOCKï¼‰"></a>é—´éš™é”ï¼ˆGAP LOCKï¼‰</h4><blockquote><p>Gap Lockæ˜¯é—´éš™é”ï¼Œé”çš„æ˜¯ç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ã€‚</p></blockquote><p>é—´éš™é”æ˜¯ InnoDB å­˜å‚¨å¼•æ“å®ç°çš„ä¸€ç§é”æœºåˆ¶ï¼Œå®ƒå¯ä»¥åœ¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ä¸‹é˜²æ­¢å¹»è¯»é—®é¢˜çš„å‘ç”Ÿã€‚åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“å¯ä»¥ä½¿ç”¨ MVCC æœºåˆ¶æ¥ä¿è¯è¯»å–çš„æ•°æ®çš„å¯é‡å¤æ€§ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨é—´éš™é”æ¥é¿å…å¹»è¯»é—®é¢˜çš„å‘ç”Ÿã€‚</p><p>é—´éš™é”æ˜¯é’ˆå¯¹ç´¢å¼•ä¸Šçš„é—´éš™ï¼ˆå³ç´¢å¼•è®°å½•ä¹‹é—´çš„ç©ºéš™ï¼‰è¿›è¡ŒåŠ é”ï¼Œç”¨æ¥é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™äº›é—´éš™ä¸­æ’å…¥æ–°çš„æ•°æ®ï¼Œä»è€Œä¿è¯äº†æŸ¥è¯¢ç»“æœçš„ä¸€è‡´æ€§ã€‚åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨é—´éš™é”æœºåˆ¶æ¥æ”¯æŒå¹»è¯»é—®é¢˜çš„è§£å†³ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡å¦‚ emp è¡¨ä¸­åªæœ‰ 101 æ¡è®°å½•ï¼Œå…¶ empid çš„å€¼åˆ†åˆ«æ˜¯1, 2, â€¦, 100, 101ï¼Œä¸‹é¢çš„SQLï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM emp WHERE empid &gt; 100 FOR UPDATE<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ç”¨æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDB ä¸ä»…ä¼šå¯¹ç¬¦åˆæ¡ä»¶çš„ empid å€¼ä¸º 101 çš„è®°å½•åŠ é”ï¼Œä¹Ÿä¼šå¯¹ empid å¤§äº 101ï¼ˆè¿™äº›è®°å½•å¹¶ä¸å­˜åœ¨ï¼‰çš„ â€œé—´éš™â€ åŠ é”ã€‚</p><p>è¿™ä¸ªæ—¶å€™å¦‚æœä½ æ’å…¥ empid ç­‰äº 102 çš„æ•°æ®çš„ï¼Œå¦‚æœé‚£è¾¹äº‹ç‰©è¿˜æ²¡æœ‰æäº¤ï¼Œé‚£ä½ å°±ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œæ— æ³•æ’å…¥æ•°æ®ã€‚</p><p><strong>ä½¿ç”¨æ–¹å¼</strong></p><ol><li><p>ä½¿ç”¨ SELECT â€¦ FOR UPDATE è¯­å¥ï¼šå¯ä»¥åœ¨ SQL æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨ SELECT â€¦ FOR UPDATE è¯­å¥ï¼Œè¯¥è¯­å¥ä¼šåœ¨æŸ¥è¯¢æ—¶å¯¹ç´¢å¼•è¿›è¡Œé—´éš™é”å®šã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM table_name WHERE col BETWEEN 10 AND 20 FOR UPDATE;<br></code></pre></td></tr></table></figure><p>è¯¥è¯­å¥ä¼šå¯¹ col åˆ—å€¼åœ¨ 10 å’Œ 20 ä¹‹é—´çš„è¡Œè¿›è¡Œé—´éš™é”å®šï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥é—´éš™å†…æ’å…¥æ–°çš„æ•°æ®ã€‚</p></li><li><p>ä½¿ç”¨ SELECT â€¦ LOCK IN SHARE MODE è¯­å¥ï¼šè¯¥è¯­å¥ä¸ SELECT â€¦ FOR UPDATE è¯­å¥ç±»ä¼¼ï¼Œä½†å®ƒä¼šå¯¹ç´¢å¼•è¿›è¡Œå…±äº«é”å®šã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM table_name WHERE col BETWEEN 10 AND 20 LOCK IN SHARE MODE;<br></code></pre></td></tr></table></figure><p>è¯¥è¯­å¥ä¼šå¯¹ col åˆ—å€¼åœ¨ 10 å’Œ 20 ä¹‹é—´çš„è¡Œè¿›è¡Œå…±äº«é”å®šï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥é—´éš™å†…ä¿®æ”¹æ•°æ®ã€‚</p></li></ol><h3 id="ä¸´é”®é”"><a href="#ä¸´é”®é”" class="headerlink" title="ä¸´é”®é”"></a>ä¸´é”®é”</h3><blockquote><p>Next-Key Lockæ˜¯Record Lockå’ŒGap Lockçš„ç»„åˆï¼ŒåŒæ—¶é”ç´¢å¼•è®°å½•å’Œé—´éš™ã€‚ä»–çš„èŒƒå›´æ˜¯å·¦å¼€å³é—­çš„ã€‚</p></blockquote><p>ä¸´é”®é”å¯ä»¥ç†è§£ä¸ºé”ä½çš„æ˜¯ç´¢å¼•æœ¬èº«ä»¥åŠç´¢å¼•ä¹‹å‰çš„é—´éš™ï¼Œæ˜¯ä¸€ä¸ªå·¦å¼€å³é—­çš„åŒºé—´ã€‚å½“ SQL æ‰§è¡ŒæŒ‰ç…§<strong>éå”¯ä¸€ç´¢å¼•</strong>è¿›è¡Œæ•°æ®çš„æ£€ç´¢æ—¶ï¼Œä¼šç»™åŒ¹é…åˆ°è¡Œä¸ŠåŠ ä¸Šä¸´é”®é”ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p>èŒƒå›´ï¼š(è´Ÿæ— ç©·å¤§ï¼Œ10]</p><p><strong>äº‹åŠ¡A:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">begin;<br>select * from sys_user where age=10 for update;<br></code></pre></td></tr></table></figure><p><strong>äº‹åŠ¡B:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">begin;<br>insert into sys_user (id, name, name_pinyin, id_card, phone, age)values (5, &#x27;å°å…­&#x27;, &#x27;xiaoliu&#x27;, 300000004, 13000008000, 9);<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š<br>äº‹åŠ¡Bè¢«é˜»å¡ï¼Œæ— æ³•è¢«æ’å…¥ã€‚</p><p><strong>äº‹åŠ¡C:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">begin;<br>insert into sys_user (id, name, name_pinyin, id_card, phone, age)values (5, &#x27;å°å…­&#x27;, &#x27;xiaoliu&#x27;, 300000004, 13000008000, 11);<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š<br>äº‹åŠ¡Cæ­£å¸¸æ’å…¥ï¼Œæ— é˜»å¡ã€‚</p><h4 id="æ„å‘é”"><a href="#æ„å‘é”" class="headerlink" title="æ„å‘é”"></a>æ„å‘é”</h4><p>æ„å‘é”æ˜¯ InnoDB å­˜å‚¨å¼•æ“å®ç°çš„ä¸€ç§é”æœºåˆ¶ï¼Œå®ƒç”¨æ¥åè°ƒäº‹åŠ¡å¯¹è¡¨å’Œåˆ†åŒºçš„é”å®šã€‚</p><p>æ„å‘é”æ˜¯ä¸€ç§è¡¨çº§åˆ«çš„é”ï¼Œå®ƒå¯ä»¥åˆ†ä¸ºæ„å‘å…±äº«é”ï¼ˆISï¼‰å’Œæ„å‘æ’å®ƒé”ï¼ˆIXï¼‰ä¸¤ç§ç±»å‹ã€‚æ„å‘å…±äº«é”ï¼ˆISï¼‰è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡æƒ³è¦å¯¹è¡¨æˆ–åˆ†åŒºè¿›è¡Œå…±äº«é”å®šï¼Œæ„å‘æ’å®ƒé”ï¼ˆIXï¼‰è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡æƒ³è¦å¯¹è¡¨æˆ–åˆ†åŒºè¿›è¡Œæ’å®ƒé”å®šã€‚å½“ä¸€ä¸ªäº‹åŠ¡æƒ³è¦å¯¹è¡¨æˆ–åˆ†åŒºåŠ é”æ—¶ï¼Œå®ƒéœ€è¦å…ˆè·å–å¯¹åº”çš„æ„å‘é”ï¼Œä»¥é€šçŸ¥å…¶ä»–äº‹åŠ¡è¯¥è¡¨æˆ–åˆ†åŒºçš„é”å®šçŠ¶æ€ã€‚</p><p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡æƒ³è¦å¯¹ä¸€ä¸ªæ•°æ®è¡ŒåŠ é”æ—¶ï¼Œå®ƒéœ€è¦å…ˆè·å–è¯¥æ•°æ®è¡Œæ‰€åœ¨çš„è¡¨æˆ–åˆ†åŒºçš„æ„å‘é”ï¼Œç„¶åå†è·å–è¯¥æ•°æ®è¡Œçš„è¡Œçº§é”ã€‚è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘é”çš„ç«äº‰ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ„å‘é”å¹¶ä¸æ˜¯ç”¨æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„é”ï¼Œè€Œæ˜¯ç”¨æ¥åè°ƒäº‹åŠ¡å¯¹è¡¨å’Œåˆ†åŒºçš„é”å®šï¼Œé¿å…é”çš„å†²çªå’Œç«äº‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œå†æ¥ç†è§£ä¸‹ä¸ºä»€ä¹ˆéœ€è¦å­˜åœ¨æ„å‘é”ã€‚</p><p>æ‰“ä¸ªæ¯”æ–¹ï¼Œå°±åƒæœ‰ä¸ªæ¸¸ä¹åœºï¼Œå¾ˆå¤šå°æœ‹å‹è¿›å»ç©ï¼Œçœ‹é—¨å¤§çˆ·å¦‚æœè¦ä¸‹ç­é”æ¸¸ä¹åœºçš„é—¨(åŠ è¡¨é”)ï¼Œä»–å¿…é¡»ç¡®ä¿æ¯ä¸ªè§’è½éƒ½è¦å»æ£€æŸ¥ä¸€éï¼Œç¡®ä¿æ¯ä¸ªå°æœ‹å‹éƒ½ç¦»å¼€äº†ï¼ˆé‡Šæ”¾è¡Œé”ï¼‰ï¼Œæ‰å¯ä»¥é”é—¨ã€‚</p><p>å‡è®¾é”é—¨æ˜¯ä»¶é¢‘ç¹å‘ç”Ÿçš„äº‹æƒ…ï¼Œå¤§çˆ·å°±ä¼šéå¸¸å´©æºƒã€‚é‚£å¤§çˆ·æƒ³äº†ä¸€ä¸ªåŠæ³•ï¼Œæ¯ä¸ªå°æœ‹å‹è¿›å…¥ï¼Œå°±æŠŠè‡ªå·±çš„åå­—å†™åœ¨æœ¬å­ä¸Šï¼Œå°æœ‹å‹ç¦»å¼€ï¼Œå°±æŠŠè‡ªå·±çš„åå­—åˆ’æ‰ï¼Œé‚£å¤§çˆ·å°±èƒ½æ–¹ä¾¿æŒæ¡æœ‰æ²¡æœ‰å°æœ‹å‹åœ¨æ¸¸ä¹åœºé‡Œï¼Œä¸å¿…æ¯ä¸ªè§’è½éƒ½å»å¯»æ‰¾ä¸€éã€‚ä¾‹å­ä¸­çš„â€œå°æœ¬å­â€ï¼Œå°±æ˜¯æ„å‘é”ï¼Œä»–è®°å½•çš„ä¿¡æ¯å¹¶ä¸ç²¾ç»†ï¼Œä»–åªæ˜¯æé†’å¤§çˆ·ï¼Œæ˜¯å¦æœ‰äººåœ¨å±‹é‡Œã€‚</p><h3 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h3><p>MySQLæ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”èµ„æºçš„çŠ¶æ€ï¼Œå¯¼è‡´äº‹åŠ¡æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œé€ æˆæ•°æ®åº“çš„é˜»å¡ã€‚MySQLæ­»é”æ˜¯ä¸€ä¸ªå¸¸è§çš„å¹¶å‘é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹å®¹æ˜“å‘ç”Ÿã€‚</p><p>MyISAMè¡¨é”æ˜¯deadlock freeçš„ï¼Œè¿™æ˜¯å› ä¸ºMyISAMæ€»æ˜¯ä¸€æ¬¡è·å¾—æ‰€éœ€çš„å…¨éƒ¨é”ï¼Œè¦ä¹ˆå…¨éƒ¨æ»¡è¶³ï¼Œè¦ä¹ˆç­‰å¾…ï¼Œå› æ­¤ä¸ä¼šå‡ºç°æ­»é”ã€‚ä½†åœ¨InnoDBä¸­ï¼Œé™¤å•ä¸ªSQLç»„æˆçš„äº‹åŠ¡å¤–ï¼Œé”æ˜¯é€æ­¥è·å¾—çš„ï¼Œè¿™å°±å†³å®šäº†åœ¨InnoDBä¸­å‘ç”Ÿæ­»é”æ˜¯å¯èƒ½çš„ã€‚</p><p>é€ æˆæ­»é”çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ol><li>ç«äº‰èµ„æºï¼šå¤šä¸ªäº‹åŠ¡åŒæ—¶ç«äº‰åŒä¸€èµ„æºï¼ˆå¦‚è¡Œã€è¡¨ç­‰ï¼‰ï¼Œå¯¼è‡´ç›¸äº’ç­‰å¾…ã€‚</li><li>äº‹åŠ¡æ‰§è¡Œé¡ºåºä¸ä¸€è‡´ï¼šå½“ä¸¤ä¸ªäº‹åŠ¡åœ¨ç›¸äº’ç­‰å¾…æ—¶ï¼Œå¦‚æœå®ƒä»¬æ‰§è¡Œçš„é¡ºåºä¸ä¸€è‡´ï¼Œå°±ä¼šå‡ºç°æ­»é”ã€‚</li><li>æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸å½“ï¼šå¦‚æœäº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®è¿‡é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ­»é”çš„å‘ç”Ÿã€‚</li></ol><p>ä¸ºäº†é¿å…MySQLæ­»é”ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ol><li>å‡å°‘äº‹åŠ¡æ—¶é—´ï¼šäº‹åŠ¡æ‰§è¡Œæ—¶é—´è¶Šé•¿ï¼Œæ­»é”çš„æ¦‚ç‡å°±è¶Šå¤§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½åœ°å‡å°‘äº‹åŠ¡çš„æ‰§è¡Œæ—¶é—´ã€‚</li><li>åˆç†ä½¿ç”¨ç´¢å¼•ï¼šåˆç†åœ°ä½¿ç”¨ç´¢å¼•å¯ä»¥å‡å°‘è¡Œçº§é”çš„ç«äº‰ï¼Œé™ä½æ­»é”çš„å‘ç”Ÿç‡ã€‚</li><li>è®¾ç½®åˆé€‚çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šåœ¨é€‰æ‹©äº‹åŠ¡éš”ç¦»çº§åˆ«æ—¶ï¼Œåº”æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥é€‰æ‹©ï¼Œé¿å…è®¾ç½®è¿‡é«˜çš„éš”ç¦»çº§åˆ«ã€‚</li><li>æ§åˆ¶å¹¶å‘åº¦ï¼šé€šè¿‡æ§åˆ¶å¹¶å‘åº¦ï¼Œå¯ä»¥é™ä½é”ç«äº‰çš„æ¦‚ç‡ï¼Œå‡å°‘æ­»é”çš„å‘ç”Ÿã€‚</li><li>å®šæœŸä¼˜åŒ–æ•°æ®åº“è¡¨ç»“æ„ï¼šå®šæœŸä¼˜åŒ–è¡¨ç»“æ„å¯ä»¥é™ä½é”ç«äº‰çš„æ¦‚ç‡ï¼Œä»è€Œå‡å°‘æ­»é”çš„å‘ç”Ÿã€‚</li><li>åœ¨åº”ç”¨ä¸­ï¼Œå¦‚æœä¸åŒçš„ç¨‹åºä¼šå¹¶å‘å­˜å–å¤šä¸ªè¡¨ï¼Œåº”å°½é‡çº¦å®šä»¥ç›¸åŒçš„é¡ºåºæ¥è®¿é—®è¡¨ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§é™ä½äº§ç”Ÿæ­»é”çš„æœºä¼šã€‚</li><li>åœ¨ç¨‹åºä»¥æ‰¹é‡æ–¹å¼å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœäº‹å…ˆå¯¹æ•°æ®æ’åºï¼Œä¿è¯æ¯ä¸ªçº¿ç¨‹æŒ‰å›ºå®šçš„é¡ºåºæ¥å¤„ç†è®°å½•ï¼Œä¹Ÿå¯ä»¥å¤§å¤§é™ä½å‡ºç°æ­»é”çš„å¯èƒ½ã€‚</li></ol><p>å¦‚æœå‡ºç°æ­»é”ï¼Œé€šè¿‡ MySQL æä¾›çš„ SHOW ENGINE INNODB STATUS å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ MySQL çš„é”çŠ¶æ€ã€‚è¯¥å‘½ä»¤ä¼šè¾“å‡ºåŒ…å«å½“å‰æ‰€æœ‰äº‹åŠ¡ã€é”ç­‰ä¿¡æ¯çš„å¤§é‡æ–‡æœ¬ï¼Œéœ€è¦æ‰¾åˆ°å…¶ä¸­çš„â€œLATEST DETECTED DEADLOCKâ€éƒ¨åˆ†ï¼ŒæŸ¥çœ‹æœ€è¿‘å‘ç”Ÿçš„æ­»é”ä¿¡æ¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯¹dubboçš„ä¸€äº›ç†è§£å’Œç®€å•ä½¿ç”¨è®°å½•</title>
    <link href="/2023/04/06/%E5%AF%B9dubbo%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3%E5%92%8C%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/04/06/%E5%AF%B9dubbo%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3%E5%92%8C%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å›¾ç‰‡å’Œå†…å®¹æ€»ç»“æ¥è‡ªï¼š<a href="https://cn.dubbo.apache.org/zh-cn/overview/what/">Dubbo ä»‹ç» | Apache Dubbo</a></p></blockquote><h4 id="ç®€å•ä»‹ç»"><a href="#ç®€å•ä»‹ç»" class="headerlink" title="ç®€å•ä»‹ç»"></a>ç®€å•ä»‹ç»</h4><p>Dubboæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„Java RPCæ¡†æ¶ã€‚å®ƒå¯ä»¥ç”¨äºæ„å»ºåˆ†å¸ƒå¼æœåŠ¡æ¶æ„ï¼Œç®€åŒ–ä¸åŒæœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨è¿‡ç¨‹ã€‚Dubboæ”¯æŒå¤šç§åè®®å’Œåºåˆ—åŒ–æ–¹å¼ï¼Œå¯ä»¥è½»æ¾åœ°ä¸Spring Bootè¿›è¡Œé›†æˆã€‚Dubboæä¾›äº†æœåŠ¡æ²»ç†ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ã€è·¯ç”±ã€é™çº§ç­‰ä¸°å¯Œçš„ç‰¹æ€§ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºå¥å£®çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p><p>åœ¨ä½¿ç”¨Dubboæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœåŠ¡æä¾›è€…æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ¶ˆè´¹è€…é€šè¿‡æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾åˆ°æœåŠ¡æä¾›è€…çš„åœ°å€ï¼Œç„¶åè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚Dubboæä¾›äº†å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¾‹å¦‚éšæœºã€è½®è¯¢ã€ä¸€è‡´æ€§å“ˆå¸Œç­‰ï¼Œå¯ä»¥æ ¹æ®å®é™…åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚æ­¤å¤–ï¼ŒDubboè¿˜æ”¯æŒå®¹é”™æœºåˆ¶ï¼Œä¾‹å¦‚è¶…æ—¶ã€å¤±è´¥é‡è¯•ã€ç†”æ–­ç­‰ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚</p><h4 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h4><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202304061124551.png" alt="service-discovery"></p><p>æœåŠ¡å‘ç°åŒ…å«æä¾›è€…ã€æ¶ˆè´¹è€…å’Œæ³¨å†Œä¸­å¿ƒä¸‰ä¸ªå‚ä¸è§’è‰²ï¼Œå…¶ä¸­ï¼ŒDubbo æä¾›è€…å®ä¾‹æ³¨å†Œ URL åœ°å€åˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œä¸­å¿ƒè´Ÿè´£å¯¹æ•°æ®è¿›è¡Œèšåˆï¼ŒDubbo æ¶ˆè´¹è€…ä»æ³¨å†Œä¸­å¿ƒè¯»å–åœ°å€åˆ—è¡¨å¹¶è®¢é˜…å˜æ›´ï¼Œæ¯å½“åœ°å€åˆ—è¡¨å‘ç”Ÿå˜åŒ–ï¼Œæ³¨å†Œä¸­å¿ƒå°†æœ€æ–°çš„åˆ—è¡¨é€šçŸ¥åˆ°æ‰€æœ‰è®¢é˜…çš„æ¶ˆè´¹è€…å®ä¾‹ã€‚</p><p>Dubbo ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†æˆ–è€…å­—èŠ‚ç å¢å¼ºæŠ€æœ¯ï¼Œç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œè¯¥ä»£ç†ç±»å®ç°äº†æœ¬åœ°æ¥å£ï¼Œå…·æœ‰æœ¬åœ°æ¥å£çš„æ‰€æœ‰æ–¹æ³•ã€‚åœ¨è°ƒç”¨æœ¬åœ°æ¥å£æ–¹æ³•æ—¶ï¼Œä¼šé€šè¿‡ä»£ç†ç±»çš„ invoke æ–¹æ³•å°†è¯·æ±‚è½¬å‘åˆ°è¿œç¨‹æœåŠ¡æä¾›è€…ä¸Šï¼ŒæœåŠ¡æä¾›æ–¹æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚ä¸­çš„æœåŠ¡æ¥å£åå’Œæ–¹æ³•åï¼Œæ‰¾åˆ°å¯¹åº”çš„å®ç°ç±»å’Œæ–¹æ³•ï¼Œå¹¶å°†è¯·æ±‚æ¶ˆæ¯ååºåˆ—åŒ–æˆå‚æ•°åˆ—è¡¨ï¼Œæœ€ç»ˆè°ƒç”¨æœåŠ¡å®ç°ç±»çš„æ–¹æ³•ï¼Œå¹¶å°†æ‰§è¡Œç»“æœåºåˆ—åŒ–æˆå“åº”æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><h4 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h4><ul><li><p>å¼•å…¥ä¾èµ–</p><p>é…ç½®Dubboç›¸å…³ä¾èµ–ï¼šåœ¨<code>pom.xml</code>æ–‡ä»¶ä¸­æ·»åŠ Dubboç›¸å…³ä¾èµ–ï¼Œä¾‹å¦‚<code>dubbo-spring-boot-starter</code>ã€<code>dubbo</code>ç­‰ã€‚</p><figure class="highlight dust"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;dubbo.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></code></pre></td></tr></table></figure></li><li><p>æœåŠ¡æä¾›è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProvideService</span> &#123;<br>    String <span class="hljs-title function_">test</span><span class="hljs-params">(String text)</span>;<br>&#125;<br><br><span class="hljs-comment">//å®ç°DubboæœåŠ¡æ¥å£ï¼šç¼–å†™DubboæœåŠ¡æ¥å£çš„å®ç°ç±»</span><br><span class="hljs-meta">@DubboService</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProvideServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ProvideService</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">(String text)</span> &#123;<br>         System.out.println(text);<br>      <span class="hljs-keyword">return</span> text;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>ä¸­é…ç½®DubboæœåŠ¡æä¾›è€…ä¿¡æ¯å’Œæ³¨å†Œä¸­å¿ƒåœ°å€å’Œåè®®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># DubboæœåŠ¡æä¾›è€…é…ç½®</span><br><span class="hljs-attr">dubbo.application.name</span>=dubbo-provide<br><span class="hljs-attr">dubbo.registry.protocol</span>=zookeeper<br><span class="hljs-attr">dubbo.protocol.name</span>=dubbo<br><span class="hljs-attr">dubbo.protocol.port</span>=<span class="hljs-number">20880</span><br><span class="hljs-comment"># Dubboæ³¨å†Œä¸­å¿ƒé…ç½®</span><br><span class="hljs-attr">dubbo.registry.address</span>=zookeeper://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">2181</span><br></code></pre></td></tr></table></figure><p>æ‰“æˆjaråŒ…å‘ä¸åˆ°mavenä»“åº“å¹¶å¯åŠ¨æœåŠ¡</p></li><li><p>æœåŠ¡æ¶ˆè´¹è€…</p><p>å¼•å…¥åŒ…å«ProvideServiceæœåŠ¡çš„ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerService</span> &#123;<br>    <span class="hljs-meta">@DubboReference</span><br>    <span class="hljs-keyword">private</span> ProvideService provideService;<br>  <br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">(String text)</span> &#123;<br>         <span class="hljs-keyword">return</span> provideService.test(text)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>ä¸­é…ç½®Dubboæ³¨å†Œä¸­å¿ƒåœ°å€å’Œåè®®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># Dubboæ³¨å†Œä¸­å¿ƒé…ç½®</span><br><span class="hljs-attr">dubbo.registry.protocol</span>=zookeeper<br><span class="hljs-attr">dubbo.registry.address</span>=zookeeper://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">2181</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="ä¸€äº›é—®é¢˜"><a href="#ä¸€äº›é—®é¢˜" class="headerlink" title="ä¸€äº›é—®é¢˜"></a>ä¸€äº›é—®é¢˜</h4><blockquote><p>ä¸ºä»€ä¹ˆä½¿ç”¨rpcæ¡†æ¶ï¼Œè€Œä¸æ˜¯ç”¨httpï¼Ÿ</p></blockquote><ul><li><p>åœ¨å¼‚æ„ç³»ç»Ÿï¼ˆè·¨è¯­è¨€å’Œè·¨å¹³å°ï¼‰ï¼ŒHTTPå…·æœ‰æ›´å¥½çš„å…¼å®¹æ€§ï¼Œå› ä¸ºHTTPæ˜¯ä¸€ç§é€šç”¨çš„åè®®ï¼Œå‡ ä¹æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€å’Œæ“ä½œç³»ç»Ÿéƒ½æ”¯æŒHTTPåè®®ï¼Œå› ä¸ºDubboæ”¯æŒæ›´ä¸¥æ ¼çš„é€šä¿¡åè®®å’Œç±»å‹çº¦æŸï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€å’Œæ“ä½œç³»ç»Ÿéƒ½æ”¯æŒç›¸åŒçš„RPCåè®®ã€‚</p></li><li><p>RPCé€‚åˆç”¨åœ¨ä¼ä¸šå†…éƒ¨ï¼Œè¦æ±‚ä½¿ç”¨åŒä¸€å¥—æ³¨å†Œä¸­å¿ƒè¿›è¡ŒæœåŠ¡æ²»ç†ï¼Œå¦‚æœæ˜¯è·¨ç»„ç»‡ï¼Œæˆ–è€…è·¨å…¬å¸ï¼Œè¿™ç§æƒ…å†µåªèƒ½ç”¨æ›´åŠ é€šç”¨çš„HTTPè¿›è¡Œé€šä¿¡ã€‚</p></li><li><p>Dubboåœ¨å¹¶å‘è¿æ¥æ•°è¾ƒé«˜æ—¶è¡¨ç°æ›´å¥½ï¼Œå› ä¸ºDubboä½¿ç”¨é•¿è¿æ¥å’ŒTCPåè®®ï¼Œè€ŒHTTPåè®®æ¯æ¬¡è¯·æ±‚éƒ½è¦å»ºç«‹è¿æ¥ï¼Œåœ¨æ¯æ¬¡è¿æ¥çš„è¿‡ç¨‹ä¸­éœ€è¦é¢å¤–çš„æ—¶é—´å¼€é”€å’Œæ•°æ®ä¼ è¾“é‡ã€‚ä½†æ˜¯ï¼Œåœ¨ä½å¹¶å‘é‡å’Œå°æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ŒHTTPçš„å¼€é”€ç›¸å¯¹è¾ƒå°ã€‚</p></li></ul><blockquote><p>rpcå…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p></blockquote><ul><li><p>æ€§èƒ½å¥½ï¼šRPCåœ¨ä¼ è¾“æ•ˆç‡ä¸Šé€šå¸¸æ¯”HTTPæ›´é«˜ï¼Œæ­¤å¤–ï¼ŒRPCå¯ä»¥ä½¿ç”¨æ›´ç´§å‡‘çš„æ•°æ®æ ¼å¼ï¼Œå¦‚Protocol Bufferså’ŒThriftï¼Œå¯ä»¥æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç½‘ç»œå¸¦å®½å’Œå­˜å‚¨ç©ºé—´ã€‚</p></li><li><p>å®‰å…¨æ€§ï¼šç›®å‰ï¼ŒDubboç­‰RPCæ¡†æ¶ä¸»è¦åº”ç”¨åœ¨ä¼ä¸šå†…éƒ¨ä¹‹é—´çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œå†…éƒ¨ç³»ç»Ÿä¹‹é—´è°ƒç”¨çš„è¯å®‰å…¨æ€§å°±æ›´æœ‰ä¿éšœä¸€äº›ã€‚</p></li><li><p>è°ƒç”¨ç®€å•ï¼šRCPå¯ä»¥å¸®æˆ‘ä»¬åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹ä»£ç ï¼Œè€ŒHTTPè°ƒç”¨éœ€è¦æ‹¼æ¥Bodyã€Headerç­‰ç­‰ï¼Œè¿‡äºå¤æ‚ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Dubbo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¯·æ±‚wordpress json apiè®°å½•</title>
    <link href="/2023/01/28/%E8%AF%B7%E6%B1%82wordpress-json-api%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/01/28/%E8%AF%B7%E6%B1%82wordpress-json-api%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h4 id="ç¬¬ä¸‰æ–¹å¹³å°è¿æ¥wp-jsonæ¥å£éœ€è¦å€ŸåŠ©pluginç”Ÿæˆtoken"><a href="#ç¬¬ä¸‰æ–¹å¹³å°è¿æ¥wp-jsonæ¥å£éœ€è¦å€ŸåŠ©pluginç”Ÿæˆtoken" class="headerlink" title="ç¬¬ä¸‰æ–¹å¹³å°è¿æ¥wp-jsonæ¥å£éœ€è¦å€ŸåŠ©pluginç”Ÿæˆtoken"></a>ç¬¬ä¸‰æ–¹å¹³å°è¿æ¥wp-jsonæ¥å£éœ€è¦å€ŸåŠ©pluginç”Ÿæˆtoken</h4><h5 id="JWT-Authentication-for-WP-API"><a href="#JWT-Authentication-for-WP-API" class="headerlink" title="JWT Authentication for WP-API"></a>JWT Authentication for WP-API</h5><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202301281606338.png" alt="image-20230128151015431"></p><p>ä¸å¤ªè¡Œ è¦æ‰‹åŠ¨ä¿®æ”¹apache .htaccessæ–‡ä»¶</p><h5 id="API-Bearer-Auth"><a href="#API-Bearer-Auth" class="headerlink" title="API Bearer Auth"></a>API Bearer Auth</h5><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202301281606381.png" alt="image-20230128152534220"></p><blockquote><p><a href="https://cn.wordpress.org/plugins/api-bearer-auth/">API Bearer Auth â€“ WordPress æ’ä»¶ | WordPress.org China ç®€ä½“ä¸­æ–‡</a></p></blockquote><ul><li>è·å–Bearer token</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">curl --location --request POST &#x27;http://localhost/wp-json/api-bearer-auth/v1/login&#x27; \<br>--header &#x27;Content-Type: application/json&#x27; \<br>--data-raw &#x27;&#123;<br>    &quot;username&quot;: &quot;beixian&quot;,<br>    &quot;password&quot;: &quot;123456&quot;,<br>    &quot;client_name&quot;: &quot;dealar&quot;<br>&#125;&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;wp_user&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;ID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_login&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_nicename&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_registered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-04 06:32:18&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_activation_key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;user_status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;display_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;ID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;caps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;administrator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;cap_key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wp_capabilities&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;roles&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;administrator&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;allcaps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;switch_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;activate_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_options&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;moderate_comments&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_categories&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_links&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;upload_files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;unfiltered_html&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_10&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_9&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_8&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_7&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_5&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;level_0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_posts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;create_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;unfiltered_upload&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_dashboard&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;update_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;install_plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;update_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;install_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;update_core&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;list_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;remove_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;promote_users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_theme_options&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_themes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;export&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_woocommerce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;view_woocommerce_reports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_product&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_product&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_product&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_products&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_product_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_product_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_product_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assign_product_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_shop_order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_shop_orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_shop_order_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_order_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_order_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assign_shop_order_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_coupon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_shop_coupon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_coupon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_others_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;publish_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_private_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_private_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_published_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_others_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_private_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_published_shop_coupons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;manage_shop_coupon_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;edit_shop_coupon_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;delete_shop_coupon_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assign_shop_coupon_terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;administrator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;access_token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dcc21431b90fd8acac52d934ea1955981b68c27d48ea16dc3bad09d9f0aff6e2&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;expires_in&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">86400</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;refresh_token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8ae0503926687677e6e5237031b1876cecfb81ce7dd982461dee8bd50ca48e97&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>Refresh token</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location --request POST &#x27;http://localhost/wp-json/api-bearer-auth/v1/tokens/refresh&#x27; \<br>--header &#x27;Content-Type: application/json&#x27; \<br>--data-raw &#x27;&#123;&quot;token&quot;: &quot;8ae0503926687677e6e5237031b1876cecfb81ce7dd982461dee8bd50ca48e97&quot;, &quot;client_name&quot;: &quot;dealar&quot;&#125;&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;access_token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;f07dc29c8b001ec143e7d6e6ebd110fb5fb07c078c9cb6e384a7cef5a479f1bf&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;expires_in&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">86400</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="Wordpree-media"><a href="#Wordpree-media" class="headerlink" title="Wordpree media"></a>Wordpree media</h4><p>ä¸Šä¼ mediaæ–‡ä»¶æ¥å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location --request POST &#x27;http://localhost/wp-json/wp/v2/media&#x27; \<br>--header &#x27;content-disposition: attachment; filename=beixian.png&#x27; \<br>--header &#x27;Authorization: Bearer f07dc29c8b001ec143e7d6e6ebd110fb5fb07c078c9cb6e384a7cef5a479f1bf&#x27; \<br>--header &#x27;Content-Type: image/jpeg&#x27; \<br>--data-binary &#x27;@/Users/casonmo/Pictures/Photos Library.photoslibrary/originals/9/9E00792B-5CD0-4233-851B-121320A61618.jpeg&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">36</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-28T07:42:13&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;date_gmt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-28T07:42:13&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;guid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;rendered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian.jpg&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;raw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian.jpg&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;modified&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-28T07:42:13&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;modified_gmt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-01-28T07:42:13&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;slug&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inherit&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;attachment&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;link&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/beixian/&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;raw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rendered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;comment_status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;open&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ping_status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;closed&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;template&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;permalink_template&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/?attachment_id=36&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;generated_slug&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;raw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rendered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;p class=\&quot;attachment\&quot;&gt;&lt;a href=&#x27;http://localhost/wp-content/uploads/2023/01/beixian.jpg&#x27;&gt;&lt;img width=\&quot;300\&quot; height=\&quot;300\&quot; src=\&quot;http://localhost/wp-content/uploads/2023/01/beixian-300x300.jpg\&quot; class=\&quot;attachment-medium size-medium\&quot; alt=\&quot;\&quot; decoding=\&quot;async\&quot; loading=\&quot;lazy\&quot; srcset=\&quot;http://localhost/wp-content/uploads/2023/01/beixian-300x300.jpg 300w, http://localhost/wp-content/uploads/2023/01/beixian.jpg 1024w, http://localhost/wp-content/uploads/2023/01/beixian-150x150.jpg 150w, http://localhost/wp-content/uploads/2023/01/beixian-768x768.jpg 768w, http://localhost/wp-content/uploads/2023/01/beixian-324x324.jpg 324w, http://localhost/wp-content/uploads/2023/01/beixian-416x416.jpg 416w, http://localhost/wp-content/uploads/2023/01/beixian-100x100.jpg 100w\&quot; sizes=\&quot;(max-width: 300px) 100vw, 300px\&quot; /&gt;&lt;/a&gt;&lt;/p&gt;\n&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;caption&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;raw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rendered&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;alt_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;media_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;media_details&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023/01/beixian.jpg&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">66568</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sizes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;medium&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-300x300.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">300</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">300</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14751</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-300x300.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;large&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-1024x1024.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">65430</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-1024x1024.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;thumbnail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-150x150.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6292</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-150x150.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;medium_large&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-768x768.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">768</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">768</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">48019</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-768x768.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;woocommerce_thumbnail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-324x324.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">324</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">324</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16413</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;uncropped&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-324x324.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;woocommerce_single&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-416x416.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">416</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">416</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22105</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-416x416.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;woocommerce_gallery_thumbnail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian-100x100.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;filesize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4004</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian-100x100.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;full&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beixian.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mime_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/jpeg&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian.jpg&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;image_meta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;aperture&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;credit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;camera&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;caption&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;created_timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;copyright&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;focal_length&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;iso&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shutter_speed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;orientation&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;keywords&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;post&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;source_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-content/uploads/2023/01/beixian.jpg&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;missing_image_sizes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;_links&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;self&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/media/36&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;collection&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/media&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;about&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/types/attachment&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;embeddable&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/users/1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;embeddable&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/comments?post=36&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;wp:action-unfiltered-html&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/media/36&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;wp:action-assign-author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost/wp-json/wp/v2/media/36&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;curies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wp&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://api.w.org/&#123;rel&#125;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;templated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>wordpress</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šmysqlæ˜¯æ€æ ·è¿è¡Œçš„ã€‹ç¬”è®°</title>
    <link href="/2023/01/20/%E3%80%8Amysql%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/01/20/%E3%80%8Amysql%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84%E3%80%8B%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h4 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h4><h5 id="Unixé‡ŒmysqlæœåŠ¡å™¨ç¨‹åºï¼š"><a href="#Unixé‡ŒmysqlæœåŠ¡å™¨ç¨‹åºï¼š" class="headerlink" title="Unixé‡ŒmysqlæœåŠ¡å™¨ç¨‹åºï¼š"></a>Unixé‡ŒmysqlæœåŠ¡å™¨ç¨‹åºï¼š</h5><p>mysqld:mysqlæœåŠ¡å™¨ç¨‹åº</p><p>mysqld_safe: è°ƒç”¨mysqld+ç›‘æ§è¿›ç¨‹+æ—¥å¿—</p><p>mysql.server:å¯åŠ¨è„šæœ¬&#x3D;è°ƒç”¨mysqld_safe</p><p> mysql_multi:å¯åŠ¨å¤šä¸ªmysqlæœåŠ¡å™¨ç¨‹åº</p><h5 id="å¯åŠ¨å®¢æˆ·ç«¯"><a href="#å¯åŠ¨å®¢æˆ·ç«¯" class="headerlink" title="å¯åŠ¨å®¢æˆ·ç«¯"></a>å¯åŠ¨å®¢æˆ·ç«¯</h5><p>mysql -hä¸»æœºå -uç”¨æˆ·å -på¯†ç  -Pç«¯å£</p><h5 id="å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿æ¥çš„æ–¹æ³•"><a href="#å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿æ¥çš„æ–¹æ³•" class="headerlink" title="å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿æ¥çš„æ–¹æ³•"></a>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿æ¥çš„æ–¹æ³•</h5><ul><li><p>TCP&#x2F;IP</p><ul><li>é‡‡ç”¨TCPåè®®ï¼Œé€šè¿‡IPåœ°å€+ç«¯å£å·è¿›è¡Œç½‘ç»œè¿æ¥</li><li>é€šè¿‡skip-networkingç¦ç”¨</li></ul></li><li><p>å‘½åç®¡é“ï¼ˆwindowsï¼‰</p><ul><li>å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤ä¸­åŠ ä¸Š â€“enable-named-pipe</li><li>å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºçš„å‘½ä»¤ä¸­åŠ å…¥ â€“pipe æˆ–è€… â€“protocol&#x3D;pipe å‚æ•°</li></ul></li><li><p>å…±äº«å†…å­˜ï¼ˆwindowsï¼‰</p><ul><li>å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤ä¸­åŠ ä¸Š â€“shared-memory</li><li>åœ¨å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºçš„å‘½ä»¤ä¸­åŠ å…¥ â€“protocol&#x3D;memory </li><li>ä½¿ç”¨ å…±äº«å†…å­˜ çš„æ–¹å¼è¿›è¡Œé€šä¿¡çš„æœåŠ¡å™¨è¿›ç¨‹å’Œå®¢æˆ·ç«¯è¿›ç¨‹å¿…é¡»åœ¨åŒä¸€å° Windows ä¸»æœºä¸­</li></ul></li><li><p><strong>Unix</strong>åŸŸå¥—æ¥å­—æ–‡ä»¶ï¼ˆunixï¼‰</p><ul><li><p>å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºçš„æ—¶å€™æŒ‡å®šçš„ä¸»æœºåä¸º localhost ï¼Œæˆ–è€…æŒ‡å®šäº† â€“protocol&#x3D;socket çš„å¯åŠ¨å‚æ•°</p></li><li><p>MySQL æœåŠ¡å™¨ç¨‹åºé»˜è®¤ç›‘å¬çš„ Unix åŸŸå¥—æ¥å­—æ–‡ä»¶è·¯å¾„ä¸º &#x2F;tmp&#x2F;mysql.sock ,é€šè¿‡mysqld â€“socket&#x3D;&#x2F;tmp&#x2F;a.txtä¿®æ”¹å¥—æ¥å­—æ–‡ä»¶è·¯å¾„</p></li><li><p>å®¢æˆ·ç«¯ç¨‹åºæ˜¾å¼è¿æ¥åˆ°unixåŸŸå¥—æ¥å­—è·¯å¾„ mysql -hlocalhost -uroot â€“socket&#x3D;&#x2F;tmp&#x2F;a.txt -p</p></li></ul></li></ul><h4 id="æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚"><a href="#æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚" class="headerlink" title="æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚"></a>æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</h4><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091807683.png" alt="image-20230120113343299"></p><h5 id="è¿æ¥ç®¡ç†"><a href="#è¿æ¥ç®¡ç†" class="headerlink" title="è¿æ¥ç®¡ç†"></a>è¿æ¥ç®¡ç†</h5><p>ä¸ºäº†é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿›ç¨‹ï¼ŒæœåŠ¡å™¨ä¸ä¼šç«‹å³åˆ é™¤åˆšé€€å‡ºçš„å®¢æˆ·ç«¯è¿æ¥çº¿ç¨‹ï¼Œç¼“å­˜èµ·æ¥ï¼Œåˆ†é…ç»™ä¸‹ä¸€ä¸ªæ–°è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯ã€‚è¿æ¥å»ºç«‹åï¼Œå¯¹åº”å®¢æˆ·ç«¯çš„æœåŠ¡å™¨è¿›ç¨‹ä¼šæŒç»­ç›‘æ§å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚</p><h5 id="è§£æä¸ä¼˜åŒ–"><a href="#è§£æä¸ä¼˜åŒ–" class="headerlink" title="è§£æä¸ä¼˜åŒ–"></a>è§£æä¸ä¼˜åŒ–</h5><ul><li><p>æŸ¥è¯¢ç¼“å­˜ </p><blockquote><p>ç¼“å†²sqlè¯·æ±‚ï¼Œå¹¶åœ¨ä¸åŒå®¢æˆ·ç«¯ä¹‹é—´å…±äº«</p><p>æ— æ³•å‘½ä¸­ï¼šä»»æ„å­—ç¬¦ä¸åŒï¼ŒæŸ¥è¯¢è¯·æ±‚ä¸­åŒ…å«æŸäº›ç³»ç»Ÿå‡½æ•°ã€ç”¨æˆ·è‡ªå®šä¹‰å˜é‡å’Œå‡½æ•°ã€ä¸€äº›ç³»ç»Ÿè¡¨</p><p>å¤±æ•ˆï¼šINSERT ã€ UPDATE ã€ DELETE ã€ TRUNCATE TABLE ã€ ALTER TABLE ã€ DROP TABLE ã€DROP DATABASE è¯­å¥</p></blockquote></li><li><p>è¯­æ³•è§£æ</p><blockquote><p>æ˜¯ä¸€ä¸ªç¼–è¯‘è¿‡ç¨‹ï¼Œæ¶‰åŠè¯æ³•è§£æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æç­‰é˜¶æ®µ</p><p>æå–æŸ¥è¯¢ä¿¡æ¯åˆ° MySQL æœåŠ¡å™¨å†…éƒ¨ä½¿ç”¨çš„ä¸€äº›æ•°æ®ç»“æ„</p></blockquote></li><li><p>æŸ¥è¯¢ä¼˜åŒ–</p><blockquote><p>ä¼˜åŒ–sqlï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼ŒEXPLAIN è¯­å¥æ¥æŸ¥çœ‹æŸä¸ªè¯­å¥çš„æ‰§è¡Œè®¡åˆ’</p></blockquote></li></ul><p>MySQL ä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½æ˜¯ é¡µ,é¡µçš„å¤§å°ä¸€èˆ¬æ˜¯ 16KB ï¼Œä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œ</p><h5 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h5><p>å¯¹æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒMySQL server å®Œæˆäº†æŸ¥è¯¢ä¼˜åŒ–åï¼Œåªéœ€æŒ‰ç…§ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’è°ƒç”¨åº•å±‚å­˜å‚¨å¼•æ“æä¾›çš„APIï¼Œè·å–åˆ°æ•°æ®å</p><p>è¿”å›ç»™å®¢æˆ·ç«¯</p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091807992.png" alt="image-20230120114806430" style="zoom:50%;" /><p>å¸¸ç”¨çš„å°±æ˜¯ InnoDB å’Œ MyISAM </p><p>innodb å…·æœ‰å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡æ˜¥åˆå¼•æ“</p><p>myisam ä¸»è¦çš„éäº‹ç‰©å¤„ç†å¼•æ“</p><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>é…ç½®æ–‡ä»¶é‡Œå°±å®šä¹‰äº†è®¸å¤šä¸ªç»„ï¼Œç»„ååˆ†åˆ«æ˜¯ server ã€ mysqld ã€ mysqld_safe ã€ client ã€ mysql ã€mysqladmin </p><p>é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§ï¼šå¦‚æœæˆ‘ä»¬åœ¨å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº†ç›¸åŒçš„å¯åŠ¨é€‰é¡¹ï¼Œé‚£ä»¥æœ€åä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„ä¸ºå‡†ï¼Œå°†ä»¥æœ€åä¸€ä¸ªå‡ºç°çš„ç»„ä¸­çš„å¯åŠ¨é€‰é¡¹ä¸ºå‡†ï¼Œä¹ˆä»¥å‘½ä»¤è¡Œä¸­çš„å¯åŠ¨é€‰é¡¹ä¸ºå‡†</p><h4 id="å­—ç¬¦é›†ï¼ˆCHARACTERï¼‰å’Œæ’åºè§„åˆ™ï¼ˆCOLLATIONï¼‰"><a href="#å­—ç¬¦é›†ï¼ˆCHARACTERï¼‰å’Œæ’åºè§„åˆ™ï¼ˆCOLLATIONï¼‰" class="headerlink" title="å­—ç¬¦é›†ï¼ˆCHARACTERï¼‰å’Œæ’åºè§„åˆ™ï¼ˆCOLLATIONï¼‰"></a>å­—ç¬¦é›†ï¼ˆCHARACTERï¼‰å’Œæ’åºè§„åˆ™ï¼ˆCOLLATIONï¼‰</h4><h5 id="å­—ç¬¦é›†ï¼ˆéƒ¨åˆ†ï¼‰ï¼š"><a href="#å­—ç¬¦é›†ï¼ˆéƒ¨åˆ†ï¼‰ï¼š" class="headerlink" title="å­—ç¬¦é›†ï¼ˆéƒ¨åˆ†ï¼‰ï¼š"></a>å­—ç¬¦é›†ï¼ˆéƒ¨åˆ†ï¼‰ï¼š</h5><p>utf8mb3 ï¼šé˜‰å‰²è¿‡çš„ utf8 å­—ç¬¦é›†ï¼Œåªä½¿ç”¨1ï½3ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ã€‚</p><p>utf8mb4 ï¼šæ­£å®—çš„ utf8 å­—ç¬¦é›†ï¼Œä½¿ç”¨1ï½4ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ã€‚</p><h5 id="æ’åºè§„åˆ™ï¼š"><a href="#æ’åºè§„åˆ™ï¼š" class="headerlink" title="æ’åºè§„åˆ™ï¼š"></a>æ’åºè§„åˆ™ï¼š</h5><p>_ai ï¼šaccent insensitive  ä¸åŒºåˆ†é‡éŸ³</p><p>_as ï¼š accent sensitive åŒºåˆ†é‡éŸ³</p><p>_ci ï¼š case insensitive ä¸åŒºåˆ†å¤§å°å†™</p><p>_cs ï¼š case sensitive åŒºåˆ†å¤§å°å†™</p><p>_bin ï¼š binary ä»¥äºŒè¿›åˆ¶æ–¹å¼æ¯”è¾ƒ</p><p>MySQL æœ‰4ä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>æœåŠ¡å™¨çº§åˆ«</li><li>æ•°æ®åº“çº§åˆ«</li><li>è¡¨çº§åˆ«</li><li>åˆ—çº§åˆ«</li></ul><h5 id="ç¼–ç å’Œè§£ç ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ä¸€è‡´çš„åæœ"><a href="#ç¼–ç å’Œè§£ç ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ä¸€è‡´çš„åæœ" class="headerlink" title="ç¼–ç å’Œè§£ç ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ä¸€è‡´çš„åæœ"></a>ç¼–ç å’Œè§£ç ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ä¸€è‡´çš„åæœ</h5><p>è´å…ˆ utf8ç¼–ç  &#x3D; 0xE8B49D 0xE58588ï¼ˆ3ä¸ªå­—èŠ‚ï¼‰</p><p>â€‹è½¬gbk &#x3D; 0xE8B4 0x9DE5 0x8588ï¼ˆ1-2ä¸ªå­—èŠ‚ 1ä¸ªå­—èŠ‚æ‰¾ä¸åˆ° å°±2ä¸ªå­—èŠ‚ï¼‰</p><p>â€‹æ˜¾ç¤º &#x3D;ç’  æ¿†      å›</p><blockquote><p>GBKå’Œæ–‡å­—åœ¨çº¿è½¬æ¢ï¼š<a href="https://www.23bei.com/tool/54.html#">ASCII&#x2F;GBK&#x2F;GB2312ä¸­æ–‡æ±‰å­—åŒºä½ç ,å†…ç ,ç¼–ç åœ¨çº¿æŸ¥è¯¢è½¯ä»¶ (23bei.com)</a></p><p>UTF-8å’Œæ–‡å­—åœ¨çº¿è½¬æ¢ï¼š<a href="http://www.metools.info/code/utf8235.html">UTF-8ç¼–ç è½¬æ¢å™¨-ME2åœ¨çº¿å·¥å…· (metools.info)</a></p></blockquote><h5 id="MySQLä¸­å­—ç¬¦é›†çš„è½¬æ¢"><a href="#MySQLä¸­å­—ç¬¦é›†çš„è½¬æ¢" class="headerlink" title="MySQLä¸­å­—ç¬¦é›†çš„è½¬æ¢"></a>MySQLä¸­å­—ç¬¦é›†çš„è½¬æ¢</h5><p>æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€æ¥çš„è¯·æ±‚å…¶å®æ˜¯ä¸€ä¸²äºŒè¿›åˆ¶çš„å­—èŠ‚ï¼Œå®ƒä¼šè®¤ä¸ºè¿™ä¸²å­—èŠ‚é‡‡ç”¨çš„å­—ç¬¦é›†æ˜¯character_set_client ï¼Œç„¶åæŠŠè¿™ä¸²å­—èŠ‚è½¬æ¢ä¸º character_set_connection å­—ç¬¦é›†ç¼–ç çš„å­—ç¬¦ã€‚æœ€åä½¿ç”¨ character_set_resultså­—ç¬¦é›† è¿”å›å®¢æˆ·ç«¯</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091807626.png" alt="image-20230120122125932"></p><p>ä¸ºé¿å…ä¹±ç ï¼Œç¡®ä¿ä¸€ä¸‹ä¸‰ä¸ªå­—ç¬¦é›†ä¸€è‡´</p><ul><li><p>character_set_client æœåŠ¡å™¨è§£ç è¯·æ±‚æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†</p></li><li><p>character_set_connection æœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶ä¼šæŠŠè¯·æ±‚å­—ç¬¦ä¸²ä» character_set_client è½¬ä¸º character_set_connection</p></li><li><p>character_set_results æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†</p></li></ul><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ default-character-set&#x3D;utf8</p><p>[client]</p><p>default-character-set&#x3D;utf8</p><h4 id="Innodb"><a href="#Innodb" class="headerlink" title="Innodb"></a>Innodb</h4><p>InnoDB æ˜¯ä¸€ä¸ªå°†è¡¨ä¸­çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„å­˜å‚¨å¼•æ“ï¼Œæœ€å¤§ç‰¹è‰²å°±æ˜¯æ”¯æŒäº†<a href="https://baike.baidu.com/item/ACID/10738?fromModule=lemma_inlink">ACID</a>å…¼å®¹çš„<a href="https://baike.baidu.com/item/%E4%BA%8B%E5%8A%A1/5945882?fromModule=lemma_inlink">äº‹åŠ¡</a>ï¼ˆTransactionï¼‰åŠŸèƒ½ã€‚</p><p>å°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼Œä»¥é¡µä½œä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„åŸºæœ¬å•ä½ï¼ŒInnoDBä¸­é¡µçš„å¤§å°ä¸€èˆ¬ä¸º <strong>16</strong> KB</p><p>æ˜¯ä»¥è®°å½•ä¸ºå•ä½æ¥å‘è¡¨ä¸­æ’å…¥æ•°æ®çš„ï¼Œè¿™äº›è®°å½•åœ¨ç£ç›˜ä¸Šçš„å­˜æ”¾æ–¹å¼ä¹Ÿè¢«ç§°ä¸º è¡Œæ ¼å¼ æˆ–è€… è®°å½•æ ¼å¼</p><blockquote><p>ACID:åŸå­æ€§ï¼ˆatomicityï¼Œæˆ–ç§°ä¸å¯åˆ†å‰²æ€§ï¼‰ã€ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆisolationï¼Œåˆç§°ç‹¬ç«‹æ€§ï¼‰ã€æŒä¹…æ€§ï¼ˆdurabilityï¼‰</p></blockquote><h5 id="è¡Œæ ¼å¼"><a href="#è¡Œæ ¼å¼" class="headerlink" title="è¡Œæ ¼å¼"></a>è¡Œæ ¼å¼</h5><ul><li>COMPACTè¡Œæ ¼å¼</li></ul><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091807391.png" alt="image-20230120102114581"></p><ul><li>Redundantè¡Œæ ¼å¼</li></ul><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091807341.png" alt="image-20230120102325757"></p><p>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨ æŒ‰ç…§ä¸¤ä¸ªç›¸é‚»æ•°å€¼çš„å·®å€¼æ¥è®¡ç®—å„ä¸ªåˆ—å€¼çš„é•¿åº¦</p><ul><li><p>Dynamic</p><blockquote><p>è¡Œæº¢å‡ºå¤„ç†ï¼šæŠŠæ‰€æœ‰çš„å­—èŠ‚éƒ½å­˜å‚¨åˆ°å…¶ä»–é¡µé¢ä¸­ï¼Œåªåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å…¶ä»–é¡µé¢çš„åœ°å€</p></blockquote></li><li><p>Compressed</p><blockquote><p>Compressed è¡Œæ ¼å¼ä¼šé‡‡ç”¨å‹ç¼©ç®—æ³•å¯¹é¡µé¢è¿›è¡Œå‹ç¼©ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚</p></blockquote></li></ul><h5 id="varchar-M-æœ€å¤šèƒ½å­˜å‚¨çš„æ•°æ®"><a href="#varchar-M-æœ€å¤šèƒ½å­˜å‚¨çš„æ•°æ®" class="headerlink" title="varchar(M)æœ€å¤šèƒ½å­˜å‚¨çš„æ•°æ®"></a>varchar(M)æœ€å¤šèƒ½å­˜å‚¨çš„æ•°æ®</h5><p> VARCHAR(M) ç±»å‹çš„åˆ—æœ€å¤šå¯ä»¥å ç”¨ 65535 ä¸ªå­—èŠ‚ MySQL å¯¹ä¸€æ¡è®°å½•å ç”¨çš„æœ€å¤§å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™åˆ¶çš„ï¼Œé™¤äº† BLOB æˆ–è€… TEXT ç±»å‹çš„åˆ—ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„åˆ—ï¼ˆä¸åŒ…æ‹¬éšè—åˆ—å’Œè®°å½•å¤´ä¿¡æ¯ï¼‰å ç”¨çš„å­—èŠ‚é•¿åº¦åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡ 65535 ä¸ªå­—èŠ‚</p><p>M &#x3D; çœŸå®æ•°æ®+çœŸå®æ•°æ®å ç”¨å­—èŠ‚çš„é•¿åº¦+NULL å€¼æ ‡è¯†(å¦‚æœè¯¥åˆ—æœ‰ NOT NULL å±æ€§åˆ™å¯ä»¥æ²¡æœ‰è¿™éƒ¨åˆ†å­˜å‚¨ç©ºé—´)</p><p>å¦‚æœè¯¥ VARCHAR ç±»å‹çš„åˆ—æ²¡æœ‰ NOT NULL å±æ€§ï¼Œé‚£æœ€å¤šåªèƒ½å­˜å‚¨ 65532 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå› ä¸ºçœŸå®æ•°æ®çš„é•¿åº¦å¯èƒ½</p><p>å ç”¨2ä¸ªå­—èŠ‚ï¼Œ NULL å€¼æ ‡è¯†éœ€è¦å ç”¨1ä¸ªå­—èŠ‚ï¼š</p><blockquote><p>çœŸå®æ•°æ®å ç”¨å­—èŠ‚çš„é•¿åº¦65535(åè¿›åˆ¶) &#x3D; 11111111 11111111ï¼ˆäºŒè¿›åˆ¶ï¼‰&#x3D; 2å­—èŠ‚</p><p>65532 &#x3D; 65535-2ï¼ˆçœŸå®æ•°æ®å ç”¨å­—èŠ‚çš„é•¿åº¦ï¼‰-1ï¼ˆNULL å€¼æ ‡è¯†ï¼‰</p><p>65533 &#x3D; 65535-2ï¼ˆçœŸå®æ•°æ®å ç”¨å­—èŠ‚çš„é•¿åº¦ï¼‰-0ï¼ˆNot Nullæ— éœ€æ ‡è¯†ï¼‰</p></blockquote><p>ascii å­—ç¬¦é›†(æœ€å¤šå ç”¨ä¸€ä¸ªå­—èŠ‚) å…è®¸ä¸ºnullæƒ…å†µä¸‹å¯ä»¥æœ€å¤§65532 ï¼ŒNot Nullæœ€å¤§65533</p><p>gbk å­—ç¬¦é›†(æœ€å¤šå ç”¨2ä¸ªå­—èŠ‚) å…è®¸ä¸ºnullæƒ…å†µä¸‹å¯ä»¥æœ€å¤§32766ï¼ˆ65532 &#x2F;2ï¼‰</p><p>utf8 å­—ç¬¦é›†(&#x3D;utf8mb3 æœ€å¤šå ç”¨3ä¸ªå­—èŠ‚) å…è®¸ä¸ºnullæƒ…å†µä¸‹å¯ä»¥æœ€å¤§21844ï¼ˆ65532 &#x2F;3ï¼‰</p><h5 id="è¡Œæº¢å‡º"><a href="#è¡Œæº¢å‡º" class="headerlink" title="è¡Œæº¢å‡º"></a>è¡Œæº¢å‡º</h5><p>æº¢å‡ºåŸå› ï¼šä¸€ä¸ªé¡µä¸€èˆ¬æ˜¯ 16KB ï¼Œå½“è®°å½•ä¸­çš„æ•°æ®å¤ªå¤šï¼Œå½“å‰é¡µæ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œä¼šæŠŠå¤šä½™çš„æ•°æ®å­˜å‚¨åˆ°å…¶ä»–é¡µä¸­ï¼Œè¿™ç§ç°è±¡ç§°ä¸º è¡Œæº¢å‡º ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šåœ¨ Compact å’Œ Reduntant è¡Œæ ¼å¼ä¸­ï¼Œåœ¨ è®°å½•çš„çœŸå®æ•°æ® å¤„åªä¼šå­˜å‚¨è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒæŠŠå‰©ä½™çš„æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å‡ ä¸ªå…¶ä»–çš„é¡µä¸­ï¼Œç„¶å è®°å½•çš„çœŸå®æ•°æ® å¤„ç”¨20ä¸ªå­—èŠ‚å­˜å‚¨æŒ‡å‘è¿™äº›é¡µçš„åœ°å€ï¼ˆå½“ç„¶è¿™20ä¸ªå­—èŠ‚ä¸­è¿˜åŒ…æ‹¬è¿™äº›åˆ†æ•£åœ¨å…¶ä»–é¡µé¢ä¸­çš„æ•°æ®çš„å ç”¨çš„å­—èŠ‚æ•°ï¼‰</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091808473.png" alt="image-20230120111527905"></p><p>åªè¦çŸ¥é“å¦‚æœæˆ‘ä»¬æƒ³ä¸€ä¸ªè¡Œä¸­å­˜å‚¨äº†å¾ˆå¤§çš„æ•°æ®æ—¶ï¼Œå¯èƒ½å‘ç”Ÿ è¡Œæº¢å‡º çš„ç°è±¡</p><p>ç´¢å¼•é¡µï¼ˆæ•°æ®é¡µï¼‰ç»“æ„</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091808995.png" alt="image-20230120143359530"></p><p><strong>è®°å½•å¤´ä¿¡æ¯</strong></p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091808206.png" alt="image-20230120144359136"></p><p>delete_maskï¼šæ ‡è®°ç€å½“å‰è®°å½•æ˜¯å¦è¢«åˆ é™¤ã€‚ç«‹å³åˆ é™¤é‡æ–°æ’åˆ—å½±å“æ€§èƒ½ï¼Œæ‰€æœ‰è¢«åˆ é™¤æ‰çš„è®°å½•éƒ½ä¼šç»„æˆä¸€ä¸ªæ‰€è°“çš„ åƒåœ¾é“¾è¡¨ ï¼Œåœ¨è¿™ä¸ªé“¾è¡¨ä¸­çš„è®°å½•å ç”¨çš„ç©ºé—´ç§°ä¹‹ä¸ºæ‰€è°“çš„ å¯é‡ç”¨ç©ºé—´ ï¼Œä¹‹åå¦‚æœæœ‰æ–°è®°å½•æ’å…¥åˆ°è¡¨ä¸­çš„è¯ï¼Œå¯èƒ½æŠŠè¿™äº›è¢«åˆ é™¤çš„è®°å½•å ç”¨çš„å­˜å‚¨ç©ºé—´è¦†ç›–æ‰</p><p>min_rec_maskï¼š</p><p>heap_noï¼šå½“å‰è®°å½•åœ¨æœ¬ é¡µ ä¸­çš„ä½ç½®ï¼Œinnodbè‡ªåŠ¨ç»™é¡µæ·»åŠ ä¼ªè®°å½•ï¼ˆè™šæ‹Ÿè®°å½•ï¼‰ï¼Œåˆ†åˆ«æ˜¯æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ï¼Œä»¥å®ƒä»¬å¹¶ä¸å­˜æ”¾åœ¨ é¡µ çš„ User Records éƒ¨åˆ†ï¼Œä»–ä»¬è¢«å•ç‹¬æ”¾åœ¨ Infimum + Supremum ã€‚</p><p>record_typeï¼š 0 è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ 1 è¡¨ç¤ºB+æ ‘éå¶èŠ‚ç‚¹è®°å½•ï¼Œ 2 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ 3 è¡¨ç¤ºæœ€å¤§è®°å½•</p><p>next_recordï¼šä»å½“å‰è®°å½•çš„çœŸå®æ•°æ®åˆ°ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®çš„åœ°å€åç§»é‡ã€‚<strong>Infimum</strong>è®°å½•ï¼ˆä¹Ÿå°±æ˜¯æœ€å°è®°å½•ï¼‰ çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯</p><p>æœ¬é¡µä¸­ä¸»é”®å€¼æœ€å°çš„ç”¨æˆ·è®°å½•ï¼Œè€Œæœ¬é¡µä¸­ä¸»é”®å€¼æœ€å¤§çš„ç”¨æˆ·è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯ <strong>Supremum</strong>è®°å½•ï¼ˆä¹Ÿå°±æ˜¯æœ€å¤§è®°å½•ï¼‰</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091808925.png" alt="image-20230207152610054"></p><p>è®°å½•åœ¨é¡µä¸­æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§é¡ºåºä¸²è”æˆä¸€ä¸ªå•é“¾è¡¨</p><p><strong>Page Directoryé¡µç›®å½•</strong></p><ul><li>å°†è®°å½•åˆ’åˆ†ç»„</li></ul><p>å¯¹æ¯ä¸ªåˆ†ç»„ä¸­çš„è®°å½•æ¡æ•°æ˜¯æœ‰è§„å®šçš„ï¼šå¯¹äºæœ€å°è®°å½•æ‰€åœ¨çš„åˆ†ç»„åªèƒ½æœ‰ <strong>1</strong> æ¡è®°å½•ï¼Œæœ€å¤§è®°å½•æ‰€åœ¨çš„åˆ†ç»„æ‹¥æœ‰çš„è®°å½•æ¡æ•°åªèƒ½åœ¨ <strong>1~8</strong> æ¡ä¹‹é—´ï¼Œå‰©ä¸‹çš„åˆ†ç»„ä¸­è®°å½•çš„æ¡æ•°èŒƒå›´åªèƒ½åœ¨æ˜¯ <strong>4~8</strong> æ¡ä¹‹é—´</p><ul><li>æ¯ç»„æœ€åä¸€æ¡è®°å½•ä½¿ç”¨n_ownedæ ‡è®°è¯¥ç»„æ‹¥æœ‰å‡ æ¡è®°å½•</li><li>æŠŠæ¯ç»„çš„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡æŒ‰é¡ºåºå­˜å‚¨åˆ°é¡µçš„å°¾éƒ¨ï¼ˆé¡µç›®å½•ï¼‰ï¼Œé¡µç›®å½•ä¸­çš„åœ°å€åç§»é‡ç§°ä½œslotæ§½</li></ul><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091808381.png" alt="image-20230120151640564"></p><p>åœ¨ä¸€ä¸ªæ•°æ®é¡µä¸­æŸ¥æ‰¾ä¸»é”®è®°å½•çš„è¿‡ç¨‹</p><ul><li><p>é€šè¿‡äºŒåˆ†æ³•ç¡®å®šè¯¥è®°å½•æ‰€åœ¨çš„æ§½ï¼Œå¹¶æ‰¾åˆ°è¯¥æ§½ä¸­ä¸»é”®å€¼æœ€å°çš„é‚£æ¡è®°å½•ã€‚ </p></li><li><p>é€šè¿‡è®°å½•çš„ next_record å±æ€§éå†è¯¥æ§½æ‰€åœ¨çš„ç»„ä¸­çš„å„ä¸ªè®°å½•ã€‚</p></li></ul><p><strong>Page Headeré¡µå¤´</strong></p><p>é¡µ ç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†å ç”¨å›ºå®šçš„ 56 ä¸ªå­—èŠ‚ï¼Œä¸“é—¨å­˜å‚¨å„ç§çŠ¶æ€ä¿¡æ¯</p><p><strong>File Headeræ–‡ä»¶å¤´éƒ¨</strong></p><p>å›ºå®šå ç”¨çš„ 38 ä¸ªå­—èŠ‚ï¼Œé’ˆå¯¹ æ•°æ®é¡µ è®°å½•çš„å„ç§çŠ¶æ€ä¿¡æ¯</p><p><strong>File Trailer</strong></p><p>ä¸ºä¿è¯ä»å†…å­˜ä¸­åŒæ­¥åˆ°ç£ç›˜çš„é¡µçš„å®Œæ•´æ€§ï¼Œåœ¨é¡µçš„é¦–éƒ¨å’Œå°¾éƒ¨éƒ½ä¼šå­˜å‚¨é¡µä¸­æ•°æ®çš„æ ¡éªŒå’Œå’Œé¡µé¢æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„ LSN å€¼ï¼Œå¦‚æœé¦–éƒ¨å’Œå°¾éƒ¨çš„æ ¡éªŒå’Œå’Œ LSN å€¼æ ¡éªŒä¸æˆåŠŸçš„è¯ï¼Œå°±è¯´æ˜åŒæ­¥è¿‡ç¨‹å‡ºç°äº†é—®é¢˜</p><h5 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h5><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091808692.png" alt="image-20230207150852788"></p><p>é¡µåˆ†è£‚ï¼šåœ¨å¯¹é¡µä¸­çš„è®°å½•è¿›è¡Œå¢åˆ æ”¹æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ä¸€äº›è¯¸å¦‚è®°å½•ç§»åŠ¨çš„æ“ä½œæ¥å§‹ç»ˆä¿è¯è¿™ä¸ªçŠ¶æ€ä¸€ç›´æˆç«‹ï¼šä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202302091808442.png" alt="image-20230207160245808"></p><p>å¶å­ç»“ç‚¹æ˜¯ç”¨æˆ·è®°å½•ï¼Œéå¶å­ç»“ç‚¹æ˜¯ç›®å½•é¡¹çºªå½•</p><p>èšç°‡ç´¢å¼•ï¼šInnoDB å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨çš„ä¸ºæˆ‘ä»¬åˆ›å»ºèšç°‡ç´¢å¼•ã€‚</p><ul><li>ä½¿ç”¨è®°å½•ä¸»é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åº</li><li>B+ æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯<strong>å®Œæ•´çš„ç”¨æˆ·è®°å½•</strong></li></ul><p>äºŒçº§ç´¢å¼•ï¼šåœ¨äºŒçº§ç´¢å¼•æ ¹æ®ç´¢å¼•åˆ—æŸ¥åˆ°å¯¹åº”ä¸»é”®ï¼Œæ ¹æ®ä¸»é”®åœ¨èšç°‡ç´¢å¼•æ‰¾å®Œæ•´æ•°æ®ï¼ˆå›è¡¨ï¼‰</p><ul><li>ä½¿ç”¨è®°å½•ç´¢å¼•åˆ—çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åº</li><li>B+ æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„å¹¶ä¸æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè€Œåªæ˜¯ç´¢å¼•åˆ—+ä¸»é”® è¿™ä¸¤ä¸ªåˆ—çš„å€¼ã€‚</li><li>ç›®å½•é¡¹è®°å½•ä¸­ä¸å†æ˜¯ ä¸»é”®+é¡µå· çš„æ­é…ï¼Œè€Œå˜æˆäº† ç´¢å¼•åˆ—+é¡µå· çš„æ­é…</li></ul><p>è”åˆç´¢å¼•ï¼šåŒæ—¶ä»¥å¤šä¸ªåˆ—çš„å¤§å°ä½œä¸ºæ’åºè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ä¸ºå¤šä¸ªåˆ—å»ºç«‹ç´¢å¼•</p><p><strong>è®°å½•æ’å…¥B+æ ‘è¿‡ç¨‹</strong>ï¼š</p><ul><li>æ ¹ç»“ç‚¹ï¼ˆè¡¨è‡ªåŠ¨ç”Ÿæˆï¼‰</li><li>è®°å½•æ’å…¥æ ¹èŠ‚ç‚¹</li><li>å†æ’å…¥æ•°æ® æ ¹èŠ‚ç‚¹ç©ºé—´ä¸è¶³ å¤åˆ¶æ ¹èŠ‚ç‚¹</li><li>é¡µåˆ†è£‚ï¼ˆä¸¤ä¸ªå­èŠ‚ç‚¹ï¼‰</li><li>æ ¹èŠ‚ç‚¹ ä¾¿å‡çº§ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µã€‚</li></ul><p><strong>ç»“è®º</strong>ï¼š</p><p>æ¯ä¸ªç´¢å¼•éƒ½å¯¹åº”ä¸€æ£µ B+ æ ‘ï¼Œ B+ æ ‘åˆ†ä¸ºå¥½å¤šå±‚ï¼Œæœ€ä¸‹è¾¹ä¸€å±‚æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå…¶ä½™çš„æ˜¯å†…èŠ‚ç‚¹ã€‚æ‰€æœ‰ç”¨æˆ·è®°å½•éƒ½å­˜å‚¨åœ¨ B+ æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæ‰€æœ‰ ç›®å½•é¡¹è®°å½• éƒ½å­˜å‚¨åœ¨å†…èŠ‚ç‚¹ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨ä¸ºä¸»é”®ï¼ˆå¦‚æœæ²¡æœ‰å®ƒä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ·»åŠ ï¼‰å»ºç«‹ èšç°‡ç´¢å¼• ï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä¸ºè‡ªå·±æ„Ÿå…´è¶£çš„åˆ—å»ºç«‹ äºŒçº§ç´¢å¼• ï¼Œ äºŒçº§ç´¢å¼• çš„å¶å­èŠ‚ç‚¹åŒ…å«çš„ç”¨æˆ·è®°å½•ç”± ç´¢å¼•åˆ— + ä¸»é”® ç»„æˆï¼Œæ‰€ä»¥å¦‚æœæƒ³é€šè¿‡ äºŒçº§ç´¢å¼• æ¥æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œéœ€è¦é€šè¿‡ å›è¡¨ æ“ä½œï¼Œä¹Ÿå°±æ˜¯åœ¨é€šè¿‡ äºŒçº§ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼ä¹‹åå†åˆ° èšç°‡ç´¢å¼• ä¸­æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚B+ æ ‘ä¸­æ¯å±‚èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—å€¼ä»å°åˆ°å¤§çš„é¡ºåºæ’åºè€Œç»„æˆäº†åŒå‘é“¾è¡¨ï¼Œè€Œä¸”æ¯ä¸ªé¡µå†…çš„è®°å½•ï¼ˆä¸è®ºæ˜¯ç”¨æˆ·è®°å½•è¿˜æ˜¯ç›®å½•é¡¹è®°å½•ï¼‰éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºè€Œå½¢æˆäº†ä¸€ä¸ªå•é“¾è¡¨ã€‚å¦‚æœæ˜¯ è”åˆç´¢å¼• çš„è¯ï¼Œåˆ™é¡µé¢å’Œè®°å½•å…ˆæŒ‰ç…§ è”åˆç´¢å¼• å‰è¾¹çš„åˆ—æ’åºï¼Œå¦‚æœè¯¥åˆ—å€¼ç›¸åŒï¼Œå†æŒ‰ç…§ è”åˆç´¢å¼• åè¾¹çš„åˆ—æ’åºã€‚é€šè¿‡ç´¢å¼•æŸ¥æ‰¾è®°å½•æ˜¯ä» B+ æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¸€å±‚ä¸€å±‚å‘ä¸‹æœç´¢ã€‚ç”±äºæ¯ä¸ªé¡µé¢éƒ½æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼å»ºç«‹äº†Page Directory ï¼ˆé¡µç›®å½•ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™äº›é¡µé¢ä¸­çš„æŸ¥æ‰¾éå¸¸å¿«ã€‚</p><p><strong>ç´¢å¼•çš„ä»£ä»·</strong></p><ul><li>ç©ºé—´ä¸Šçš„ä»£ä»·</li><li>æ—¶é—´ä¸Šçš„ä»£ä»·</li></ul><p>â€‹æ¯æ¬¡å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å»ä¿®æ”¹å„ä¸ª B+ æ ‘ç´¢å¼•ã€‚</p><blockquote><p>æœç´¢è¯­å¥ä¸­ä¹Ÿå¯ä»¥ä¸ç”¨åŒ…å«å…¨éƒ¨è”åˆç´¢å¼•ä¸­çš„åˆ—ï¼ŒåªåŒ…å«å·¦è¾¹çš„å°±è¡Œ</p><p>å‰ç¼€éƒ½æ˜¯æ’å¥½åºçš„ï¼Œæ‰€ä»¥å¯¹äºå­—ç¬¦ä¸²ç±»å‹çš„ç´¢å¼•åˆ—æ¥è¯´ï¼Œæˆ‘ä»¬åªåŒ¹é…å®ƒçš„å‰ç¼€ä¹Ÿæ˜¯å¯ä»¥å¿«é€Ÿå®šä½è®°å½•</p><p>è”åˆç´¢å¼•ï¼Œå¦‚æœå¯¹å¤šä¸ªåˆ—åŒæ—¶è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œåªæœ‰å¯¹ç´¢å¼•æœ€å·¦è¾¹çš„é‚£ä¸ªåˆ—è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™æ‰èƒ½ç”¨åˆ° B+ æ ‘ç´¢å¼•</p><p>äºåŒä¸€ä¸ªè”åˆç´¢å¼•æ¥è¯´ï¼Œè™½ç„¶å¯¹å¤šä¸ªåˆ—éƒ½è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾æ—¶åªèƒ½ç”¨åˆ°æœ€å·¦è¾¹é‚£ä¸ªç´¢å¼•åˆ—ï¼Œä½†æ˜¯å¦‚æœå·¦è¾¹çš„åˆ—æ˜¯ç²¾ç¡®æŸ¥æ‰¾ï¼Œåˆ™å³è¾¹çš„åˆ—å¯ä»¥è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾</p></blockquote><p><strong>ä¸å¯ä»¥ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºçš„å‡ ç§æƒ…å†µ</strong></p><ul><li><strong>DESC</strong>æ··ç”¨</li><li><strong>WHERE</strong>å­å¥ä¸­å‡ºç°éæ’åºä½¿ç”¨åˆ°çš„ç´¢å¼•åˆ—</li><li>æ’åºåˆ—åŒ…å«éåŒä¸€ä¸ªç´¢å¼•çš„åˆ—</li><li>æ’åºåˆ—ä½¿ç”¨äº†å¤æ‚çš„è¡¨è¾¾å¼</li></ul><p><strong>å›è¡¨</strong></p><p>éœ€è¦å›è¡¨çš„è®°å½•è¶Šå¤šï¼Œä½¿ç”¨äºŒçº§ç´¢å¼•çš„æ€§èƒ½å°±è¶Šä½ï¼Œ</p><p>ä¸ºäº†å½»åº•å‘Šåˆ« å›è¡¨ æ“ä½œå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œæˆ‘ä»¬å»ºè®®ï¼šæœ€å¥½åœ¨æŸ¥è¯¢åˆ—è¡¨é‡ŒåªåŒ…å«ç´¢å¼•åˆ—ï¼Œ</p><p>ç´¢å¼•å­—ç¬¦ä¸²å€¼çš„å‰ç¼€ ï¼š åªå¯¹å­—ç¬¦ä¸²çš„å‰å‡ ä¸ªå­—ç¬¦è¿›è¡Œç´¢å¼•</p><blockquote><p>KEY idx_name_birthday_phone_number (name(10), birthday, phone_number)</p></blockquote><p>å¦‚æœç´¢å¼•åˆ—åœ¨æ¯”è¾ƒè¡¨è¾¾å¼ä¸­ä¸æ˜¯ä»¥å•ç‹¬åˆ—çš„å½¢å¼å‡ºç°ï¼Œè€Œæ˜¯ä»¥æŸä¸ªè¡¨è¾¾å¼ï¼Œæˆ–è€…å‡½æ•°è°ƒç”¨å½¢å¼å‡ºç°çš„è¯ï¼Œæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„</p><p><strong>ä¸»é”®æ’å…¥é¡ºåº</strong></p><p>ä¸­é—´æ’å…¥ä¸»é”®ä¼šå¯¼è‡´é¡µåˆ†è£‚ï¼Œå¯¼è‡´æ€§èƒ½æŸè€—ï¼Œæœ€å¥½è®©æ’å…¥çš„è®°å½•çš„ä¸»é”®å€¼ä¾æ¬¡é€’å¢ï¼Œè¿™æ ·å°±ä¸ä¼šå‘ç”Ÿè¿™æ ·çš„æ€§èƒ½æŸè€—äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å»ºè®®ï¼šè®©ä¸»é”®å…·æœ‰ AUTO_INCREMENT ï¼Œè®©å­˜å‚¨å¼•æ“è‡ªå·±ä¸ºè¡¨ç”Ÿæˆä¸»é”®ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ’å…¥</p><p>ç»“è®ºï¼š</p><ol><li><p>B+ æ ‘ç´¢å¼•åœ¨ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½æœ‰ä»£ä»·ï¼Œæ‰€ä»¥æ²¡äº‹å„¿åˆ«çå»ºç´¢å¼•ã€‚</p></li><li><p>B+ æ ‘ç´¢å¼•é€‚ç”¨äºä¸‹è¾¹è¿™äº›æƒ…å†µï¼š</p></li></ol><p>å…¨å€¼åŒ¹é…</p><p>åŒ¹é…å·¦è¾¹çš„åˆ—</p><p>åŒ¹é…èŒƒå›´å€¼</p><p>ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—</p><p>ç”¨äºæ’åº</p><p>ç”¨äºåˆ†ç»„</p><ol start="3"><li>åœ¨ä½¿ç”¨ç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä¸‹è¾¹è¿™äº›äº‹é¡¹ï¼š</li></ol><p>åªä¸ºç”¨äºæœç´¢ã€æ’åºæˆ–åˆ†ç»„çš„åˆ—åˆ›å»ºç´¢å¼•</p><p>ä¸ºåˆ—çš„åŸºæ•°å¤§çš„åˆ—åˆ›å»ºç´¢å¼•</p><p>ç´¢å¼•åˆ—çš„ç±»å‹å°½é‡å°</p><p>å¯ä»¥åªå¯¹å­—ç¬¦ä¸²å€¼çš„å‰ç¼€å»ºç«‹ç´¢å¼•</p><p>åªæœ‰ç´¢å¼•åˆ—åœ¨æ¯”è¾ƒè¡¨è¾¾å¼ä¸­å•ç‹¬å‡ºç°æ‰å¯ä»¥é€‚ç”¨ç´¢å¼•</p><p>ä¸ºäº†å°½å¯èƒ½å°‘çš„è®© èšç°‡ç´¢å¼• å‘ç”Ÿé¡µé¢åˆ†è£‚å’Œè®°å½•ç§»ä½çš„æƒ…å†µï¼Œå»ºè®®è®©ä¸»é”®æ‹¥æœ‰ AUTO_INCREMENT å±æ€§ã€‚</p><p>å®šä½å¹¶åˆ é™¤è¡¨ä¸­çš„é‡å¤å’Œå†—ä½™ç´¢å¼•</p><p>å°½é‡ä½¿ç”¨ è¦†ç›–ç´¢å¼• è¿›è¡ŒæŸ¥è¯¢ï¼Œé¿å… å›è¡¨ å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p><h4 id="InnoDBçš„è¡¨ç©ºé—´"><a href="#InnoDBçš„è¡¨ç©ºé—´" class="headerlink" title="InnoDBçš„è¡¨ç©ºé—´"></a>InnoDBçš„è¡¨ç©ºé—´</h4><p>åŒº ï¼ˆ extent ï¼‰ï¼š64é¡µ</p><p>æ®µï¼ˆ<strong>segment</strong>ï¼‰ï¼šå­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆå°±ç®—æ˜¯ä¸€ä¸ª æ®µ ï¼ˆ segment ï¼‰ï¼Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆä¹Ÿç®—æ˜¯ä¸€ä¸ª æ®µ ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç´¢å¼•ä¼šç”Ÿæˆ2ä¸ªæ®µï¼Œä¸€ä¸ªå¶å­èŠ‚ç‚¹æ®µï¼Œä¸€ä¸ªéå¶å­èŠ‚ç‚¹æ®µã€‚é“¾è¡¨ä¸­ç›¸é‚»çš„ä¸¤ä¸ªé¡µï¼Œç‰©ç†ä½ç½®å¯èƒ½ç¦»å¾—éå¸¸è¿œï¼Œä¼šäº§ç”Ÿ éšæœºI&#x2F;Oï¼Œåœ¨ç£ç›˜ä¸­è®¿é—®é€Ÿåº¦æ…¢ï¼Œå°½é‡æŠŠé¡µæ”¾åœ¨ç›¸é‚»çš„ä½ç½®</p><ul><li><p>åœ¨åˆšå¼€å§‹å‘è¡¨ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ®µæ˜¯ä»æŸä¸ªç¢ç‰‡åŒºä»¥å•ä¸ªé¡µé¢ä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´çš„ã€‚</p></li><li><p>å½“æŸä¸ªæ®µå·²ç»å ç”¨äº†32ä¸ªç¢ç‰‡åŒºé¡µé¢ä¹‹åï¼Œå°±ä¼šä»¥å®Œæ•´çš„åŒºä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Javascriptä¿®æ”¹vueè¾“å…¥æ¡†çš„å€¼</title>
    <link href="/2023/01/18/Javascript%E4%BF%AE%E6%94%B9vue%E8%BE%93%E5%85%A5%E6%A1%86%E7%9A%84%E5%80%BC/"/>
    <url>/2023/01/18/Javascript%E4%BF%AE%E6%94%B9vue%E8%BE%93%E5%85%A5%E6%A1%86%E7%9A%84%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<p>vue æ˜¯é€šè¿‡<a href="https://so.csdn.net/so/search?q=input%E4%BA%8B%E4%BB%B6&spm=1001.2101.3001.7020">inputäº‹ä»¶</a>æ¥è§¦å‘åŒå‘ç»‘å®šçš„ï¼Œè€Œä½ ç”¨å•çº¯çš„js å»ä¿®æ”¹inputå€¼ï¼Œå¹¶æ²¡æœ‰è§¦å‘ä»–çš„inputäº‹ä»¶ï¼Œé€šè¿‡ä¸‹æ–¹ä»£ç ï¼Œè¿›è¡Œè§¦å‘å³å¯ã€‚ä¸¤ç§æ–¹å¼é€‰å…¶ä¸€å³å¯ã€‚</p><blockquote><ol><li><p>event.target.dispatchEvent(new Event(â€˜inputâ€™));</p></li><li><p>el.dispatchEvent(new Event(â€˜inputâ€™));</p></li></ol></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>nginx:æ ¹æ®äºŒçº§åŸŸåè‡ªåŠ¨åˆ†å‘å¯¹åº”æ–‡ä»¶å¤¹ç›®å½•</title>
    <link href="/2023/01/18/nginx-%E5%8A%A8%E6%80%81%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E8%87%AA%E5%8A%A8%E5%88%86%E5%8F%91%E5%AF%B9%E5%BA%94%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9B%AE%E5%BD%95/"/>
    <url>/2023/01/18/nginx-%E5%8A%A8%E6%80%81%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E8%87%AA%E5%8A%A8%E5%88%86%E5%8F%91%E5%AF%B9%E5%BA%94%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9B%AE%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹</p><p><a href="http://site-1.cason.work/">http://site-1.cason.work</a> æ˜ å°„åˆ° &#x2F;www&#x2F;site&#x2F;1&#x2F; ç›®å½•</p><p><a href="http://site-2.cason.work/">http://site-2.cason.work</a> æ˜ å°„åˆ° &#x2F;www&#x2F;site&#x2F;2&#x2F; ç›®å½•</p><figure class="highlight json"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><pre><code class="hljs json">server <span class="hljs-punctuation">&#123;</span><br>       listen       <span class="hljs-number">80</span>;<br>        server_name  ~^site\-(?&lt;subdomain&gt;.+)\.cason\.work$;<br>        root   /www/site/$subdomain/;<br>        index  index.html index.htm ;<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œ<code>server_name</code>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ•è·äº†äºŒçº§åŸŸåçš„åç§°ï¼Œæ•è·ç»“æœä¿å­˜åœ¨åä¸º<code>subdomain</code>çš„å˜é‡ä¸­ã€‚åœ¨<code>root</code>ä¸­ä½¿ç”¨<code>$subdomain</code>å˜é‡ï¼ŒæŒ‡å®šäº†è¯¥è™šæ‹Ÿä¸»æœºå¯¹åº”çš„æ–‡ä»¶å¤¹ç›®å½•ï¼Œå³è®¿é—®å¯¹åº”çš„äºŒçº§åŸŸåæ—¶æ˜¾ç¤ºçš„æ–‡ä»¶å¤¹å†…çš„å†…å®¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Tiktok Shop ç”Ÿæˆsignatureï¼ˆjavaï¼‰</title>
    <link href="/2023/01/10/Tiktok-Shop-%E7%94%9F%E6%88%90signature%EF%BC%88java%EF%BC%89/"/>
    <url>/2023/01/10/Tiktok-Shop-%E7%94%9F%E6%88%90signature%EF%BC%88java%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>tiktok å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://partner.tiktokshop.com/doc/page/261251">TikTok Shop Partner Center</a></p><p>å› ä¸ºtiktokå®˜æ–¹æ–‡æ¡£ç”Ÿæˆsignatureåªæœ‰goè¯­è¨€ç‰ˆæœ¬çš„</p><p>æ‰€ä»¥è®°å½•ä¸€ä¸‹javaç‰ˆæœ¬ç”Ÿæˆtiktok shop è¯·æ±‚open apiæ—¶éœ€è¦çš„signature</p><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getSignature</span><span class="hljs-params">(String uri, Map&lt;String, String&gt; parametersMap, String appSecret)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Map&lt;String, String&gt; tempParamsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;(Comparator.naturalOrder());<br>        tempParamsMap.putAll(parametersMap);<br>        tempParamsMap.remove(<span class="hljs-string">&quot;sign&quot;</span>);<br>        tempParamsMap.remove(<span class="hljs-string">&quot;access_token&quot;</span>);<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(uri);<br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : tempParamsMap.entrySet()) &#123;<br>            input.append(entry.getKey()).append(entry.getValue());<br>        &#125;<br>        input = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(appSecret + input + appSecret);<br>        <span class="hljs-keyword">return</span> hmacSHA256(appSecret, input.toString());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * sha256_HMACåŠ å¯†</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message æ¶ˆæ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> secret  ç§˜é’¥</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> åŠ å¯†åå­—ç¬¦ä¸²</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">hmacSHA256</span><span class="hljs-params">(String secret, String message)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Mac</span> <span class="hljs-variable">hmacSha256</span> <span class="hljs-operator">=</span> Mac.getInstance(<span class="hljs-string">&quot;HmacSHA256&quot;</span>);<br>        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secret_key</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(secret.getBytes(), <span class="hljs-string">&quot;HmacSHA256&quot;</span>);<br>        hmacSha256.init(secret_key);<br>        <span class="hljs-type">byte</span>[] bytes = hmacSha256.doFinal(message.getBytes());<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">hs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        String stmp;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; bytes != <span class="hljs-literal">null</span> &amp;&amp; n &lt; bytes.length; n++) &#123;<br>            stmp = Integer.toHexString(bytes[n] &amp; <span class="hljs-number">0XFF</span>);<br>            <span class="hljs-keyword">if</span> (stmp.length() == <span class="hljs-number">1</span>)<br>                hs.append(<span class="hljs-string">&#x27;0&#x27;</span>);<br>            hs.append(stmp);<br>        &#125;<br>        <span class="hljs-keyword">return</span> hs.toString().toLowerCase();<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="è°ƒç”¨æ–¹æ³•"><a href="#è°ƒç”¨æ–¹æ³•" class="headerlink" title="è°ƒç”¨æ–¹æ³•"></a>è°ƒç”¨æ–¹æ³•</h3><p>åŸæ¥çš„urlå‚æ•°åŠ ä¸Šapp_keyå’Œtimestampå³å¯</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202301101729177.png" alt="image-20230110172708810"></p>]]></content>
    
    
    <categories>
      
      <category>å¤–è´¸ç”µå•†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tiktok shop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WooCommerceæ­å»ºï¼ˆdockerï¼‰</title>
    <link href="/2023/01/04/WooCommerce%E6%90%AD%E5%BB%BA%EF%BC%88docker%EF%BC%89/"/>
    <url>/2023/01/04/WooCommerce%E6%90%AD%E5%BB%BA%EF%BC%88docker%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>å¹³å°å¯¹æ¥WooCommerce api è®°å½•ä¸€ä¸‹åˆ›å»ºè¿‡ç¨‹</p><blockquote><p>apiåœ°å€:<a href="https://woocommerce.github.io/woocommerce-rest-api-docs/?python&from_wecom=1#introduction">Introduction â€“ WooCommerce REST API Documentation - WP REST API v3</a></p></blockquote><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><p><code>docker pull mysql  </code></p><p><code>docker run --name mysql -e MYSQL_ROOT_PASSWORD=&lt;å¯†ç &gt; -p 3306:3306 -d mysql</code></p><p>åˆ›å»ºä¸€ä¸ªDB ï¼šwordpress ç¼–ç utf8mb4</p><h2 id="wordpress"><a href="#wordpress" class="headerlink" title="wordpress"></a>wordpress</h2><p><code>docker pull wordpress:latest</code></p><p><code>docker run -d --name wordpress -e WORDPRESS_DB_HOST=mysql -e WORDPRESS_DB_USER=root -e WORDPRESS_DB_PASSWORD=&lt;mysqlå¯†ç &gt; -e WORDPRESS_DB_NAME=wordpress -p 80:80 --link mysql:mysql wordpress</code></p><p>æœ€å¥½ä½¿ç”¨80ç«¯å£ å¦åˆ™wordpress rest apiæ— æ³•ä½¿ç”¨</p><h2 id="WooCommerce"><a href="#WooCommerce" class="headerlink" title="WooCommerce"></a>WooCommerce</h2><p>åœ¨Pluginså®‰è£…WooCommerce</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202301041630702.png" alt="image-20230104162118061"></p>]]></content>
    
    
    <categories>
      
      <category>å¤–è´¸ç”µå•†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>woocommerce</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®—æ³•ç¬”è®°</title>
    <link href="/2022/12/27/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/12/27/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h1><p>ç‰¹å¾</p><ul><li>è‡ªèº«è°ƒç”¨ï¼šåŸé—®é¢˜å¯ä»¥åˆ†è§£ä¸ºå­é—®é¢˜ï¼Œå­é—®é¢˜å’ŒåŸé—®é¢˜çš„æ±‚è§£æ–¹æ³•æ˜¯ä¸€è‡´çš„ï¼Œå³éƒ½æ˜¯è°ƒç”¨è‡ªèº«çš„åŒä¸€ä¸ªå‡½æ•°ã€‚</li><li>ç»ˆæ­¢æ¡ä»¶ï¼šé€’å½’å¿…é¡»æœ‰ä¸€ä¸ªç»ˆæ­¢çš„æ¡ä»¶ï¼Œå³ä¸èƒ½æ— é™å¾ªç¯åœ°è°ƒç”¨æœ¬èº«ã€‚</li></ul><p>è§£å†³é€’å½’é—®é¢˜ä¸‰æ­¥æ›²</p><ul><li>ç¬¬ä¸€æ­¥ï¼Œå®šä¹‰å‡½æ•°åŠŸèƒ½</li><li>ç¬¬äºŒæ­¥ï¼Œå¯»æ‰¾é€’å½’ç»ˆæ­¢æ¡ä»¶</li><li>ç¬¬äºŒæ­¥ï¼Œé€’æ¨å‡½æ•°çš„ç­‰ä»·å…³ç³»å¼</li></ul><p>é€’å½’å­˜åœ¨çš„é—®é¢˜</p><ul><li>é€’å½’è°ƒç”¨å±‚çº§å¤ªå¤šï¼Œå¯¼è‡´æ ˆæº¢å‡ºé—®é¢˜<ul><li>è°ƒå¤§JVMçš„æ ˆç©ºé—´å†…å­˜</li><li>ä¼˜åŒ–ä¸€ä¸‹ä½ çš„é€’å½’</li></ul></li><li>é€’å½’é‡å¤è®¡ç®—ï¼Œå¯¼è‡´æ•ˆç‡ä½ä¸‹<ul><li>å¤‡å¿˜å½•</li></ul></li></ul><blockquote><p><strong>ã€Œé¢˜ç›®ï¼šã€</strong> ç¿»è½¬ä¸€æ£µäºŒå‰æ ‘ã€‚</p><p><a href="https://leetcode-cn.com/problems/invert-binary-tree/">https://leetcode-cn.com/problems/invert-binary-tree/</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for a binary tree node.</span><br><span class="hljs-comment"> * public class TreeNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     TreeNode left;</span><br><span class="hljs-comment"> *     TreeNode right;</span><br><span class="hljs-comment"> *     TreeNode() &#123;&#125;</span><br><span class="hljs-comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span><br><span class="hljs-comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span><br><span class="hljs-comment"> *         this.val = val;</span><br><span class="hljs-comment"> *         this.left = left;</span><br><span class="hljs-comment"> *         this.right = right;</span><br><span class="hljs-comment"> *     &#125;</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br> <span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">invertTree</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>        <span class="hljs-comment">//èŠ‚ç‚¹ä¸ºç©º æˆ– ä¸ä¸ºå¶å­èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span> || (root.left == <span class="hljs-literal">null</span> &amp;&amp; root.right == <span class="hljs-literal">null</span>)) &#123;<br>            <span class="hljs-keyword">return</span> root;<br>        &#125;<br>        <span class="hljs-comment">//ç¿»è½¬å·¦å­æ ‘</span><br>        invertTree(root.left);<br>        <span class="hljs-comment">//ç¿»è½¬å³å­æ ‘</span><br>        invertTree(root.right);<br>        <span class="hljs-comment">//å°†å½“å‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘äº¤æ¢</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> root.left;<br>        root.left = root.right;<br>        root.right = temp;<br>        <span class="hljs-keyword">return</span> root;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å­—ç¬¦ä¸²ç›¸å…³"><a href="#å­—ç¬¦ä¸²ç›¸å…³" class="headerlink" title="å­—ç¬¦ä¸²ç›¸å…³"></a>å­—ç¬¦ä¸²ç›¸å…³</h1><h2 id="BFç®—æ³•ï¼ˆBrute-Forceï¼‰"><a href="#BFç®—æ³•ï¼ˆBrute-Forceï¼‰" class="headerlink" title="BFç®—æ³•ï¼ˆBrute Forceï¼‰"></a>BFç®—æ³•ï¼ˆBrute Forceï¼‰</h2><p>æˆ‘ä»¬å°†æ¨¡å¼ä¸²å’Œä¸»ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œä¸€è‡´æ—¶åˆ™ç»§ç»­æ¯”è¾ƒä¸‹ä¸€å­—ç¬¦ï¼Œç›´åˆ°æ¯”è¾ƒå®Œæ•´ä¸ªæ¨¡å¼ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">strStr</span><span class="hljs-params">(String haystack, String needle)</span> &#123;<br>       <span class="hljs-type">char</span>[] haystackChars = haystack.toCharArray();<br>       <span class="hljs-type">char</span>[] needleChars = needle.toCharArray();<br>       <span class="hljs-keyword">if</span> (haystackChars.length &lt; needleChars.length || StringUtils.isBlank(haystack) || StringUtils.isBlank(needle)) &#123;<br>           <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>       &#125;<br>       <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; haystackChars.length; i++) &#123;<br>           <span class="hljs-type">int</span> j;<br>           <span class="hljs-keyword">for</span> ( j= <span class="hljs-number">0</span>; j &lt; needleChars.length; j++) &#123;<br>               <span class="hljs-keyword">if</span> (haystackChars[i+j] != needleChars[j]) &#123;<br>                   <span class="hljs-keyword">break</span>;<br>               &#125;<br>           &#125;<br>           <span class="hljs-keyword">if</span> (j == needleChars.length) &#123;<br>               <span class="hljs-keyword">return</span> i;<br>           &#125;<br>       &#125;<br>       <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>   &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®ç»“æ„ç¬”è®°</title>
    <link href="/2022/12/27/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/12/27/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h1><p><strong>æ ˆï¼ˆstackï¼‰æ˜¯é™åˆ¶æ’å…¥å’Œåˆ é™¤åªèƒ½åœ¨ä¸€ä¸ªä½ç½®ä¸Šè¿›è¡Œçš„è¡¨</strong>ï¼Œè¯¥ä½ç½®æ˜¯è¡¨çš„æœ«ç«¯å«åšæ ˆçš„é¡¶ï¼ˆtopï¼‰ï¼Œå¯¹æ ˆçš„åŸºæœ¬æ“ä½œæœ‰ push(è¿›æ ˆ)å’Œ pop(å‡ºæ ˆ),å‰è€…ç›¸å½“äºæ’å…¥ï¼Œåè€…åˆ™æ˜¯åˆ é™¤æœ€åæ’å…¥çš„å…ƒç´ ã€‚</p><p>æ ˆçš„å¦ä¸€ä¸ªåå­—æ˜¯ LIFOï¼ˆå…ˆè¿›åå‡ºï¼‰è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackTest</span> &#123;<br><br>    <span class="hljs-type">int</span> len;<br>    <span class="hljs-type">int</span>[] elems;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StackTest</span><span class="hljs-params">(<span class="hljs-type">int</span> len)</span> &#123;<br>        <span class="hljs-built_in">this</span>.len = len;<br>        <span class="hljs-built_in">this</span>.elems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[len];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFull</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span>= len - <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span>= -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;empty stack&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.elems[top];<br>        top--;<br>        <span class="hljs-keyword">return</span> val;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">push</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isFull()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;full stack&quot;</span>);<br>        &#125;<br>        top++;<br>        elems[top] = i;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h1><p>åƒæ ˆä¸€æ ·ï¼Œé˜Ÿåˆ—ï¼ˆqueueï¼‰ä¹Ÿæ˜¯è¡¨ã€‚ç„¶è€Œä½¿ç”¨é˜Ÿåˆ—æ—¶æ’å…¥åœ¨ä¸€ç«¯è¿›è¡Œè€Œåˆ é™¤åœ¨å¦ä¸€ç«¯è¿›è¡Œï¼Œéµå®ˆå…ˆè¿›å…ˆå‡ºçš„è§„åˆ™ã€‚æ‰€ä»¥é˜Ÿåˆ—çš„å¦ä¸€ä¸ªåå­—æ˜¯ï¼ˆFIFOï¼‰ã€‚</p><p>é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œæ˜¯å…¥é˜Ÿï¼ˆenqueueï¼‰:å®ƒæ˜¯åœ¨è¡¨çš„æœ«ç«¯(é˜Ÿå°¾(rear)æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚å‡ºé˜Ÿï¼ˆdequeueï¼‰:å‡ºé˜Ÿä»–æ˜¯åˆ é™¤åœ¨è¡¨çš„å¼€å¤´ï¼ˆé˜Ÿå¤´(front)ï¼‰çš„å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueueTest</span> &#123;<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">rear</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">front</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> size;<br>    <span class="hljs-type">int</span>[] elems;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">QueueTest</span><span class="hljs-params">(<span class="hljs-type">int</span> size)</span> &#123;<br>        <span class="hljs-built_in">this</span>.size = size;<br>        <span class="hljs-built_in">this</span>.elems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[size];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">rear</span> <span class="hljs-operator">=</span>= front;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFull</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> (rear + <span class="hljs-number">1</span>) % <span class="hljs-built_in">this</span>.size == front;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">dequeue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;empty queue&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">this</span>.front = (<span class="hljs-built_in">this</span>.front + <span class="hljs-number">1</span>) % <span class="hljs-built_in">this</span>.size;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.elems[<span class="hljs-built_in">this</span>.front];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isFull()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;full queue&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">this</span>.rear = (<span class="hljs-built_in">this</span>.rear + <span class="hljs-number">1</span>) % <span class="hljs-built_in">this</span>.size;<br>        <span class="hljs-built_in">this</span>.elems[<span class="hljs-built_in">this</span>.rear] = val;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ•£åˆ—è¡¨"><a href="#æ•£åˆ—è¡¨" class="headerlink" title="æ•£åˆ—è¡¨"></a>æ•£åˆ—è¡¨</h1><p>æ•£åˆ—è¿‡ç¨‹</p><ul><li>é€šè¿‡<strong>æ•£åˆ—å‡½æ•°</strong>è®¡ç®—è®°å½•çš„æ•£åˆ—åœ°å€ï¼Œå¹¶æŒ‰æ­¤<strong>æ•£åˆ—åœ°å€</strong>å­˜å‚¨è¯¥è®°å½•</li><li>æŸ¥æ‰¾æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<strong>åŒæ ·çš„æ•£åˆ—å‡½æ•°</strong>è®¡ç®—è®°å½•çš„æ•£åˆ—åœ°å€ï¼ŒæŒ‰æ­¤æ•£åˆ—åœ°å€è®¿é—®è¯¥è®°å½•</li></ul><p>æ•£åˆ—å‡½æ•°æ„é€ æ–¹æ³•</p><ul><li><p>ç›´æ¥å®šå€æ³•</p></li><li><p>æ•°å­—åˆ†ææ³•</p></li><li><p>æŠ˜å æ³•</p></li><li><p>é™¤æ³•æ•£åˆ—æ³•</p></li><li><p>ä¹˜æ³•æ•£åˆ—æ³•</p></li><li><p>éšæœºæ•°æ³•</p></li><li><p>å¹³æ–¹å–ä¸­æ³•</p></li></ul><p>å¤„ç†æ•£åˆ—å†²çªçš„æ–¹æ³•</p><ul><li>å¼€æ”¾åœ°å€æ³•</li><li>é“¾åœ°å€æ³•</li><li>å…¬å…±æº¢å‡ºåŒºæ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashTest</span> &#123;<br>    KeyValue[] elements;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HashTest</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.elements = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValue</span>[size];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key,String value)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> key.hashCode() % <span class="hljs-built_in">this</span>.size;<br>        <span class="hljs-type">KeyValue</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.elements[index];<br>        <span class="hljs-keyword">if</span> (element != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">while</span> (element.next != <span class="hljs-literal">null</span>) &#123;<br>                element = element.next;<br>            &#125;<br>            <span class="hljs-type">KeyValue</span> <span class="hljs-variable">newKv</span> <span class="hljs-operator">=</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValue</span>(key, value);<br>            newKv.setNext(element);<br>            <span class="hljs-built_in">this</span>.elements[index] = newKv;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            element = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValue</span>(key, value);<br>            <span class="hljs-built_in">this</span>.elements[index] = element;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> key.hashCode() % <span class="hljs-built_in">this</span>.size;<br>        <span class="hljs-type">KeyValue</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.elements[index];<br>        <span class="hljs-keyword">while</span> (!element.getKey().equals(key)) &#123;<br>            element=element.next;<br>        &#125;<br>        <span class="hljs-keyword">return</span> element.getValue();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyValue</span> &#123;<br>        <span class="hljs-keyword">private</span> String key;<br>        <span class="hljs-keyword">private</span> String value;<br>        <span class="hljs-keyword">private</span> KeyValue next;<br><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> key;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setKey</span><span class="hljs-params">(String key)</span> &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> value;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValue</span><span class="hljs-params">(String value)</span> &#123;<br>            <span class="hljs-built_in">this</span>.value = value;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> KeyValue <span class="hljs-title function_">getNext</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> next;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNext</span><span class="hljs-params">(KeyValue next)</span> &#123;<br>            <span class="hljs-built_in">this</span>.next = next;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">KeyValue</span><span class="hljs-params">(String key, String value)</span> &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>            <span class="hljs-built_in">this</span>.value = value;<br>            <span class="hljs-built_in">this</span>.next = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h1><p>å®šä¹‰ï¼šé“¾è¡¨æ˜¯ä¸€ç§é€’å½’çš„æ•°æ®ç»“æ„ï¼Œä»–æˆ–è€…ä¸ºç©ºï¼ˆnullï¼‰ï¼Œæˆ–è€…æ˜¯æŒ‡å‘ä¸€ä¸ªç»“ç‚¹ï¼ˆnodeï¼‰çš„å¼•ç”¨ï¼Œè¯¥ç»“ç‚¹å«æœ‰ä¸€ä¸ªæ³›å‹çš„å…ƒç´ å’Œä¸€ä¸ªæŒ‡å‘å¦ä¸€æ¡é“¾è¡¨çš„å¼•ç”¨ã€‚æ˜¯ä¸€ç§çº¿æ€§è¡¨ï¼Œä½†æ˜¯ä»–ä¸æ˜¯æŒ‰çº¿æ€§é¡ºåºå­˜å–æ•°æ®ã€‚é“¾è¡¨åœ¨å†…å­˜ä¸æ˜¯è¿ç»­åˆ†é…çš„</p><p>é“¾è¡¨çš„ç±»å‹</p><ul><li>å•é“¾è¡¨</li><li>åŒå‘é“¾è¡¨</li></ul><h1 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h1><p>æ ‘æ˜¯ n ï¼ˆn &gt;&#x3D; 0ï¼‰ ä¸ªèŠ‚ç‚¹çš„æœ‰é™é›†ã€‚ n &#x3D; 0 æ—¶ æˆ‘ä»¬ç§°ä¹‹ä¸ºç©ºæ ‘, ç©ºæ ‘æ˜¯æ ‘çš„ç‰¹ä¾‹ã€‚</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202212281826260.png" alt="image-20221228121105999"></p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202212281826519.png" alt="image-20221228121120312"></p><p>æ•´ç†æºè‡ª<a href="https://github.com/chefyuan/algorithm-base/blob/main/animation-simulation/%E4%BA%8C%E5%8F%89%E6%A0%91/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%9F%BA%E7%A1%80.md">algorithm-base&#x2F;äºŒå‰æ ‘åŸºç¡€.md at main Â· chefyuan&#x2F;algorithm-base Â· GitHub</a></p><h2 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h2><ul><li>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤æ£µå­æ ‘ï¼Œä¹Ÿå°±æ˜¯è¯´äºŒå‰æ ‘ä¸­ä¸å­˜åœ¨åº¦å¤§äº 2 çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„åº¦å¯ä»¥ä¸º 0ï¼Œ1ï¼Œ2ã€‚</li><li>å·¦å­æ ‘å’Œå³å­æ ‘æ˜¯æœ‰é¡ºåºçš„,æœ‰å·¦å³ä¹‹åˆ†ã€‚</li><li>å‡å¦‚åªæœ‰ä¸€æ£µå­æ ‘ ï¼Œä¹Ÿè¦åŒºåˆ†å®ƒæ˜¯å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘</li></ul><h2 id="ç‰¹æ®Šçš„äºŒå‰æ ‘"><a href="#ç‰¹æ®Šçš„äºŒå‰æ ‘" class="headerlink" title="ç‰¹æ®Šçš„äºŒå‰æ ‘"></a>ç‰¹æ®Šçš„äºŒå‰æ ‘</h2><h3 id="æ»¡äºŒå‰æ ‘"><a href="#æ»¡äºŒå‰æ ‘" class="headerlink" title="æ»¡äºŒå‰æ ‘"></a>æ»¡äºŒå‰æ ‘</h3><p>æ»¡äºŒå‰æ ‘ï¼šåœ¨ä¸€æ£µäºŒå‰æ ‘ä¸­ï¼Œ<code>æ‰€æœ‰åˆ†æ”¯èŠ‚ç‚¹éƒ½å­˜åœ¨å·¦å­æ ‘å’Œå³å­æ ‘</code>ï¼Œå¹¶ä¸”<code>æ‰€æœ‰çš„å¶å­éƒ½åœ¨åŒä¸€å±‚</code></p><h3 id="å®Œå…¨äºŒå‰æ ‘"><a href="#å®Œå…¨äºŒå‰æ ‘" class="headerlink" title="å®Œå…¨äºŒå‰æ ‘"></a>å®Œå…¨äºŒå‰æ ‘</h3><p>å¶å­ç»“ç‚¹åªèƒ½å‡ºç°åœ¨æœ€ä¸‹å±‚å’Œæ¬¡ä¸‹å±‚ï¼Œä¸”æœ€ä¸‹å±‚çš„å¶å­ç»“ç‚¹é›†ä¸­åœ¨æ ‘çš„å·¦éƒ¨ã€‚</p><h3 id="æ–œäºŒå‰æ ‘"><a href="#æ–œäºŒå‰æ ‘" class="headerlink" title="æ–œäºŒå‰æ ‘"></a>æ–œäºŒå‰æ ‘</h3><p>æ–œäºŒå‰æ ‘ä¹Ÿå°±æ˜¯æ–œçš„äºŒå‰æ ‘,æ‰€æœ‰çš„èŠ‚ç‚¹åªæœ‰å·¦å­æ ‘çš„ç§°ä¸ºå·¦æ–œæ ‘,æ‰€æœ‰èŠ‚ç‚¹åªæœ‰å³å­æ ‘çš„äºŒå‰æ ‘ç§°ä¸ºå³æ–œæ ‘.</p><h3 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h3><p>å‰åºéå†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">traverse</span><span class="hljs-params">(TreeNode root, List&lt;Integer&gt; arr)</span> &#123;<br>     <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> root;<br>     &#125;<br>     arr.add(root.val);<br>     traverse(root.left, arr);<br>     traverse(root.right, arr);<br>     <span class="hljs-keyword">return</span> root;<br> &#125;<br></code></pre></td></tr></table></figure><p>ä¸­åºéå†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">traverse</span><span class="hljs-params">(TreeNode root, List&lt;Integer&gt; arr)</span> &#123;<br>     <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> root;<br>     &#125;<br>     traverse(root.left, arr);<br>   arr.add(root.val);<br>     traverse(root.right, arr);<br>     <span class="hljs-keyword">return</span> root;<br> &#125;<br></code></pre></td></tr></table></figure><p>ååºéå†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">traverse</span><span class="hljs-params">(TreeNode root, List&lt;Integer&gt; arr)</span> &#123;<br>     <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> root;<br>     &#125;<br>     traverse(root.left, arr);<br>     traverse(root.right, arr);<br>   arr.add(root.val);<br>     <span class="hljs-keyword">return</span> root;<br> &#125;<br></code></pre></td></tr></table></figure><p>å±‚çº§éå†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="hljs-title function_">levelOrder</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>        List&lt;List&lt;Integer&gt;&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> list;<br>        &#125;<br>        Queue&lt;TreeNode&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        queue.offer(root);<br>        <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;<br>            List&lt;Integer&gt; temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            <span class="hljs-comment">//æå‰å–å‡ºè¿™å±‚çš„size ï¼Œqueueçš„sizeæ˜¯ä¸æ–­å˜åŒ–çš„</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> queue.size();<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++) &#123;<br>                <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode</span> <span class="hljs-operator">=</span> queue.poll();<br>              <span class="hljs-comment">//å‡ºé˜Ÿåˆ—å‰å°±å–å‡ºè¿™ä¸ªèŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹</span><br>                <span class="hljs-keyword">if</span>(treeNode.left!=<span class="hljs-literal">null</span>) queue.offer(treeNode.left);<br>                <span class="hljs-keyword">if</span>(treeNode.right!=<span class="hljs-literal">null</span>) queue.offer(treeNode.right);<br>                temp.add(treeNode.val);<br>            &#125;<br>            list.add(temp);<br>        &#125;<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•é—®é¢˜è®°å½•-Mysql select count(1)ã€count(*)ã€count(column)</title>
    <link href="/2022/08/01/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-Mysql-select-count-1-%E3%80%81count-%E3%80%81count-column/"/>
    <url>/2022/08/01/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-Mysql-select-count-1-%E3%80%81count-%E3%80%81count-column/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜æŠ„è‡ªç½‘ç»œ</p></blockquote><p>count(*)ï¼šå…ˆæŠŠæ˜Ÿå·ç¿»è¯‘ä¸ºå…·ä½“å­—æ®µåå­—ï¼Œå¤šäº†ä¸€æ­¥ç¿»è¯‘ï¼Œæ•ˆç‡å·®ç‚¹<br>count(1)ï¼šè®¡ç®—æœ‰å¤šå°‘ç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œå¯ä»¥ç†è§£ä¸ºæ¯è¡Œæ•°æ®å­˜åœ¨æŸä¸ªå€¼å›ºå®šçš„å­—æ®µï¼Œè®¡ç®—æœ‰å¤šå°‘ä¸ªå›ºå®šå€¼</p><p><strong>ä»ç»“æœæ¥è¯´ï¼š</strong></p><ul><li>count(*) å’Œ count(1) æ²¡åŒºåˆ«ï¼Œéƒ½ä¸ä¼šè¿‡æ»¤ NULL</li><li>count(column) ä¼šè¿‡æ»¤ NULL</li></ul><p><strong>ä»é€Ÿåº¦æ¥è¯´ï¼š</strong></p><ul><li>å¦‚æœåªæœ‰ä¸€åˆ—ï¼Œcount(<em>) æ•ˆç‡æœ€é«˜</em></li><li><em>å¤šåˆ—æ—¶ï¼Œcount(1) æ•ˆç‡é«˜äº count(</em>)</li><li>å¦‚æœåˆ—ä¸ºä¸»é”®ï¼Œcount(column) æ•ˆç‡æœ€é«˜</li><li>å¦‚æœåˆ—ä¸ä¸ºä¸»é”®ï¼Œcount(1) æ•ˆç‡æ¯” count(column) æ•ˆç‡é«˜</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>é¢è¯•é—®é¢˜</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python é€šè¿‡requestsçˆ¬å–shopify collectionså•†å“</title>
    <link href="/2022/08/01/python-%E9%80%9A%E8%BF%87requests%E7%88%AC%E5%8F%96shopify-collections%E5%95%86%E5%93%81/"/>
    <url>/2022/08/01/python-%E9%80%9A%E8%BF%87requests%E7%88%AC%E5%8F%96shopify-collections%E5%95%86%E5%93%81/</url>
    
    <content type="html"><![CDATA[<p>ç®€å•ä½¿ç”¨requestsçˆ¬å–shopifyå•†å“ä¿¡æ¯</p><p>éœ€è¦è‡ªè¡Œåˆ†æå•†å“é“¾æ¥ã€æ ‡é¢˜ã€ä»·æ ¼ã€æè¿°ã€å›¾ç‰‡çš„é€‰æ‹©å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> csv<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">import</span> bs4<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># collectionsåœ°å€</span><br>url_pro = <span class="hljs-string">&#x27;https://www.naluboutique.com/collections/all&#x27;</span><br><br><span class="hljs-comment"># åˆ†æxpath</span><br>product_link_select = <span class="hljs-string">&#x27;.grid-product__content .grid-product__link&#x27;</span><br>product_title_select = <span class="hljs-string">&#x27;.product-single__title&#x27;</span><br>product_price_select = <span class="hljs-string">&#x27;.product__price&#x27;</span><br>product_desc_select = <span class="hljs-string">&#x27;.product-single__description&#x27;</span><br>product_img_select = <span class="hljs-string">&#x27;.product__photos img&#x27;</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;é‡‡é›†å•†å“é›†åˆå¼€å§‹&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crawl_collections</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            res = requests.get(url, timeout=<span class="hljs-number">30</span>)<br>            res.encoding = res.apparent_encoding<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è¯·æ±‚&#x27;</span>, url, <span class="hljs-string">&#x27;çŠ¶æ€&#x27;</span>, res.status_code)<br>            <span class="hljs-comment"># å¦‚æœè¿”å›çŠ¶æ€ä¸æ˜¯200ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span><br>            res.raise_for_status()<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span>:<br>            timeout = <span class="hljs-number">3</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;é“¾æ¥å¤±è´¥,ç­‰å¾…&#x27;</span>, timeout, <span class="hljs-string">&#x27;ç§’é‡è¯•&#x27;</span>)<br>            time.sleep(timeout)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;é‡æ–°é“¾æ¥ä¸­&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è¯·æ±‚æˆåŠŸï¼Œå¼€å§‹è·å–å•†å“é“¾æ¥&#x27;</span>)<br>    <span class="hljs-comment"># html.parser æŒ‡å®šè§£æå™¨</span><br>    noStarchSoup = bs4.BeautifulSoup(res.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    url = noStarchSoup.select(product_link_select)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(url)):<br>        imgurl = domainWithProtocol + url[i].get(<span class="hljs-string">&#x27;href&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è·å–äº§å“url&#x27;</span>)<br>        <span class="hljs-comment"># è°ƒç”¨é‡‡é›†å†…å®¹æ–¹æ³•</span><br>        crawl_product(imgurl)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><br><span class="hljs-string">&#x27;&#x27;&#x27;é‡‡é›†å•†å“urlç»“æŸ&#x27;&#x27;&#x27;</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;é‡‡é›†å•†å“å†…å®¹å¼€å§‹&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crawl_product</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å¼€å§‹è¯·æ±‚äº§å“é¡µé¢&#x27;</span>, url)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            res = requests.get(url, timeout=<span class="hljs-number">30</span>)<br>            res.encoding = res.apparent_encoding<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æˆåŠŸè¯·æ±‚å•†å“é¡µé¢:&#x27;</span>, res.status_code)<br>            res.raise_for_status()  <span class="hljs-comment"># å¦‚æœä¸‹è½½å‘ç”Ÿé—®é¢˜ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è¯·æ±‚å•†å“é¡µé¢&#x27;</span>, url, <span class="hljs-string">&#x27;å¤±è´¥ï¼Œé‡æ–°é“¾æ¥&#x27;</span>)<br><br>    noStarchSoup = bs4.BeautifulSoup(res.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    name = noStarchSoup.select(product_title_select)<br>    name = name[<span class="hljs-number">0</span>].getText()<br>    price = noStarchSoup.select(product_price_select)<br>    price = price[<span class="hljs-number">0</span>].getText()<br>    price = re.sub(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, price)<br>    price = re.sub(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, price)<br>    des = noStarchSoup.select(product_desc_select)<br>    des = des[<span class="hljs-number">0</span>].getText()<br>    img = noStarchSoup.select(product_img_select)<br>    l = []<br>    <span class="hljs-keyword">if</span> img != []:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(img)):<br>            imgurl = img[i].get(<span class="hljs-string">&#x27;src&#x27;</span>)<br>            <span class="hljs-keyword">if</span> imgurl <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                imgurl = img[i].get(<span class="hljs-string">&#x27;data-src&#x27;</span>)<br>            <span class="hljs-keyword">if</span> imgurl.__contains__(<span class="hljs-string">&#x27;&#123;width&#125;&#x27;</span>):<br>                <span class="hljs-keyword">continue</span><br>            l.append(<span class="hljs-string">&#x27;https:&#x27;</span> + imgurl)<br>        l = <span class="hljs-string">&#x27;\r\n&#x27;</span>.join(l)<br>    fileHeader = [<span class="hljs-string">&#x27;æ ‡é¢˜&#x27;</span>, <span class="hljs-string">&#x27;äº§å“url&#x27;</span>, <span class="hljs-string">&#x27;ä»·æ ¼&#x27;</span>, <span class="hljs-string">&#x27;æè¿°&#x27;</span>, <span class="hljs-string">&#x27;å›¾ç‰‡&#x27;</span>]<br>    file = [name, url, price, des, l]<br>    <span class="hljs-comment"># æ–‡ä»¶å­˜å‚¨çš„åœ°æ–¹ï¼Œæ–‡ä»¶å¤¹éœ€è¦äº‹å…ˆåˆ›å»ºï¼Œå¹¶æŒ‡å®šæ–‡ä»¶çš„æ ¼å¼ä¸ºutf-8</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            csvFile = <span class="hljs-built_in">open</span>(csv_name, <span class="hljs-string">&#x27;a+&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(e)<br>            <span class="hljs-built_in">print</span>(csv_name + <span class="hljs-string">&#x27;æ–‡ä»¶å†™å…¥å¤±è´¥ï¼Œé‡è¯•ä¸­ã€‚ã€‚ã€‚ã€‚ã€‚&#x27;</span>)<br>            time.sleep(<span class="hljs-number">5</span>)<br>    size = os.path.getsize(csv_name)  <span class="hljs-comment"># åˆ¤æ–­æ–‡ä»¶å¤§å°ï¼Œå¦‚æœæ–‡ä»¶å¤§äº0åˆ™è¡¨ç¤ºæ–‡ä»¶æœ‰å†…</span><br>    writer = csv.writer(csvFile)<br>    <span class="hljs-keyword">if</span> size == <span class="hljs-number">0</span>:<br>        writer.writerow(fileHeader)<br>        writer.writerow(file)<br>        csvFile.close()<br>    <span class="hljs-keyword">else</span>:<br>        writer.writerow(file)<br>        csvFile.close()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;é‡‡é›†æˆåŠŸï¼&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    protocol = <span class="hljs-string">&#x27;https://&#x27;</span><br>    domain = re.match(<span class="hljs-string">&#x27;https://(.*)/collections&#x27;</span>, url_pro).group(<span class="hljs-number">1</span>)<br>    domainWithProtocol = protocol + domain<br>    csv_name = domain + time.strftime(<span class="hljs-string">&#x27;_%Y-%m-%d-%H-%M-%S&#x27;</span>, time.localtime(time.time())) + <span class="hljs-string">&#x27;.csv&#x27;</span><br>    <span class="hljs-built_in">next</span> = [<span class="hljs-string">&#x27;1&#x27;</span>]<br>    n = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">next</span> != []:<br>        url = url_pro + <span class="hljs-string">&#x27;?sort_by=best-selling&amp;page=&#x27;</span> + <span class="hljs-built_in">str</span>(n)<br>        <span class="hljs-comment"># è°ƒç”¨é‡‡é›†åˆ—è¡¨æ–¹æ³•</span><br>        crawl_collections(url)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æˆåŠŸé‡‡é›†&#x27;</span>, n, <span class="hljs-string">&#x27;é¡µ&#x27;</span>)<br>        n = n + <span class="hljs-number">1</span><br>        res = requests.get(url)<br>        res.raise_for_status()<br>        noStarchSoup = bs4.BeautifulSoup(res.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>        <span class="hljs-built_in">next</span> = noStarchSoup.select(<span class="hljs-string">&#x27;.next&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å…¨éƒ¨é‡‡é›†å®Œæ¯•ï¼ï¼&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202208011527113.png" alt="image-20220801152718166"></p>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OkhttpUtils å·¥å…·ç±»</title>
    <link href="/2022/07/26/OkhttpUtils%20%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <url>/2022/07/26/OkhttpUtils%20%E5%B7%A5%E5%85%B7%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹OkhttpUtilså·¥å…·ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by IntelliJ IDEA.</span><br><span class="hljs-comment"> * User: è´å…ˆ [ Cason mo ]</span><br><span class="hljs-comment"> * Date: 2022/5/20</span><br><span class="hljs-comment"> * Time: 10:56</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OkHttpUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(OkHttpUtils.class);<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">readTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">connectTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">writeTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">MediaType</span> <span class="hljs-variable">JSON</span> <span class="hljs-operator">=</span> MediaType.parse(<span class="hljs-string">&quot;application/json; charset=utf-8&quot;</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] LOCKER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> OkHttpUtils mInstance;<br>    <span class="hljs-keyword">private</span> OkHttpClient mOkHttpClient;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setReadTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> readTimeout)</span> &#123;<br>        <span class="hljs-built_in">this</span>.readTimeout = readTimeout;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setConnectTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> connectTimeout)</span> &#123;<br>        <span class="hljs-built_in">this</span>.connectTimeout = connectTimeout;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWriteTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> writeTimeout)</span> &#123;<br>        <span class="hljs-built_in">this</span>.writeTimeout = writeTimeout;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è‡ªå®šä¹‰ç½‘ç»œå›è°ƒæ¥å£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NetCall</span> &#123;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">success</span><span class="hljs-params">(Call call, Response response)</span> <span class="hljs-keyword">throws</span> IOException;<br><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">failed</span><span class="hljs-params">(Call call, IOException e)</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">OkHttpUtils</span><span class="hljs-params">()</span> &#123;<br>        okhttp3.OkHttpClient.<span class="hljs-type">Builder</span> <span class="hljs-variable">clientBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">okhttp3</span>.OkHttpClient.Builder();<br>        clientBuilder.readTimeout(readTimeout, TimeUnit.SECONDS);<span class="hljs-comment">//è¯»å–è¶…æ—¶</span><br>        clientBuilder.connectTimeout(connectTimeout, TimeUnit.SECONDS);<span class="hljs-comment">//è¿æ¥è¶…æ—¶</span><br>        clientBuilder.writeTimeout(writeTimeout, TimeUnit.SECONDS);<span class="hljs-comment">//å†™å…¥è¶…æ—¶</span><br>        clientBuilder.hostnameVerifier(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostnameVerifier</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verify</span><span class="hljs-params">(String hostname, SSLSession session)</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;);<br>        mOkHttpClient = clientBuilder.build();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> OkHttpUtils <span class="hljs-title function_">newInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpUtils</span>();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å•ä¾‹æ¨¡å¼è·å–OkHttpUtil</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> OkHttpUtils <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mInstance == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (LOCKER) &#123;<br>                <span class="hljs-keyword">if</span> (mInstance == <span class="hljs-literal">null</span>) &#123;<br>                    mInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpUtils</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> mInstance;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">get</span><span class="hljs-params">(String url, Map&lt;String, String&gt; params, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        <span class="hljs-type">UriBuilder</span> <span class="hljs-variable">uriBuilder</span> <span class="hljs-operator">=</span> UriBuilder.fromUri(url);<br>        <span class="hljs-keyword">if</span> (params != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; param : params.entrySet()) &#123;<br>                <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(param.getKey())) &#123;<br>                    uriBuilder.queryParam(param.getKey(), param.getValue());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> builder.get().url(uriBuilder.build().toString()).headers(headers).build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Response <span class="hljs-title function_">post</span><span class="hljs-params">(String url, T t, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">requestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        requestBuilder.post(RequestBody.create(JSON, <span class="hljs-string">&quot;&quot;</span>)).url(url).headers(headers);<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, JsonUtils.toJSONString(t));<br>            requestBuilder.post(body);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestBuilder.build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Response <span class="hljs-title function_">patch</span><span class="hljs-params">(String url, T t, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">requestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        requestBuilder.patch(RequestBody.create(JSON, <span class="hljs-string">&quot;&quot;</span>)).url(url).headers(headers);<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, JsonUtils.toJSONString(t));<br>            requestBuilder.patch(body);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestBuilder.build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">postJson</span><span class="hljs-params">(String url, String json, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, json);<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()<br>                .url(url)<br>                .post(body)<br>                .headers(headers)<br>                .build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-keyword">return</span> mOkHttpClient.newCall(request).execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Response <span class="hljs-title function_">put</span><span class="hljs-params">(String url, T t, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">requestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        requestBuilder.put(RequestBody.create(JSON, <span class="hljs-string">&quot;&quot;</span>)).url(url).headers(headers);<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, JsonUtils.toJSONString(t));<br>            requestBuilder.put(body);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestBuilder.build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">putJson</span><span class="hljs-params">(String url, String json, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, json);<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()<br>                .url(url)<br>                .put(body)<br>                .headers(headers)<br>                .build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-keyword">return</span> mOkHttpClient.newCall(request).execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Response <span class="hljs-title function_">delete</span><span class="hljs-params">(String url, T t, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        Request.<span class="hljs-type">Builder</span> <span class="hljs-variable">requestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder();<br>        requestBuilder.delete().url(url).headers(headers);<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, JsonUtils.toJSONString(t));<br>            requestBuilder.delete(body);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestBuilder.build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> mOkHttpClient.newCall(request);<br>        <span class="hljs-keyword">return</span> call.execute();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">deleteJson</span><span class="hljs-params">(String url, String json, Headers headers)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (headers == <span class="hljs-literal">null</span>) &#123;<br>            headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>.Builder().build();<br>        &#125;<br>        <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(JSON, json);<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()<br>                .url(url)<br>                .delete(body)<br>                .headers(headers)<br>                .build();<br>        logger.info(<span class="hljs-string">&quot;okhttp url : [&#123;&#125;] &#123;&#125; \nheader : &#123;&#125; \nrequestBody : &#123;&#125;&quot;</span>, request.method(), request.url(), request.headers(), getRequestBody(request));<br>        <span class="hljs-keyword">return</span> mOkHttpClient.newCall(request).execute();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRequestBody</span><span class="hljs-params">(Request request)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Buffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Buffer</span>();<br>        <span class="hljs-keyword">if</span> (request.body() != <span class="hljs-literal">null</span>) &#123;<br>            request.body().writeTo(buffer);<br>            <span class="hljs-keyword">return</span> buffer.clone().readUtf8();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è·å–æŒ‡å®šåŒ…ä¸‹ä½¿ç”¨æŒ‡å®šæ³¨è§£ç›¸å…³çš„ç±»ã€æ–¹æ³•ã€å­—æ®µ</title>
    <link href="/2022/07/20/%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E5%8C%85%E4%B8%8B%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E6%B3%A8%E8%A7%A3%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB%E3%80%81%E6%96%B9%E6%B3%95%E3%80%81%E5%AD%97%E6%AE%B5/"/>
    <url>/2022/07/20/%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E5%8C%85%E4%B8%8B%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E6%B3%A8%E8%A7%A3%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB%E3%80%81%E6%96%B9%E6%B3%95%E3%80%81%E5%AD%97%E6%AE%B5/</url>
    
    <content type="html"><![CDATA[<p>é€šè¿‡å¯¹æŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰ç±»æ–‡ä»¶è¿›è¡Œæ‰«æï¼Œè·å–ä½¿ç”¨æŒ‡å®šæ³¨è§£çš„æ‰€æœ‰ç±»ã€æ–¹æ³•ã€å­—æ®µ</p><h3 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.core.io.DefaultResourceLoader;<br><span class="hljs-keyword">import</span> org.springframework.core.io.Resource;<br><span class="hljs-keyword">import</span> org.springframework.core.io.ResourceLoader;<br><span class="hljs-keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;<br><span class="hljs-keyword">import</span> org.springframework.core.io.support.ResourcePatternUtils;<br><span class="hljs-keyword">import</span> org.springframework.core.type.ClassMetadata;<br><span class="hljs-keyword">import</span> org.springframework.core.type.classreading.MetadataReader;<br><span class="hljs-keyword">import</span> org.springframework.core.type.classreading.MetadataReaderFactory;<br><span class="hljs-keyword">import</span> org.springframework.core.type.classreading.SimpleMetadataReaderFactory;<br><span class="hljs-keyword">import</span> org.springframework.util.ClassUtils;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.lang.annotation.Annotation;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by IntelliJ IDEA.</span><br><span class="hljs-comment"> * User: è´å…ˆ [ Cason mo ]</span><br><span class="hljs-comment"> * Date: 2022/6/29</span><br><span class="hljs-comment"> * Time: 10:45</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(AnnotationUtils.class);<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_RESOURCE_PATTERN</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;**/*.class&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> AnnotationUtils mInstance;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">LOCKER</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å•ä¾‹æ¨¡å¼è·å–AnnotationUtils</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AnnotationUtils <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mInstance == <span class="hljs-literal">null</span>) &#123;<br>            LOCKER.lock();<br>            <span class="hljs-keyword">if</span> (mInstance == <span class="hljs-literal">null</span>) &#123;<br>                mInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationUtils</span>();<br>            &#125;<br>            LOCKER.unlock();<br>        &#125;<br>        <span class="hljs-keyword">return</span> mInstance;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Class&lt;?&gt;&gt; getClassCandidates(String basePackages, Class clazz) &#123;<br>        List&lt;Class&lt;?&gt;&gt; candidates = scanPackagesForClass(basePackages, clazz);<br>        validateCandidates(basePackages, candidates.isEmpty());<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Method&gt; <span class="hljs-title function_">getMethodCandidates</span><span class="hljs-params">(String basePackages, Class clazz)</span> &#123;<br>        List&lt;Method&gt; candidates = scanPackagesForMethod(basePackages, clazz);<br>        validateCandidates(basePackages, candidates.isEmpty());<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Field&gt; <span class="hljs-title function_">getFieldCandidates</span><span class="hljs-params">(String basePackages, Class clazz)</span> &#123;<br>        List&lt;Field&gt; candidates = scanPackagesForField(basePackages, clazz);<br>        validateCandidates(basePackages, candidates.isEmpty());<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Class&lt;?&gt;&gt; scanPackagesForClass(String basePackages, Class clazz) &#123;<br>        List&lt;Class&lt;?&gt;&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Class&lt;?&gt;&gt;();<br>        <span class="hljs-keyword">try</span> &#123;<br>            candidates.addAll(findCandidateClasses(basePackages, clazz));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            logger.error(<span class="hljs-string">&quot;æ‰«ææŒ‡å®šåŒ…æ—¶å‡ºç°å¼‚å¸¸&quot;</span>, basePackages);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Method&gt; <span class="hljs-title function_">scanPackagesForMethod</span><span class="hljs-params">(String basePackages, Class clazz)</span> &#123;<br>        List&lt;Method&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Method&gt;();<br>        <span class="hljs-keyword">try</span> &#123;<br>            candidates.addAll(findCandidateMethod(basePackages, clazz));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            logger.error(<span class="hljs-string">&quot;æ‰«ææŒ‡å®šåŒ…æ—¶å‡ºç°å¼‚å¸¸&quot;</span>, basePackages);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Field&gt; <span class="hljs-title function_">scanPackagesForField</span><span class="hljs-params">(String basePackages, Class clazz)</span> &#123;<br>        List&lt;Field&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Field&gt;();<br>        <span class="hljs-keyword">try</span> &#123;<br>            candidates.addAll(findCandidateField(basePackages, clazz));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            logger.error(<span class="hljs-string">&quot;æ‰«ææŒ‡å®šåŒ…æ—¶å‡ºç°å¼‚å¸¸&quot;</span>, basePackages);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Class&lt;?&gt;&gt; findCandidateClasses(String basePackage, Class clazz) <span class="hljs-keyword">throws</span> IOException &#123;<br>        List&lt;Class&lt;?&gt;&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Class&lt;?&gt;&gt;();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">packageSearchPath</span> <span class="hljs-operator">=</span> getPackageSearchPath(basePackage);<br>        <span class="hljs-type">ResourceLoader</span> <span class="hljs-variable">resourceLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultResourceLoader</span>();<br>        <span class="hljs-type">MetadataReaderFactory</span> <span class="hljs-variable">readerFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMetadataReaderFactory</span>(resourceLoader);<br>        Resource[] resources = ResourcePatternUtils.getResourcePatternResolver(resourceLoader).getResources(packageSearchPath);<br>        <span class="hljs-keyword">for</span> (Resource resource : resources) &#123;<br>            <span class="hljs-type">MetadataReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> readerFactory.getMetadataReader(resource);<br>            <span class="hljs-keyword">if</span> (match(reader.getClassMetadata(), clazz)) &#123;<br>                Class&lt;?&gt; candidateClass = transform(reader.getClassMetadata().getClassName());<br>                <span class="hljs-keyword">if</span> (candidateClass != <span class="hljs-literal">null</span>) &#123;<br>                    candidates.add(candidateClass);<br>                    logger.debug(<span class="hljs-string">&quot;æ‰«æåˆ°ç¬¦åˆè¦æ±‚çš„ç±»ï¼š&quot;</span> + candidateClass.getName());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Method&gt; <span class="hljs-title function_">findCandidateMethod</span><span class="hljs-params">(String basePackage, Class clazz)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        List&lt;Method&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Method&gt;();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">packageSearchPath</span> <span class="hljs-operator">=</span> getPackageSearchPath(basePackage);<br>        <span class="hljs-type">ResourceLoader</span> <span class="hljs-variable">resourceLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultResourceLoader</span>();<br>        <span class="hljs-type">MetadataReaderFactory</span> <span class="hljs-variable">readerFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMetadataReaderFactory</span>(resourceLoader);<br>        Resource[] resources = ResourcePatternUtils.getResourcePatternResolver(resourceLoader).getResources(packageSearchPath);<br>        <span class="hljs-keyword">for</span> (Resource resource : resources) &#123;<br>            <span class="hljs-type">MetadataReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> readerFactory.getMetadataReader(resource);<br>            matchMethod(clazz, candidates, reader);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Field&gt; <span class="hljs-title function_">findCandidateField</span><span class="hljs-params">(String basePackage, Class clazz)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        List&lt;Field&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Field&gt;();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">packageSearchPath</span> <span class="hljs-operator">=</span> getPackageSearchPath(basePackage);<br>        <span class="hljs-type">ResourceLoader</span> <span class="hljs-variable">resourceLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultResourceLoader</span>();<br>        <span class="hljs-type">MetadataReaderFactory</span> <span class="hljs-variable">readerFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMetadataReaderFactory</span>(resourceLoader);<br>        Resource[] resources = ResourcePatternUtils.getResourcePatternResolver(resourceLoader).getResources(packageSearchPath);<br>        <span class="hljs-keyword">for</span> (Resource resource : resources) &#123;<br>            <span class="hljs-type">MetadataReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> readerFactory.getMetadataReader(resource);<br>            matchField(clazz, candidates, reader);<br>        &#125;<br>        <span class="hljs-keyword">return</span> candidates;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">matchMethod</span><span class="hljs-params">(Class clazz, List&lt;Method&gt; candidates, MetadataReader reader)</span> &#123;<br>        Class&lt;?&gt; clz = transformToClass(reader.getClassMetadata().getClassName());<br>        Method[] methods = clz.getMethods();<br>        <span class="hljs-keyword">for</span> (Method method : methods) &#123;<br>            <span class="hljs-type">Annotation</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> method.getAnnotation(clazz);<br><br>            <span class="hljs-keyword">if</span> (annotation == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (method != <span class="hljs-literal">null</span> &amp;&amp; method.isAnnotationPresent(clazz)) &#123;<br>                candidates.add(method);<br>                logger.debug(<span class="hljs-string">&quot;æ‰«æåˆ°ç¬¦åˆè¦æ±‚çš„methodï¼š&quot;</span> + method.getName());<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">matchField</span><span class="hljs-params">(Class clazz, List&lt;Field&gt; candidates, MetadataReader reader)</span> &#123;<br>        Class&lt;?&gt; clz = transformToClass(reader.getClassMetadata().getClassName());<br>        Field[] declaredFields = clz.getDeclaredFields();<br>        <span class="hljs-keyword">for</span> (Field field : declaredFields) &#123;<br>            <span class="hljs-type">Annotation</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> field.getAnnotation(clazz);<br><br>            <span class="hljs-keyword">if</span> (annotation == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (field != <span class="hljs-literal">null</span> &amp;&amp; field.isAnnotationPresent(clazz)) &#123;<br>                candidates.add(field);<br>                logger.debug(<span class="hljs-string">&quot;æ‰«æåˆ°ç¬¦åˆè¦æ±‚çš„fieldï¼š&quot;</span> + field.getName());<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">convertPath</span><span class="hljs-params">(String path)</span> &#123;<br>        <span class="hljs-keyword">return</span> StringUtils.replace(path, <span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; transform(String className) &#123;<br>        Class&lt;?&gt; clazz = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            clazz = ClassUtils.forName(className, <span class="hljs-built_in">this</span>.getClass().getClassLoader());<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            logger.info(<span class="hljs-string">&quot;æœªæ‰¾åˆ°æŒ‡å®šç±»&quot;</span>, className);<br>        &#125;<br>        <span class="hljs-keyword">return</span> clazz;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(ClassMetadata metadata, Class c)</span> &#123;<br>        Class&lt;?&gt; clazz = transformToClass(metadata.getClassName());<br>        <span class="hljs-keyword">return</span> clazz != <span class="hljs-literal">null</span> &amp;&amp; clazz.isAnnotationPresent(c);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; transformToClass(String className) &#123;<br>        Class&lt;?&gt; clazz = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            clazz = ClassUtils.forName(className, <span class="hljs-built_in">this</span>.getClass().getClassLoader());<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            logger.info(<span class="hljs-string">&quot;æœªæ‰¾åˆ°æŒ‡å®šç±»&quot;</span>, className);<br>        &#125;<br>        <span class="hljs-keyword">return</span> clazz;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateCandidates</span><span class="hljs-params">(String basePackages, <span class="hljs-type">boolean</span> empty)</span> &#123;<br>        <span class="hljs-keyword">if</span> (empty) &#123;<br>            logger.info(<span class="hljs-string">&quot;æ‰«ææŒ‡å®šåŒ…ä¸‹ï¼Œæœªå‘ç°ç¬¦åˆæ¡ä»¶çš„ç±»&quot;</span>, basePackages);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getPackageSearchPath</span><span class="hljs-params">(String basePackage)</span> &#123;<br>        <span class="hljs-keyword">return</span> ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +<br>                convertPath(basePackage) + <span class="hljs-string">&#x27;/&#x27;</span> + DEFAULT_RESOURCE_PATTERN;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–ä½¿ç”¨æŒ‡å®šæ³¨è§£çš„æ‰€æœ‰ç±»</span><br>List&lt;Class&lt;?&gt;&gt; candidates = AnnotationUtils.getInstance().getClassCandidates(<span class="hljs-string">&quot;com.cason&quot;</span>, PermitAccountStatus.class);<br><span class="hljs-comment">//è·å–ä½¿ç”¨æŒ‡å®šæ³¨è§£çš„æ‰€æœ‰æ–¹æ³•</span><br>List&lt;Method&gt; methodCandidates = AnnotationUtils.getInstance().getMethodCandidates(<span class="hljs-string">&quot;com.cason&quot;</span>, PermitAccountStatus.class);<br><span class="hljs-comment">//è·å–ä½¿ç”¨æŒ‡å®šæ³¨è§£çš„æ‰€æœ‰å­—æ®µ</span><br>List&lt;Field&gt; fieldCandidates = AnnotationUtils.getInstance().getFieldCandidates(<span class="hljs-string">&quot;com.cason&quot;</span>, PermitAccountStatus.class);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨ImageIOè¯»å–ç½‘ç»œå›¾ç‰‡æˆ–æœ¬åœ°å›¾ç‰‡</title>
    <link href="/2022/07/19/%E4%BD%BF%E7%94%A8ImageIO%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E6%88%96%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/"/>
    <url>/2022/07/19/%E4%BD%BF%E7%94%A8ImageIO%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E6%88%96%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ¥è‡ªç½‘ç»œ</p></blockquote><h3 id="è¯»å–ç½‘ç»œå›¾ç‰‡"><a href="#è¯»å–ç½‘ç»œå›¾ç‰‡" class="headerlink" title="è¯»å–ç½‘ç»œå›¾ç‰‡"></a>è¯»å–ç½‘ç»œå›¾ç‰‡</h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(path);<br>BufferedImage source= ImageIO.read(url);<br></code></pre></td></tr></table></figure><h3 id="è¯»å–æœ¬åœ°å›¾ç‰‡"><a href="#è¯»å–æœ¬åœ°å›¾ç‰‡" class="headerlink" title="è¯»å–æœ¬åœ°å›¾ç‰‡"></a>è¯»å–æœ¬åœ°å›¾ç‰‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">BufferedImage source= ImageIO.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path));<br></code></pre></td></tr></table></figure><h3 id="è·å–ç½‘ç»œå›¾ç‰‡å·¥å…·ç±»"><a href="#è·å–ç½‘ç»œå›¾ç‰‡å·¥å…·ç±»" class="headerlink" title="è·å–ç½‘ç»œå›¾ç‰‡å·¥å…·ç±»"></a>è·å–ç½‘ç»œå›¾ç‰‡å·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpImageUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(HttpImageUtils.class);<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ç½‘ç»œå›¾ç‰‡è½¬æˆå­—èŠ‚æµ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> strUrl å®Œæ•´å›¾ç‰‡åœ°å€</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å›¾ç‰‡èµ„æºæ•°ç»„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] getNetImgByUrl(String strUrl) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(strUrl);<br>            <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> (HttpURLConnection) url.openConnection();<br>            conn.setRequestMethod(<span class="hljs-string">&quot;GET&quot;</span>);<br>            conn.setConnectTimeout(TIMEOUT);<br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">inStream</span> <span class="hljs-operator">=</span> conn.getInputStream();<br>            <span class="hljs-keyword">return</span> readInputStream(inStream);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            logger.error(e.getMessage(),e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»è¾“å…¥æµä¸­è·å–å­—èŠ‚æµæ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> inStream è¾“å…¥æµ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span>  å›¾ç‰‡æµ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] readInputStream(InputStream inStream) <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">outStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[Integer.MAX_VALUE];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> ((len = inStream.read(buffer)) != -<span class="hljs-number">1</span>) &#123;<br>            outStream.write(buffer, <span class="hljs-number">0</span>, len);<br>        &#125;<br>        inStream.close();<br>        <span class="hljs-keyword">return</span> outStream.toByteArray();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>è§£å†³Okhttpåªèƒ½è·å–ä¸€æ¬¡responsebodyçš„é—®é¢˜</title>
    <link href="/2022/07/18/%E8%A7%A3%E5%86%B3Okhttp%E5%8F%AA%E8%83%BD%E8%8E%B7%E5%8F%96%E4%B8%80%E6%AC%A1responsebody%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2022/07/18/%E8%A7%A3%E5%86%B3Okhttp%E5%8F%AA%E8%83%BD%E8%8E%B7%E5%8F%96%E4%B8%80%E6%AC%A1responsebody%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>okhttpé€šè¿‡response.body().string() è·å–å­—ç¬¦ä¸²ç±»å‹çš„responsebody</p><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><pre><code class="hljs java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">string</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> source()) &#123;<br>      <span class="hljs-type">Charset</span> <span class="hljs-variable">charset</span> <span class="hljs-operator">=</span> Util.bomAwareCharset(source, charset());<br>      <span class="hljs-keyword">return</span> source.readString(charset);<br>    &#125;<br>  &#125;<br><br><br><span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>    Util.closeQuietly(source());<br>  &#125;<br></code></pre></td></tr></table></figure><p>ResponseBodyï¼Œå…¶å®ç°äº† <code>Closeable</code> æ¥å£ï¼Œé€šè¿‡å¤å†™ <code>close()</code> æ–¹æ³•æ¥ <strong>å…³é—­å¹¶é‡Šæ”¾èµ„æº</strong>ï¼Œå…³é—­ <code>ResponseBody</code> å­ç±»æ‰€æŒæœ‰çš„ <code>BufferedSource</code> æ¥å£å¯¹è±¡ï¼Œå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>response.body().string()</code> æ—¶ï¼ŒOkHttp å°†å“åº”ä½“çš„ç¼“å†²èµ„æºè¿”å›çš„åŒæ—¶ï¼Œè°ƒç”¨ <code>closeQuietly()</code> æ–¹æ³•é»˜é»˜é‡Šæ”¾äº†èµ„æº</p><h3 id="è·å–responseBody"><a href="#è·å–responseBody" class="headerlink" title="è·å–responseBody"></a>è·å–responseBody</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getResponseBody</span><span class="hljs-params">(Response response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>     <span class="hljs-type">BufferedSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> response.body().source();<br>     source.request(Long.MAX_VALUE);<br>     <span class="hljs-type">Buffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> source.getBuffer();<br>     <span class="hljs-type">String</span> <span class="hljs-variable">responseBody</span> <span class="hljs-operator">=</span> buffer.clone().readUtf8();<br>     <span class="hljs-keyword">return</span> responseBody;<br> &#125;<br></code></pre></td></tr></table></figure><h3 id="è·å–requestBody"><a href="#è·å–requestBody" class="headerlink" title="è·å–requestBody"></a>è·å–requestBody</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRequestBody</span><span class="hljs-params">(Request request)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Buffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Buffer</span>();<br>        <span class="hljs-keyword">if</span> (request.body() != <span class="hljs-literal">null</span>) &#123;<br>            request.body().writeTo(buffer);<br>            <span class="hljs-keyword">return</span> buffer.clone().readUtf8();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>okhttp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>InheritableThreadLocalè§£å†³ThreadLocalå­çº¿ç¨‹ä¸å¯ç»§æ‰¿çˆ¶çº¿ç¨‹å˜é‡çš„é—®é¢˜</title>
    <link href="/2022/06/17/InheritableThreadLocal%E8%A7%A3%E5%86%B3ThreadLocal%E5%AD%90%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%8F%AF%E7%BB%A7%E6%89%BF%E7%88%B6%E7%BA%BF%E7%A8%8B%E5%8F%98%E9%87%8F%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2022/06/17/InheritableThreadLocal%E8%A7%A3%E5%86%B3ThreadLocal%E5%AD%90%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%8F%AF%E7%BB%A7%E6%89%BF%E7%88%B6%E7%BA%BF%E7%A8%8B%E5%8F%98%E9%87%8F%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>å½“æˆ‘ç”¨Mybatis-plusè‡ªåŠ¨å¡«å……åˆ›å»ºäººå‘˜ï¼Œæ›´æ–°äººå‘˜å­—æ®µçš„æ—¶å€™ï¼Œå‘ç°æ•°æ®åº“ä¸­åˆå¾ˆå¤šå­—æ®µéƒ½æ²¡æœ‰è®°å½•è¿™ä¸¤ä¸ªå­—æ®µï¼Œé€šè¿‡åˆ†æå‘ç°æ˜¯å› ä¸ºè¿™äº›æ›´æ–°æˆ–è€…åˆ›å»ºæ“ä½œæ˜¯åœ¨å¼‚æ­¥çš„æƒ…å†µä¸‹å»æ‰§è¡Œçš„ï¼Œç”±äºçˆ¶çº¿ç¨‹åˆ›å»ºçš„å­çº¿ç¨‹æ— æ³•è·å–çˆ¶çº¿ç¨‹çš„ThreadLocalå˜é‡ï¼Œå¯¼è‡´æ— æ³•æ­£ç¡®çš„è·å–è¿™ä¸¤ä¸ªå­—æ®µã€‚</p><blockquote><p>ä»¥ä¸‹ä»£ç è¯´æ˜ä½¿ç”¨ThreadLocal å­çº¿ç¨‹æ— æ³•è®¿é—®çˆ¶çº¿ç¨‹çš„çº¿ç¨‹å˜é‡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestThreadLocal</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;String&gt; username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        username.set(<span class="hljs-string">&quot;beixian&quot;</span>);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;å­çº¿ç¨‹è·å–ï¼š&quot;</span>+username.get());<br>            &#125;<br>        &#125;);<br>        thread.start();<br>        System.out.println(<span class="hljs-string">&quot;mainçº¿ç¨‹è·å–&quot;</span>+username.get());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202206180001004.png" alt="TestThreadLocal.mainæ‰§è¡Œç»“æœ"></p><p>åŸå› ï¼šå­çº¿ç¨‹ThreadLocal get()è·å–çš„çš„æ˜¯å­çº¿ç¨‹çš„threadLocalsé‡Œçš„å€¼ï¼Œè€Œçˆ¶çº¿ç¨‹set()çš„æ˜¯çˆ¶çº¿ç¨‹çš„threadLocalsé‡Œçš„å€¼ï¼Œè€Œå­çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™æ²¡æœ‰ç»§æ‰¿threadLocalsé‡Œçš„å€¼ã€‚</p><blockquote><p>ä»¥ä¸‹ä»£ç è¯´æ˜ä½¿ç”¨InheritableThreadLocalå­çº¿ç¨‹å¯ä»¥è®¿é—®çˆ¶çº¿ç¨‹çš„çº¿ç¨‹å˜é‡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestInheritableThreadLocal</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> InheritableThreadLocal&lt;String&gt; username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        username.set(<span class="hljs-string">&quot;beixian&quot;</span>);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;å­çº¿ç¨‹è·å–ï¼š&quot;</span>+username.get());<br>            &#125;<br>        &#125;);<br>        thread.start();<br>        System.out.println(<span class="hljs-string">&quot;mainçº¿ç¨‹è·å–&quot;</span>+username.get());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202206180001992.png" alt="TestInheritableThreadLocal.mainæ‰§è¡Œç»“æœ"></p><p>è§£å†³æ–¹æ¡ˆï¼šInheritableThreadLocalå¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå­çº¿ç¨‹åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šé€šè¿‡çˆ¶çº¿ç¨‹çš„inheritThreadLocalså˜é‡åˆå§‹åŒ–å­çº¿ç¨‹çš„inheritThreadLocalså˜é‡ï¼Œè¿™æ ·å­çº¿ç¨‹æ‹¥æœ‰äº†çˆ¶çº¿ç¨‹çš„çº¿ç¨‹å˜é‡å¹¶å¯è®¿é—®ã€‚</p><h5 id="Thread-init-æºç "><a href="#Thread-init-æºç " class="headerlink" title="Thread init()æºç "></a>Thread init()æºç </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Threadçš„æ„é€ æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Thread</span><span class="hljs-params">(Runnable target)</span> &#123;<br>        init(<span class="hljs-literal">null</span>, target, <span class="hljs-string">&quot;Thread-&quot;</span> + nextThreadNum(), <span class="hljs-number">0</span>);<br>    &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,</span><br><span class="hljs-params">                      <span class="hljs-type">long</span> stackSize)</span> &#123;<br>  <span class="hljs-comment">//è¿™é‡Œè®¾ç½®äº†inheritThreadLocalsä¸ºtrue</span><br>        init(g, target, name, stackSize, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,</span><br><span class="hljs-params">                      <span class="hljs-type">long</span> stackSize, AccessControlContext acc,</span><br><span class="hljs-params">                      <span class="hljs-type">boolean</span> inheritThreadLocals)</span> &#123;<br>      <span class="hljs-comment">/**çœç•¥éƒ¨åˆ†ä»£ç **/</span><br>  <span class="hljs-comment">// inheritThreadLocalsä¸ºtrue ä¸” çˆ¶çº¿ç¨‹çš„inheritThreadLocalsä¸ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="hljs-literal">null</span>)<br>            <span class="hljs-built_in">this</span>.inheritableThreadLocals =<br>                ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);<br>       <span class="hljs-comment">/**çœç•¥éƒ¨åˆ†ä»£ç **/</span><br>    &#125;<br><br><span class="hljs-keyword">static</span> ThreadLocalMap <span class="hljs-title function_">createInheritedMap</span><span class="hljs-params">(ThreadLocalMap parentMap)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(parentMap);<br>    &#125;<br></code></pre></td></tr></table></figure><h5 id="InheritableThreadLocalæºç "><a href="#InheritableThreadLocalæºç " class="headerlink" title="InheritableThreadLocalæºç "></a>InheritableThreadLocalæºç </h5><p>InheritableThreadLocalç»§æ‰¿äºThreadLocalï¼Œåªæ˜¯é‡å†™äº†childValue()ï¼ŒgetMap()ï¼ŒcreateMap()æ–¹æ³•ï¼Œé‡å†™çš„åŸå› æ˜¯å› ä¸ºè¦è·å–å’Œæ“ä½œçš„ä¸åœ¨æ˜¯Thread.threadLocalsè¿™ä¸ªå˜é‡ï¼Œè€Œæ˜¯inheritableThreadLocalsè¿™ä¸ªå˜é‡</p><p>get()ã€set()ç­‰æ–¹æ³•åŒThreadLocalï¼Œå¯ä»¥å‚è€ƒã€Threadlocalçš„ç®€å•ç†è§£å’Œéƒ¨åˆ†æºç åˆ†æã€‘è¿™ç¯‡æ–‡ç« </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ThreadLocal</span>&lt;T&gt; &#123;<br>  <br>    <span class="hljs-keyword">protected</span> T <span class="hljs-title function_">childValue</span><span class="hljs-params">(T parentValue)</span> &#123;<br>        <span class="hljs-keyword">return</span> parentValue;<br>    &#125;<br><br>    ThreadLocalMap <span class="hljs-title function_">getMap</span><span class="hljs-params">(Thread t)</span> &#123;<br>       <span class="hljs-keyword">return</span> t.inheritableThreadLocals;<br>    &#125;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> &#123;<br>        t.inheritableThreadLocals = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(<span class="hljs-built_in">this</span>, firstValue);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ThreadLocal</tag>
      
      <tag>InheritableThreadLocal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Threadlocalçš„ç®€å•ç†è§£å’Œéƒ¨åˆ†æºç åˆ†æ</title>
    <link href="/2022/06/16/Threadlocal%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E5%92%8C%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <url>/2022/06/16/Threadlocal%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E5%92%8C%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>Mybatis-plus å¯ä»¥å®ç°å­—æ®µè‡ªåŠ¨å¡«å……åŠŸèƒ½ï¼Œæˆ‘é€šå¸¸ä¼šæŠŠå¤šä¸ªè¡¨ä¸­å…±åŒå­—æ®µæŠ½ç¦»åˆ°äº†ä¸€ä¸ªå…¬å…±å®ä½“ç±»ä¸­ï¼Œå¦‚åˆ›å»ºæ—¶é—´ï¼Œåˆ›å»ºäººå‘˜ï¼Œæ›´æ–°æ—¶é—´ï¼Œæ›´æ–°äººå‘˜ç­‰ç­‰ï¼Œä½†æ˜¯å¦‚ä½•è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯å¡«å…¥åˆ›å»ºäººå‘˜ï¼Œæ›´æ–°äººå‘˜å­—æ®µï¼Ÿ</p><p>ThreadLocalå¯ä»¥å¸®åŠ©æˆ‘è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä½¿ç”¨çš„çš„æ˜¯JWT token éªŒè¯ç™»é™†çŠ¶æ€ï¼Œåœ¨æ¯æ¬¡Httpè¯·æ±‚æ—¶Headeréƒ½ä¼šé™„å¸¦tokenï¼Œtokenä¸­å°±ä¼šé™„å¸¦ç”¨æˆ·ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬éªŒè¯å®ŒåæŠŠç”¨æˆ·ä¿¡æ¯setè¿›Threadlocalï¼Œå°±å¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­é€šè¿‡ThreadLocalè·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p><h4 id="ThreadLocalç†è§£"><a href="#ThreadLocalç†è§£" class="headerlink" title="ThreadLocalç†è§£"></a>ThreadLocalç†è§£</h4><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202206162045177.png" alt="å›¾æºè‡ªç½‘ç»œ"></p><p>ThreadLocalæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒå¯ä»¥ç¡®ä¿å¤šçº¿ç¨‹è®¿é—®æ—¶æ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®åˆ°è‡ªå·±çš„çº¿ç¨‹ç§æœ‰å˜é‡ã€‚å®ƒçš„çº¿ç¨‹éš”ç¦»æœºåˆ¶æ˜¯é€šè¿‡æŠŠå…±äº«å˜é‡çš„å‰¯æœ¬å­˜å‚¨åˆ°Thread.threadLocalså®ç°ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„å‰¯æœ¬ï¼Œå°±èƒ½é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202206162045799.png" alt="Threadç±»æˆªå›¾"></p><p>ThreadLocalå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ“ä½œThread.threadLocalsçš„å¤–å£³ã€‚Thread.threadLocalså˜é‡æ˜¯ä¸€ä¸ªkeyvalueMapï¼ŒThreadåˆ›å»ºçš„æ—¶å€™é»˜è®¤åˆå§‹åŒ–threadLocalsä¸ºnullï¼Œåœ¨ThreadLocalé¦–æ¬¡è¯»æˆ–å†™çš„æ—¶å€™åˆå§‹åŒ–threadLocalsã€‚ThreadLocalMapæ˜¯ThreadLocalä¸­çš„é™æ€å†…éƒ¨ç±»ï¼ŒThreadLocalMapé€šè¿‡Entryé”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œæ˜¯ä¸€ä¸ªå®šåˆ¶åŒ–çš„Mapã€‚</p><h4 id="ThreadLocalæºç åˆ†æ"><a href="#ThreadLocalæºç åˆ†æ" class="headerlink" title="ThreadLocalæºç åˆ†æ"></a>ThreadLocalæºç åˆ†æ</h4><h5 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h5><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>  <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>  <span class="hljs-comment">//è·å–Thread.threadLocals</span><br>        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>  <span class="hljs-comment">//mapä¸ä¸ºç©ºå°±è®¾å…¥é”®å€¼å¯¹ keyä¸ºå½“å‰ThreadLocalå¯¹è±¡ </span><br>        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)<br>            map.set(<span class="hljs-built_in">this</span>, value);<br>        <span class="hljs-keyword">else</span><br>          <span class="hljs-comment">//å¦åˆ™åˆ›å»ºThread.threadLocals</span><br>            createMap(t, value);<br>    &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°ThreadLocal setçš„æ–¹æ³•æ˜¯å¯¹Thread.threadLocalsè¿™ä¸ªå®šåˆ¶åŒ–çš„Mapè¿›è¡Œæ“ä½œ</p><h6 id="getMap"><a href="#getMap" class="headerlink" title="getMap()"></a>getMap()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadLocalMap <span class="hljs-title function_">getMap</span><span class="hljs-params">(Thread t)</span> &#123;<br>  <span class="hljs-comment">//å°±æ˜¯å–å‡ºThread.threadLocals</span><br>    <span class="hljs-keyword">return</span> t.threadLocals;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="createMap"><a href="#createMap" class="headerlink" title="createMap()"></a>createMap()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> &#123;<br>  <span class="hljs-comment">//ä»¥å½“å‰TreadLocalå¯¹è±¡ä¸ºkey åˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªThread.threadLocals</span><br>    t.threadLocals = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(<span class="hljs-built_in">this</span>, firstValue);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹</span><br>     <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>  <span class="hljs-comment">//è·å–Thread.threadLocals</span><br>     <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>  <span class="hljs-comment">//mapä¸ä¸ºç©º é€šè¿‡å½“å‰å¯¹è±¡ä½œä¸ºkey è·å–å€¼</span><br>     <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>         ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);<br>       <span class="hljs-comment">//mapéƒ¨ä½ç©ºè¿˜å¾—åˆ¤æ–­å½“å‰é”®åœ¨ä¸åœ¨mapé‡Œ</span><br>         <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>             <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>             <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;<br>             <span class="hljs-keyword">return</span> result;<br>         &#125;<br>     &#125;<br>  <span class="hljs-comment">// mapä¸ºç©ºå°±åˆ›å»ºå¹¶åˆå§‹åŒ–</span><br>     <span class="hljs-keyword">return</span> setInitialValue();<br> &#125;<br></code></pre></td></tr></table></figure><h6 id="setInitialValue"><a href="#setInitialValue" class="headerlink" title="setInitialValue()"></a>setInitialValue()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-keyword">private</span> T <span class="hljs-title function_">setInitialValue</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-comment">//åˆå§‹åŒ–valueä¸ºnull</span><br>       <span class="hljs-type">T</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> initialValue();<br>     <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹</span><br>       <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>     <span class="hljs-comment">//è·å–Thread.threadLocals</span><br>       <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>     <span class="hljs-comment">//åˆ¤æ–­mapæ˜¯å¦ä¸ºç©º ä¸ä¸ºç©ºå°±æŠŠ keyä¸ºå½“å‰å¯¹è±¡ valueä¸ºnull è®¾ç½®è¿›map</span><br>       <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)<br>           map.set(<span class="hljs-built_in">this</span>, value);<br>       <span class="hljs-keyword">else</span><br>         <span class="hljs-comment">//å¦åˆ™å°±åˆ›å»ºå¹¶åˆå§‹åŒ–Thread.threadLocals</span><br>           createMap(t, value);<br>       <span class="hljs-keyword">return</span> value;<br>   &#125;<br><br><span class="hljs-keyword">protected</span> T <span class="hljs-title function_">initialValue</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>   &#125;<br></code></pre></td></tr></table></figure><h5 id="remove"><a href="#remove" class="headerlink" title="remove()"></a>remove()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-comment">//åœ¨å½“å‰çº¿ç¨‹é‡Œè·å–Thread.threadLocals</span><br>        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> getMap(Thread.currentThread());<br>        <span class="hljs-keyword">if</span> (m != <span class="hljs-literal">null</span>)<br>           <span class="hljs-comment">//åœ¨mapé‡Œç§»é™¤ ä»¥å½“å‰å¯¹è±¡ä¸ºkeyçš„ é”®å€¼å¯¹</span><br>            m.remove(<span class="hljs-built_in">this</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ThreadLocal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springbooté›†æˆWebSocketå®ç°æ¶ˆæ¯æ¨é€ è®°å½•</title>
    <link href="/2022/06/07/Springboot%E9%9B%86%E6%88%90WebSocket%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81-%E8%AE%B0%E5%BD%95/"/>
    <url>/2022/06/07/Springboot%E9%9B%86%E6%88%90WebSocket%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81-%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯WebSocketï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯WebSocketï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯WebSocketï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯WebSocketï¼Ÿ</h3><p>WebSocketæ˜¯HTML5å¼€å§‹æä¾›çš„ä¸€ç§åœ¨å•ä¸ªTCPè¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šè®¯çš„åè®®ï¼Œèƒ½æ›´å¥½çš„èŠ‚çœæœåŠ¡å™¨èµ„æºå’Œå¸¦å®½ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ›´å®æ—¶åœ°è¿›è¡Œé€šè®¯ã€‚</p><p>WebSocket ä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢å˜å¾—æ›´åŠ ç®€å•ï¼Œå…è®¸æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œåœ¨WebSocket APIä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚â€“æ¥æºè‡ª<a href="https://juejin.cn/post/6844904004762222606?utm_source=gold_browser_extension">https://juejin.cn/post/6844904004762222606?utm_source=gold_browser_extension</a></p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202206071031666.jpeg" alt="img"></p><center><small>(å›¾æºè‡ªç½‘ç»œ)</small></center><h3 id="äºŒã€ä¸springbooté›†æˆ"><a href="#äºŒã€ä¸springbooté›†æˆ" class="headerlink" title="äºŒã€ä¸springbooté›†æˆ"></a>äºŒã€ä¸springbooté›†æˆ</h3><h4 id="å¼•å…¥spring-boot-starter-websocketä¾èµ–"><a href="#å¼•å…¥spring-boot-starter-websocketä¾èµ–" class="headerlink" title="å¼•å…¥spring-boot-starter-websocketä¾èµ–"></a>å¼•å…¥spring-boot-starter-websocketä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;springboot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æ–°å»ºWebSocketHandler"><a href="#æ–°å»ºWebSocketHandler" class="headerlink" title="æ–°å»ºWebSocketHandler"></a>æ–°å»ºWebSocketHandler</h4><p>MercuryWebsocketHandler.class å¯¹è¿æ¥å»ºç«‹å¤„ç†ï¼Œæ¶ˆæ¯å¤„ç†ï¼Œé”™è¯¯å¤„ç†ï¼Œä»¥åŠè¿æ¥å…³é—­å¤„ç†ç­‰ç­‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MercuryWebSocketHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterConnectionEstablished</span><span class="hljs-params">(WebSocketSession webSocketSession)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">wsId</span> <span class="hljs-operator">=</span> WsSessionManager.getWsId(webSocketSession.getUri().getPath());<br>        <span class="hljs-keyword">if</span> (wsId != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// ç”¨æˆ·è¿æ¥æˆåŠŸï¼Œæ”¾å…¥åœ¨çº¿ç”¨æˆ·ç¼“å­˜</span><br>            WsSessionManager.add(wsId, webSocketSession);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ç”¨æˆ·ç™»å½•å·²ç»å¤±æ•ˆ!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(WebSocketSession webSocketSession, WebSocketMessage&lt;?&gt; webSocketMessage)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> webSocketMessage.getPayload().toString();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">wsId</span> <span class="hljs-operator">=</span> WsSessionManager.getWsId(webSocketSession.getUri().getPath());<br>        System.out.println(<span class="hljs-string">&quot;server æ¥æ”¶åˆ° &quot;</span> + wsId + <span class="hljs-string">&quot; å‘é€çš„ &quot;</span> + payload);<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleTransportError</span><span class="hljs-params">(WebSocketSession webSocketSession, Throwable throwable)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        log.error(<span class="hljs-string">&quot;å‘ç”Ÿé”™è¯¯&quot;</span>, throwable);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterConnectionClosed</span><span class="hljs-params">(WebSocketSession webSocketSession, CloseStatus closeStatus)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">wsId</span> <span class="hljs-operator">=</span> WsSessionManager.getWsId(webSocketSession.getUri().getPath());<br>        <span class="hljs-keyword">if</span> (wsId != <span class="hljs-literal">null</span>) &#123;<br>            WsSessionManager.removeAndClose(wsId);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsPartialMessages</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å®ç°WebSocketConfigurer-æ¥å¯¹æ¡æ‰‹å‰åè¿›è¡Œé€»è¾‘å¤„ç†"><a href="#å®ç°WebSocketConfigurer-æ¥å¯¹æ¡æ‰‹å‰åè¿›è¡Œé€»è¾‘å¤„ç†" class="headerlink" title="å®ç°WebSocketConfigurer æ¥å¯¹æ¡æ‰‹å‰åè¿›è¡Œé€»è¾‘å¤„ç†"></a>å®ç°WebSocketConfigurer æ¥å¯¹æ¡æ‰‹å‰åè¿›è¡Œé€»è¾‘å¤„ç†</h4><p>å› ä¸ºæˆ‘éœ€è¦å¯¹websocket æ¡æ‰‹å‰è¿›è¡Œæ ¡éªŒï¼Œæ‰€ä»¥åˆ›å»ºWebSocketHandshakeInterceptor.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketHandshakeInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpSessionHandshakeInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">beforeHandshake</span><span class="hljs-params">(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler webSocketHandler, Map&lt;String, Object&gt; attributes)</span><br>            <span class="hljs-keyword">throws</span> Exception &#123;<br>       <span class="hljs-comment">/**çœç•¥æ ¡éªŒé€»è¾‘ æ ¡éªŒä¸é€šè¿‡ return false**/</span><br>      <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.beforeHandshake(request, response, webSocketHandler, attributes);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterHandshake</span><span class="hljs-params">(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Exception e)</span> &#123;<br>        <span class="hljs-built_in">super</span>.afterHandshake(request, response, wsHandler, e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å®ç°WebSocketConfigurer"><a href="#å®ç°WebSocketConfigurer" class="headerlink" title="å®ç°WebSocketConfigurer"></a>å®ç°WebSocketConfigurer</h4><p>æ–°å»ºwebsocketé…ç½®ç±»ï¼Œæ·»åŠ æ‹¦æˆªåœ°å€ä»¥åŠç›¸åº”çš„websocketæ¶ˆæ¯å¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebSocket</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketServerConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerWebSocketHandlers</span><span class="hljs-params">(WebSocketHandlerRegistry registry)</span> &#123;<br>        <span class="hljs-comment">// æ·»åŠ æ‹¦æˆªåœ°å€ä»¥åŠç›¸åº”çš„websocketæ¶ˆæ¯å¤„ç†å™¨</span><br>        <span class="hljs-type">WebSocketHandlerRegistration</span> <span class="hljs-variable">registration</span> <span class="hljs-operator">=</span> registry<br>                .addHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MercuryWebSocketHandler</span>(), <span class="hljs-string">&quot;/api/websocket/**&quot;</span>)<br>                .setAllowedOrigins(<span class="hljs-string">&quot;*&quot;</span>);<br>        <span class="hljs-comment">// æ·»åŠ æ‹¦æˆªå™¨</span><br>        registration.addInterceptors(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketHandshakeInterceptor</span>());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºWsSessionManagerå­˜å‚¨websocket-session"><a href="#åˆ›å»ºWsSessionManagerå­˜å‚¨websocket-session" class="headerlink" title="åˆ›å»ºWsSessionManagerå­˜å‚¨websocket session"></a>åˆ›å»ºWsSessionManagerå­˜å‚¨websocket session</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WsSessionManager</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ConcurrentHashMap&lt;String, WebSocketSession&gt; SESSION_POOL = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">onlineCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ  session</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wsId</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String wsId, WebSocketSession session)</span> &#123;<br>        addOnlineCount();<br>        SESSION_POOL.put(wsId, session);<br>        log.info(<span class="hljs-string">&quot;æœ‰æ–°çª—å£å¼€å§‹ç›‘å¬:&quot;</span> + wsId + <span class="hljs-string">&quot;,å½“å‰åœ¨çº¿äººæ•°ä¸º:&quot;</span> + getOnlineCount());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤ session,ä¼šè¿”å›åˆ é™¤çš„ session</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wsId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WebSocketSession <span class="hljs-title function_">remove</span><span class="hljs-params">(String wsId)</span> &#123;<br>        <span class="hljs-type">WebSocketSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> SESSION_POOL.remove(wsId);<br>        subOnlineCount();<br>        log.info(<span class="hljs-string">&quot;é‡Šæ”¾çš„wsIdä¸ºï¼š&quot;</span> + wsId);<br>        log.info(<span class="hljs-string">&quot;æœ‰ä¸€è¿æ¥å…³é—­ï¼å½“å‰åœ¨çº¿äººæ•°ä¸º&quot;</span> + getOnlineCount());<br>        <span class="hljs-keyword">return</span> session;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤å¹¶åŒæ­¥å…³é—­è¿æ¥</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wsId</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeAndClose</span><span class="hljs-params">(String wsId)</span> &#123;<br>        <span class="hljs-type">WebSocketSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> remove(wsId);<br>        <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// å…³é—­è¿æ¥</span><br>                session.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                log.error(e.getMessage(),e);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å¾— session</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WebSocketSession <span class="hljs-title function_">get</span><span class="hljs-params">(String wsId)</span> &#123;<br>        <span class="hljs-comment">// è·å¾— session</span><br>        <span class="hljs-keyword">return</span> SESSION_POOL.get(wsId);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å®ç°æœåŠ¡å™¨ä¸»åŠ¨æ¨é€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(String wsId,String message)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        get(wsId).sendMessage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextMessage</span>(message));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * éå¤šæœºéƒ¨ç½²è¯·æ³¨é‡Šæ­¤æ–¹æ³•</span><br><span class="hljs-comment">     * å®ç°æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ ç”¨äºè§£å†³åˆ†å¸ƒå¼websocket sessionä¸å…±äº«çš„é—®é¢˜</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessageBroadcasting</span><span class="hljs-params">(String wsId,String message)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">RocketMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> SpringContextUtils.getBean(RocketMQProducer.class);<br>        <span class="hljs-type">WebSocketMessageSendDto</span> <span class="hljs-variable">webSocketMessageSendDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketMessageSendDto</span>();<br>        webSocketMessageSendDto.setWsId(wsId);<br>        webSocketMessageSendDto.setMessage(message);<br>        producer.sendObject(RocketMqConstant.Topic.MERCURY_WEB_SOCKET_MESSAGE_SEND,webSocketMessageSendDto);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOnlineCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> WsSessionManager.onlineCount.get();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addOnlineCount</span><span class="hljs-params">()</span> &#123;<br>        WsSessionManager.onlineCount.getAndIncrement();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subOnlineCount</span><span class="hljs-params">()</span> &#123;<br>        WsSessionManager.onlineCount.getAndDecrement();<br>    &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * url templateï¼šhttp://localhost/api/websocket/&#123;ws_id&#125;</span><br><span class="hljs-comment">    * éœ€è¦åœ¨urlæå–ws_id</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getWsId</span><span class="hljs-params">(String requestUrl)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        String[] split = requestUrl.split(<span class="hljs-string">&quot;/api/websocket/&quot;</span>);<br>        <span class="hljs-keyword">if</span> (split.length &lt; <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;invalid ws request&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> split[split.length - <span class="hljs-number">1</span>];<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å‘é€æ¶ˆæ¯ç»™å‰ç«¯"><a href="#å‘é€æ¶ˆæ¯ç»™å‰ç«¯" class="headerlink" title="å‘é€æ¶ˆæ¯ç»™å‰ç«¯"></a>å‘é€æ¶ˆæ¯ç»™å‰ç«¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">WsSessionManager.sendMessage(ws_id,message)<br></code></pre></td></tr></table></figure><h3 id="ä¸‰ã€å‰ç«¯Vueä¸websocketé›†æˆ"><a href="#ä¸‰ã€å‰ç«¯Vueä¸websocketé›†æˆ" class="headerlink" title="ä¸‰ã€å‰ç«¯Vueä¸websocketé›†æˆ"></a>ä¸‰ã€å‰ç«¯Vueä¸websocketé›†æˆ</h3><h4 id="æ–°å»ºwebsocket-js"><a href="#æ–°å»ºwebsocket-js" class="headerlink" title="æ–°å»ºwebsocket.js"></a>æ–°å»ºwebsocket.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// import &#123; showInfoMsg, showErrorMsg &#125; from &#x27;@/utils/popInfo&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementUI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">WS_API</span> = <span class="hljs-string">`ws://localhost:8080`</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">initWebSocket</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-string">&#x27;WebSocket&#x27;</span><span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>)) &#123;<br>        <span class="hljs-title class_">ElementUI</span>.<span class="hljs-title class_">Notification</span>(&#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;å½“å‰æµè§ˆå™¨ Not support websocket&#x27;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>            <span class="hljs-attr">duration</span>: <span class="hljs-number">0</span>,<br>        &#125;);<br>    &#125;<br>    <span class="hljs-keyword">const</span> wsUri = <span class="hljs-variable constant_">WS_API</span> + <span class="hljs-string">&#x27;/api/websocket/&#x27;</span> + e;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(wsUri); <span class="hljs-comment">//è¿™é‡Œé¢çš„thiséƒ½æŒ‡å‘vue</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">onerror</span> = webSocketOnError;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">onmessage</span> = webSocketOnMessage;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">onclose</span> = closeWebsocket;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">webSocketOnError</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-comment">// console.log(e)</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)<br>    <span class="hljs-title class_">ElementUI</span>.<span class="hljs-title class_">Notification</span>(&#123;<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;WebSocketè¿æ¥å‘ç”Ÿé”™è¯¯&#x27;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-number">3000</span>,<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">webSocketOnMessage</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(e.<span class="hljs-property">data</span>);<br>  <span class="hljs-title class_">ElementUI</span>.<span class="hljs-title class_">Notification</span>(&#123;<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-attr">message</span>: data.<span class="hljs-property">msg</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;success&#x27;</span>,<br>    <span class="hljs-attr">duration</span>: <span class="hljs-number">5000</span>,<br>  &#125;);<br>&#125;<br><br><span class="hljs-comment">// å…³é—­websiocket</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">closeWebsocket</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¿æ¥å·²å…³é—­...&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">close</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-title function_">close</span>(); <span class="hljs-comment">// å…³é—­ websocket</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">onclose</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e); <span class="hljs-comment">//ç›‘å¬å…³é—­äº‹ä»¶</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;å…³é—­&#x27;</span>);<br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">webSocketSend</span>(<span class="hljs-params">agentData</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">socket</span>.<span class="hljs-title function_">send</span>(agentData);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    initWebSocket,<br>    close,<br>&#125;;<br><br></code></pre></td></tr></table></figure><h4 id="åœ¨main-jså¼•å…¥"><a href="#åœ¨main-jså¼•å…¥" class="headerlink" title="åœ¨main.jså¼•å…¥"></a>åœ¨main.jså¼•å…¥</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> websocket <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;å…·ä½“åœ°å€/websocket&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$websocket</span> = websocket;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨éœ€è¦åˆå§‹åŒ–websocketçš„åœ°æ–¹ï¼Œæˆ‘æ˜¯åœ¨App.vueå…¨å±€mountedä»¥ä¸‹ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">$websocket</span>.<span class="hljs-title function_">initWebSocket</span>(&#123;ws_id&#125;)<span class="hljs-comment">//è¯·æ ¹æ®å…·ä½“é€»è¾‘æ›¿æ¢ws_id æˆ‘è¿™é‡Œå¡«å…¥çš„æ˜¯jwt token</span><br></code></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202206071032239.png" alt="image-20220606183934456"></p><center><small>è¿›å…¥é¡µé¢å°±ä¼šè¿æ¥websocket</small></center><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202206071032020.png" alt="image-20220606183828420"></p><center><small>åç«¯é€šè¿‡è°ƒç”¨WsSessionManager.sendMessage(ws_id,message)å‘é€æ¶ˆæ¯ç»™å…·ä½“ç”¨æˆ·</small></center><h3 id="ä¸‰ã€è§£å†³websocket-sessionåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸å…±äº«é—®é¢˜"><a href="#ä¸‰ã€è§£å†³websocket-sessionåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸å…±äº«é—®é¢˜" class="headerlink" title="ä¸‰ã€è§£å†³websocket sessionåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸å…±äº«é—®é¢˜"></a>ä¸‰ã€è§£å†³websocket sessionåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸å…±äº«é—®é¢˜</h3><p>åœ¨Springæ‰€é›†æˆçš„WebSocketé‡Œé¢ï¼Œæ¯ä¸ªwsè¿æ¥éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„sessionï¼šWebSocketSessionï¼Œåœ¨Spring WebSocketä¸­ï¼Œæˆ‘ä»¬å»ºç«‹wsè¿æ¥ä¹‹åå¯ä»¥é€šè¿‡ç±»ä¼¼è¿™æ ·çš„æ–¹å¼è¿›è¡Œä¸å®¢æˆ·ç«¯çš„é€šä¿¡ã€‚ä½†æ˜¯ wsçš„sessionæ— æ³•åºåˆ—åŒ–åˆ°redisï¼Œ å› æ­¤åœ¨é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬æ— æ³•å°†æ‰€æœ‰WebSocketSessionéƒ½ç¼“å­˜åˆ°redisè¿›è¡Œsessionå…±äº«ã€‚</p><p>æœ¬æ–‡ç®€å•è§£å†³æ–¹æ¡ˆæ€è·¯ï¼šåˆ©ç”¨rocketmqå¹¿æ’­çš„ç‰¹æ€§ä½¿å¾—æ¯ä¸€å°æœºå­éƒ½èƒ½æ‰§è¡Œå‘é€æ¶ˆæ¯çš„åŠ¨ä½œï¼Œè¿™æ ·çš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´æ²¡æœ‰å¯¹åº”webSocketSessionçš„æœºå™¨æ‰§è¡Œä¸€ç›´æ²¡å¿…è¦çš„æ“ä½œï¼Œä½†æ˜¯å› ä¸ºæ ¹æ®é”®å€¼ws_idåœ¨mapä¸­å®šä½sessionï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><h4 id="ç®€å•å®šä¹‰ä¸€ä¸ªæ•°æ®ä¼ è¾“å¯¹è±¡"><a href="#ç®€å•å®šä¹‰ä¸€ä¸ªæ•°æ®ä¼ è¾“å¯¹è±¡" class="headerlink" title="ç®€å•å®šä¹‰ä¸€ä¸ªæ•°æ®ä¼ è¾“å¯¹è±¡"></a>ç®€å•å®šä¹‰ä¸€ä¸ªæ•°æ®ä¼ è¾“å¯¹è±¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketMessageSendDto</span> &#123;<br>    <span class="hljs-keyword">private</span> String wsId;<br>    <span class="hljs-keyword">private</span> String message;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ¶ˆè´¹è€…"><a href="#åˆ›å»ºæ¶ˆè´¹è€…" class="headerlink" title="åˆ›å»ºæ¶ˆè´¹è€…"></a>åˆ›å»ºæ¶ˆè´¹è€…</h4><p>é‡ç‚¹ï¼šmessageModel &#x3D; MessageModel.BROADCASTING</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@RocketMQMessageListener(topic = RocketMqConstant.Topic.MERCURY_WEB_SOCKET_MESSAGE_SEND</span><br><span class="hljs-meta">        , consumerGroup = RocketMqConstant.ComsumerGroup.MERCURY_WEB_SOCKET_MESSAGE_SEND,</span><br><span class="hljs-meta">        messageModel = MessageModel.BROADCASTING)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketMessageSendConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;WebSocketMessageSendDto&gt;, RocketMQPushConsumerLifecycleListener &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(WebSocketMessageSendDto dto)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;WebSocketMessageSendConsumer æ¥æ”¶åˆ°ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>,JSON.toJSONString(dto));<br>        <span class="hljs-keyword">try</span> &#123;<br>            WsSessionManager.sendMessage(dto.getWsId(),dto.getMessage());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(e.getMessage(),e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareStart</span><span class="hljs-params">(DefaultMQPushConsumer consumer)</span> &#123;<br>        consumer.setMaxReconsumeTimes(<span class="hljs-number">2</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#æ¶ˆæ¯ç”Ÿäº§è€…" class="headerlink" title="æ¶ˆæ¯ç”Ÿäº§è€…"></a>æ¶ˆæ¯ç”Ÿäº§è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * å®ç°æœåŠ¡å™¨ä¸»åŠ¨æ¨é€</span><br><span class="hljs-comment">  */</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessageBroadcasting</span><span class="hljs-params">(String wsId,String message)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>     <span class="hljs-type">RocketMQTemplate</span> <span class="hljs-variable">rocketMQTemplate</span> <span class="hljs-operator">=</span> SpringContextUtils.getBean(RocketMQTemplate.class);<br>     <span class="hljs-type">WebSocketMessageSendDto</span> <span class="hljs-variable">webSocketMessageSendDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketMessageSendDto</span>();<br>     webSocketMessageSendDto.setWsId(wsId);<br>     webSocketMessageSendDto.setMessage(message);<br>   rocketMQTemplate.convertAndSend(RocketMqConstant.Topic.MERCURY_WEB_SOCKET_MESSAGE_SEND, JSON.toJSONString(webSocketMessageSendDto))<br> &#125;<br>  <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WebSocket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åº—åŒ æ’ä»¶å¼€å‘-åˆ›å»ºåº—åŒ åº”ç”¨</title>
    <link href="/2022/05/09/%E5%BA%97%E5%8C%A0%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91-%E5%88%9B%E5%BB%BA%E5%BA%97%E5%8C%A0%E5%BA%94%E7%94%A8/"/>
    <url>/2022/05/09/%E5%BA%97%E5%8C%A0%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91-%E5%88%9B%E5%BB%BA%E5%BA%97%E5%8C%A0%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>å› ä¸ºå…¬å¸æœ€è¿‘æœ‰éœ€æ±‚éœ€è¦å¼€å‘å•†å“æ‰¹é‡å¯¼å…¥åˆ°åº—åŒ ï¼Œæ‰€ä»¥ç®€å•è®°å½•ä¸€ä¸‹æ“ä½œè¿‡ç¨‹</p><h3 id="åˆ›å»ºåº—åŒ ç§æœ‰App"><a href="#åˆ›å»ºåº—åŒ ç§æœ‰App" class="headerlink" title="åˆ›å»ºåº—åŒ ç§æœ‰App"></a>åˆ›å»ºåº—åŒ ç§æœ‰App</h3><p>åº—åŒ å®˜ç½‘ï¼š<a href="https://promo.shoplazza.cn/">https://promo.shoplazza.cn</a></p><p>å®˜æ–¹æ•™ç¨‹ï¼š<a href="https://www.shoplazza.dev/reference">https://www.shoplazza.dev/reference</a></p><blockquote><p>åˆ›å»ºåº—é“ºè¿‡ç¨‹å¿½ç•¥</p></blockquote><p>è¿›å…¥åº—é“º&gt;Apps&gt;ç®¡ç†ç§æœ‰App&gt;åˆ›å»ºåº”ç”¨</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205091923902.png" alt="image-20220509151049132"></p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205091920237.png" alt="image-20220509192015711"></p><p>å¡«å…¥åº”ç”¨åç§°ï¼Œå¼€å‘è€…é‚®ç®±ï¼Œç„¶åæŒ‰éœ€é€‰æ‹©æ¥å£è°ƒç”¨æƒé™</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205091923235.png" alt="image-20220509151137589"></p><p>åˆ›å»ºappæˆåŠŸåå³å¯è·å¾—Tokenã€App UIDã€App Secretï¼Œåç»­å¼€å‘ä¼šç”¨åˆ°</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205091924048.png" alt="image-20220509151302132"></p><h3 id="ä½¿ç”¨Postmanè°ƒè¯•"><a href="#ä½¿ç”¨Postmanè°ƒè¯•" class="headerlink" title="ä½¿ç”¨Postmanè°ƒè¯•"></a>ä½¿ç”¨Postmanè°ƒè¯•</h3><p>ä½¿ç”¨Tokenå’Œå®˜æ–¹æä¾›çš„APIè¿›è¡Œæ¥å£è°ƒè¯•</p><p>å¡«å…¥token å¤åˆ¶CURLè¯­å¥</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205091919133.png" alt="image-20220509191946173"></p><p>ç²˜è´´åˆ°postmanè¿›è¡Œè°ƒè¯•</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205091924847.png" alt="image-20220509191446157"></p><p>æœ‰è¿”å›å€¼ä¸”çŠ¶æ€ç ä¸º200è¡¨ç¤ºæµ‹è¯•æˆåŠŸ</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205091924934.png" alt="image-20220509191601006"></p><blockquote><p>æ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®å¯¹åº”æ¥å£è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘å•¦ï¼Œåç»­æ˜¯å…¬å¸å®šåˆ¶åŒ–ä»£ç å°±ä¸å±•ç¤ºä¸Šæ¥äº†</p></blockquote><h3 id="åˆ›å»ºåº—åŒ å…¬æœ‰App"><a href="#åˆ›å»ºåº—åŒ å…¬æœ‰App" class="headerlink" title="åˆ›å»ºåº—åŒ å…¬æœ‰App"></a>åˆ›å»ºåº—åŒ å…¬æœ‰App</h3><h4 id="æ³¨å†Œè´¦å·"><a href="#æ³¨å†Œè´¦å·" class="headerlink" title="æ³¨å†Œè´¦å·"></a>æ³¨å†Œè´¦å·</h4><p>å®˜ç½‘ï¼š<a href="https://partners.shoplazza.com/">https://partners.shoplazza.com/</a></p><h4 id="åˆ›å»ºåº”ç”¨"><a href="#åˆ›å»ºåº”ç”¨" class="headerlink" title="åˆ›å»ºåº”ç”¨"></a>åˆ›å»ºåº”ç”¨</h4><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205092121186.png" alt="image-20220509212114676"></p><table><thead><tr><th align="left"><strong>App URL</strong></th><th align="left">Appâ€™s main service URL</th><th align="left">åœ¨åº”ç”¨ç¨‹åºå®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚ å½“å•†å®¶å®‰è£…æ‚¨çš„åº”ç”¨æˆ–è¿›å…¥è¯¥åº”ç”¨æ—¶ï¼Œæ‚¨çš„åº”ç”¨ä¼šæ”¶åˆ°å¯¹è¯¥åº”ç”¨ URL çš„ GET è¯·æ±‚ã€‚ æ‚¨çš„åº”ç”¨åœ¨æ”¶åˆ° GET è¯·æ±‚åéœ€è¦å¯åŠ¨ OAuth æµç¨‹æ¥å®‰è£…åº”ç”¨ï¼Œæ— è®ºåº”ç”¨å®‰è£…è¿‡ç¨‹æ˜¯ä» Shoplaza åº”ç”¨å•†åº—çš„â€œæ·»åŠ åº”ç”¨â€å¼€å§‹ï¼Œè¿˜æ˜¯ä»åˆä½œä¼™ä¼´ä¸­å¿ƒä»ªè¡¨æ¿çš„â€œå®‰è£…åº”ç”¨â€å¼€å§‹ã€‚â€“è°·æ­Œç¿»è¯‘</th></tr></thead><tbody><tr><td align="left"><strong>Redirect URL</strong></td><td align="left">Appâ€™s redirect URL</td><td align="left">åœ¨åº”ç”¨ç¨‹åºå®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚ å•†æˆ·åœ¨ OAuth è¿‡ç¨‹ä¸­æˆäºˆæƒé™åï¼Œå•†æˆ·å°†è¢«é‡å®šå‘åˆ°å¸¦æœ‰ OAuth ä»£ç å’Œå…¶ä»–å­—æ®µçš„é‡å®šå‘ URLã€‚â€“è°·æ­Œç¿»è¯‘</td></tr></tbody></table><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205092121847.png" alt="image-20220509212107975"></p><h4 id="æˆæƒæµç¨‹"><a href="#æˆæƒæµç¨‹" class="headerlink" title="æˆæƒæµç¨‹"></a>æˆæƒæµç¨‹</h4><blockquote><p> ä»¥ä¸‹å¤§éƒ¨åˆ†å†…å®¹æ˜¯ç›´æ¥è°·æ­Œç¿»è¯‘è‡ªåº—åŒ å®˜æ–¹</p></blockquote><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205092153822.png" alt="img"></p><center><small>åŸºäºå•†å®¶ã€æ‚¨çš„åº”ç”¨å’Œ Shoplaza çš„æ“ä½œçš„ OAuth æµç¨‹-å›¾æºæ¥è‡ªåº—åŒ å®˜ç½‘</small></center><ol><li>å•†å®¶å‘å‡ºå®‰è£…åº”ç”¨ç¨‹åºçš„è¯·æ±‚ã€‚</li><li>åº”ç”¨é‡å®šå‘åˆ°Shoplazza Storeçš„åº”ç”¨å®‰è£…é¡µé¢ï¼Œè¯·æ±‚å•†å®¶æˆæƒã€‚</li><li>Shoplazza å•†åº—çš„åº”ç”¨å®‰è£…é¡µé¢æç¤º OAuth æˆæƒå±å¹•å¹¶è¯·æ±‚å•†å®¶æˆæƒæ‰€éœ€çš„èŒƒå›´ã€‚</li><li>å•†å®¶é€šè¿‡åŒæ„åº”ç”¨è¯·æ±‚çš„æƒé™æ¥æˆæƒåº”ç”¨ã€‚</li><li>è¯¥åº”ç”¨ç¨‹åºæ”¶åˆ°ä¸€ä¸ªæˆæƒä»£ç ã€‚</li><li>è¯¥åº”ç”¨ç¨‹åºé€šè¿‡ä½¿ç”¨æˆæƒä»£ç å‘ Shoplazza Store å‘é€è¯·æ±‚æ¥è¯·æ±‚è®¿é—®ä»¤ç‰Œã€‚</li><li>Shoplazza å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒéªŒè¯æˆæƒä»£ç ï¼Œç„¶åå‘å‡ºå¹¶è¿”å›è®¿é—®ä»¤ç‰Œã€‚è¯¥åº”ç”¨ç¨‹åºç°åœ¨å¯ä»¥ä» Shoplazza è¯·æ±‚æ•°æ®ã€‚</li><li>è¯¥åº”ç”¨ç¨‹åºä½¿ç”¨è®¿é—®ä»¤ç‰Œå‘<a href="https://www.shoplazza.dev/reference/overview">Shoplazza Open API</a>å‘å‡ºè¯·æ±‚ã€‚</li><li>Shoplazza éªŒè¯è®¿é—®ä»¤ç‰Œå¹¶è¿”å›è¯·æ±‚çš„æ•°æ®ã€‚</li></ol><h5 id="OAuthæˆæƒæµç¨‹çš„æ­¥éª¤"><a href="#OAuthæˆæƒæµç¨‹çš„æ­¥éª¤" class="headerlink" title="OAuthæˆæƒæµç¨‹çš„æ­¥éª¤"></a>OAuthæˆæƒæµç¨‹çš„æ­¥éª¤</h5><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205092153672.png" alt="img"></p><center><small>OAuthæˆæƒæµç¨‹-å›¾æºæ¥è‡ªåº—åŒ å®˜ç½‘</small></center><blockquote><p> PHPå’ŒGOå¯ä»¥ä½¿ç”¨å®˜ç½‘çš„SDKè¿›è¡Œæˆæƒç¬¬äºŒæ­¥ï¼Œè‡ªè¡Œå°è¯•</p></blockquote><h5 id="Javaå¯¹æ¥åº—åŒ OAuthæˆæƒæµç¨‹"><a href="#Javaå¯¹æ¥åº—åŒ OAuthæˆæƒæµç¨‹" class="headerlink" title="Javaå¯¹æ¥åº—åŒ OAuthæˆæƒæµç¨‹"></a>Javaå¯¹æ¥åº—åŒ OAuthæˆæƒæµç¨‹</h5>]]></content>
    
    
    <categories>
      
      <category>å¤–è´¸ç”µå•†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åº—åŒ </tag>
      
      <tag>å¤–è´¸ç”µå•†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®© Google æ”¶å½•åšå®¢</title>
    <link href="/2022/05/08/%E8%AE%A9google-%E6%94%B6%E5%BD%95%E5%8D%9A%E5%AE%A2/"/>
    <url>/2022/05/08/%E8%AE%A9google-%E6%94%B6%E5%BD%95%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ³¨æ„ï¼šæœ¬æ–‡ä»¥Fluidä¸»é¢˜å½“ç¤ºä¾‹æ¥ä»‹ç»</p></blockquote><h3 id="Google-Search-Consoleé…ç½®"><a href="#Google-Search-Consoleé…ç½®" class="headerlink" title="Google Search Consoleé…ç½®"></a>Google Search Consoleé…ç½®</h3><p>è¿›å…¥ç½‘å€<a href="https://search.google.com/search-console">https://search.google.com/search-console</a></p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081849682.png" alt="image-20220508183546777" /><p>æˆ‘é€‰æ‹©çš„æ˜¯&lt;ç½‘å€å‰ç¼€&gt; è¾“å…¥ç½‘å€åæç¤º</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081849684.png" alt="image-20220508183818914"></p><p>æˆ‘é€‰æ‹©çš„æ˜¯HTMLæ ‡è¯†éªŒè¯ æŠŠå…ƒæ ‡è®°å¤åˆ¶æ·»åŠ åˆ°hexoé…ç½®</p><h3 id="Hexoé…ç½®"><a href="#Hexoé…ç½®" class="headerlink" title="Hexoé…ç½®"></a>Hexoé…ç½®</h3><p>å› ä¸ºä¸Šæ–‡ä¸­å·²ä½¿ç”¨è¦†ç›–é…ç½®çš„æ–¹å¼ä½¿<strong>ä¸»é¢˜é…ç½®</strong>æ”¾ç½®åœ¨ &lt;ä¸»é¢˜&gt; ç›®å½•ä¹‹å¤–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨hexoæ ¹ç›®å½•ä¸‹ä¿®æ”¹_config.&lt;ä¸»é¢˜åç§°&gt;.ymlå³å¯</p><p>æˆ‘è¿™é‡Œæ˜¯_config.fluid.ymlï¼Œå…¨å±€æœç´¢commentæ‰¾åˆ°ä»¥ä¸‹å†…å®¹æ·»åŠ googleæä¾›çš„meta</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081849685.png" alt="image-20220508183318695"></p><p>æ·»åŠ æˆåŠŸå¹¶Hexoéƒ¨ç½²</p><p>ç„¶åå†å›åˆ°Google Search Consoleç‚¹å‡»éªŒè¯ï¼Œæ˜¾ç¤ºè¿™ä¸ªä»£è¡¨é…ç½®æˆåŠŸ</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081849686.png" alt="image-20220508183634549"></p><h3 id="Google-Search-Console-è¯·æ±‚ç¼–å…¥ç´¢å¼•"><a href="#Google-Search-Console-è¯·æ±‚ç¼–å…¥ç´¢å¼•" class="headerlink" title="Google Search Console è¯·æ±‚ç¼–å…¥ç´¢å¼•"></a>Google Search Console è¯·æ±‚ç¼–å…¥ç´¢å¼•</h3><p>ç™»å½•ä½ çš„ <a href="https://search.google.com/search-console/about">Google search console</a>ï¼Œç™»é™†ååœ¨æ§åˆ¶å°ç‚¹å‡»ç½‘å€æ£€æŸ¥ã€‚</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081849687.png" alt="image-20220508184304499"></p><p>ç‚¹å‡»è¯·æ±‚ç¼–å…¥ç´¢å¼•ï¼Œè€å¿ƒç­‰å¾…</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081849688.png" alt="image-20220508184322245"></p><p>æ˜¾ç¤ºä»¥ä¸‹å†…å®¹è¡¨ç¤ºç¼–å…¥ç´¢å¼•æˆåŠŸ</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081849689.png" alt="image-20220508184351161"></p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo é…ç½®è¯„è®ºåŠŸèƒ½</title>
    <link href="/2022/05/08/Hexo-%E9%85%8D%E7%BD%AE%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/"/>
    <url>/2022/05/08/Hexo-%E9%85%8D%E7%BD%AE%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ³¨æ„ï¼šæœ¬æ–‡ä»¥Fluidä¸»é¢˜å½“ç¤ºä¾‹æ¥ä»‹ç»å¦‚ä½•é…ç½®è¯„è®ºï¼Œå…¶ä»–ä¸»é¢˜è¯·æ ¹æ®å¯¹åº”ç”¨æˆ·æ‰‹å†Œé…ç½®</p></blockquote><p>æˆ‘æ˜¯ç”¨çš„ä¸»é¢˜Fluidæ”¯æŒå¤šç§è¯„è®ºæ’ä»¶ï¼Œutterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | </p><p>cusdisï¼Œæ¯ç§æ’ä»¶æœ‰ä¸åŒçš„é…ç½®æ–¹æ³•ï¼Œä¸ºäº†å’Œè¯„è®ºç”¨æˆ·æœ‰çœŸå®åé¦ˆã€é•¿ä¹…çš„äº¤äº’å’Œå°½å¯èƒ½ç®€å•é…ç½®æˆ‘è¿™é‡Œé€‰æ‹©äº†åŸºäº GitHub Issueså®ç°çš„utterances</p><h3 id="æ–°å»ºgithubä»“åº“"><a href="#æ–°å»ºgithubä»“åº“" class="headerlink" title="æ–°å»ºgithubä»“åº“"></a>æ–°å»ºgithubä»“åº“</h3><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081715639.png" alt="image-20220508171452067"></p><p>ï¼ˆæˆ‘è¿™é‡Œå·²ç»åˆ›å»ºè¿‡äº†ï¼Œæ‰€ä»¥æ˜¾ç¤ºæŠ¥é”™ï¼‰</p><h3 id="github-Install-utterances-app"><a href="#github-Install-utterances-app" class="headerlink" title="github Install utterances app"></a>github Install utterances app</h3><p>utteranceså®˜ç½‘ï¼š<a href="https://utteranc.es/">https://utteranc.es/</a></p><p>ç‚¹å‡»æ­¤é“¾æ¥githubå®‰è£…<a href="https://github.com/apps/utterances">utterances app</a>ã€‚</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081720238.png" alt="image-20220508172011715"></p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081730113.png" alt="image-20220508172028588"></p><h3 id="Hexoé…ç½®"><a href="#Hexoé…ç½®" class="headerlink" title="Hexoé…ç½®"></a>Hexoé…ç½®</h3><p>å› ä¸ºä¸Šæ–‡ä¸­å·²ä½¿ç”¨è¦†ç›–é…ç½®çš„æ–¹å¼ä½¿<strong>ä¸»é¢˜é…ç½®</strong>æ”¾ç½®åœ¨ &lt;ä¸»é¢˜&gt; ç›®å½•ä¹‹å¤–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨hexoæ ¹ç›®å½•ä¸‹ä¿®æ”¹_config.&lt;ä¸»é¢˜åç§°&gt;.ymlå³å¯</p><p>æˆ‘è¿™é‡Œæ˜¯_config.fluid.ymlï¼Œå…¨å±€æœç´¢commentæ‰¾åˆ°ä»¥ä¸‹å†…å®¹å¼€å¯è¯„è®ºå¹¶ä½¿ç”¨utterancesæ’ä»¶ ä¿®æ”¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># è¯„è®ºæ’ä»¶</span><br><span class="hljs-comment"># Comment plugin</span><br><span class="hljs-attr">comments:</span><br><span class="hljs-comment">#å¼€å¯è¯„è®ºæ’ä»¶</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># æŒ‡å®šçš„æ’ä»¶ï¼Œéœ€è¦åŒæ—¶è®¾ç½®å¯¹åº”æ’ä»¶çš„å¿…è¦å‚æ•°</span><br>  <span class="hljs-comment"># The specified plugin needs to set the necessary parameters at the same time</span><br>  <span class="hljs-comment"># Options: utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | cusdis</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">utterances</span><br></code></pre></td></tr></table></figure><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081730114.png" alt="image-20220508170721628"></p><p>é…ç½®utterancesæ’ä»¶ åœ¨_config.fluid.ymlæ–‡ä»¶å…¨å±€æœç´¢utterancesæ‰¾åˆ°ä»¥ä¸‹å†…å®¹ä¿®æ”¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Utterances</span><br><span class="hljs-comment"># åŸºäº GitHub Issues</span><br><span class="hljs-comment"># Based on GitHub Issues</span><br><span class="hljs-comment"># See: https://utteranc.es</span><br><span class="hljs-attr">utterances:</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">repoä»“åº“</span><br>  <span class="hljs-attr">issue_term:</span> <span class="hljs-string">pathname</span><br>  <span class="hljs-attr">label:</span> <span class="hljs-string">utterances</span><br>  <span class="hljs-attr">theme:</span> <span class="hljs-string">github-light</span><br>  <span class="hljs-attr">theme_dark:</span> <span class="hljs-string">github-dark</span><br>  <span class="hljs-attr">crossorigin:</span> <span class="hljs-string">anonymous</span><br></code></pre></td></tr></table></figure><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>æ‰“å¼€ä½ çš„åšå®¢æ–‡ç«  çœ‹åˆ°ä»¥ä¸‹å†…å®¹ å³ä¸ºé…ç½®æˆåŠŸ</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081730181.png" alt="image-20220508172837182"></p><p>æ³¨ï¼šå¦‚æœæœ‰äº›é¡µé¢æ²¡æœ‰å‡ºç°æ­¤è¯„è®ºæ’ä»¶å¯ä»¥åœ¨æ–‡ç« å¼€å¤´æ‰‹åŠ¨æ‰“å¼€</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081729044.png" alt="image-20220508172937108"></p><p>ä¸€æ—¦æœ‰è¯„è®ºæˆ‘å°±ä¼šç¬¬ä¸€æ—¶é—´æ”¶åˆ°é‚®ä»¶å•¦ï¼Œæˆ‘å°±ä¼šåœ¨ç¬¬ä¸€æ—¶é—´å›å¤å•¦ğŸ¤ªï¼Œæ¬¢è¿è¯„è®º</p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081734441.png" alt="image-20220508173435809" />]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo æ­å»ºåšå®¢Blogè®°å½•</title>
    <link href="/2022/05/07/Hexo%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2Blog%E8%AE%B0%E5%BD%95/"/>
    <url>/2022/05/07/Hexo%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2Blog%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p><strong>æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç«  è®°å½•ä¸€ä¸‹åšå®¢æ­å»ºè¿‡ç¨‹</strong></p><center><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/202205081923624.jpg" alt="GitHub+Hexo æ­å»ºä¸ªäººç½‘ç«™è¯¦ç»†æ•™ç¨‹" style="width:100%;"/></center><center><small><font color="gray">(æ­¤å›¾æ¥æºäºç½‘ç»œ)</font></small></center><h4 id="Hexoä»‹ç»"><a href="#Hexoä»‹ç»" class="headerlink" title="Hexoä»‹ç»"></a>Hexoä»‹ç»</h4><p>Hexoå®˜ç½‘åœ°å€ &gt; <a href="https://hexo.io/">https://hexo.io/</a></p><blockquote><p>What is Hexo?</p><p>Hexo is a fast, simple and powerful blog framework. You write posts in <a href="http://daringfireball.net/projects/markdown/">Markdown</a> (or other markup languages) and Hexo generates static files with a beautiful theme in seconds.â€”å¼•ç”¨è‡ªå®˜ç½‘</p></blockquote><p>Hexoæ˜¯ä»€ä¹ˆï¼Ÿ Hexoæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€å•ä¸”åŠŸèƒ½å¼ºå¤§çš„åšå®¢æ¡†æ¶ã€‚ä½ ç”¨Markdownï¼ˆæˆ–å…¶ä»–æ ‡è®°è¯­è¨€ï¼‰å†™æ–‡ç« ï¼ŒHexoä¼šåœ¨å‡ ç§’é’Ÿå†…ç”Ÿæˆå¸¦æœ‰æ¼‚äº®ä¸»é¢˜çš„é™æ€æ–‡ä»¶ã€‚</p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/image-20220507225447240.png" alt="image-20220507225447240"></p><p>æ³¨ï¼šæœ¬æ–‡å®‰è£…æ•™ç¨‹é’ˆå¯¹ Macç³»ç»Ÿï¼Œéƒ¨åˆ†å‘½ä»¤ä¸é€‚ç”¨äºWindows</p><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><ul><li><p><a href="http://nodejs.org/">Node.js</a> (Should be at least Node.js 10.13, recommends 12.0 or higher)</p><p><code>brew install node</code></p><blockquote><p>å®˜ç½‘ï¼š</p><ul><li>Windows: Download &amp; install <a href="https://git-scm.com/download/win">git</a>.</li><li>Mac: Install it with <a href="https://brew.sh/">Homebrew</a>, <a href="http://www.macports.org/">MacPorts</a> or <a href="http://sourceforge.net/projects/git-osx-installer/">installer</a>.</li><li>Linux (Ubuntu, Debian): <code>sudo apt-get install git-core</code></li><li>Linux (Fedora, Red Hat, CentOS): <code>sudo yum install git-core</code></li></ul></blockquote></li><li><p><a href="http://git-scm.com/">Git</a></p><p><code>brew install git</code></p><blockquote><p>å®˜ç½‘ï¼š</p><ul><li>Windows: Install it with <a href="https://github.com/jasongin/nvs/">nvs</a> (recommended) or <a href="https://github.com/nvm-sh/nvm">nvm</a>.</li><li>Mac: Install it with <a href="https://brew.sh/">Homebrew</a> or <a href="http://www.macports.org/">MacPorts</a>.</li><li>Linux (DEB&#x2F;RPM-based): Install it with <a href="https://github.com/nodesource/distributions">NodeSource</a>.</li><li>Others: Install it through respective package manager. Refer to <a href="https://nodejs.org/en/download/package-manager/">the guide</a> provided by Node.js.</li></ul></blockquote></li></ul><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p><code>npm install hexo-cli -g </code></p><p><code>hexo init blog </code></p><p><code>cd blog </code></p><p><code>npm install</code></p><h4 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p><code>hexo server</code></p><p>æ˜¾ç¤ºä»¥ä¸‹å†…å®¹ä¸ºå¯åŠ¨æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/CasonMo/pic-go/master/img/image-20231208170516196.png" alt="image-20231208170516196"></p><p>è®¿é—®<a href="http://localhost:4000/">http://localhost:4000/</a> å³å¯è¿›å…¥ä½ çš„åšå®¢</p><h4 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h4><p>ä¸»é¢˜åœ°å€ï¼š<a href="https://hexo.io/themes/">https://hexo.io/themes/</a></p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/image-20220507233206084.png" alt="image-20220507233206084"></p><p>æŒ‘é€‰å–œæ¬¢çš„ä¸»é¢˜ ç‚¹å‡»è¿›å…¥githubåœ°å€</p><p>åœ¨åˆå§‹åŒ–çš„hexoç›®å½•ä¸‹æ‰§è¡Œgit clone åˆ°themeä¸‹æŒ‡å®šç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs git">git clone https://github.com/fluid-dev/hexo-theme-fluid.git themes/fluid<br></code></pre></td></tr></table></figure><p>ä¸»é¢˜éƒ½ä¼šæœ‰è‡ªå·±çš„ç”¨æˆ·æ‰‹å†Œ æˆ‘ç”¨çš„æ˜¯Fluidä¸»é¢˜ ç”¨æˆ·æ‰‹å†Œï¼š<a href="https://hexo.fluid-dev.com/docs/start">https://hexo.fluid-dev.com/docs/start</a></p><p>ä¸»é¢˜è·Ÿè¿™ä¸ªç”¨æˆ·æ‰‹å†Œé…ç½®å°±å¥½äº† æˆ‘è¿™é‡Œå°±ä¸èµ˜è¿°äº†</p><h4 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h4><blockquote><p> è¯¦ç»†ä½¿ç”¨æ•™ç¨‹ <a href="https://hexo.io/zh-cn/docs/">https://hexo.io/zh-cn/docs/</a></p></blockquote><ul><li>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ–°å»ºæ–‡ç« </li></ul><p><code>hexo new &quot;&lt;æ–‡ç« åç§°&gt;&quot;</code></p><ul><li><p>ç„¶åcd &lt;hexoç›®å½•&gt;&#x2F;source&#x2F;_posts å°±å¯ä»¥ç”¨markdownè¯­å¥ç¼–è¾‘æ–‡æ¡£</p></li><li><p>å¯ä»¥åœ¨æ–‡ä»¶é¡¶éƒ¨é€šè¿‡tags ä¿®æ”¹æ ‡ç­¾ ã€é€šè¿‡categoriesä¿®æ”¹åˆ†ç±»ã€é€šè¿‡hideéšè—æ–‡ç« ã€é€šè¿‡archiveså½’æ¡£</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">æ­å»ºåšå®¢Blogè®°å½•</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2022-05-07 17:44:14</span><br><span class="hljs-attr">hide:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">archives:</span> <span class="hljs-string">/archives</span><br><span class="hljs-attr">tags:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">first</span> <span class="hljs-string">tags</span><br><span class="hljs-attr">categories:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">first</span> <span class="hljs-string">categories</span><br><span class="hljs-meta">---</span><br><span class="hljs-string">&lt;æ­£æ–‡å†…å®¹&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/image-20220508045636333.png" alt="image-20220508045636333"></p><p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/image-20220508045657889.png" alt="image-20220508045657889"></p><h4 id="å…³äºéƒ¨ç½²"><a href="#å…³äºéƒ¨ç½²" class="headerlink" title="å…³äºéƒ¨ç½²"></a>å…³äºéƒ¨ç½²</h4><blockquote><p>Hexo æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ å…·ä½“å¯åˆ°å®˜ç½‘æŸ¥çœ‹ï¼š<a href="https://hexo.io/zh-cn/docs/one-command-deployment">https://hexo.io/zh-cn/docs/one-command-deployment</a></p></blockquote><h5 id="æ–°å»ºgithubä»“åº“"><a href="#æ–°å»ºgithubä»“åº“" class="headerlink" title="æ–°å»ºgithubä»“åº“"></a>æ–°å»ºgithubä»“åº“</h5><p>æ³¨æ„ï¼šå›ºå®šåç§°&lt;ç”¨æˆ·å&gt;.github.io</p><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/image-20220508050126798.png" alt="Â·" style="zoom:50%;" /><h5 id="å…³è”gitä»“åº“å’ŒHexo"><a href="#å…³è”gitä»“åº“å’ŒHexo" class="headerlink" title="å…³è”gitä»“åº“å’ŒHexo"></a>å…³è”gitä»“åº“å’ŒHexo</h5><p>åœ¨ä½ åˆå§‹åŒ–Hexoçš„æ ¹ç›®å½• ä¿®æ”¹_config.yml åœ¨#Deploymentä¸‹æ·»åŠ ä»¥ä¸‹å†…å®¹ æ³¨æ„ç©ºæ ¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">deploy:</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br><span class="hljs-attr">repo:</span> <span class="hljs-string">ä»“åº“åœ°å€</span><br><span class="hljs-attr">branch:</span> <span class="hljs-string">åˆ†æ”¯</span><br></code></pre></td></tr></table></figure><h5 id="å®‰è£…éƒ¨ç½²æ’ä»¶"><a href="#å®‰è£…éƒ¨ç½²æ’ä»¶" class="headerlink" title="å®‰è£…éƒ¨ç½²æ’ä»¶"></a>å®‰è£…éƒ¨ç½²æ’ä»¶</h5><p><code>npm install hexo-deployer-git --save</code></p><h5 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h5><p><code>hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</code></p><p>å¯ç®€å†™ä¸º</p><p><code>hexo clean &amp;&amp; hexo g -d</code></p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><ul><li><p>è¦†ç›–é…ç½®å¯ä»¥ä½¿<strong>ä¸»é¢˜é…ç½®</strong>æ”¾ç½®åœ¨ fluid ç›®å½•ä¹‹å¤–ï¼Œé¿å…åœ¨æ›´æ–°ä¸»é¢˜æ—¶ä¸¢å¤±è‡ªå®šä¹‰çš„é…ç½®ã€‚</p><p>åœ¨åšå®¢ç›®å½•ä¸‹åˆ›å»º <code>_config.&lt;ä¸»é¢˜åç§°&gt;.yml</code> æ–‡ä»¶ï¼Œå°†ä¸»é¢˜çš„ <a href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml">_config.yml (opens new window)</a>å…¨éƒ¨é…ç½®ï¼ˆæˆ–éƒ¨åˆ†é…ç½®ï¼‰å¤åˆ¶è¿‡å»ã€‚</p><p>ä»¥åå¦‚æœä¿®æ”¹ä»»ä½•ä¸»é¢˜é…ç½®ï¼Œéƒ½åªéœ€ä¿®æ”¹ <code>_config.&lt;ä¸»é¢˜åç§°&gt;.yml</code> çš„é…ç½®å³å¯ã€‚</p><p><left><img src="https://picgo-1258041929.cos.ap-guangzhou.myqcloud.com/img/image-20220508154920223.png" alt="image-20220508154920223"  /></left></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
